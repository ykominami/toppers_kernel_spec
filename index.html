<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>TOPPERS新世代カーネル統合仕様書</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>TOPPERS新世代カーネル統合仕様書</h1>
<div id="toc" class="toc2">
<div id="toctitle">目次</div>
<ul class="sectlevel1">
<li><a href="#_仕様書で用いる記述項目と記号">仕様書で用いる記述項目と記号</a></li>
<li><a href="#_タグの付与方法">タグの付与方法</a></li>
<li><a href="#ch1_summary_of_toppers_kernel">1. TOPPERS新世代カーネルの概要</a>
<ul class="sectlevel2">
<li><a href="#_toppers新世代カーネル仕様の位置付け">1.1. TOPPERS新世代カーネル仕様の位置付け</a></li>
<li><a href="#_toppers新世代カーネル仕様の設計方針">1.2. TOPPERS新世代カーネル仕様の設計方針</a></li>
<li><a href="#_toppers_aspカーネルの適用対象領域と仕様設計方針">1.3. TOPPERS/ASPカーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_toppers_fmpカーネルの適用対象領域と仕様設計方針">1.4. TOPPERS/FMPカーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_toppers_hrp2カーネルの適用対象領域と仕様設計方針">1.5. TOPPERS/HRP2カーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_toppers_sspカーネルの適用対象領域と仕様設計方針">1.6. TOPPERS/SSPカーネルの適用対象領域と仕様設計方針</a></li>
<li><a href="#_toppers_asp_safetyカーネルの適用対象領域と仕様設計方針">1.7. TOPPERS/ASP Safetyカーネルの適用対象領域と仕様設計方針</a></li>
</ul>
</li>
<li><a href="#ch2_concepts_and_Common_definision">2. 主要な概念と共通定義</a>
<ul class="sectlevel2">
<li><a href="#_仕様の位置付け">2.1. 仕様の位置付け</a>
<ul class="sectlevel3">
<li><a href="#_カーネルの機能セット">2.1.1. カーネルの機能セット</a></li>
<li><a href="#_ターゲット非依存の規定とターゲット定義の規定">2.1.2. ターゲット非依存の規定とターゲット定義の規定</a></li>
<li><a href="#_想定するソフトウェア構成">2.1.3. 想定するソフトウェア構成</a></li>
<li><a href="#_想定するハードウェア構成">2.1.4. 想定するハードウェア構成</a></li>
<li><a href="#_想定するプログラミング言語">2.1.5. 想定するプログラミング言語</a></li>
</ul>
</li>
<li><a href="#_apiの構成要素とコンベンション">2.2. APIの構成要素とコンベンション</a>
<ul class="sectlevel3">
<li><a href="#_apiの構成要素">2.2.1. APIの構成要素</a></li>
<li><a href="#_パラメータとリターンパラメータ">2.2.2. パラメータとリターンパラメータ</a></li>
<li><a href="#_返値とエラーコード">2.2.3. 返値とエラーコード</a></li>
<li><a href="#_機能コード">2.2.4. 機能コード</a></li>
<li><a href="#_ヘッダファイル">2.2.5. ヘッダファイル</a></li>
</ul>
</li>
<li><a href="#_主な概念">2.3. 主な概念</a>
<ul class="sectlevel3">
<li><a href="#_オブジェクトと処理単位">2.3.1. オブジェクトと処理単位</a></li>
<li><a href="#_サービスコールとパラメータ">2.3.2. サービスコールとパラメータ</a></li>
<li><a href="#_保護機能">2.3.3. 保護機能</a></li>
<li><a href="#_マルチプロセッサ対応">2.3.4. マルチプロセッサ対応</a></li>
<li><a href="#_その他">2.3.5. その他</a></li>
</ul>
</li>
<li><a href="#_処理単位の種類と実行順序">2.4. 処理単位の種類と実行順序</a>
<ul class="sectlevel3">
<li><a href="#_処理単位の種類">2.4.1. 処理単位の種類</a></li>
<li><a href="#_処理単位の実行順序">2.4.2. 処理単位の実行順序</a></li>
<li><a href="#_カーネル処理の不可分性">2.4.3. カーネル処理の不可分性</a></li>
<li><a href="#_処理単位を実行するプロセッサ">2.4.4. 処理単位を実行するプロセッサ</a></li>
</ul>
</li>
<li><a href="#_システム状態とコンテキスト">2.5. システム状態とコンテキスト</a>
<ul class="sectlevel3">
<li><a href="#_カーネル動作状態と非動作状態">2.5.1. カーネル動作状態と非動作状態</a></li>
<li><a href="#_タスクコンテキストと非タスクコンテキスト">2.5.2. タスクコンテキストと非タスクコンテキスト</a></li>
<li><a href="#_カーネルの振舞いに影響を与える状態">2.5.3. カーネルの振舞いに影響を与える状態</a></li>
<li><a href="#_全割込みロック状態と全割込みロック解除状態">2.5.4. 全割込みロック状態と全割込みロック解除状態</a></li>
<li><a href="#_cpuロック状態とcpuロック解除状態">2.5.5. CPUロック状態とCPUロック解除状態</a></li>
<li><a href="#_割込み優先度マスク">2.5.6. 割込み優先度マスク</a></li>
<li><a href="#_ディスパッチ禁止状態とディスパッチ許可状態">2.5.7. ディスパッチ禁止状態とディスパッチ許可状態</a></li>
<li><a href="#_ディスパッチ保留状態">2.5.8. ディスパッチ保留状態</a></li>
<li><a href="#_カーネル管理外の状態">2.5.9. カーネル管理外の状態</a></li>
<li><a href="#_処理単位の開始_終了とシステム状態">2.5.10. 処理単位の開始・終了とシステム状態</a></li>
</ul>
</li>
<li><a href="#_タスクの状態遷移とスケジューリング規則">2.6. タスクの状態遷移とスケジューリング規則</a>
<ul class="sectlevel3">
<li><a href="#_基本的なタスク状態">2.6.1. 基本的なタスク状態</a></li>
<li><a href="#_タスクの状態遷移">2.6.2. タスクの状態遷移</a></li>
<li><a href="#_タスクのスケジューリング規則">2.6.3. タスクのスケジューリング規則</a></li>
<li><a href="#_待ち行列と待ち解除の順序">2.6.4. 待ち行列と待ち解除の順序</a></li>
<li><a href="#_タスク例外処理マスク状態と待ち禁止状態">2.6.5. タスク例外処理マスク状態と待ち禁止状態</a></li>
<li><a href="#_ディスパッチ保留状態で実行中のタスクに対する強制待ち">2.6.6. ディスパッチ保留状態で実行中のタスクに対する強制待ち</a></li>
<li><a href="#_制約タスク">2.6.7. 制約タスク</a></li>
</ul>
</li>
<li><a href="#_割込み処理モデル">2.7. 割込み処理モデル</a>
<ul class="sectlevel3">
<li><a href="#_割込み処理の流れ">2.7.1. 割込み処理の流れ</a></li>
<li><a href="#_割込み優先度">2.7.2. 割込み優先度</a></li>
<li><a href="#_割込み要求ラインの属性">2.7.3. 割込み要求ラインの属性</a></li>
<li><a href="#_割込みを受け付ける条件">2.7.4. 割込みを受け付ける条件</a></li>
<li><a href="#_割込み番号と割込みハンドラ番号">2.7.5. 割込み番号と割込みハンドラ番号</a></li>
<li><a href="#_マルチプロセッサにおける割込み処理">2.7.6. マルチプロセッサにおける割込み処理</a></li>
<li><a href="#_カーネル管理外の割込み">2.7.7. カーネル管理外の割込み</a></li>
<li><a href="#_カーネル管理外の割込みの設定方法">2.7.8. カーネル管理外の割込みの設定方法</a></li>
</ul>
</li>
<li><a href="#_cpu例外処理モデル">2.8. CPU例外処理モデル</a>
<ul class="sectlevel3">
<li><a href="#_cpu例外処理の流れ">2.8.1. CPU例外処理の流れ</a></li>
<li><a href="#_cpu例外ハンドラから呼び出せるサービスコール">2.8.2. CPU例外ハンドラから呼び出せるサービスコール</a></li>
<li><a href="#_エミュレートされたcpu例外ハンドラ">2.8.3. エミュレートされたCPU例外ハンドラ</a></li>
<li><a href="#_カーネル管理外のcpu例外">2.8.4. カーネル管理外のCPU例外</a></li>
</ul>
</li>
<li><a href="#_システムの初期化と終了">2.9. システムの初期化と終了</a>
<ul class="sectlevel3">
<li><a href="#_システム初期化手順">2.9.1. システム初期化手順</a></li>
<li><a href="#_システム終了手順">2.9.2. システム終了手順</a></li>
</ul>
</li>
<li><a href="#_オブジェクトの登録とその解除">2.10. オブジェクトの登録とその解除</a>
<ul class="sectlevel3">
<li><a href="#_id番号で識別するオブジェクト">2.10.1. ID番号で識別するオブジェクト</a></li>
<li><a href="#_オブジェクト番号で識別するオブジェクト">2.10.2. オブジェクト番号で識別するオブジェクト</a></li>
<li><a href="#_識別番号を持たないオブジェクト">2.10.3. 識別番号を持たないオブジェクト</a></li>
<li><a href="#_オブジェクト生成に必要なメモリ領域">2.10.4. オブジェクト生成に必要なメモリ領域</a></li>
<li><a href="#_オブジェクトが属する保護ドメインの設定">2.10.5. オブジェクトが属する保護ドメインの設定</a></li>
<li><a href="#_オブジェクトが属するクラスの設定">2.10.6. オブジェクトが属するクラスの設定</a></li>
<li><a href="#_オブジェクトの状態参照">2.10.7. オブジェクトの状態参照</a></li>
</ul>
</li>
<li><a href="#_オブジェクトのアクセス保護">2.11. オブジェクトのアクセス保護</a>
<ul class="sectlevel3">
<li><a href="#_オブジェクトのアクセス保護とアクセス違反の通知">2.11.1. オブジェクトのアクセス保護とアクセス違反の通知</a></li>
<li><a href="#_メモリオブジェクトに対するアクセス許可ベクタの制限">2.11.2. メモリオブジェクトに対するアクセス許可ベクタの制限</a></li>
<li><a href="#_デフォルトのアクセス許可ベクタ">2.11.3. デフォルトのアクセス許可ベクタ</a></li>
<li><a href="#_アクセス許可ベクタの設定">2.11.4. アクセス許可ベクタの設定</a></li>
<li><a href="#_カーネルの管理領域のアクセス保護">2.11.5. カーネルの管理領域のアクセス保護</a></li>
<li><a href="#_ユーザタスクのユーザスタック領域">2.11.6. ユーザタスクのユーザスタック領域</a></li>
</ul>
</li>
<li><a href="#_システムコンフィギュレーション手順">2.12. システムコンフィギュレーション手順</a>
<ul class="sectlevel3">
<li><a href="#_システムコンフィギュレーションファイル">2.12.1. システムコンフィギュレーションファイル</a></li>
<li><a href="#_静的apiの文法とパラメータ">2.12.2. 静的APIの文法とパラメータ</a></li>
<li><a href="#_保護ドメインの指定">2.12.3. 保護ドメインの指定</a></li>
<li><a href="#_クラスの指定">2.12.4. クラスの指定</a></li>
<li><a href="#_コンフィギュレータの処理モデル">2.12.5. コンフィギュレータの処理モデル</a></li>
<li><a href="#_静的apiのパラメータに関するエラー検出">2.12.6. 静的APIのパラメータに関するエラー検出</a></li>
<li><a href="#_オブジェクトのid番号の指定">2.12.7. オブジェクトのID番号の指定</a></li>
</ul>
</li>
<li><a href="#_toppersネーミングコンベンション">2.13. TOPPERSネーミングコンベンション</a>
<ul class="sectlevel3">
<li><a href="#_モジュール識別名">2.13.1. モジュール識別名</a></li>
<li><a href="#_データ型名">2.13.2. データ型名</a></li>
</ul>
</li>
<li><a href="#_関数名">2.14. 関数名</a>
<ul class="sectlevel3">
<li><a href="#_変数名">2.14.1. 変数名</a></li>
<li><a href="#_定数名">2.14.2. 定数名</a></li>
<li><a href="#_マクロ名">2.14.3. マクロ名</a></li>
<li><a href="#_静的api名">2.14.4. 静的API名</a></li>
<li><a href="#_ファイル名">2.14.5. ファイル名</a></li>
<li><a href="#_モジュール内部の名称の衝突回避">2.14.6. モジュール内部の名称の衝突回避</a></li>
</ul>
</li>
<li><a href="#_toppers共通定義">2.15. TOPPERS共通定義</a>
<ul class="sectlevel3">
<li><a href="#_toppers共通ヘッダファイル">2.15.1. TOPPERS共通ヘッダファイル</a></li>
<li><a href="#_toppers共通データ型">2.15.2. TOPPERS共通データ型</a></li>
<li><a href="#_toppers共通定数">2.15.3. TOPPERS共通定数</a></li>
<li><a href="#toppers_errorcode">2.15.4. TOPPERS共通エラーコード</a></li>
<li><a href="#_toppers共通マクロ">2.15.5. TOPPERS共通マクロ</a></li>
<li><a href="#_toppers共通構成マクロ">2.15.6. TOPPERS共通構成マクロ</a></li>
<li><a href="#_カーネル共通定数">2.15.7. カーネル共通定数</a></li>
<li><a href="#_カーネル共通マクロ">2.15.8. カーネル共通マクロ</a></li>
<li><a href="#_カーネル共通構成マクロ">2.15.9. カーネル共通構成マクロ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_システムインタフェースレイヤapi仕様">3. システムインタフェースレイヤAPI仕様</a>
<ul class="sectlevel2">
<li><a href="#_システムインタフェースレイヤの概要">3.1. システムインタフェースレイヤの概要</a></li>
<li><a href="#_silヘッダファイル">3.2. SILヘッダファイル</a></li>
<li><a href="#_全割込みロック状態の制御">3.3. 全割込みロック状態の制御</a></li>
<li><a href="#_silスピンロック">3.4. SILスピンロック</a></li>
<li><a href="#_微少時間待ち">3.5. 微少時間待ち</a></li>
<li><a href="#_エンディアンの取得">3.6. エンディアンの取得</a></li>
<li><a href="#_メモリ空間アクセス関数">3.7. メモリ空間アクセス関数</a></li>
<li><a href="#_i_o空間アクセス関数">3.8. I/O空間アクセス関数</a></li>
<li><a href="#_プロセッサidの参照">3.9. プロセッサIDの参照</a></li>
</ul>
</li>
<li><a href="#ch4_kernel_api">4. カーネルAPI仕様</a>
<ul class="sectlevel2">
<li><a href="#_タスク管理機能">4.1. タスク管理機能</a></li>
<li><a href="#_タスク付属同期機能">4.2. タスク付属同期機能</a></li>
<li><a href="#_タスク例外処理機能">4.3. タスク例外処理機能</a></li>
<li><a href="#_同期_通信機能">4.4. 同期・通信機能</a>
<ul class="sectlevel3">
<li><a href="#_セマフォ">4.4.1. セマフォ</a></li>
<li><a href="#_イベントフラグ">4.4.2. イベントフラグ</a></li>
<li><a href="#_データキュー">4.4.3. データキュー</a></li>
<li><a href="#_優先度データキュー">4.4.4. 優先度データキュー</a></li>
<li><a href="#_メールボックス">4.4.5. メールボックス</a></li>
<li><a href="#_ミューテックス">4.4.6. ミューテックス</a></li>
<li><a href="#_メッセージバッファ">4.4.7. メッセージバッファ</a></li>
<li><a href="#_スピンロック">4.4.8. スピンロック</a></li>
</ul>
</li>
<li><a href="#_メモリプール管理機能">4.5. メモリプール管理機能</a>
<ul class="sectlevel3">
<li><a href="#_固定長メモリプール">4.5.1. 固定長メモリプール</a></li>
</ul>
</li>
<li><a href="#_時間管理機能">4.6. 時間管理機能</a>
<ul class="sectlevel3">
<li><a href="#_システム時刻管理">4.6.1. システム時刻管理</a></li>
<li><a href="#_周期ハンドラ">4.6.2. 周期ハンドラ</a></li>
<li><a href="#_アラームハンドラ">4.6.3. アラームハンドラ</a></li>
<li><a href="#_オーバランハンドラ">4.6.4. オーバランハンドラ</a></li>
</ul>
</li>
<li><a href="#_システム状態管理機能">4.7. システム状態管理機能</a></li>
<li><a href="#_メモリオブジェクト管理機能">4.8. メモリオブジェクト管理機能</a></li>
<li><a href="#_割込み管理機能">4.9. 割込み管理機能</a></li>
<li><a href="#_cpu例外管理機能">4.10. CPU例外管理機能</a></li>
<li><a href="#_拡張サービスコール管理機能">4.11. 拡張サービスコール管理機能</a></li>
<li><a href="#_システム構成管理機能">4.12. システム構成管理機能</a></li>
</ul>
</li>
<li><a href="#_リファレンス">5. リファレンス</a>
<ul class="sectlevel2">
<li><a href="#_サービスコール一覧">5.1. サービスコール一覧</a></li>
<li><a href="#_静的api一覧">5.2. 静的API一覧</a></li>
<li><a href="#_データ型">5.3. データ型</a>
<ul class="sectlevel3">
<li><a href="#_toppers共通データ型_2">5.3.1. TOPPERS共通データ型</a></li>
<li><a href="#_カーネルの使用するデータ型">5.3.2. カーネルの使用するデータ型</a></li>
<li><a href="#_カーネルの使用するパケット形式">5.3.3. カーネルの使用するパケット形式</a></li>
</ul>
</li>
<li><a href="#_定数とマクロ">5.4. 定数とマクロ</a>
<ul class="sectlevel3">
<li><a href="#_toppers共通定数_2">5.4.1. TOPPERS共通定数</a></li>
<li><a href="#_toppers共通マクロ_2">5.4.2. TOPPERS共通マクロ</a></li>
<li><a href="#_カーネル共通定数_2">5.4.3. カーネル共通定数</a></li>
<li><a href="#_カーネル共通マクロ_2">5.4.4. カーネル共通マクロ</a></li>
<li><a href="#_カーネルの機能毎の定数">5.4.5. カーネルの機能毎の定数</a></li>
<li><a href="#_カーネルの機能毎のマクロ">5.4.6. カーネルの機能毎のマクロ</a></li>
</ul>
</li>
<li><a href="#_構成マクロ">5.5. 構成マクロ</a>
<ul class="sectlevel3">
<li><a href="#_toppers共通構成マクロ_2">5.5.1. TOPPERS共通構成マクロ</a></li>
<li><a href="#_カーネル共通構成マクロ_2">5.5.2. カーネル共通構成マクロ</a></li>
<li><a href="#_カーネルの機能毎の構成マクロ">5.5.3. カーネルの機能毎の構成マクロ</a></li>
</ul>
</li>
<li><a href="#_エラーコード一覧">5.6. エラーコード一覧</a></li>
<li><a href="#_機能コード一覧_ngki4036">5.7. 機能コード一覧【NGKI4036】</a></li>
<li><a href="#_カーネルオブジェクトに対するアクセスの種別">5.8. カーネルオブジェクトに対するアクセスの種別</a></li>
<li><a href="#_ターゲット定義事項一覧">5.9. ターゲット定義事項一覧</a></li>
<li><a href="#_省略名の元になった英語">5.10. 省略名の元になった英語</a>
<ul class="sectlevel3">
<li><a href="#_サービスコールと静的apiの名称の中のxxxの元になった英語">5.10.1. サービスコールと静的APIの名称の中のxxxの元になった英語</a></li>
<li><a href="#_サービスコールと静的apiの名称の中のyyy_の元になった英語">5.10.2. サービスコールと静的APIの名称の中のyyy の元になった英語</a></li>
<li><a href="#_サービスコールの名称の中のzの元になった英語">5.10.3. サービスコールの名称の中のzの元になった英語</a></li>
</ul>
</li>
<li><a href="#_バージョン履歴">5.11. バージョン履歴</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>バージョン: Release 1.7.1
最終更新: 2015年5月30日</pre>
</div>
</div>
<div class="paragraph">
<p>このドキュメントは，TOPPERS新世代カーネルに属する一連のリアルタイムカー
ネルの仕様を，統合的に記述したものである．今後，この仕様に対して，大き
い機能追加や仕様改変は行わず，これ以降は第3世代カーネル仕様として検討を
行う計画である．ただし，仕様が未完成の部分（特に動的生成対応カーネルに
関しては，仕様検討が不十分なところが多い）については，それを実装する時
点で追加で決定していくこととする．</p>
</div>
<div class="paragraph">
<p>なお，本文中から参照している図は，ファイルの最後にまとめて掲載してある．</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  TOPPERS New Generation Kernel Specification

  Copyright (C) 2006-2015 by Embedded and Real-Time Systems Laboratory
              Graduate School of Information Science, Nagoya Univ., JAPAN
  Copyright (C) 2006-2015 by TOPPERS Project, Inc., JAPAN

 上記著作権者は，以下の (1)〜(3) の条件を満たす場合に限り，本ドキュメ
 ント（本ドキュメントを改変したものを含む．以下同じ）を使用・複製・改
 変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
 (1) 本ドキュメントを利用する場合には，上記の著作権表示，この利用条件
     および下記の無保証規定が，そのままの形でドキュメント中に含まれて
     いること．
 (2) 本ドキュメントを改変する場合には，ドキュメントを改変した旨の記述
     を，改変後のドキュメント中に含めること．ただし，改変後のドキュメ
     ントが，TOPPERSプロジェクト指定の開発成果物である場合には，この限
     りではない．
 (3) 本ドキュメントの利用により直接的または間接的に生じるいかなる損害
     からも，上記著作権者およびTOPPERSプロジェクトを免責すること．また，
     本ドキュメントのユーザまたはエンドユーザからのいかなる理由に基づ
     く請求からも，上記著作権者およびTOPPERSプロジェクトを免責すること．

 本ドキュメントは，無保証で提供されているものである．上記著作権者およ
 びTOPPERSプロジェクトは，本ドキュメントに関して，特定の使用目的に対す
 る適合性も含めて，いかなる保証も行わない．また，本ドキュメントの利用
 により直接的または間接的に生じたいかなる損害に関しても，その責任を負
 わない．</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_仕様書で用いる記述項目と記号">仕様書で用いる記述項目と記号</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この仕様書では，以下の記述項目を用いる．</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">【補足説明】</dt>
<dd>
<p>仕様本体の記述に対する補足事項を説明する．</p>
</dd>
<dt class="hdlist1">【〜〜カーネルにおける規定】</dt>
<dd>
<p>TOPPERS新世代カーネルに属する特定のカーネルにおける追加仕様を規定する．</p>
</dd>
<dt class="hdlist1">【〜〜仕様との関係】</dt>
<dd>
<p>この仕様と，μITRON4.0仕様またはμITRON4.0/PX仕様との違いについて説明する．</p>
</dd>
<dt class="hdlist1">【未決定事項】</dt>
<dd>
<p>この仕様書の現時点のバージョンでは，決定されずに残っている事項について記述する．</p>
</dd>
<dt class="hdlist1">【仕様決定の理由】</dt>
<dd>
<p>仕様を決定するにあたって考慮した事項について説明する．</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>「第４章 <a href="#ch4_kernel_api">カーネルAPI仕様</a>」の章の各サービスコールおよび静的APIの仕様記述
においては，以下の記述項目を用いる．</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">【静的API】</dt>
<dd>
<p>システムコンフィギュレーションファイル中で静的APIを記述する形式を規定する．
また，【C言語API】の項では，C言語からサービスコールを呼び出す形式を規定する．</p>
</dd>
<dt class="hdlist1">【パラメータ】</dt>
<dd>
<p>サービスコールおよび静的APIに渡すパラメータの名称とデータ型を規定し，簡単な説明を行う．</p>
</dd>
<dt class="hdlist1">【リターンパラメータ】</dt>
<dd>
<p> サービスコールが返すリターンパラメータの名称とデータ型を規定し，簡単な説明を行う．
【エラーコード】の項では，サービスコールおよび静的APIが返す可能性のあるメインエラーコードと，その検出条件を規定する．</p>
</dd>
<dt class="hdlist1">【機能】</dt>
<dd>
<p>サービスコールおよび静的APIの機能を規定する．</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>TOPPERS新世代カーネルに属する特定のカーネルにおいてのみサポートするAPI
につしては，【サポートするカーネル】の項で，そのことを記述する．</p>
</div>
<div class="paragraph">
<p>また，「第４章 <a href="#ch4_kernel_api">カーネルAPI仕様</a>」の章では，カーネルのAPIの種別とAPIをサ
ポートするカーネルの種類を表すために，次の記号を用いる．</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">〔T〕</dt>
<dd>
<p>タスクコンテキスト専用のサービスコールを示す．非タスクコンテキストから呼び出すと，E_CTXエラーとなる．</p>
</dd>
<dt class="hdlist1">〔I〕</dt>
<dd>
<p>非タスクコンテキスト専用のサービスコールを示す．タスクコンテキストから呼び出すと，E_CTXエラーとなる．</p>
</dd>
<dt class="hdlist1">〔TI〕</dt>
<dd>
<p>タスクコンテキストからも非タスクコンテキストからも呼び出すことのできるサービスコールを示す．</p>
</dd>
<dt class="hdlist1">〔S〕</dt>
<dd>
<p>静的APIを示す．</p>
</dd>
<dt class="hdlist1">〔P〕</dt>
<dd>
<p>保護機能対応カーネルのみでサポートされているAPIを示す．保護機能対応でないカーネルでは，このAPIはサポートされない．</p>
</dd>
<dt class="hdlist1">〔p〕</dt>
<dd>
<p>保護機能対応でないカーネルのみでサポートされているAPIを示す．保護機能対応カーネルでは，このAPIはサポートされない．</p>
</dd>
<dt class="hdlist1">〔M〕</dt>
<dd>
<p>マルチプロセッサ対応カーネルのみでサポートされているAPIを示す．マルチプロセッサ対応でないカーネルでは，このAPIはサポートされない．</p>
</dd>
<dt class="hdlist1">〔D〕</dt>
<dd>
<p>動的生成対応カーネルのみでサポートされているAPIを示す．動的生成対応でないカーネルでは，このAPIはサポートされない．</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>また，エラーが発生する条件を表すために，次の記号を用いる．</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">〔s〕</dt>
<dd>
<p>サービスコールのみで発生するエラーを示す．静的APIでは，このエラーは発生しない．</p>
</dd>
<dt class="hdlist1">〔S〕</dt>
<dd>
<p>静的APIのみで発生するエラーを示す．サービスコールでは，このエラーは発生しない．</p>
</dd>
<dt class="hdlist1">〔P〕</dt>
<dd>
<p>保護機能対応カーネルのみで発生するエラーを示す．保護機能対応でないカーネルでは，このエラーは発生しない．</p>
</dd>
<dt class="hdlist1">〔D〕</dt>
<dd>
<p>動的生成対応カーネルのみで発生するエラーを示す．動的生成対応でないカーネルでは，このエラーは発生しない．</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_タグの付与方法">タグの付与方法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この仕様書では，トレーサビリティの確保のために，記述事項に対してタグを付与する．
具体的には，以下に該当する記述事項を，タグを付与する対象とする．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>対象ソフトウェアの実装に対する要求事項や制限事項</p>
</li>
<li>
<p>対象ソフトウェアの仕様に対する一般要求事項</p>
</li>
<li>
<p>対象ソフトウェアの動作環境に対する要求事項</p>
</li>
<li>
<p>ターゲット定義の規定</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>それに対して，用語の定義や補足説明，対象ソフトウェアを使用する上での推奨事項や注意事項，
仕様決定の理由，他の仕様との関係に対しては，タグを付与しない．</p>
</div>
<div class="paragraph">
<p>タグの形式と意味は次の通りである（xxxxは4桁の数字を表す）．</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NGKIxxxx	TOPPERS新世代カーネル全体を対象とした記述
ASPSxxxx	TOPPERS/ASPカーネルを対象とした記述
FMPSxxxx	TOPPERS/FMPカーネルを対象とした記述
HRPSxxxx	TOPPERS/HRP2カーネルを対象とした記述
SSPSxxxx	TOPPERS/SSPカーネルを対象とした記述
ASSSxxxx	TOPPERS/ASP Safetyカーネルを対象とした記述</pre>
</div>
</div>
<div class="paragraph">
<p>仕様書中では，ある記述事項に，<strong>タグYYYYxxxx</strong>
（YYYYは4文字の英文字，xxxxは4桁の数字を表す）が付与されていることを，
【YYYYxxxx】で表現する．それに対して，<strong>タグYYYYxxxx</strong> を参照する場合には，
［YYYYxxxx］と表記する．</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch1_summary_of_toppers_kernel">1. TOPPERS新世代カーネルの概要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TOPPERS新世代カーネルとは，TOPPERSプロジェクトにおいてITRON仕様をベース
として開発している一連のリアルタイムカーネルの総称である．この章では，
TOPPERS新世代カーネル仕様の位置付けと設計方針，それに属する各カーネルの
適用対象領域と設計方針について述べる．</p>
</div>
<div class="sect2">
<h3 id="_toppers新世代カーネル仕様の位置付け">1.1. TOPPERS新世代カーネル仕様の位置付け</h3>
<div class="paragraph">
<p>TOPPERSプロジェクトでは，2000年に公開したTOPPERS/JSPカーネルを始めとし
て，μITRON4.0仕様およびその保護機能拡張（μITRON4.0/PX仕様）に準拠した
リアルタイムカーネルを開発してきた．</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様は1999年に，μITRON4.0/PX仕様は2002年に公表されたが，それ
以降現在までの間に，大きな仕様改訂は実施されていない．その間に，組込み
システムおよびソフトウェアのますますの大規模化・複雑化，これまで以上に
高い信頼性・安全性に対する要求，小さい消費エネルギー下での高い性能要求
など，組込みシステム開発を取り巻く状況は刻々変化している．リアルタイム
カーネルに対しても，マルチプロセッサへの対応，発展的な保護機能のサポー
ト，機能安全対応，省エネルギー制御機能のサポートなど，新しい要求が生じ
ている．</p>
</div>
<div class="paragraph">
<p>TOPPERSプロジェクトでは，リアルタイムカーネルに対するこのような新しい要
求に対応するために，μITRON4.0仕様を発展させる形で，TOPPERS新世代カーネ
ル仕様を策定することになった．</p>
</div>
<div class="paragraph">
<p>ただし，ITRON仕様が，各社が開発するリアルタイムカーネルを標準化すること
を目的に，リアルタイムカーネルの「標準仕様」を規定することを目指してい
るのに対して，TOPPERS新世代カーネル仕様は，TOPPERSプロジェクトにおいて
開発している一連のリアルタイムカーネルの「実装仕様」を記述するものであ
り，ITRON仕様とは異なる目的・位置付けを持つものである．</p>
</div>
</div>
<div class="sect2">
<h3 id="_toppers新世代カーネル仕様の設計方針">1.2. TOPPERS新世代カーネル仕様の設計方針</h3>
<div class="paragraph">
<p>TOPPERS新世代カーネル仕様を設計するにあたり，次の方針を設定する．</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>μITRON4.0仕様をベースに拡張・改良を加える<br></p>
<div class="paragraph">
<p>TOPPERS新世代カーネル仕様は，多くの技術者の尽力により作成され，多くの実
装・使用実績があるμITRON4.0仕様をベースとする．ただし，μITRON4.0仕様
の策定時以降の状況の変化を考慮し，μITRON4.0仕様で不十分と考えられる点
については積極的に拡張・改良する．μITRON4.0仕様への準拠性にはこだわら
ない．</p>
</div>
</li>
<li>
<p>ソフトウェアの再利用性を重視する<br></p>
<div class="paragraph">
<p>μITRON4.0仕様の策定時点と比べると，組込みソフトウェアの大規模化が進展
している一方で，ハードウェアの性能向上も著しい．そのため，ソフトウェア
の再利用性を向上させるためには，少々のオーバヘッドは許容される状況にあ
る．</p>
</div>
<div class="paragraph">
<p>そこで，TOPPERS新世代カーネル仕様では，μITRON4.0仕様においてオーバヘッ
ド削減のために実装定義または実装依存としていたような項目についても，ター
ゲットシステムに依存する項目とするのではなく，強く規定する方針とする．</p>
</div>
</li>
<li>
<p>高信頼・安全なシステム構築を支援する<br></p>
<div class="paragraph">
<p>TOPPERS新世代カーネル仕様は，高信頼・安全な組込みシステム構築を支援する
ものとする．</p>
</div>
<div class="paragraph">
<p>安全性の面では，アプリケーションプログラムに問題がある場合でも，リーゾ
ナブルなオーバヘッドでそれを救済できるなら，救済するような仕様とする．
また，アプリケーションプログラムの誤動作を検出する機能や，システムの自
己診断のための機能についても，順次取り込んでいく．</p>
</div>
</li>
<li>
<p>アプリケーションシステム構築に必要な機能は積極的に取り込む<br></p>
<div class="paragraph">
<p>上記の方針を満たした上で，多くのアプリケーションシステムに共通に必要と
なる機能については，積極的にカーネルに取り込む．</p>
</div>
<div class="paragraph">
<p>カーネル単体の信頼性を向上させるためには，カーネルの機能は少なくした方
が楽である．しかし，アプリケーションシステム構築に必要となる機能は，カー
ネルがサポートしていなければアプリケーションプログラムで実現しなければ
ならず，システム全体の信頼性を考えると，多くのアプリケーションシステム
に共通に必要となる機能については，カーネルに取り込んだ方が有利である．</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_toppers_aspカーネルの適用対象領域と仕様設計方針">1.3. TOPPERS/ASPカーネルの適用対象領域と仕様設計方針</h3>
<div class="paragraph">
<p>TOPPERS/ASPカーネル（ASPは，Advanced Standard Profileの略．以下，ASPカー
ネル）は，TOPPERS新世代カーネルの出発点となるリアルタイムカーネルである．
保護機能を持ったカーネルやマルチプロセッサ対応のカーネルは，ASPカーネル
を拡張する形で開発する．</p>
</div>
<div class="paragraph">
<p>ASPカーネルは，20年以上に渡るITRON仕様の技術開発成果をベースとして，完
成度の高いリアルタイムカーネルを実現するものである．完成度を高めるとい
う観点から，カーネル本体の仕様については，枯れた技術で実装できる範囲に
留める．</p>
</div>
<div class="paragraph">
<p>ASPカーネルの主な適用対象は，高い信頼性・安全性・リアルタイム性を要求さ
れる組込みシステムとする．ソフトウェア規模の面では，プログラムサイズ
（バイナリコード）が数十KB〜1MB程度のシステムを主な適用対象とする．それ
より大規模なシステムには，保護機能を持ったリアルタイムカーネルを適用す
べきと考えられる．</p>
</div>
<div class="paragraph">
<p>ASPカーネルの機能は，カーネル内で動的なメモリ管理が不要な範囲に留める．
これは，高い信頼性・安全性・リアルタイム性を要求される組込みシステムで
は，システム稼働中に発生するメモリ不足への対処が難しいためである．この
方針から，カーネルオブジェクトは静的に生成することとし，動的なオブジェ
クト生成機能は設けない．ただし，アプリケーションプログラムが動的なメモ
リ管理をするためのカーネル機能である固定長メモリプール機能はサポートす
る．</p>
</div>
</div>
<div class="sect2">
<h3 id="_toppers_fmpカーネルの適用対象領域と仕様設計方針">1.4. TOPPERS/FMPカーネルの適用対象領域と仕様設計方針</h3>
<div class="paragraph">
<p>TOPPERS/FMPカーネル（FMPは，Flexible Multiprocessor Profileの略．以下，
FMPカーネル）は，ASPカーネルを，マルチプロセッサ対応に拡張したリアルタ
イムカーネルである．</p>
</div>
<div class="paragraph">
<p>FMPカーネルの適用対象となるターゲットハードウェアは，ホモジニアスなマル
チプロセッサシステムである．各プロセッサが全く同一のものである必要はな
いが，すべてのプロセッサでバイナリコードを共有することから，同じバイナ
リコードを実行できることが必要である．</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，タスクを実行するプロセッサを静的に決定するのが基本であ
り，カーネルは自動的に負荷分散する機能を持たないが，タスクをマイグレー
ションさせるサービスコールを備えている．これを用いて，アプリケーション
で動的な負荷分散を実現することが可能である．</p>
</div>
<div class="paragraph">
<p>FMPカーネルの機能は，ASPカーネルと同様に，カーネル内で動的なメモリ管理
が不要な範囲に留める．</p>
</div>
</div>
<div class="sect2">
<h3 id="_toppers_hrp2カーネルの適用対象領域と仕様設計方針">1.5. TOPPERS/HRP2カーネルの適用対象領域と仕様設計方針</h3>
<div class="paragraph">
<p>TOPPERS/HRP2カーネル（HRPは，High Reliable system Profileの略．2はバー
ジョン番号を示す．以下，HRP2カーネル）は，さらに高い信頼性・安全性を要
求される組込みシステムや，より大規模な組込みシステム向けに適用できるよ
うに，ASPカーネルを拡張したリアルタイムカーネルである．</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの適用対象となるターゲットハードウェアは，特権モードと非特
権モードを備え，メモリ保護のためにMMU（Memory Management Unit）または
MPU（Memory Protection Unit）を持つプロセッサを用いたシステムである．
HRP2カーネルの主な適用対象は，ソフトウェア規模の面では，プログラムサイ
ズ（バイナリコード）が数百KB以上のシステムである．</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの機能は，ASPカーネルと同様に，カーネル内で動的なメモリ管理
が不要な範囲に留める．具体的には，ASPカーネルに対して，メモリ保護機能と
オブジェクトアクセス保護機能，拡張サービスコール機能，ミューテックス機
能，オーバランハンドラ機能を追加し，メールボックス機能を削除している．</p>
</div>
</div>
<div class="sect2">
<h3 id="_toppers_sspカーネルの適用対象領域と仕様設計方針">1.6. TOPPERS/SSPカーネルの適用対象領域と仕様設計方針</h3>
<div class="paragraph">
<p>TOPPERS/SSPカーネル（SSPは，Smallest Set Profileの略．以下，SSPカーネル）
は，小規模システムに用いるために，ASPカーネルをベースに可能な限り機能を
絞り込んだリアルタイムカーネルである．</p>
</div>
<div class="paragraph">
<p>SSPカーネルの機能は，μITRON4.0仕様の「仕様準拠の最低条件」の考え方を踏
襲し，メモリ使用量を最小化するように定めている．具体的には，SSPカーネル
においては，タスクは待ち状態を持たない（言い換えると，制約タスクのみを
サポートする）のが最大の特徴である．また，ASPカーネルに対して下位互換性
を持つように配慮しているが，システム全体のメモリ使用量を最小化するため
に有用な機能は，ASPカーネルに対して追加している．</p>
</div>
<div class="paragraph">
<p>TOPPERS/SSPカーネルの主な適用対象は，プログラムサイズ（バイナリコード）
が数KB〜数十KB程度の極めて小規模な組込みシステムである．</p>
</div>
</div>
<div class="sect2">
<h3 id="_toppers_asp_safetyカーネルの適用対象領域と仕様設計方針">1.7. TOPPERS/ASP Safetyカーネルの適用対象領域と仕様設計方針</h3>
<div class="paragraph">
<p>TOPPERS/ASP Safetyカーネル（以下，ASP Safetyカーネル）は，小規模な安全
関連システムに用いるために，ASPカーネルの機能を徹底的な検証が可能な範囲
にサブセット化したものである．メールボックスのように安全性の観点から問
題のある機能や，タスク例外処理機能のように使用頻度に比べて検証にコスト
のかかる機能はサポートしない．</p>
</div>
<div class="paragraph">
<p>ASP Safetyカーネルの主な適用対象は，特に高い安全性を要求される組込みシ
ステムとする．ソフトウェア規模の面では，プログラムサイズ（バイナリコー
ド）が数十KB〜1MB程度のシステムを主な適用対象とする．それより大規模なシ
ステムには，保護機能を持ったカーネルを適用すべきと考えられる．</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch2_concepts_and_Common_definision">2. 主要な概念と共通定義</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_仕様の位置付け">2.1. 仕様の位置付け</h3>
<div class="paragraph">
<p>この仕様は，TOPPERS新世代カーネルに属する各カーネルの仕様を，統合的に記
述することを目標としている．また，TOPPERS新世代カーネル上で動作する各種
のシステムサービスに共通に適用される事項についても規定する．</p>
</div>
<div class="sect3">
<h4 id="_カーネルの機能セット">2.1.1. カーネルの機能セット</h4>
<div class="paragraph">
<p>TOPPERS新世代カーネルは，ASPカーネルをベースとして，保護機能，マルチプ
ロセッサ，カーネルオブジェクトの動的生成，機能安全などに対応した一連の
カーネルで構成される．</p>
</div>
<div class="paragraph">
<p>この仕様では，TOPPERS新世代カーネルを構成する一連のカーネルの仕様を統合
的に記述するが，言うまでもなく，カーネルの種類によってサポートする機能
は異なる．サポートする機能をカーネルの種類毎に記述する方法もあるが，カー
ネルの種類はユーザ要求に対応して増える可能性もあり，その度に仕様書を修
正するのは得策ではない．</p>
</div>
<div class="paragraph">
<p>そこでこの仕様では，サポートする機能を，カーネルの種類毎ではなく，カー
ネルの対応する機能セット毎に記述する．具体的には，保護機能を持ったカー
ネルを保護機能対応カーネル，マルチプロセッサに対応したカーネルをマルチ
プロセッサ対応カーネル，カーネルオブジェクトの動的生成機能を持ったカー
ネルを動的生成対応カーネルと呼ぶことにする．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルは，保護機能対応カーネル，マルチプロセッサ対応カーネル，動的
生成対応カーネルのいずれでもない【ASPS0001】．ただし，動的生成機能拡張
パッケージを用いると，動的生成対応カーネルの機能の一部がサポートされる
【ASPS0002】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルは，マルチプロセッサ対応カーネルであり，保護機能対応カーネル，
動的生成対応カーネルではない【FMPS0001】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルは，保護機能対応カーネルであり，マルチプロセッサ対応カーネ
ル，動的生成対応カーネルではない【HRPS0001】．ただし，動的生成機能拡張
パッケージを用いると，動的生成対応カーネルの機能の一部がサポートされる
【HRPS0009】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルは，保護機能対応カーネル，マルチプロセッサ対応カーネル，動的
生成対応カーネルのいずれでもない【SSPS0001】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様，μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様は，カーネルオブジェクトの動的生成機能を持っているが，保
護機能を持っておらず，マルチプロセッサにも対応していない．μITRON4.0/PX
仕様は，μITRON4.0仕様に対して保護機能を追加するための仕様であり，カー
ネルオブジェクトの動的生成機能と保護機能を持っているが，マルチプロセッ
サには対応していない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_ターゲット非依存の規定とターゲット定義の規定">2.1.2. ターゲット非依存の規定とターゲット定義の規定</h4>
<div class="paragraph">
<p>TOPPERS新世代カーネルは，アプリケーションプログラムの再利用性を向上させ
るために，ターゲットハードウェアや開発環境の違いをできる限り隠蔽するこ
とを目指している．ただし，ターゲットハードウェアや開発環境の制限によっ
て実現できない機能が生じたり，逆にターゲットハードウェアの特徴を活かす
ためには機能拡張が不可欠になる場合がある．また，同一のターゲットハード
ウェアであっても，アプリケーションシステムによって使用方法が異なる場合
があり，ターゲットシステム毎に仕様の細部に違いが生じることは避けられな
い．</p>
</div>
<div class="paragraph">
<p>そこで，TOPPERS新世代カーネルの仕様は，ターゲットシステムによらずに定め
るターゲット非依存（target-independent）の規定と，ターゲットシステム毎
に定めるターゲット定義（target-defined）の規定に分けて記述する．この仕
様書は，ターゲット非依存の規定について記述するものであり，この仕様書で
「ターゲット定義」とした事項は，ターゲットシステム毎に用意するドキュメ
ントにおいて規定する．</p>
</div>
<div class="paragraph">
<p>また，この仕様書でターゲット非依存に規定した事項であっても，ターゲット
ハードウェアや開発環境の制限によって実現できない場合や，実現するための
オーバヘッドが大きくなる場合には，この仕様書の規定を逸脱する場合がある．
このような場合には，ターゲットシステム毎に用意するドキュメントでその旨
を明記する．</p>
</div>
</div>
<div class="sect3">
<h4 id="_想定するソフトウェア構成">2.1.3. 想定するソフトウェア構成</h4>
<div class="paragraph">
<p>この仕様では，アプリケーションシステムを構成するソフトウェアを，アプリ
ケーションプログラム（以下，単にアプリケーションと呼ぶ），システムサー
ビス，カーネルの3階層に分けて考える（図2-1）．カーネルとシステムサービ
スをあわせて，ソフトウェアプラットフォームと呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネルは，コンピュータの持つ最も基本的なハードウェア資源であるプロセッ
サ，メモリ，タイマを抽象化し，上位階層のソフトウェア（アプリケーション
およびシステムサービス）に論理的なプログラム実行環境を提供するソフトウェ
アである．</p>
</div>
<div class="paragraph">
<p>システムサービスは，各種の周辺デバイスを抽象化するソフトウェアで，ファ
イルシステムやネットワークプロトコルスタック，各種のデバイスドライバな
どが含まれる．</p>
</div>
<div class="paragraph">
<p>また，この仕様では，プロセッサと各種の周辺デバイスの接続方法を隠蔽する
ためのソフトウェア階層として，システムインタフェースレイヤ（SIL）を規定
する．</p>
</div>
<div class="paragraph">
<p>システムインタフェースレイヤ，カーネル，各種のシステムサービス（これら
をモジュールと呼ぶ）を，上位階層のソフトウェアから使うためのインタフェー
スを，API（Application Programming Interface）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>この仕様書では，第3章においてシステムインタフェースレイヤのAPI仕様を，
第4章においてカーネルのAPI仕様を規定する．システムサービスのAPI仕様は，
システムサービス毎の仕様書で規定される．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，カーネルとアプリケーションの中間にあるソフトウェア
をソフトウェア部品と呼んでいたが，TOPPERS組込みコンポーネントシステム
（TECS）においてはカーネルもソフトウェア部品の1つと捉えることから，この
仕様ではシステムサービスと呼ぶことにした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_想定するハードウェア構成">2.1.4. 想定するハードウェア構成</h4>
<div class="paragraph">
<p>この仕様では，カーネルがサポートするハードウェア構成として，以下のこと
を想定している．これらに合致しないターゲットハードウェアでカーネルを動
作させることは可能であるが，合致しない部分への適応はアプリケーションの
責任になる．</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>メモリ番地は，常に同一のメモリを指すこと（オーバレイのように，異な
るメモリを同一のメモリ番地でアクセスすることがないこと）【NGKI0001】．
マルチプロセッサ対応カーネルにおいては，同一のメモリに対しては，各プロ
セッサから同一の番地でアクセスできること【NGKI0002】．</p>
</li>
<li>
<p>マルチプロセッサ対応カーネルにおいては，各プロセッサが同一の機械語
命令を実行できること【NGKI0003】．</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_想定するプログラミング言語">2.1.5. 想定するプログラミング言語</h4>
<div class="paragraph">
<p>この仕様におけるAPI仕様は，ISO/IEC 9899:1990（以下，C90と呼ぶ）または
ISO/IEC 9899:1999（以下，C99と呼ぶ）に準拠したC言語を，フリースタンディ
ング環境で用いることを想定して規定している【NGKI0004】．</p>
</div>
<div class="paragraph">
<p>ただし，C90の規定に加えて，以下のことを仮定している．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>16ビットおよび32ビットの整数型があること【NGKI0005】</p>
</li>
<li>
<p>ポインタが格納できるサイズの整数型があること【NGKI0006】</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_apiの構成要素とコンベンション">2.2. APIの構成要素とコンベンション</h3>
<div class="sect3">
<h4 id="_apiの構成要素">2.2.1. APIの構成要素</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>サービスコール<br></p>
<div class="paragraph">
<p>上位階層のソフトウェアから，下位階層のソフトウェアを呼び出すインタフェー
スをサービスコール（service call）と呼ぶ．カーネルのサービスコールを，
システムコール（system call）と呼ぶ場合もある．</p>
</div>
</li>
<li>
<p>コールバック<br></p>
<div class="paragraph">
<p>下位階層のソフトウェアから，上位階層のソフトウェアを呼び出すインタフェー
スをコールバック（callback）と呼ぶ．</p>
</div>
</li>
<li>
<p>静的API<br></p>
<div class="paragraph">
<p>オブジェクトの生成情報や初期状態などを定義するために，システムコンフィ
ギュレーションファイル中に記述するインタフェースを，静的API（static
API）と呼ぶ．</p>
</div>
</li>
<li>
<p>構成マクロ<br></p>
<div class="paragraph">
<p>下位階層のソフトウェアに関する各種の情報を取り出すために，上位階層のソ
フトウェアが用いるマクロを，構成マクロ（configuration macro）と呼ぶ．</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_パラメータとリターンパラメータ">2.2.2. パラメータとリターンパラメータ</h4>
<div class="paragraph">
<p>サービスコールやコールバックに渡すデータをパラメータ（parameter），それ
らが返すデータをリターンパラメータ（return parameter）と呼ぶ．また，静
的APIに渡すデータもパラメータと呼ぶ．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成するサービスコールなど，パラメータの数が多い場合やター
ゲット定義のパラメータを追加する可能性がある場合には，複数のパラメータ
を1つの構造体に入れ，その領域へのポインタをパラメータとして渡す
【NGKI0007】．また，パラメータのサイズが大きい場合にも，パラメータを入
れた領域へのポインタをパラメータとして渡す場合がある【NGKI0008】．</p>
</div>
<div class="paragraph">
<p>C言語APIでは，リターンパラメータは，関数の返値とするか，リターンパラメー
タを入れる領域へのポインタをパラメータとして渡すことで実現する
【NGKI0009】．オブジェクトの状態を参照するサービスコールなど，リターン
パラメータの数が多い場合やターゲット定義のリターンパラメータを追加する
可能性がある場合には，複数のリターンパラメータを1つの構造体に入れて返す
こととし，その領域へのポインタをパラメータとして渡す【NGKI0010】．</p>
</div>
<div class="paragraph">
<p>複数のパラメータまたはリターンパラメータを入れるための構造体を，パケッ
ト（packet）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>サービスコールやコールバックに，パケットを置く領域へのポインタやリター
ンパラメータを入れる領域へのポインタを渡す場合，別に規定がない限りは，
サービスコールやコールバックの処理が完了した後は，それらの領域が参照さ
れることはなく，別の目的に使用できる【NGKI0011】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_返値とエラーコード">2.2.3. 返値とエラーコード</h4>
<div class="paragraph">
<p>一部の例外を除いて，サービスコールおよびコールバックの返値は，処理が正
常終了したかを表す符号付き整数とする．処理が正常終了した場合には，E_OK
（＝0）または正の値が返るものとし，値の意味はサービスコールまたはコール
バック毎に定める【NGKI0012】．処理が正常終了しなかった場合には，その原
因を表す負の値が返る【NGKI0013】．処理が正常終了しなかった原因を表す値
を，エラーコード（error code）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>エラーコードは，いずれも負の値のメインエラーコードとサブエラーコードで
構成される【NGKI0014】．メインエラーコードとサブエラーコードからエラー
コードを構成するマクロ（ERCD）と，エラーコードからメインエラーコードを
取り出すマクロ（MERCD），サブエラーコードを取り出すマクロ（SERCD）が用
意されている【NGKI0015】．</p>
</div>
<div class="paragraph">
<p>メインエラーコードの名称・意味・値は，カーネルとシステムサービスで共通
に定める（「<a href="#toppers_errorcode">TOPPERS共通エラーコード</a>」の節を参照）【NGKI0016】．
サービスコールおよびコールバックの機能説明中の「E_XXXXXエラーとなる」ま
たは「E_XXXXXエラーが返る」という記述は，メインエラーコードとして
E_XXXXXが返ることを意味する．</p>
</div>
<div class="paragraph">
<p>サブエラーコードは，エラーの原因をより詳細に表すために用いる．カーネル
はサブエラーコードを使用せず，サブエラーコードとして常に-1が返る
【NGKI0017】．サブエラーコードの名称・意味・値は，サブエラーコードを使
用するシステムサービスのAPI仕様において規定する【NGKI0018】．</p>
</div>
<div class="paragraph">
<p>サービスコールが負の値のエラーコード（警告を表すものを除く）を返した場
合には，サービスコールによる副作用がないのが原則である【NGKI0019】．た
だし，そのような実装ができない場合にはこの原則の例外とし，サービスコー
ルの機能説明にその旨を記述する【NGKI0020】．</p>
</div>
<div class="paragraph">
<p>サービスコールが複数のエラーを検出するべき状況では，その内のいずれか1つ
のエラーを示すエラーコードが返る【NGKI0021】．</p>
</div>
<div class="paragraph">
<p>コールバックが複数のエラーを検出するべき状況では，その内のいずれか1つの
エラーを示すエラーコードを返せばよい【NGKI0022】．</p>
</div>
<div class="paragraph">
<p>なお，静的APIは返値を持たない．静的APIの処理でエラーが検出された場合の
扱いについては，「2.12.5 コンフィギュレータの処理モデル」の節および
「2.12.6 静的APIのパラメータに関するエラー検出」の節を参照すること．</p>
</div>
</div>
<div class="sect3">
<h4 id="_機能コード">2.2.4. 機能コード</h4>
<div class="paragraph">
<p>ソフトウェア割込みによりサービスコールを呼び出す場合などに用いるための
サービスコールを識別するための番号を，機能コード（function code）と呼ぶ．
機能コードは符号付きの整数値とし，カーネルのサービスコールには負の値を
割り付け，拡張サービスコールには正の値を用いる【NGKI0023】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_ヘッダファイル">2.2.5. ヘッダファイル</h4>
<div class="paragraph">
<p>カーネルやシステムサービスを用いるために必要な定義を含むファイル．</p>
</div>
<div class="paragraph">
<p>ヘッダファイルは，原則として，複数回インクルードしてもエラーにならない
ように対処されている．具体的には，ヘッダファイルの先頭で特定の識別子
（例えば，kernel.hなら"TOPPERS_KERNEL_H"）がマクロ定義され，ヘッダファ
イルの内容全体をその識別子が定義されていない場合のみ有効とする条件ディ
レクティブが付加されている【NGKI0024】．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_主な概念">2.3. 主な概念</h3>
<div class="sect3">
<h4 id="_オブジェクトと処理単位">2.3.1. オブジェクトと処理単位</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>オブジェクト<br></p>
<div class="paragraph">
<p>カーネルまたはシステムサービスが管理対象とするソフトウェア資源を，オブ
ジェクト（object）と呼ぶ．特に，カーネルが管理対象とするソフトウェア資
源を，カーネルオブジェクト（kernel object）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>オブジェクトは，種類毎に，番号によって識別する【NGKI0025】．カーネルま
たはシステムサービスで，オブジェクトに対して任意に識別番号を付与できる
場合には，1から連続する正の整数値でオブジェクトを識別するのを原則とする
【NGKI0026】．この場合に，オブジェクトの識別番号を，オブジェクトのID番
号（ID number）と呼ぶ．そうでない場合，すなわちカーネルまたはシステムサー
ビスの内部または外部からの条件によって識別番号が決まる場合には，オブジェ
クトの識別番号を，オブジェクト番号（object number）と呼ぶ．識別する必要
のないオブジェクトには，識別番号を付与しない場合がある【NGKI0027】．</p>
</div>
<div class="paragraph">
<p>オブジェクト属性（object attribute）は，オブジェクトの動作モードや初期
状態を定めるもので，オブジェクトの登録時に指定する【NGKI0028】．オブジェ
クト属性にTA_XXXXが指定されている場合，そのオブジェクトを，TA_XXXX属性
のオブジェクトと呼ぶ．複数の属性を指定する場合には，オブジェクト属性を
渡すパラメータに，指定する属性値のビット毎論理和（C言語の"|"）を渡す
【NGKI0029】．また，指定すべきオブジェクト属性がない場合には，TA_NULLを
指定する【NGKI0030】．</p>
</div>
</li>
<li>
<p>処理単位<br></p>
<div class="paragraph">
<p>オブジェクトの中には，プログラムが対応付けられるものがある．プログラム
が対応付けられるオブジェクト（または，対応付けられるプログラム）を，処
理単位（processing unit）と呼ぶ．処理単位に対応付けられるプログラムは，
アプリケーションまたはシステムサービスで用意し，カーネルが実行制御する．</p>
</div>
<div class="paragraph">
<p>処理単位の実行を要求することを起動（activate），処理単位の実行を開始す
ることを実行開始（start）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>拡張情報（extended information）は，処理単位が呼び出される時にパラメー
タとして渡される情報で，処理単位の登録時に指定する【NGKI0031】．拡張情
報は，カーネルやシステムサービスの動作には影響しない【NGKI0032】．</p>
</div>
</li>
<li>
<p>タスク<br></p>
<div class="paragraph">
<p>カーネルが実行順序を制御するプログラムの並行実行の単位をタスク（task）
と呼ぶ．タスクは，処理単位の1つである．</p>
</div>
<div class="paragraph">
<p>サービスコールの機能説明において，サービスコールを呼び出したタスクを，
自タスク（invoking task）と呼ぶ．拡張サービスコールからサービスコールを
呼び出した場合には，拡張サービスコールを呼び出したタスクが自タスクであ
る．</p>
</div>
<div class="paragraph">
<p>カーネルには，静的APIにより，少なくとも1つのタスクを登録しなければなら
ない．タスクが登録されていない場合には，コンフィギュレータがエラーを報
告する【NGKI0033】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>タスクが呼び出した拡張サービスコールが実行されている間は，「サービスコー
ルを呼び出した処理単位」は拡張サービスコールであり，「自タスク」とは一
致しない．そのため，保護機能対応カーネルにおいて，「サービスコールを呼
び出した処理単位の属する保護ドメイン」と「自タスクの属する保護ドメイン」
は，異なるものを指す．</p>
</div>
</li>
<li>
<p>ディスパッチとスケジューリング<br></p>
<div class="paragraph">
<p>プロセッサが実行するタスクを切り換えることを，タスクディスパッチまたは
単にディスパッチ（dispatching）と呼ぶ．それに対して，次に実行すべきタス
クを決定する処理を，タスクスケジューリングまたは単にスケジューリング
（scheduling）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>ディスパッチが起こるべき状態（すなわち，スケジューリングによって，現在
実行しているタスクとは異なるタスクが，実行すべきタスクに決定されている
状態）となっても，何らかの理由でディスパッチを行わないことを，ディスパッ
チの保留（pend dispatching）という．ディスパッチを行わない理由が解除さ
れた時点で，ディスパッチが起こる【NGKI0034】．</p>
</div>
</li>
<li>
<p>割込みとCPU例外<br></p>
<div class="paragraph">
<p>プロセッサが実行中の処理とは独立に発生するイベントによって起動される例
外処理のことを，外部割込みまたは単に割込み（interrupt）と呼ぶ．それに対
して，プロセッサが実行中の処理に依存して起動される例外処理を，CPU例外
（CPU exception）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>周辺デバイスからの割込み要求をプロセッサに伝える経路を遮断し，割込み要
求が受け付けられるのを抑止することを，割込みのマスク（mask interrupt）
または割込みの禁止（disable interrupt）という．マスクが解除された時点で，
まだ割込み要求が保持されていれば，その時点で割込み要求を受け付ける
【NGKI0035】．</p>
</div>
<div class="paragraph">
<p>マスクすることができない割込みを，NMI（non-maskable interrupt）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様において，未定義のまま使われていた割込みとCPU例外という用
語を定義した．</p>
</div>
</li>
<li>
<p>タイムイベントとタイムイベントハンドラ<br></p>
<div class="paragraph">
<p>時間の経過をきっかけに発生するイベントをタイムイベント（time event）と
呼ぶ．タイムイベントにより起動され，カーネルが実行制御する処理単位を，
タイムイベントハンドラ（time event handler）と呼ぶ．</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_サービスコールとパラメータ">2.3.2. サービスコールとパラメータ</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>優先順位と優先度<br></p>
<div class="paragraph">
<p>優先順位（precedence）とは，処理単位の実行順序を説明するための仕様上の
概念である．複数の処理単位が実行できる場合には，その中で最も優先順位の
高い処理単位が実行される【NGKI0036】．</p>
</div>
<div class="paragraph">
<p>優先度（priority）は，タスクなどの処理単位の優先順位や，メッセージなど
の配送順序を決定するために，アプリケーションが処理単位やメッセージなど
に与える値である．優先度は，符号付きの整数型であるPRI型で表し，1から連
続した正の値を用いるのを原則とする【NGKI0037】．優先度は，値が小さいほ
ど優先度が高い（すなわち，先に実行または配送される）ものとする
【NGKI0038】．</p>
</div>
</li>
<li>
<p>システム時刻と相対時間<br></p>
<div class="paragraph">
<p>カーネルが管理する時刻を，システム時刻（system time）と呼ぶ．システム時
刻は，符号無しの整数型であるSYSTIM型で表し，単位はミリ秒とする
【NGKI0039】．システム時刻は，タイムティック（time tick）を通知するため
のタイマ割込みが発生する毎に更新される【NGKI0040】．</p>
</div>
<div class="paragraph">
<p>イベントを発生させる時刻を指定する場合には，基準時刻（base time）からの
相対時間（relative time）によって指定する【NGKI0041】．基準時刻は，別に
規定がない限りは，相対時間を指定するサービスコールを呼び出した時刻とな
る【NGKI0042】．</p>
</div>
<div class="paragraph">
<p>相対時間は，符号無しの整数型であるRELTIM型で表し，単位はシステム時刻と
同一，すなわちミリ秒とする【NGKI0043】．相対時間には，少なくとも，16ビッ
トの符号無しの整数型（uint16_t型）に格納できる任意の値を指定することが
できるが，RELTIM型（uint_t型に定義される）に格納できる任意の値を指定で
きるとは限らない【NGKI0044】．相対時間に指定できる最大値は，構成マクロ
TMAX_RELTIMに定義されている【NGKI0045】．</p>
</div>
<div class="paragraph">
<p>イベントを発生させる時刻を相対時間で指定した場合，イベントの処理が行わ
れるのは，基準時刻から相対時間によって指定した以上の時間が経過した後と
なる【NGKI0046】．ただし，基準時刻を定めるサービスコールを呼び出した時
に，タイムティックを通知するためのタイマ割込みがマスクされている場合
（タイマ割込みより優先して実行される割込み処理が実行されている場合を含
む）は，相対時間によって指定した以上の時間が経過した後となることは保証
されない【NGKI0047】．</p>
</div>
<div class="paragraph">
<p>イベントが発生する時刻を参照する場合には，基準時刻からの相対時間として
返される【NGKI0048】．基準時刻は，相対時間を返すサービスコールを呼び出
した時刻となる【NGKI0049】．</p>
</div>
<div class="paragraph">
<p>イベントが発生する時刻が相対時間で返された場合，イベントの処理が行われ
るのは，基準時刻から相対時間として返された以上の時間が経過した後となる
【NGKI0050】．ただし，相対時間を返すサービスコールを呼び出した時に，タ
イムティックを通知するためのタイマ割込みがマスクされている場合（タイマ
割込みより優先して実行される割込み処理が実行されている場合を含む）は，
相対時間として返された以上の時間が経過した後となることは保証されない
【NGKI0051】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>相対時間に0を指定した場合，基準時刻後の最初のタイムティックでイベントの
処理が行われる．また，1を指定した場合，基準時刻後の2回目以降のタイム
ティックでイベントの処理が行われる．これは，基準時刻後の最初のタイム
ティックは，基準時刻の直後に発生する可能性があるため，ここでイベントの
処理を行うと，基準時刻からの経過時間が1以上という仕様を満たせないためで
ある．</p>
</div>
<div class="paragraph">
<p>同様に，相対時間として0が返された場合，基準時刻後の最初のタイムティック
でイベントの処理が行われる．また，1が返された場合，基準時刻後の2回目以
降のタイムティックでイベントの処理が行われる．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>相対時間（RELTIM型）とシステム時刻（SYSTIM型）の時間単位は，μITRON4.0
仕様では実装定義としていたが，この仕様ではミリ秒と規定した．また，相対
時間の解釈について，より厳密に規定した．</p>
</div>
<div class="paragraph">
<p>TMAX_RELTIMは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
</li>
<li>
<p>タイムアウトとポーリング<br></p>
<div class="paragraph">
<p>サービスコールの中で待ち状態が指定した時間以上継続した場合に，サービス
コールの処理を取りやめて，サービスコールからリターンすることを，タイム
アウト（timeout）という．タイムアウトしたサービスコールからは，E_TMOUT
エラーが返る【NGKI0052】．</p>
</div>
<div class="paragraph">
<p>タイムアウトを起こすまでの時間（タイムアウト時間）は，符号付きの整数型
であるTMO型で表し，単位はシステム時刻と同一，すなわちミリ秒とする
【NGKI0053】．タイムアウト時間に正の値を指定した場合には，タイムアウト
を起こすまでの相対時間を表す【NGKI0054】．すなわち，タイムアウトの処理
が行われるのは，サービスコールを呼び出してから指定した以上の時間が経過
した後となる．</p>
</div>
<div class="paragraph">
<p>ポーリング（polling）を行うサービスコールとは，サービスコールの中で待ち
状態に遷移すべき状況になった場合に，サービスコールの処理を取りやめてリ
ターンするサービスコールのことをいう．ここで，サービスコールの処理を取
りやめてリターンすることを，ポーリングに失敗したという．ポーリングに失
敗したサービスコールからは，E_TMOUTエラーが返る【NGKI0055】．</p>
</div>
<div class="paragraph">
<p>ポーリングを行うサービスコールでは，待ち状態に遷移することはないのが原
則である【NGKI0056】．そのため，ポーリングを行うサービスコールは，ディ
スパッチ保留状態であっても呼び出せる【NGKI0057】．ただし，サービスコー
ルの中で待ち状態に遷移する状況が複数ある場合，ある状況でポーリング動作
をしても，他の状況では待ち状態に遷移する場合がある．このような場合の振
舞いは，該当するサービスコール毎に規定する【NGKI0058】．</p>
</div>
<div class="paragraph">
<p>タイムアウト付きのサービスコールは，別に規定がない限りは，タイムアウト
時間にTMO_POL（＝0）を指定した場合にはポーリングを行い，TMO_FEVR（＝-1）
を指定した場合にはタイムアウトを起こさないものとする【NGKI0059】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>［NGKI0019］の原則より，サービスコールがタイムアウトした場合やポーリン
グに失敗した場合には，サービスコールによる副作用がないのが原則である．
ただし，そのような実装ができない場合にはこの原則の例外とし，どのような
副作用があるかをサービスコール毎に規定する．</p>
</div>
<div class="paragraph">
<p>タイムアウト付きのサービスコールを，タイムアウト時間をTMO_POLとして呼び
出した場合には，ディスパッチ保留状態で呼び出すとE_CTXエラーとなることを
除いては，ポーリングを行うサービスコールと同じ振舞いをする．また，タイ
ムアウト時間をTMO_FEVRとして呼び出した場合には，タイムアウトなしのサー
ビスコールと全く同じ振舞いをする．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>タイムアウト時間（TMO型）の時間単位は，μITRON4.0仕様では実装定義として
いたが，この仕様ではミリ秒と規定した．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>ディスパッチ保留状態において，ポーリングを行うサービスコールを呼び出せ
る場合があるのに対して，タイムアウト付きのサービスコールをタイムアウト
時間をTMO_POLとして呼び出すとエラーになるのは，割込み優先度マスクが全解
除でない状態やディスパッチ禁止状態では，自タスクを広義の待ち状態に遷移
させる可能性のあるサービスコール（タイムアウト付きのサービスコールはこ
れに該当）を呼び出すことはできないという原則［NGKI0175］と［NGKI0179］
があるためである．</p>
</div>
</li>
<li>
<p>ノンブロッキング<br></p>
<div class="paragraph">
<p>サービスコールの中で待ち状態に遷移すべき状況になった時，サービスコール
の処理を継続したままサービスコールからリターンする場合，そのサービスコー
ルをノンブロッキング（non-blocking）という．処理を継続したままリターン
する場合，サービスコールからはE_WBLKエラーが返る【NGKI0060】．E_WBLKは
警告を表すエラーコードであり，サービスコールによる副作用がないという原
則は適用されない【NGKI0061】．</p>
</div>
<div class="paragraph">
<p>サービスコールからE_WBLKエラーが返った場合には，サービスコールの処理は
継続しているため，サービスコールに渡したパラメータまたはリターンパラメー
タを入れる領域はまだ参照される可能性があり，別の目的に使用することはで
きない【NGKI0062】．継続している処理が完了した場合や，何らかの理由で処
理が取りやめられた場合には，コールバックを呼び出すなどの方法で，サービ
スコールを呼び出したソフトウェアに通知するものとする【NGKI0063】．</p>
</div>
<div class="paragraph">
<p>ノンブロッキングの指定は，タイムアウト時間にTMO_NBLK（＝-2）を指定する
ことによって行う【NGKI0064】．ノンブロッキングの指定を行えるサービスコー
ルは，指定した場合の振舞いをサービスコール毎に規定する【NGKI0065】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>ノンブロッキングは，システムサービスでサポートすることを想定した機能で
ある．カーネルは，ノンブロッキングの指定を行えるサービスコールをサポー
トしていない．</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_保護機能">2.3.3. 保護機能</h4>
<div class="paragraph">
<p>この節では，保護機能に関連する主な概念について説明する．この節の内容は，
保護機能対応カーネルにのみ適用される．</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アクセス保護<br></p>
<div class="paragraph">
<p>保護機能対応カーネルは，処理単位が，許可されたカーネルオブジェクトに対
して，許可された種別のアクセスを行うことのみを許し，それ以外のアクセス
を防ぐアクセス保護機能を提供する【NGKI0066】．</p>
</div>
<div class="paragraph">
<p>アクセス制御の用語では，処理単位が主体（subject），カーネルオブジェクト
が対象（object）ということになる．</p>
</div>
</li>
<li>
<p>メモリオブジェクト<br></p>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，メモリ領域をカーネルオブジェクトとして
扱い，アクセス保護の対象とする【NGKI0067】．カーネルがアクセス保護の対
象とする連続したメモリ領域を，メモリオブジェクト（memory object）と呼ぶ．
メモリオブジェクトは，互いに重なりあうことはない【NGKI0068】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトは，その先頭番地によって識別する【NGKI0069】．言い換
えると，先頭番地がオブジェクト番号となる．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトの先頭番地とサイズには，ターゲットハードウェアでメモ
リ保護が実現できるように，ターゲット定義の制約が課せられる【NGKI0070】．</p>
</div>
</li>
<li>
<p>保護ドメイン<br></p>
<div class="paragraph">
<p>保護機能を提供するために用いるカーネルオブジェクトの集合を，保護ドメイ
ン（protection domain）と呼ぶ．保護ドメインは，保護ドメインIDと呼ぶID番
号によって識別する【NGKI0071】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトは，たかだか1つの保護ドメインに属する．処理単位は，
いずれか1つの保護ドメインに属さなければならないのに対して，それ以外のカー
ネルオブジェクトは，いずれの保護ドメインにも属さないことができる
【NGKI0072】．いずれの保護ドメインにも属さないカーネルオブジェクトを，
無所属のカーネルオブジェクト（independent kernel object）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>処理単位がカーネルオブジェクトにアクセスできるかどうかは，処理単位が属
する保護ドメインにより決まるのが原則である【NGKI0073】．すなわち，カー
ネルオブジェクトに対するアクセス権は，処理単位ではなく，保護ドメイン単
位で管理される．このことから，ある保護ドメインに属する処理単位がアクセ
スできることを，単に，その保護ドメインからアクセスできるという．</p>
</div>
<div class="paragraph">
<p>ただし，タスクのユーザスタック領域は，ターゲット定義での変更がない限り
は，そのタスク（とカーネルドメインに属する処理単位）のみがアクセスでき
る（「2.11.6 ユーザタスクのユーザスタック領域」の節を参照）【NGKI0074】．
これは，［NGKI0073］の原則の例外となっている．</p>
</div>
<div class="paragraph">
<p>デフォルトでは，保護ドメインに属するカーネルオブジェクトは，同じ保護ド
メイン（とカーネルドメイン）のみからアクセスできる【NGKI0075】．また，
無所属のカーネルオブジェクトは，すべての保護ドメインからアクセスできる
【NGKI0076】．</p>
</div>
</li>
<li>
<p>カーネルドメインとユーザドメイン<br></p>
<div class="paragraph">
<p>システムには，カーネルドメイン（kernel domain）と呼ばれる保護ドメインが
1つ存在する【NGKI0077】．カーネルドメインに属する処理単位は，プロセッサ
の特権モードで実行される【NGKI0078】．また，すべてのカーネルオブジェク
トに対して，すべての種別のアクセスを行うことが許可される【NGKI0079】．
この仕様で，「ある保護ドメイン（またはタスク）のみからアクセスできる」
といった場合でも，カーネルドメインドメインからはアクセスすることができ
る．</p>
</div>
<div class="paragraph">
<p>カーネルドメイン以外の保護ドメインを，ユーザドメイン（user domain）と呼
ぶ．ユーザドメインに属する処理単位は，プロセッサの非特権モードで実行さ
れる【NGKI0080】．また，どのカーネルオブジェクトに対してどの種別のアク
セスを行えるかを制限することができる【NGKI0081】．</p>
</div>
<div class="paragraph">
<p>ユーザドメインには，1から連続する正の整数値の保護ドメインIDが付与される
【NGKI0082】．カーネルドメインの保護ドメインIDは，TDOM_KERNEL（＝-1）で
ある【NGKI0083】．</p>
</div>
<div class="paragraph">
<p>この仕様では，システムに登録できるユーザドメインの数は，32個以下に制限
する【NGKI0084】．これを超える数のユーザドメインを登録した場合には，コ
ンフィギュレータがエラーを報告する【NGKI0085】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>ユーザドメインは，システムコンフィギュレーションファイル中にユーザドメ
インの囲みを記述することで，カーネルに登録する（「2.12.3 保護ドメインの
指定」の節を参照）．ユーザドメインを動的に生成する機能は，現時点では用
意していない．</p>
</div>
<div class="paragraph">
<p>保護機能対応でないカーネルは，カーネルドメインのみをサポートしていると
みなすこともできる．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様のシステムドメイン（system domain）は，現時点ではサポー
トしない．システムドメインは，それに属する処理単位が，プロセッサの特権
モードで実行され，カーネルオブジェクトに対するアクセスを制限することが
できる保護ドメインである．</p>
</div>
</li>
<li>
<p>システムタスクとユーザタスク<br></p>
<div class="paragraph">
<p>カーネルドメインに属するタスクをシステムタスク（system task），ユーザド
メインに属するタスクをユーザタスク（user task）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>特権モードで実行されるタスクをシステムタスク，非特権モードで実行される
タスクをユーザタスクと定義する方法もあるが，ユーザタスクであっても，サー
ビスコールの実行中は特権モードで実行されるため，上記の定義とした．</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様のシステムドメインに属するタスクは，システムタスクと呼
ぶことになる．</p>
</div>
</li>
<li>
<p>アクセス許可パターン<br></p>
<div class="paragraph">
<p>あるカーネルオブジェクトに対するある種別のアクセスが，どの保護ドメイン
に属する処理単位に許可されているかを表現するビットパターンを，アクセス
許可パターン（access permission pattern）と呼ぶ．アクセス許可パターンの
各ビットは，1つのユーザドメインに対応する【NGKI0086】．カーネルドメイン
には，すべてのアクセスが許可されているため，カーネルドメインに対応する
ビットは用意されていない．</p>
</div>
<div class="paragraph">
<p>アクセス許可パターンは，符号無し32ビット整数に定義されるデータ型
（ACPTN）で保持し，値が1のビットに対応するユーザドメインにアクセスが許
可されていることを表す【NGKI0087】．そのため，2つのアクセス許可パターン
のビット毎論理和（C言語の"|"）を求めることで，アクセスを許可されている
ユーザドメインの和集合（union）を得ることができる．また，2つのアクセス
許可パターンのビット毎論理積（C言語の"&amp;"）を求めることで，アクセスを許
可されているユーザドメインの積集合（intersection）を得ることができる．</p>
</div>
<div class="paragraph">
<p>アクセス許可パターンの指定に用いるために，指定したユーザドメインのみに
アクセスを許可することを示すアクセス許可パターンを構成するマクロ（TACP）
が用意されている【NGKI0088】．また，カーネルドメインのみにアクセスを許
可することを示すアクセス許可パターンを表す定数（TACP_KERNEL）と，すべて
の保護ドメインにアクセスを許可することを示すアクセス許可パターンを表す
定数（TACP_SHARED）が用意されている【NGKI0089】．</p>
</div>
</li>
<li>
<p>アクセス許可ベクタ<br></p>
<div class="paragraph">
<p>カーネルオブジェクトに対するアクセスは，カーネルオブジェクトの種類毎に，
通常操作1，通常操作2，管理操作，参照操作の4つの種別に分類されている
【NGKI0090】．あるカーネルオブジェクトに対する4つの種別のアクセスに関す
るアクセス許可パターンをひとまとめにしたものを，アクセス許可ベクタ
（access permission vector）と呼び，次のように定義されるデータ型
（ACVCT）で保持する【NGKI0091】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	typedef struct acvct {
		ACPTN	acptn1;		/* 通常操作1のアクセス許可パターン */
		ACPTN	acptn2;		/* 通常操作2のアクセス許可パターン */
		ACPTN	acptn3;		/* 管理操作のアクセス許可パターン */
		ACPTN	acptn4;		/* 参照操作のアクセス許可パターン */
	} ACVCT;</code></pre>
</div>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトの種類毎のアクセスの種別の分類については，「5.8 カー
ネルオブジェクトに対するアクセスの種別」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様では，アクセス許可ベクタを，1つまたは2つのアクセス許可
パターンで構成することも許しているが，この仕様では4つで構成するものと決
めている．</p>
</div>
</li>
<li>
<p>サービスコールの呼出し方法<br></p>
<div class="paragraph">
<p>保護機能対応カーネルでは，サービスコールは，ソフトウェア割込みによって
呼び出すのが基本である．サービスコール呼出しを通常の方法で記述した場合，
ソフトウェア割込みによって呼び出すコードが生成される【NGKI0092】．</p>
</div>
<div class="paragraph">
<p>一般に，ソフトウェア割込みによるサービスコール呼出しはオーバヘッドが大
きい．そのため，カーネルドメインに属する処理単位からは，関数呼出しによっ
てサービスコールを呼び出すことで，オーバヘッドを削減することができる．
そこで，カーネルドメインに属する処理単位から関数呼出しによってサービス
コールを呼び出せるように，以下の機能が用意されている．</p>
</div>
<div class="paragraph">
<p>カーネルドメインに属する処理単位が実行する関数のみを含んだソースファイ
ルでは，カーネルヘッダファイル（kernel.h）をインクルードする前に，
TOPPERS_SVC_CALLをマクロ定義することで，サービスコール呼出しを通常の方
法で記述した場合に，関数呼出しによって呼び出すコードが生成される
【NGKI0093】．</p>
</div>
<div class="paragraph">
<p>また，カーネルドメインに属する処理単位が実行する関数と，ユーザドメイン
に属する処理単位が実行する関数の両方を含んだソースファイルでは，関数呼
出しによってサービスコールを呼び出すための名称を作るマクロ（SVC_CALL）
を用いることで，関数呼出しによって呼び出すコードが生成される
【NGKI0094】．例えば，act_tskを関数呼出しによって呼び出す場合には，次の
ように記述すればよい．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	ercd = SVC_CALL(act_tsk)(tskid);</code></pre>
</div>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>拡張サービスコールを，関数呼出しによって呼び出す方法は用意されていない．
カーネルドメインに属する処理単位が，関数呼出しによって，拡張サービスコー
ルとして登録した関数を呼び出すことはできるが，その場合には，処理単位が
呼び出した通常の関数であるとみなされ，拡張サービスコールであるとは扱わ
れない．</p>
</div>
</li>
<li>
<p>ユーザドメインから行える処理に対する制限<br></p>
<div class="paragraph">
<p>ユーザドメインに属する処理単位が，システムの重要な処理に悪影響を及ぼす
のを防ぐために，ユーザドメインから行える処理に対して制限を設ける機能が
用意されている．具体的には，ユーザドメインに属する処理単位が，タスクの
ベース優先度を変更する際に，指定できるタスク優先度を制限することができ
る．</p>
</div>
<div class="paragraph">
<p>この機能を実現するために，各ユーザドメインは次の情報を持つ【NGKI0531】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>指定できる最高のタスク優先度</p>
<div class="paragraph">
<p>なお，カーネルドメインに対しては，制限を設ける機能を用意していない．す
なわち，カーネルドメインに属する処理単位は，すべてのタスク優先度を使う
ことができる【NGKI0532】．</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_マルチプロセッサ対応">2.3.4. マルチプロセッサ対応</h4>
<div class="paragraph">
<p>この節では，マルチプロセッサ対応に関連する主な概念について説明する．こ
の節の内容は，マルチプロセッサ対応カーネルにのみ適用される．</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>クラス<br></p>
<div class="paragraph">
<p>マルチプロセッサに対応するために用いるカーネルオブジェクトの集合を，ク
ラス（class）と呼ぶ．クラスは，クラスIDと呼ぶID番号によって識別する
【NGKI0095】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトは，いずれか1つのクラスに属するのが原則である
【NGKI0096】．カーネルオブジェクトが属するクラスは，オブジェクトの登録
時に決定し，登録後に変更することはできない【NGKI0097】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>処理単位を実行するプロセッサを静的に決定する機能分散型のマルチプロセッ
サシステムでは，プロセッサ毎にクラスを設ける方法が典型的である．それに
対して，対称型のマルチプロセッサシステムで，処理単位のマイグレーション
を許す場合には，プロセッサ毎のクラスに加えて，どのプロセッサでも実行で
きるクラスを（システム中に1つまたは初期割付けプロセッサ毎に）設ける方法
が典型的である．</p>
</div>
<div class="paragraph">
<p>［NGKI0096］の原則に関わらず，以下のオブジェクトはいずれのクラスにも属
さない．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>オーバランハンドラ</p>
</li>
<li>
<p>拡張サービスコール</p>
</li>
<li>
<p>グローバル初期化ルーチン</p>
</li>
<li>
<p>グローバル終了処理ルーチン</p>
<div class="paragraph">
<p>マルチプロセッサ対応でないカーネルは，カーネルによって規定された1つのク
ラスのみをサポートしているとみなすこともできる．</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>プロセッサ<br></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>たかだか1つの処理単位のみを同時に実行できるハードウェアの単位を，プロセッ
サ（processor）と呼ぶ．プロセッサは，プロセッサIDと呼ぶID番号によって識
別する【NGKI0098】．</p>
</div>
<div class="paragraph">
<p>+
複数のプロセッサを持つシステム構成をマルチプロセッサ（multiprocessor）
と呼び，同時に複数の処理単位を実行することができる【NGKI0099】．</p>
</div>
<div class="paragraph">
<p>+
システムの初期化時と終了時に特別な役割を果たすプロセッサを，マスタプロ
セッサ（master processor）と呼び，システムに1つ存在する【NGKI0100】．ど
のプロセッサをマスタプロセッサとするかは，ターゲット定義である
【NGKI0101】．マスタプロセッサ以外のプロセッサを，スレーブプロセッサ
（slave processor）と呼ぶ．なお，カーネル動作状態では，マスタプロセッサ
とスレーブプロセッサの振舞いに違いはない【NGKI0102】．</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>処理単位の割付けとマイグレーション<br></p>
<div class="paragraph">
<p>処理単位は，後述のマイグレーションが発生しない限りは，いずれか1つのプロ
セッサに割り付けられて実行される【NGKI0103】．処理単位を実行するプロセッ
サを，割付けプロセッサと呼ぶ．また，処理単位が登録時に割り付けられるプ
ロセッサを，初期割付けプロセッサと呼ぶ．</p>
</div>
<div class="paragraph">
<p>処理単位によっては，処理単位の登録後に，割付けプロセッサを変更すること
が可能である【NGKI0104】．処理単位の登録後に割付けプロセッサを変更する
ことを，処理単位のマイグレーション（migration）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>割付けプロセッサを変更できる処理単位に対しては，処理単位を割り付けるこ
とができるプロセッサ（これを，割付け可能プロセッサと呼ぶ）を制限するこ
とができる【NGKI0105】．</p>
</div>
</li>
<li>
<p>クラスの持つ属性とカーネルオブジェクト<br></p>
<div class="paragraph">
<p>タスクの初期割付けプロセッサや割付け可能プロセッサなど，カーネルオブジェ
クトをマルチプロセッサ上で実現する際に設定すべき属性は，そのカーネルオ
ブジェクトが属するクラスによって定まる．</p>
</div>
<div class="paragraph">
<p>各クラスが持ち，それに属するカーネルオブジェクトに適用される属性は，次
の通りである【NGKI0106】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>初期割付けプロセッサ</p>
</li>
<li>
<p>割付け可能プロセッサ（複数のプロセッサを指定可能，初期割付けプロセッサを含む）</p>
</li>
<li>
<p>ATT_MOD／ATA_MODによって，オブジェクトモジュールに含まれる標準のセクションがされるメモリリージョン（標準メモリリージョン）</p>
</li>
<li>
<p>オブジェクト生成に必要なメモリ領域（オブジェクトの管理ブロック，タスクのスタックやデータキューのデータキュー管理領域など）の配置場所</p>
</li>
<li>
<p>その他の管理情報（ロック単位など）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用できるクラスのID番号とその属性は，ターゲット定義である【NGKI0107】．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>クラスを導入することで，カーネルオブジェクト毎に上記の属性を設定できる
ようにしなかったのは，これらの属性をアプリケーション設計者が個別に設定
するよりも，ターゲット依存部の実装者が有益な組み合わせをあらかじめ用意
しておく方が良いと考えたためである．</p>
</div>
</li>
<li>
<p>ローカルタイマ方式とグローバルタイマ方式<br></p>
<div class="paragraph">
<p>システム時刻の管理方式として，プロセッサ毎にシステム時刻を持つローカル
タイマ方式と，システム全体で1つのシステム時刻を持つグローバルタイマ方式
の2つの方式がある．どちらの方式を用いることができるかは，ターゲット定義
である【NGKI0108】．</p>
</div>
<div class="paragraph">
<p>ローカルタイマ方式では，プロセッサ毎のシステム時刻は，それぞれのプロセッ
サが更新する【NGKI0109】．異なるプロセッサのシステム時刻を同期させる機
能は，カーネルでは用意しない．</p>
</div>
<div class="paragraph">
<p>グローバルタイマ方式では，システム中の1つのプロセッサがシステム時刻を更
新する【NGKI0110】．これを，システム時刻管理プロセッサと呼ぶ．どのプロ
セッサをシステム時刻管理プロセッサとするかは，ターゲット定義である
【NGKI0111】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>システム時刻管理プロセッサが，マスタプロセッサと一致している必要はない．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>ローカルタイマ方式の場合に，プロセッサ毎に異なるタイムティックの周期を
設定したい場合が考えられるが，現時点の実装ではサポートしておらず，
TIC_NUMEとTIC_DENOの扱いも未決定であるため，今後の課題とする．</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_その他">2.3.5. その他</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>オブジェクトモジュール<br></p>
<div class="paragraph">
<p>プログラムのオブジェクトコードとデータを含むファイルを，オブジェクトモ
ジュール（object module）と呼ぶ．オブジェクトファイルとライブラリは，オ
ブジェクトモジュールである．</p>
</div>
</li>
<li>
<p>メモリリージョン<br></p>
<div class="paragraph">
<p>オブジェクトモジュールに含まれるセクションの配置対象となる同じ性質を持っ
た連続したメモリ領域をメモリリージョン（memory region）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>メモリリージョンは，文字列によって識別する【NGKI0112】．メモリリージョ
ンを識別する文字列を，メモリリージョン名と呼ぶ．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>この仕様では，メモリ領域（memory area）という用語は，連続したメモリの範
囲という一般的な意味で使っている．</p>
</div>
</li>
<li>
<p>標準のセクション<br></p>
<div class="paragraph">
<p>コンパイラに特別な指定をしない場合に出力するセクションを，標準のセクショ
ン（standard sections）と呼ぶ．コンパイラが出力しないセクションの中で，
ターゲット定義のものを，標準のセクションと扱う場合もある【NGKI0113】．</p>
</div>
</li>
<li>
<p>保護ドメイン毎の標準セクション<br></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，保護ドメイン毎に，標準のセクションを配
置するためのセクションが登録される【NGKI0114】．また，無所属の標準のセ
クションを配置するためのセクションが登録される【NGKI0115】．これらのセ
クションを，保護ドメイン毎の標準セクションと呼ぶ（standards
for each protection domain）．保護ドメイン毎の標準セクションのセクショ
ン名は，ターゲット定義で別に規定がない限りは，標準のセクション名と保護
ドメイン名（カーネルドメインの場合は"kernel"，無所属の場合は"shared"）
を"_"でつないだものとする【NGKI0116】．例えば，カーネルドメインの
".text"セクションのセクション名は，".text_kernel" とする．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_処理単位の種類と実行順序">2.4. 処理単位の種類と実行順序</h3>
<div class="sect3">
<h4 id="_処理単位の種類">2.4.1. 処理単位の種類</h4>
<div class="paragraph">
<p>カーネルが実行を制御する処理単位の種類は次の通りである【NGKI0117】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(a) タスク
	(a.1) タスク例外処理ルーチン
(b) 割込みハンドラ
	(b.1) 割込みサービスルーチン
	(b.2) タイムイベントハンドラ
(c) CPU例外ハンドラ
(d) 拡張サービスコール
(e) 初期化ルーチン
(f) 終了処理ルーチン</pre>
</div>
</div>
<div class="paragraph">
<p>ここで，タイムイベントハンドラとは，時間の経過をきっかけに起動される処
理単位である周期ハンドラ，アラームハンドラ，オーバランハンドラの総称で
ある．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，オーバランハンドラと拡張サービスコールをサポートしてい
ない【ASPS0003】．ただし，オーバランハンドラ機能拡張パッケージを用いる
と，オーバランハンドラ機能を追加することができる【ASPS0004】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，オーバランハンドラと拡張サービスコールをサポートしてい
ない【FMPS0002】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，タスク例外処理ルーチン，タイムイベントハンドラ，拡張サー
ビスコールをサポートしていない【SSPS0002】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_処理単位の実行順序">2.4.2. 処理単位の実行順序</h4>
<div class="paragraph">
<p>処理単位の実行順序を規定するために，ここでは，処理単位の優先順位を規定
する．また，ディスパッチが起こるタイミングを規定するために，ディスパッ
チを行うカーネル内の処理であるディスパッチャの優先順位についても規定す
る．</p>
</div>
<div class="paragraph">
<p>タスクの優先順位は，ディスパッチャの優先順位よりも低い【NGKI0118】．タ
スク間では，高い優先度を持つ方が優先順位が高く，同じ優先度を持つタスク
間では，先に実行できる状態となった方が優先順位が高い【NGKI0119】．詳し
くは，「2.6.3 タスクのスケジューリング規則」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチンの優先順位は，例外が要求されたタスクと同じである
が，タスクよりも先に実行される【NGKI0120】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラの優先順位は，ディスパッチャの優先順位よりも高い
【NGKI0121】．割込みハンドラ間では，高い割込み優先度を持つ方が優先順位
が高く，同じ割込み優先度を持つ割込みハンドラ間では，先に実行開始された
方が優先順位が高い【NGKI0122】．同じ割込み優先度を持つ割込みハンドラ間
での実行開始順序は，この仕様では規定しない．詳しくは，「2.7.2 割込み優
先度」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチンとタイムイベントハンドラの優先順位は，それを呼び
出す割込みハンドラと同じである【NGKI0123】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラの優先順位は，CPU例外がタスクまたはタスク例外処理ルーチ
ンで発生した場合には，ディスパッチャの優先順位と同じであるが，ディスパッ
チャよりも先に実行される【NGKI0124】．CPU例外がその他の処理単位で発生し
た場合には，CPU例外ハンドラの優先順位は，その処理単位の優先順位と同じで
あるが，その処理単位よりも先に実行される【NGKI0125】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールの優先順位は，それを呼び出した処理単位と同じであるが，
それを呼び出した処理単位よりも先に実行される【NGKI0126】．</p>
</div>
<div class="paragraph">
<p>初期化ルーチンは，カーネルの動作開始前に，システムコンフィギュレーショ
ンファイル中に初期化ルーチンを登録する静的APIを記述したのと同じ順序で実
行される【NGKI0127】．終了処理ルーチンは，カーネルの動作終了後に，終了
処理ルーチンを登録する静的APIを記述したのと逆の順序で実行される
【NGKI0128】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，初期化ルーチンには，クラスに属さない
グローバル初期化ルーチンと，クラスに属するローカル初期化ルーチンがある
【NGKI0129】．グローバル初期化ルーチンがマスタプロセッサで実行された後
に，各プロセッサでローカル初期化ルーチンが実行される【NGKI0130】．また，
終了処理ルーチンには，クラスに属さないグローバル終了処理ルーチンと，ク
ラスに属するローカル終了処理ルーチンがある【NGKI0131】．ローカル終了処
理ルーチンが各プロセッサで実行された後に，マスタプロセッサでグローバル
終了処理ルーチンが実行される【NGKI0132】．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>終了処理ルーチンを，登録する静的APIを記述したのと逆順で実行するのは，終
了処理は初期化の逆の順序で行うのがよいためである（システムコンフィギュ
レーションファイルを分割すると，終了処理ルーチンを登録する静的APIだけ逆
順に記述するのは難しい）．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル処理の不可分性">2.4.3. カーネル処理の不可分性</h4>
<div class="paragraph">
<p>カーネルのサービスコール処理やディスパッチャ，割込みハンドラとCPU例外ハ
ンドラの入口処理と出口処理などのカーネル処理は不可分に実行されるのが基
本である．実際には，カーネル処理の途中でアプリケーションが実行される場
合はあるが，アプリケーションがサービスコールを用いて観測できる範囲で，
カーネル処理が不可分に実行された場合と同様に振る舞うのが原則である
【NGKI0133】．これを，カーネル処理の不可分性という．</p>
</div>
<div class="paragraph">
<p>ただし，マルチプロセッサ対応カーネルにおいては，カーネル処理が実行され
ているプロセッサ以外のプロセッサから，カーネル処理の途中の状態が観測で
きる場合がある．具体的には，1つのサービスコールにより複数のオブジェクト
の状態が変化する場合に，一部のオブジェクトの状態のみが変化し，残りのオ
ブジェクトの状態が変化していない過渡的な状態が観測できる場合がある
【NGKI0134】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応でないカーネルでは，1つのサービスコールにより複数の
タスクが実行できる状態になる場合，新しく実行状態となるべきタスクへのディ
スパッチは，すべてのタスクの状態遷移が完了した後に行われる．例えば，低
優先度のタスクAが発行したサービスコールにより，中優先度のタスクBと高優
先度のタスクCがこの順で待ち解除される場合，タスクBとタスクCが待ち解除さ
れた後に，タスクCへのディスパッチが行われる．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，上のことは，1つのプロセッサ内では成り
立つが，他のプロセッサに割り付けられたタスクに対しては成り立たない．例
えば，プロセッサ1で低優先度のタスクAが実行されている時に，他のプロセッ
サ2で実行されているタスクが発行したサービスコールにより，プロセッサ1に
割り付けられた中優先度のタスクBと高優先度のタスクCがこの順で待ち解除さ
れる場合，タスクCが待ち解除される前に，タスクBへディスパッチされる場合
がある．</p>
</div>
</div>
<div class="sect3">
<h4 id="_処理単位を実行するプロセッサ">2.4.4. 処理単位を実行するプロセッサ</h4>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，処理単位を実行するプロセッサ（割付け
プロセッサ）は，その処理単位が属するクラスの初期割付けプロセッサと割付
け可能プロセッサから，次のように決まる．</p>
</div>
<div class="paragraph">
<p>タスク，周期ハンドラ，アラームハンドラは，登録時に，属するクラスの初期
割付けプロセッサに割り付けられる【NGKI0135】．また，割付けプロセッサを
変更するサービスコール（mact_tsk／imact_tsk，mig_tsk，msta_cyc，
msta_alm／imsta_alm）によって，割付けプロセッサを，クラスの割付け可能プ
ロセッサのいずれかに変更することができる【NGKI0136】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラ，CPU例外ハンドラ，ローカル初期化ルーチン，ローカル終了処
理ルーチンは，属するクラスの初期割付けプロセッサで実行される
【NGKI0137】．クラスの割付け可能プロセッサの情報は用いられない．</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチンは，属するクラスの割付け可能プロセッサのいずれか
（オプション設定によりすべて）で実行される【NGKI0138】．クラスの初期割
付けプロセッサの情報は用いられない．</p>
</div>
<div class="paragraph">
<p>以上を整理すると，次の表の通りとなる．この表の中で，「○」はその情報が
使用されることを，「−」はその情報が使用されないことを示す．</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 45.4545%;">
<col style="width: 27.2727%;">
<col style="width: 27.2728%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">初期割付けプロセッサ</th>
<th class="tableblock halign-center valign-top">割付け可能プロセッサ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">タスク（タスク例外処理ルーチンを含む）</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みハンドラ</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>−</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">割込みサービスルーチン</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>−</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">周期ハンドラ</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">アラームハンドラ</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU例外ハンドラ</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>−</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローカル初期化ルーチン</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>−</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ローカル終了処理ルーチン</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>○</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>−</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>オーバランハンドラ，拡張サービスコール，グローバル初期化ルーチン，グロー
バル終了処理ルーチンは，いずれのクラスにも属さない【NGKI0139】．オーバ
ランハンドラは，オーバランを起こしたタスクの割付けプロセッサによって実
行される【NGKI0140】．拡張サービスコールは，それを呼び出した処理単位の
割付けプロセッサによって実行される【NGKI0141】．グローバル初期化ルーチ
ンとグローバル終了処理ルーチンは，マスタプロセッサによって実行される
【NGKI0142】．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_システム状態とコンテキスト">2.5. システム状態とコンテキスト</h3>
<div class="sect3">
<h4 id="_カーネル動作状態と非動作状態">2.5.1. カーネル動作状態と非動作状態</h4>
<div class="paragraph">
<p>カーネルの初期化が完了した後，カーネルの終了処理が開始されるまでの間を，
カーネル動作状態と呼ぶ．それ以外の状態，すなわちカーネルの初期化完了前
（初期化ルーチンの実行中を含む）と終了処理開始後（終了処理ルーチンの実
行中を含む）を，カーネル非動作状態と呼ぶ．プロセッサは，カーネル動作状
態かカーネル非動作状態のいずれかの状態を取る【NGKI0143】．</p>
</div>
<div class="paragraph">
<p>カーネル非動作状態では，原則として，NMIを除くすべての割込みがマスクされ
る【NGKI0144】．</p>
</div>
<div class="paragraph">
<p>カーネル非動作状態では，システムインタフェースレイヤのAPIとカーネル非動
作状態を参照するサービスコール（sns_ker）のみを呼び出すことができる
【NGKI0145】．カーネル非動作状態で，その他のサービスコールを呼び出した
場合の動作は，保証されない【NGKI0146】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，カーネル動作状態かカー
ネル非動作状態のいずれかの状態を取る【NGKI0147】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_タスクコンテキストと非タスクコンテキスト">2.5.2. タスクコンテキストと非タスクコンテキスト</h4>
<div class="paragraph">
<p>処理単位が実行される環境（用いるスタック領域やプロセッサの動作モードな
ど）をコンテキストと呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネル動作状態において，処理単位が実行されるコンテキストは，タスクコ
ンテキストと非タスクコンテキストに分類される【NGKI0148】．</p>
</div>
<div class="paragraph">
<p>タスク（タスク例外処理ルーチンを含む）が実行されるコンテキストは，タス
クコンテキストに分類される【NGKI0149】．また，タスクコンテキストから呼
び出した拡張サービスコールが実行されるコンテキストは，タスクコンテキス
トに分類される【NGKI0150】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラ（割込みサービスルーチンおよびタイムイベントハンドラを含
む）とCPU例外ハンドラが実行されるコンテキストは，非タスクコンテキストに
分類される【NGKI0151】．また，非タスクコンテキストから呼び出した拡張サー
ビスコールが実行されるコンテキストは，非タスクコンテキストに分類される
【NGKI0152】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストで実行される処理単位は，別に規定がない限り，タスクの
スタック領域を用いて実行される【NGKI0153】．非タスクコンテキストで実行
される処理単位は，別に規定がない限り，非タスクコンテキスト用スタック領
域を用いて実行される【NGKI0154】．</p>
</div>
<div class="paragraph">
<p>タスクコンテキストからは，非タスクコンテキスト専用のサービスコールを呼
び出すことはできない【NGKI0155】．逆に，非タスクコンテキストからは，タ
スクコンテキスト専用のサービスコールを呼び出すことはできない
【NGKI0156】．いずれも，呼び出した場合にはE_CTXエラーとなる【NGKI0157】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネルの振舞いに影響を与える状態">2.5.3. カーネルの振舞いに影響を与える状態</h4>
<div class="paragraph">
<p>カーネル動作状態において，プロセッサは，カーネルの振舞いに影響を与える
状態として，次の状態を持つ【NGKI0158】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>全割込みロックフラグ（全割込みロック状態と全割込みロック解除状態）</p>
</li>
<li>
<p>CPUロックフラグ（CPUロック状態とCPUロック解除状態）</p>
</li>
<li>
<p>割込み優先度マスク（割込み優先度マスク全解除状態と全解除でない状態）</p>
</li>
<li>
<p>ディスパッチ禁止フラグ（ディスパッチ禁止状態とディスパッチ許可状態）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これらの状態は，それぞれ独立な状態である．すなわち，プロセッサは上記の
状態の任意の組合せを取ることができ，それぞれの状態を独立に変化させるこ
とができる【NGKI0159】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_全割込みロック状態と全割込みロック解除状態">2.5.4. 全割込みロック状態と全割込みロック解除状態</h4>
<div class="paragraph">
<p>プロセッサは，NMIを除くすべての割込みをマスクするための全割込みロックフ
ラグを持つ【NGKI0160】．全割込みロックフラグがセットされた状態を全割込
みロック状態，クリアされた状態を全割込みロック解除状態と呼ぶ．すなわち，
全割込みロック状態では，NMIを除くすべての割込みがマスクされる．</p>
</div>
<div class="paragraph">
<p>全割込みロック状態では，システムインタフェースレイヤのAPIとカーネル非動
作状態を参照するサービスコール（sns_ker），カーネルを終了するサービスコー
ル（ext_ker）のみを呼び出すことができる【NGKI0161】．全割込みロック状態
で，その他のサービスコール（拡張サービスコールを含む）を呼び出した場合
の動作は，保証されない【NGKI0162】．また，全割込みロック状態で，実行中
の処理単位からリターンしてはならない．リターンした場合の動作は保証され
ない【NGKI0164】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，全割込みロックフラグ
を持つ【NGKI0165】．すなわち，プロセッサ毎に，全割込みロック状態か全割
込みロック解除状態のいずれかの状態を取る．</p>
</div>
</div>
<div class="sect3">
<h4 id="_cpuロック状態とcpuロック解除状態">2.5.5. CPUロック状態とCPUロック解除状態</h4>
<div class="paragraph">
<p>プロセッサは，カーネル管理の割込み（「2.7.7 カーネル管理外の割込み」の
節を参照）をすべてマスクするためのCPUロックフラグを持つ【NGKI0166】．
CPUロックフラグがセットされた状態をCPUロック状態，クリアされた状態を
CPUロック解除状態と呼ぶ．CPUロック状態では，すべてのカーネル管理の割込
みがマスクされ，ディスパッチが保留される【NGKI0167】．</p>
</div>
<div class="paragraph">
<p>CPUロック状態で呼び出すことができるサービスコールは次の通り【NGKI0168】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システムインタフェースレイヤのAPI</p>
</li>
<li>
<p>loc_cpu／iloc_cpu，unl_cpu／iunl_cpu</p>
</li>
<li>
<p>unl_spn／iunl_spn（マルチプロセッサ対応カーネルのみ）</p>
</li>
<li>
<p>dis_int，ena_int</p>
</li>
<li>
<p>sns_yyy</p>
</li>
<li>
<p>xsns_yyy（CPU例外ハンドラからのみ）</p>
</li>
<li>
<p>get_utm</p>
</li>
<li>
<p>ext_tsk，ext_ker</p>
</li>
<li>
<p>prb_mem（保護機能対応カーネルのみ）</p>
</li>
<li>
<p>cal_svc（保護機能対応カーネルのみ）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CPUロック状態で，その他のサービスコールを呼び出した場合には，E_CTXエラー
となる【NGKI0169】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，CPUロックフラグを持つ
【NGKI0170】．すなわち，プロセッサ毎に，CPUロック状態かCPUロック解除状
態のいずれかの状態を取る．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>NMI以外にカーネル管理外の割込みを設けない場合には，全割込みロックフラグ
とCPUロックフラグの機能は同一となるが，両フラグは独立に存在する．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，あるプロセッサがCPUロック状態にあ
る間は，そのプロセッサにおいてのみ，すべてのカーネル管理の割込みがマス
クされ，ディスパッチが保留される．それに対して他のプロセッサにおいては，
割込みはマスクされず，ディスパッチも起こるため，CPUロック状態を使って他
のプロセッサで実行される処理単位との排他制御を実現することはできない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_割込み優先度マスク">2.5.6. 割込み優先度マスク</h4>
<div class="paragraph">
<p>プロセッサは，割込み優先度を基準に割込みをマスクするための割込み優先度
マスクを持つ【NGKI0171】．割込み優先度マスクがTIPM_ENAALL（＝0）の時は，
いずれの割込み要求もマスクされない【NGKI0172】．この状態を割込み優先度
マスク全解除状態と呼ぶ．割込み優先度マスクがTIPM_ENAALL（＝0）以外の時
は，割込み優先度マスクと同じかそれより低い割込み優先度を持つ割込みはマ
スクされ，ディスパッチは保留される【NGKI0173】．この状態を割込み優先度
マスクが全解除でない状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>割込み優先度マスクが全解除でない状態では，別に規定がない限りは，自タス
クを広義の待ち状態に遷移させる可能性のあるサービスコールを呼び出すこと
はできない．呼び出した場合には，E_CTXエラーとなる【NGKI0175】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，割込み優先度マスクを
持つ【NGKI0176】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_ディスパッチ禁止状態とディスパッチ許可状態">2.5.7. ディスパッチ禁止状態とディスパッチ許可状態</h4>
<div class="paragraph">
<p>プロセッサは，ディスパッチを保留するためのディスパッチ禁止フラグを持つ
【NGKI0177】．ディスパッチ禁止フラグがセットされた状態をディスパッチ禁
止状態，クリアされた状態をディスパッチ許可状態と呼ぶ．すなわち，ディス
パッチ禁止状態では，ディスパッチは保留される．</p>
</div>
<div class="paragraph">
<p>ディスパッチ禁止状態では，別に規定がない限りは，自タスクを広義の待ち状
態に遷移させる可能性のあるサービスコールを呼び出すことはできない．呼び
出した場合には，E_CTXエラーとなる【NGKI0179】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，ディスパッチ禁止フラ
グを持つ【NGKI0180】．すなわち，プロセッサ毎に，ディスパッチ禁止状態か
ディスパッチ許可状態のいずれかの状態を取る．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，あるプロセッサがディスパッチ禁止
状態にある間は，そのプロセッサにおいてのみ，ディスパッチが保留される．
それに対して他のプロセッサにおいては，ディスパッチが起こるため，ディス
パッチ禁止状態を使って他のプロセッサで実行されるタスクとの排他制御を実
現することはできない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_ディスパッチ保留状態">2.5.8. ディスパッチ保留状態</h4>
<div class="paragraph">
<p>非タスクコンテキストの実行中，CPUロック状態，割込み優先度マスクが全解除
でない状態，ディスパッチ禁止状態では，ディスパッチが保留される
【NGKI0181】．これらの状態を総称して，ディスパッチ保留状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，ディスパッチ保留状態
かそうでない状態のいずれかの状態を取る【NGKI0182】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>全割込みロック状態はカーネルが管理しておらず，ディスパッチが保留される
ことをカーネルが保証できないため，ディスパッチ保留状態に含めていない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル管理外の状態">2.5.9. カーネル管理外の状態</h4>
<div class="paragraph">
<p>全割込みロック状態，カーネル管理外の割込みハンドラ実行中（「2.7.7 カー
ネル管理外の割込み」の節を参照），カーネル管理外のCPU例外ハンドラ実行中
（「2.8.4 カーネル管理外のCPU例外」の節を参照）を総称して，カーネル管理
外の状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネル管理外の状態では，システムインタフェースレイヤのAPIとsns_ker，
ext_kerのみ（カーネル管理外のCPU例外ハンドラからは，それに加えて
xsns_dpnとxsns_xpn）を呼び出すことができ，その他のサービスコールを呼び
出すことはできない【NGKI0543】．カーネル管理外の状態から，その他のサー
ビスコールを呼び出した場合の動作は，保証されない【NGKI0544】．</p>
</div>
<div class="paragraph">
<p>カーネル管理外の状態では，少なくとも，カーネル管理の割込みはマスクされ
ている【NGKI0545】．カーネル管理外の割込み（の一部）もマスクされている
場合もある【NGKI0546】．保護機能対応カーネルでは，カーネル管理外の状態
になるのは，特権モードで実行している間に限られる【NGKI0547】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_処理単位の開始_終了とシステム状態">2.5.10. 処理単位の開始・終了とシステム状態</h4>
<div class="paragraph">
<p>各処理単位が実行開始されるシステム状態の条件（実行開始条件），各処理単
位の実行開始時にカーネルによって行われるシステム状態の変更処理（実行開
始時処理），各処理単位からのリターン前（または終了前）にアプリケーショ
ンが設定しておくべきシステム状態（リターン前または終了前），各処理単位
からのリターン時（または終了時）にカーネルによって行われるシステム状態
の変更処理（リターン時処理または終了時処理）は，次の表の通りである．</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">CPUロックフラグ</th>
<th class="tableblock halign-left valign-top">割込み優先度マスク</th>
<th class="tableblock halign-left valign-top">ディスパッチ禁止フラグ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">【タスク】【NGKI0183】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">許可</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">終了前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則全解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則許可(*1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">終了時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">許可する</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">【タスク例外処理ルーチン】【NGKI0184】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則全解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元に戻す</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元に戻す(*4)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">【カーネル管理の割込みハンドラ】【NGKI0185】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">【割込みサービスルーチン】【NGKI0186】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">【タイムイベントハンドラ】【NGKI0187】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自優先度より低い</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自優先度に(*2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則解除(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解除する</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元に戻す(*5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">【CPU例外ハンドラ】【NGKI0188】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま(*6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">原則元に(*1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">変更不可(*3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元に戻す</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">元に戻す(*5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">【拡張サービスコール】【NGKI0189】</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始条件</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行開始時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン前</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任意</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">リターン時処理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">そのまま</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>この表の中で「原則(*1)」とは，処理単位からのリターン前（または終了前）
に，アプリケーションが指定された状態に設定しておくことが原則であるが，
この原則に従わなくても，リターン時（または終了時）にカーネルによって状
態が設定されるため，支障がないことを意味する．</p>
</div>
<div class="paragraph">
<p>「自優先度に(*2)」 とは，割込みハンドラと割込みサービスルーチンの場合に
はそれを要求した割込みの割込み優先度，周期ハンドラとアラームハンドラの
場合にはタイマ割込みの割込み優先度，オーバランハンドラの場合にはオーバ
ランタイマ割込みの割込み優先度に変更することを意味する．</p>
</div>
<div class="paragraph">
<p>「変更不可(*3)」 とは，その処理単位中で，そのシステム状態を変更するAPI
が用意されていないことを示す．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，タスク例外処理ルーチンからのリターン時にディ
スパッチ禁止フラグを元に戻す処理(*4)は，タスクにディスパッチ禁止フラグ
の変更を許可している場合にのみ行われる【NGKI0529】．カーネルは，ディス
パッチ禁止フラグの元の状態をユーザスタック上に保存する【NGKI0530】．ア
プリケーションがユーザスタック上に保存されたディスパッチ禁止フラグの状
態を書き換えた場合，タスク例外処理ルーチンからのリターン時には，書き換
えた後のディスパッチ禁止フラグの状態に変更される（すなわち，元に戻され
るとは限らない）【NGKI0190】．</p>
</div>
<div class="paragraph">
<p>また，保護機能対応カーネルでは，タスクにディスパッチ禁止フラグの変更を
許可していない場合で，タスク例外処理ルーチン中で拡張サービスコールを用
いてディスパッチ禁止フラグを変更した場合，カーネルは元の状態に戻さない
【NGKI0191】．このことから，タスク例外処理ルーチンからの終了前に，ディ
スパッチ禁止フラグを元の状態に戻すのは，アプリケーションの責任とする
【NGKI0192】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，タスクがタスク例外処理ルーチンを
実行中にマイグレーションされた場合，マイグレーション先のプロセッサにお
いて，割込み優先度マスクとディスパッチ禁止フラグが元に戻される．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，タスク例外処理ルーチンからのリターン時に
ディスパッチ禁止フラグを元に戻す処理(*4)が，タスクにディスパッチ禁止フ
ラグの変更を許可している場合にのみ行われるのは，タスクがユーザスタック
上の状態を書き換えることで，許可していない状態変更を起こせてしまうこと
を防止するためである．</p>
</div>
<div class="paragraph">
<p>割込みハンドラやCPU例外ハンドラで，その処理単位中で割込み優先度マスクを
変更するAPIが用意されていないにもかかわらず，処理単位からのリターン時に
元の状態に戻す(*5)のは，プロセッサによっては，割込み優先度マスクがステー
タスレジスタ等に含まれており，APIを用いずに変更できてしまう場合があるた
めである．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラの実行開始時には，CPUロックフラグは変更されない(*6)こと
から，CPUロック状態でCPU例外が発生した場合，CPU例外ハンドラの実行開始直
後はCPUロック状態となっている．CPUロック状態でCPU例外が発生した場合，起
動されるCPU例外ハンドラはカーネル管理外のCPU例外ハンドラであり（xsns_dpn，
xsns_xpnともtrueを返す），CPU例外ハンドラ中でiunl_cpuを呼び出してCPUロッ
ク状態を解除しようとした場合の動作は保証されない．ただし，保証されない
にも関わらずiunl_cpuを呼び出した場合も考えられるため，リターン時には元
に戻すこととしている．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_タスクの状態遷移とスケジューリング規則">2.6. タスクの状態遷移とスケジューリング規則</h3>
<div class="sect3">
<h4 id="_基本的なタスク状態">2.6.1. 基本的なタスク状態</h4>
<div class="paragraph">
<p>カーネルに登録したタスクは，実行できる状態，休止状態，広義の待ち状態の
いずれかの状態を取る【NGKI0193】．また，実行できる状態と広義の待ち状態
を総称して，起動された状態と呼ぶ．さらに，タスクをカーネルに登録してい
ない仮想的な状態を，未登録状態と呼ぶ．</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>実行できる状態（runnable）<br></p>
<div class="paragraph">
<p>タスクを実行できる条件が，プロセッサが使用できるかどうかを除いて，揃っ
ている状態．実行できる状態は，さらに，実行状態と実行可能状態に分類され
る．</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>実行状態（running）<br></p>
<div class="paragraph">
<p>タスクが実行されている状態．または，そのタスクの実行中に，割込みまたは
CPU例外により非タスクコンテキストの実行が開始され，かつ，タスクコンテキ
ストに戻った後に，そのタスクの実行を再開するという状態．</p>
</div>
</li>
<li>
<p>実行可能状態（ready）<br></p>
<div class="paragraph">
<p>タスク自身は実行できる状態にあるが，それよりも優先順位の高いタスクが実
行状態にあるために，そのタスクが実行されない状態．</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>休止状態（dormant）<br></p>
<div class="paragraph">
<p>タスクが実行すべき処理がない状態．タスクの実行を終了した後，次に起動す
るまでの間は，タスクは休止状態となっている．タスクが休止状態にある時に
は，タスクの実行を再開するための情報（実行再開番地やレジスタの内容など）
は保存されていない【NGKI0194】．</p>
</div>
</li>
<li>
<p>広義の待ち状態（blocked）<br></p>
<div class="paragraph">
<p>タスクが，処理の途中で実行を止められている状態．タスクが広義の待ち状態
にある時には，タスクの実行を再開するための情報（実行再開番地やレジスタ
の内容など）は保存されており，タスクが実行を再開する時には，広義の待ち
状態に遷移する前の状態に戻される【NGKI0195】．広義の待ち状態は，さらに，
（狭義の）待ち状態，強制待ち状態，二重待ち状態に分類される．</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>（狭義の）待ち状態（waiting）<br></p>
<div class="paragraph">
<p>タスクが何らかの条件が揃うのを待つために，自ら実行を止めている状態．</p>
</div>
</li>
<li>
<p>強制待ち状態（suspended）<br></p>
<div class="paragraph">
<p>他のタスクによって，強制的に実行を止められている状態．ただし，自タスク
を強制待ち状態にすることも可能である．</p>
</div>
</li>
<li>
<p>二重待ち状態（waiting-suspended）+</p>
<div class="paragraph">
<p>待ち状態と強制待ち状態が重なった状態．すなわち，タスクが何らかの条件が
揃うのを待つために自ら実行を止めている時に，他のタスクによって強制的に
実行を止められている状態．</p>
</div>
<div class="paragraph">
<p>単にタスクが「待ち状態である」といった場合には，二重待ち状態である場合
を含み，「待ち状態でない」といった場合には，二重待ち状態でもないことを
意味する．また，単にタスクが「強制待ち状態である」といった場合には，二
重待ち状態である場合を含み，「強制待ち状態でない」といった場合には，二
重待ち状態でもないことを意味する．</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>未登録状態（non-existent）<br></p>
<div class="paragraph">
<p>タスクをカーネルに登録していない仮想的な状態．タスクの生成前と削除後は，
タスクは未登録状態にあるとみなす．</p>
</div>
<div class="paragraph">
<p>カーネルによっては，これらのタスク状態以外に，過渡的な状態が存在する場
合がある【NGKI0196】．過渡的な状態については，「2.6.6 ディスパッチ保留
状態で実行中のタスクに対する強制待ち」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，タスクが未登録状態になることはない【ASPS0005】．また，
上記のタスク状態以外の過渡的な状態になることもない【ASPS0006】．ただし，
動的生成機能拡張パッケージでは，タスクが未登録状態になる【ASPS0007】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，タスクが未登録状態になることはない【FMPS0003】．上記の
タスク状態以外の過渡的な状態として，タスクが強制待ち状態［実行継続中］
になることがある【FMPS0004】．詳しくは，「2.6.6 ディスパッチ保留状態で
実行中のタスクに対する強制待ち」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，タスクが未登録状態になることはない【HRPS0002】．また，
上記のタスク状態以外の過渡的な状態になることもない【HRPS0003】．ただし，
動的生成機能拡張パッケージでは，タスクが未登録状態になる【HRPS0010】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，タスクが広義の待ち状態と未登録状態になることはない
【SSPS0003】．また，上記のタスク状態以外の過渡的な状態になることもない
【SSPS0004】．</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_タスクの状態遷移">2.6.2. タスクの状態遷移</h4>
<div class="paragraph">
<p>タスクの状態遷移を図2-2に示す【NGKI0197】．</p>
</div>
<div class="paragraph">
<p>未登録状態のタスクをカーネルに登録することを，タスクを生成する（create）
という．生成されたタスクは，休止状態に遷移する【NGKI0198】．また，タス
ク生成時の属性指定により，生成と同時にタスクを起動し，実行できる状態に
することもできる【NGKI0199】．逆に，登録されたタスクを未登録状態に遷移
させることを，タスクを削除する（delete）という．</p>
</div>
<div class="paragraph">
<p>休止状態のタスクを，実行できる状態にすることを，タスクを起動する
（activate）という．起動されたタスクは，実行できる状態になる
【NGKI0200】．逆に，起動された状態のタスクを，休止状態（または未登録状
態）に遷移させることを，タスクを終了する（terminate）という．</p>
</div>
<div class="paragraph">
<p>実行できる状態になったタスクは，まずは実行可能状態に遷移するが，そのタ
スクの優先順位が実行状態のタスクよりも高い場合には，ディスパッチ保留状
態でない限りはただちにディスパッチが起こり，実行状態へ遷移する
【NGKI0201】．この時，それまで実行状態であったタスクは実行可能状態に遷
移する【NGKI0202】．この時，実行状態に遷移したタスクは，実行可能状態に
遷移したタスクをプリエンプトしたという．逆に，実行可能状態に遷移したタ
スクは，プリエンプトされたという．</p>
</div>
<div class="paragraph">
<p>タスクを待ち解除するとは，タスクが待ち状態（二重待ち状態を除く）であれ
ば実行できる状態に，二重待ち状態であれば強制待ち状態に遷移させることを
いう．また，タスクを強制待ちから再開するとは，タスクが強制待ち状態（二
重待ち状態を除く）であれば実行できる状態に，二重待ち状態であれば待ち状
態に遷移させることをいう．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>タスクの実行開始とは，タスクが起動された後に最初に実行される（実行状態
に遷移する）時のことをいう．</p>
</div>
</div>
<div class="sect3">
<h4 id="_タスクのスケジューリング規則">2.6.3. タスクのスケジューリング規則</h4>
<div class="paragraph">
<p>実行できるタスクは，優先順位の高いものから順に実行される【NGKI0203】．
すなわち，ディスパッチ保留状態でない限りは，実行できるタスクの中で最も
高い優先順位を持つタスクが実行状態となり，他は実行可能状態となる．</p>
</div>
<div class="paragraph">
<p>タスクの優先順位は，タスクの優先度とタスクが実行できる状態になった順序
から，次のように定まる．優先度の異なるタスクの間では，優先度の高いタス
クが高い優先順位を持つ【NGKI0204】．優先度が同一のタスクの間では，先に
実行できる状態になったタスクが高い優先順位を持つ【NGKI0205】．すなわち，
同じ優先度を持つタスクは，FCFS（First Come First Served）方式でスケジュー
リングされる．ただし，サービスコールの呼出しにより，同じ優先度を持つタ
スク間の優先順位を変更することも可能である【NGKI0206】．</p>
</div>
<div class="paragraph">
<p>最も高い優先順位を持つタスクが変化した場合には，ディスパッチ保留状態で
ない限りはただちにディスパッチが起こり，最も高い優先順位を持つタスクが
実行状態となる【NGKI0207】．ディスパッチ保留状態においては，実行状態の
タスクは切り換わらず，最も高い優先順位を持つタスクは実行可能状態にとど
まる【NGKI0208】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサ毎に，上記のスケジューリン
グ規則を適用して，タスクスケジューリングを行う【NGKI0209】．すなわち，
プロセッサがディスパッチ保留状態でない限りは，そのプロセッサに割り付け
られた実行できるタスクの中で最も高い優先順位を持つタスクが実行状態とな
り，他は実行可能状態となる．そのため，実行状態のタスクは，プロセッサ毎
に存在する．</p>
</div>
</div>
<div class="sect3">
<h4 id="_待ち行列と待ち解除の順序">2.6.4. 待ち行列と待ち解除の順序</h4>
<div class="paragraph">
<p>タスクが待ち解除される順序の管理のために，待ち状態のタスクがつながれて
いるキューを，待ち行列と呼ぶ．また，タスクが同期・通信オブジェクトの待
ち行列につながれている場合に，そのオブジェクトを，タスクの待ちオブジェ
クトと呼ぶ．</p>
</div>
<div class="paragraph">
<p>待ち行列にタスクをつなぐ順序には，FIFO順とタスクの優先度順がある．どち
らの順序でつなぐかは，待ち行列毎に規定される【NGKI0210】．多くの待ち行
列において，どちらの順序でつなぐかを，オブジェクト属性により指定できる
【NGKI0211】．</p>
</div>
<div class="paragraph">
<p>FIFO順の待ち行列においては，新たに待ち状態に遷移したタスクは待ち行列の
最後につながれる【NGKI0212】．それに対してタスクの優先度順の待ち行列に
おいては，新たに待ち状態に遷移したタスクは，優先度の高い順に待ち行列に
つながれる【NGKI0213】．同じ優先度のタスクが待ち行列につながれている場
合には，新たに待ち状態に遷移したタスクが，同じ優先度のタスクの中で最後
につながれる【NGKI0214】．</p>
</div>
<div class="paragraph">
<p>待ち解除の条件がタスクによって異なる場合には，待ち行列の先頭のタスクは
待ち解除の条件を満たさないが，後方のタスクが待ち解除の条件を満たす場合
がある．このような場合の振舞いとして，次の2つのケースがある．どちらの振
舞いをするかは，待ち行列毎に規定される【NGKI0215】．</p>
</div>
<div class="paragraph">
<p>(a) 待ち解除の条件を満たしたタスクの中で，待ち行列の前方につながれたも
のから順に待ち解除される【NGKI0216】．すなわち，待ち行列の前方に待ち解
除の条件を満たさないタスクがあっても，後方のタスクが待ち解除の条件を満
たしていれば，先に待ち解除される．</p>
</div>
<div class="paragraph">
<p>(b) タスクの待ち解除は，待ち行列につながれている順序で行われる
【NGKI0217】．すなわち，待ち行列の前方に待ち解除の条件を満たさないタス
クがあると，後方のタスクが待ち解除の条件を満たしても，待ち解除されない．</p>
</div>
<div class="paragraph">
<p>ここで，(b)の振舞いをする待ち行列においては，待ち行列につながれたタスク
の強制終了，タスク優先度の変更（待ち行列がタスクの優先度順の場合のみ），
待ち状態の強制解除が行われた場合に，タスクの待ち解除が起こることがある．
具体的には，これらの操作により新たに待ち行列の先頭になったタスクが，待
ち解除の条件を満たしていれば，ただちに待ち解除される【NGKI0218】．さら
に，この待ち解除により新たに待ち行列の先頭になったタスクに対しても，同
じ処理が繰り返される【NGKI0219】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_タスク例外処理マスク状態と待ち禁止状態">2.6.5. タスク例外処理マスク状態と待ち禁止状態</h4>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，ユーザタスクについては特権モードで実行し
ている間（特権モードを実行している間に，実行可能状態や広義の待ち状態に
なっている場合を含む．また，サービスコールを呼び出して，実行可能状態や
広義の待ち状態になっている場合も含む．タスクの実行開始前は含まない），
システムタスクについては拡張サービスコールを実行している間（拡張サービ
スコールを実行している間に，実行可能状態や広義の待ち状態になっている場
合を含む）は，タスク例外処理ルーチンの実行は開始されない【NGKI0220】．
これらの状態を，タスク例外処理マスク状態と呼ぶ．</p>
</div>
<div class="paragraph">
<p>タスクは，タスク例外処理マスク状態である時に，基本的なタスク状態と重複
して，待ち禁止状態になることができる【NGKI0221】．待ち禁止状態とは，タ
スクが待ち状態に入ることが一時的に禁止された状態である．待ち禁止状態に
あるタスクが，サービスコールを呼び出して待ち状態に遷移しようとした場合，
サービスコールはE_RLWAIエラーとなる【NGKI0222】．</p>
</div>
<div class="paragraph">
<p>タスクを待ち禁止状態に遷移させるサービスコールは，対象タスクがタスク例
外処理マスク状態である場合に，対象タスクを待ち禁止状態に遷移させる
【NGKI0223】．その後，タスクがタスク例外処理マスク状態でなくなる時点
（ユーザタスクについては特権モードから戻る時点，システムタスクについて
拡張サービスコールからリターンする時点）で，待ち禁止状態が解除される
【NGKI0224】．また，タスクの待ち禁止状態を解除するサービスコールによっ
ても，待ち禁止状態を解除することができる【NGKI0225】．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチンでは，タスクの本体のための例外処理（例えば，タス
クに対して終了要求があった時の処理）を行うことを想定しており，タスクか
ら呼び出した拡張サービスコールのための例外処理を行うことは想定していな
い．そのため，拡張サービスコールを実行している間にタスク例外処理が要求
された場合に，すぐにタスク例外処理ルーチンを実行すると，拡張サービスコー
ルのための例外処理が行われないことになる．</p>
</div>
<div class="paragraph">
<p>また，ユーザタスクの場合には，特権モードを実行中にタスク例外処理ルーチ
ンを実行すると，システムスタックに情報を残したまま非特権モードに戻るこ
とになる．この状態で，タスク例外処理ルーチンから大域脱出すると，システ
ムスタック上に不要な情報が残ってしまう．</p>
</div>
<div class="paragraph">
<p>これらの理由から，タスクが拡張サービスコールを実行している間は，タスク
例外処理マスク状態とし，タスク例外処理ルーチンの実行を開始しないことと
する．さらに，ユーザタスクについては，特権モードを実行している間（拡張
サービスコールを実行している間を含む）を，タスク例外処理マスク状態とす
る．</p>
</div>
<div class="paragraph">
<p>対象タスクに，タスク例外処理ルーチンをすみやかに実行させたい場合には，
タスク例外処理の要求に加えて，待ち状態の強制解除を行う（必要に応じて，
強制待ち状態からの再開も行う）．保護機能対応でないカーネルにおいては，
この方法により，対象タスクが正常に待ち解除されるのを待たずに，タスク例
外処理ルーチンを実行させることができる．</p>
</div>
<div class="paragraph">
<p>それに対して，保護機能対応カーネルにおいては，対象タスクがタスク例外処
理マスク状態で実行している間は，タスク例外処理ルーチンの実行が開始され
ない．そのため，対象タスクに対して待ち状態の強制解除を行っても，その後
に対象タスクが待ち状態に入ると，タスク例外処理ルーチンがすみやかに実行
されないことになる．</p>
</div>
<div class="paragraph">
<p>待ち禁止状態は，この問題を解決するために導入したものである．タスク例外
処理の要求（ras_tex／iras_tex）に加えて，待ち禁止状態への遷移（dis_wai／
idis_wai）と待ち状態の強制解除（rel_wai／irel_wai）をこの順序で行うこと
で，対象タスクが正常に待ち解除されるのを待たずに，タスク例外処理ルーチ
ンを実行させることができる．</p>
</div>
<div class="paragraph">
<p>タスク例外処理マスク状態を，ユーザタスクについても拡張サービスコールを
実行している間とせず，特権モードで実行している間とした理由は，拡張サー
ビスコールを実行している間とした場合に次のような問題があるためである．</p>
</div>
<div class="paragraph">
<p>ユーザタスクが，ソフトウェア割込みにより自タスクを待ち状態に遷移させる
サービスコールを呼び出した直後に割込みが発生し，その割込みハンドラの中
でiras_tex，idis_wai，irel_waiが呼び出されると，この時点では待ち解除も
されず待ち禁止状態にもならないために，割込みハンドラからのリターン後に
待ち状態に入ってしまう．ソフトウェア割込みによりすべての割込みが禁止さ
れないターゲットプロセッサでは，ソフトウェア割込みの発生とサービスコー
ルの実行を不可分にできないため，このような状況を防ぐことができない．</p>
</div>
<div class="paragraph">
<p>なお，拡張サービスコールは，待ち状態に入るサービスコールからE_RLWAIが返
された場合には，実行中の処理を取りやめて，E_RLWAIを返値としてリターンす
るように実装すべきである．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様，μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>待ち禁止状態は，μITRON4.0仕様にはない概念であり，μITRON4.0/PX仕様で導
入された．ただし，μITRON4.0/PX仕様では，タスクの待ち状態を強制解除する
サービスコールが，タスクを待ち禁止状態へ遷移させる機能も持つこととして
いる．その結果μITRON4.0/PX仕様は，待ち状態を強制解除するサービスコール
の仕様において，μITRON4.0仕様との互換性がなくなっている．</p>
</div>
<div class="paragraph">
<p>この仕様では，待ち状態の強制解除と待ち禁止状態への遷移を別々のサービス
コールで行うこととした．これにより，待ち状態を強制解除するサービスコー
ルの仕様が，μITRON4.0仕様と互換になっている．一方，μITRON4.0/PX仕様と
は互換性がない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_ディスパッチ保留状態で実行中のタスクに対する強制待ち">2.6.6. ディスパッチ保留状態で実行中のタスクに対する強制待ち</h4>
<div class="paragraph">
<p>ディスパッチ保留状態において，実行状態のタスクを強制待ち状態へ遷移させ
るサービスコールを呼び出した場合，実行状態のタスクの切換えは，ディスパッ
チ保留状態が解除されるまで保留される【NGKI0226】．</p>
</div>
<div class="paragraph">
<p>この間，それまで実行状態であったタスクは，実行状態と強制待ち状態の間の
過渡的な状態にあると考える【NGKI0227】．この状態を，強制待ち状態［実行
継続中］と呼ぶ．一方，ディスパッチ保留状態が解除された後に実行すべきタ
スクは，実行可能状態にとどまる【NGKI0228】．</p>
</div>
<div class="paragraph">
<p>タスクが強制待ち状態［実行継続中］にある時に，ディスパッチ保留状態が解
除されると，ただちにディスパッチが起こり，タスクは強制待ち状態に遷移す
る【NGKI0229】．</p>
</div>
<div class="paragraph">
<p>過渡的な状態も含めたタスクの状態遷移を図2-3に示す【NGKI0230】．</p>
</div>
<div class="paragraph">
<p>タスクが強制待ち状態［実行継続中］である時の扱いは次の通りである．</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>プロセッサを占有して実行を継続する．<br></p>
<div class="paragraph">
<p>強制待ち状態［実行継続中］のタスクは，プロセッサを占有して，そのまま継
続して実行される【NGKI0231】．</p>
</div>
</li>
<li>
<p>実行状態のタスクに関する情報を参照するサービスコールでは，実行状態
であるものと扱う．</p>
<div class="paragraph">
<p>実行状態のタスクに関する情報を参照するサービスコール（get_tid／
iget_tid，get_did，sns_tex）では，強制待ち状態［実行継続中］のタスクが，
それを実行するプロセッサにおいて実行状態のタスクであるものと扱う．具体
的には，強制待ち状態［実行継続中］のタスクが実行されている時にget_tid／
iget_tidを発行すると，そのタスクのID番号を参照する【NGKI0232】．また，
get_didを発行するとそのタスクが属する保護ドメインのID番号を，sns_texを
発行するとそのタスクのタスク例外処理禁止フラグを参照する【NGKI0233】．</p>
</div>
</li>
<li>
<p>その他のサービスコールでは，強制待ち状態であるものと扱う．</p>
<div class="paragraph">
<p>その他のサービスコールでは，強制待ち状態［実行継続中］のタスクは，強制
待ち状態であるものと扱う【NGKI0234】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ディスパッチ保留状態において実行状態のタスクを強制待ち
状態へ遷移させるサービスコールはサポートしていないため，タスクが強制待
ち状態［実行継続中］になることはない【ASPS0008】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ディスパッチ保留状態において実行状態のタスクを強制待ち
状態へ遷移させるサービスコールを，他のプロセッサから呼び出すことができ
るため，タスクが強制待ち状態［実行継続中］になる場合がある【FMPS0005】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ディスパッチ保留状態において実行状態のタスクを強制待
ち状態へ遷移させるサービスコールはサポートしていないため，タスクが強制
待ち状態［実行継続中］になることはない【HRPS0004】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，タスクが広義の待ち状態になることはないため，タスクが強
制待ち状態［実行継続中］になることもない【SSPS0005】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>この仕様では，ディスパッチ保留状態において，実行状態のタスクを強制終了
させるサービスコールはサポートしていない．そのため，実行状態と休止状態
の間の過渡的な状態は存在しない．</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_制約タスク">2.6.7. 制約タスク</h4>
<div class="paragraph">
<p>制約タスク（restricted task）は，複数のタスクでスタック領域を共有するこ
とによるメモリ使用量の削減を目的に，通常のタスクに対して，広義の待ち状
態を持たないなどの機能制限を加えたものである．具体的には，制約タスクに
は以下の機能制限がある．</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>広義の待ち状態に入ることができない【NGKI0235】．</p>
</li>
<li>
<p>サービスコールによりベース優先度を変更することができない【NGKI0236】．</p>
</li>
<li>
<p>対象優先度の中の先頭のタスクが制約タスクである場合には，タスクの優
先順位の回転（rot_rdq／irot_rdq）を行うことができない【NGKI0237】．</p>
</li>
<li>
<p>マルチプロセッサ対応カーネルでは，割付けプロセッサを変更することが
できない【NGKI0238】．</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>制約タスクに対して，機能制限により使用できなくなったサービスコールを呼
び出した場合には，E_NOSPTエラーとなる【NGKI0239】．E_NOSPTエラーが返る
ことに依存している場合を除いては，制約タスクを通常のタスクに置き換える
ことができる【NGKI0240】．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>現状では，制約タスクの優先度を変更するサービスコールは設けていないが，
制約タスクが，自タスクの優先度を，起動時優先度（SSPカーネルにおいては，
実行時優先度）と同じかそれよりも高い値に変更することは許してもよい．た
だし，優先度の変更後は，同じ優先度内で最高優先順位としなければならない
ため，chg_priとは振舞いが異なることになる．自タスクの優先度を起動時優先
度と同じかそれよりも高い値に変更するサービスコールを設けるかどうかは，
今後の課題である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，制約タスクをサポートしていない【ASPS0009】．ただし，制
約タスク拡張パッケージを用いると，制約タスクの機能を追加することができ
る【ASPS0010】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，制約タスクをサポートしていない【FMPS0006】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，制約タスクをサポートしていない【HRPS0005】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，制約タスクのみをサポートする【SSPS0006】．そのため，す
べてのタスクと非タスクコンテキストがスタック領域を共有することができ，
すべての処理単位で同一のスタック領域を使用している【SSPS0007】．このス
タック領域を，共有スタック領域と呼ぶ．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>制約タスクは，μITRON4.0仕様の自動車制御プロファイルで導入された機能で
ある．この仕様における制約タスクは，μITRON4.0仕様の制約タスクよりも機
能制限が少なくなっている．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_割込み処理モデル">2.7. 割込み処理モデル</h3>
<div class="paragraph">
<p>TOPPERS新世代カーネルにおける割込み処理のモデルは，TOPPERS標準割込み処
理モデルに準拠している．</p>
</div>
<div class="paragraph">
<p>TOPPERS標準割込み処理モデルの概念図を図2-4に示す【NGKI0241】．この図は，
割込み処理モデルの持つすべての機能が，ハードウェア（プロセッサおよび割
込みコントローラ）で実現されているとして描いた概念図である．実際のハー
ドウェアで不足している機能については，カーネル内の割込み処理のソフトウェ
アで実現される．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>割込み処理モデルは，μITRON4.0仕様から大幅に拡張している．</p>
</div>
<div class="sect3">
<h4 id="_割込み処理の流れ">2.7.1. 割込み処理の流れ</h4>
<div class="paragraph">
<p>周辺デバイス（以下，デバイスと呼ぶ）からの割込み要求は，割込みコントロー
ラ（IRC）を経由して，プロセッサに伝えられる．デバイスから割込みコントロー
ラに割込み要求を伝えるための信号線を，割込み要求ラインと呼ぶ．一般には，
1つの割込み要求ラインに，複数のデバイスからの割込み要求が接続される．</p>
</div>
<div class="paragraph">
<p>プロセッサは，デバイスからの割込み要求を受け付ける条件が満たされた場合，
割込み要求を受け付ける【NGKI0242】．受け付けた割込み要求が，カーネル管
理の割込みである場合には，カーネル内の割込みハンドラの入口処理（割込み
入口処理）を経由して，カーネル内の割込みハンドラを実行する【NGKI0243】．</p>
</div>
<div class="paragraph">
<p>カーネル内の割込みハンドラは，アプリケーションが割込み要求ラインに対し
て登録した割込みサービスルーチン（ISR）を呼び出す【NGKI0244】．割込みサー
ビスルーチンは，プロセッサの割込みアーキテクチャや割込みコントローラに
依存せず，割込みを要求したデバイスのみに依存して記述するのが原則である
【NGKI0245】．1つの割込み要求ラインに対して複数のデバイスが接続されるこ
とから，1つの割込み要求ラインに対して複数の割込みサービスルーチンを登録
することができる【NGKI0246】．</p>
</div>
<div class="paragraph">
<p>ただし，カーネルが標準的に用意している割込みハンドラで対応できない特殊
なケースも考えられる．このような場合に対応するために，アプリケーション
が用意した割込みハンドラをカーネルに登録することもできる【NGKI0247】．</p>
</div>
<div class="paragraph">
<p>カーネルが用いるタイマデバイスからの割込み要求の場合，カーネル内の割込
みハンドラにより，タイムイベントの処理が行われる．具体的には，タイムア
ウト処理等が行われることに加えて，アプリケーションが登録したタイムイベ
ントハンドラが呼び出される【NGKI0248】．</p>
</div>
<div class="paragraph">
<p>なお，受け付けた割込み要求に対して，割込みサービスルーチンも割込みハン
ドラも登録していない場合の振舞いは，ターゲット定義である【NGKI0249】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_割込み優先度">2.7.2. 割込み優先度</h4>
<div class="paragraph">
<p>割込み要求は，割込み処理の優先順位を指定するための割込み優先度を持つ
【NGKI0250】．プロセッサは，割込み優先度マスクの現在値よりも高い割込み
優先度を持つ割込み要求のみを受け付ける【NGKI0251】．逆に言うと，割込み
優先度マスクの現在値と同じか，それより低い割込み優先度を持つ割込みは，
マスクされる．</p>
</div>
<div class="paragraph">
<p>プロセッサは，割込み要求を受け付けると，割込み優先度マスクを，受け付け
た割込み要求の割込み優先度に設定する（ただし，受け付けた割込みがNMIであ
る場合には例外とする）【NGKI0252】．また，割込み処理からのリターンによ
り，割込み優先度マスクを，割込み要求を受け付ける前の値に戻す
【NGKI0253】．</p>
</div>
<div class="paragraph">
<p>これらのことから，他の方法で割込みをマスクしていない限り，ある割込み要
求の処理中は，それと同じかそれより低い割込み優先度を持つ割込み要求は受
け付けられず，それより高い割込み優先度を持つ割込み要求は受け付けられる
ことになる．つまり，割込み優先度は，多重割込みを制御するためのものと位
置付けることができる．それに対して，同時に発生している割込み要求の中で，
割込み優先度の高い割込み要求が先に受け付けられるとは限らない
【NGKI0254】．</p>
</div>
<div class="paragraph">
<p>割込み優先度は，PRI型で表現し，値が小さいほど優先度が高いものとするが，
［NGKI0037］の原則には従わず，-1から連続した負の値を用いる【NGKI0255】．</p>
</div>
<div class="paragraph">
<p>割込み優先度の段階数は，ターゲット定義である【NGKI0256】．プロセッサが
割込み優先度マスクを実現するための機能を持たないか，実現するために大き
いオーバヘッドを生じる場合には，ターゲット定義で，割込み優先度の段階数
を1にする（すなわち，多重割込みを許さない）場合がある．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>割込み優先度に-1から連続した負の値を用いるのは，割込み優先度とタスク優
先度を比較できるようになることと，いずれの割込みもマスクしない割込み優
先度マスクの値を0にできるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_割込み要求ラインの属性">2.7.3. 割込み要求ラインの属性</h4>
<div class="paragraph">
<p>各割込み要求ラインは，以下の属性を持つ．なお，1つの割込み要求ラインに複
数のデバイスからの割込み要求が接続されている場合，それらの割込み要求は
同一の属性を持つ【NGKI0257】．それらの割込み要求に別々の属性を設定する
ことはできない．</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>割込み要求禁止フラグ</p>
<div class="paragraph">
<p>割込み要求ライン毎に，割込みをマスクするための割込み要求禁止フラグを持
つ【NGKI0258】．割込み要求禁止フラグをセットすると，その割込み要求ライ
ンによって伝えられる割込み要求はマスクされる【NGKI0259】．</p>
</div>
<div class="paragraph">
<p>プロセッサが割込み要求禁止フラグを実現するための機能を持たないか，実現
するために大きいオーバヘッドを生じる場合には，ターゲット定義で，割込み
要求禁止フラグをサポートしない場合がある【NGKI0260】．また，プロセッサ
の持つ割込み要求禁止フラグの機能がこの仕様に合致しない場合には，ターゲッ
ト定義で，割込み要求禁止フラグをサポートしないか，振舞いが異なるものと
する場合がある【NGKI0261】．</p>
</div>
</li>
<li>
<p>割込み優先度</p>
<div class="paragraph">
<p>割込み要求ライン毎に，割込み優先度を設定することができる【NGKI0262】．
割込み要求の割込み優先度とは，その割込み要求を伝える割込み要求ラインに
対して設定された割込み優先度のことである【NGKI0263】．</p>
</div>
</li>
<li>
<p>トリガモード</p>
<div class="paragraph">
<p>割込み要求ラインに対する割込み要求が，レベルトリガであるかエッジトリガ
であるかを設定することができる【NGKI0264】．エッジトリガの場合には，さ
らに，ターゲット定義で，ポジティブエッジトリガかネガティブエッジトリガ
か両エッジトリガかを設定できる場合もある【NGKI0265】．また，レベルトリ
ガの場合には，ターゲット定義で，ローレベルトリガかハイレベルトリガかを
設定できる場合もある【NGKI0266】．</p>
</div>
<div class="paragraph">
<p>プロセッサがトリガモードを設定するための機能を持たないか，設定するため
に大きいオーバヘッドを生じる場合には，ターゲット定義で，トリガモードの
設定をサポートしない場合がある【NGKI0267】．</p>
</div>
<div class="paragraph">
<p>属性が設定されていない割込み要求ラインに対しては，割込み要求禁止フラグ
がセットされ，割込み要求はマスクされる【NGKI0268】．また，割込み要求禁
止フラグをクリアすることもできない【NGKI0269】．</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>アプリケーションが，割込み要求禁止フラグを動的にセット／クリアする機能
を用いると，次の理由でソフトウェアの再利用性が下がる可能性があるため，
注意が必要である．プロセッサによっては，この割込み処理モデルに合致した
割込み要求禁止フラグの機能を実現できない場合がある．また，割込み要求禁
止フラグをセットすることで，複数のデバイスからの割込みがマスクされる場
合がある．ソフトウェアの再利用性を上げるためには，あるデバイスからの割
込みのみをマスクしたい場合には，そのデバイス自身の機能を使ってマスクを
実現すべきである．</p>
</div>
<div class="paragraph">
<p>複数のデバイスからの割込み要求が接続されている割込み要求ラインを，エッ
ジトリガに設定することは推奨されない．これは，次のような状況において，
割込み要求を取りこぼす可能性があるためである．ある割込み要求ラインに，
デバイスAとデバイスBからの割込み要求が接続されており，デバイスAの割込み
処理を先に行う場合を考える．この時，デバイスBからの割込み要求によって割
込みハンドラが実行され，デバイスAの割込み処理を行った後，デバイスBの割
込み処理を行う前に，デバイスAからの割込み要求が発生した場合に，デバイス
Aからの割込み要求を取りこぼしてしまう．</p>
</div>
</div>
<div class="sect3">
<h4 id="_割込みを受け付ける条件">2.7.4. 割込みを受け付ける条件</h4>
<div class="paragraph">
<p>NMI以外の割込み要求は，次の4つの条件が揃った場合に受け付けられる
【NGKI0270】．</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>割込み要求ラインに対する割込み要求禁止フラグがクリアされていること</p>
</li>
<li>
<p>割込み要求ラインに設定された割込み優先度が，割込み優先度マスクの現
在値よりも高い（優先度の値としては小さい）こと</p>
</li>
<li>
<p>全割込みロックフラグがクリアされていること</p>
</li>
<li>
<p>割込み要求がカーネル管理の割込みである場合には，CPUロックフラグがク
リアされていること</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>これらの条件が揃った割込み要求が複数ある場合に，どの割込み要求が最初に
受け付けられるかは，この仕様では規定しない【NGKI0271】．すなわち，割込
み優先度の高い割込み要求が先に受け付けられるとは限らない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_割込み番号と割込みハンドラ番号">2.7.5. 割込み番号と割込みハンドラ番号</h4>
<div class="paragraph">
<p>割込み要求ラインを識別するための番号を，割込み番号と呼ぶ．割込み番号は，
符号無しの整数型であるINTNO型で表し，ターゲットハードウェアの仕様から決
まる自然な番号付けを基本として，ターゲット定義で付与される【NGKI0272】．
そのため，1から連続した正の値であるとは限らない．</p>
</div>
<div class="paragraph">
<p>それに対して，アプリケーションが用意した割込みハンドラをカーネルに登録
する場合に，割込みハンドラの登録対象となる割込みを識別するための番号を，
割込みハンドラ番号と呼ぶ．割込みハンドラ番号は，符号無しの整数型である
INHNO型で表し，ターゲットハードウェアの仕様から決まる自然な番号付けを基
本として，ターゲット定義で付与される【NGKI0273】．そのため，1から連続し
た正の値であるとは限らない．</p>
</div>
<div class="paragraph">
<p>割込みハンドラ番号は，割込み番号と1対1に対応するのが基本である（両者が
一致する場合が多い）【NGKI0274】．</p>
</div>
<div class="paragraph">
<p>ただし，割込みを要求したデバイスが割込みベクタを生成してプロセッサに渡
すアーキテクチャなどでは，割込み番号と割込みハンドラ番号の対応を，カー
ネルが管理していない場合がある【NGKI0275】．そこで，ターゲット定義で，
割込み番号に対応しない割込みハンドラ番号や，割込みハンドラ番号に対応し
ない割込み番号を設ける場合もある【NGKI0276】．ただし，割込みサービスルー
チンの登録対象にできる割込み番号は，割込みハンドラ番号との1対1の対応関
係をカーネルが管理しているもののみである【NGKI0277】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_マルチプロセッサにおける割込み処理">2.7.6. マルチプロセッサにおける割込み処理</h4>
<div class="paragraph">
<p>この節では，マルチプロセッサにおける割込み処理について説明する．この節
の内容は，マルチプロセッサ対応カーネルにのみ適用される．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，TOPPERS標準割込み処理モデルの構成要素
の中で，図2-4の破線に囲まれた部分はプロセッサ毎に持ち，それ以外の部分は
システム全体で1つのみ持つ【NGKI0278】．すなわち，全割込みロックフラグ，
CPUロックフラグ，割込み優先度マスクはプロセッサ毎に持つのに対して，割込
み要求ラインおよびその属性（割込み要求禁止フラグ，割込み優先度，トリガ
モード）はシステム全体で共通に持つ．</p>
</div>
<div class="paragraph">
<p>割込み番号は，割込み要求ラインを識別するための番号であることから，割込
み要求ラインが複数のプロセッサに接続されている場合でも，1つの割込み要求
ラインには1つの割込み番号を付与する【NGKI0279】．逆に，複数のプロセッサ
が同じ種類のデバイスを持っている場合でも，別のデバイスからの割込み要求
ラインには異なる割込み番号を付与する（図2-5）【NGKI0280】．図2-5におい
て，ローカルIRCは個々のプロセッサに対する割込みを制御するための回路であ
り，グローバルIRCはデバイスからの割込みをプロセッサに分配するための回路
である．グローバルIRCは，必ず備わっているとは限らない．</p>
</div>
<div class="paragraph">
<p>割込み要求禁止フラグは，この仕様上はシステム全体で共通に持つこととして
いるが，実際のターゲットハードウェア（特に，グローバルIRCを備えていない
もの）では，プロセッサ毎に持っている場合がある．そのため，ターゲット定
義で，あるプロセッサで割込み要求禁止フラグを動的にセット／クリアしても，
他のプロセッサに対しては割込みがマスク／マスク解除されない場合があるも
のとする【NGKI0281】．</p>
</div>
<div class="paragraph">
<p>複数のプロセッサに接続された割込み要求ラインに対して登録された割込みサー
ビスルーチンは，それらのプロセッサのいずれによっても実行することができ
る【NGKI0282】．ただし，その内のどのプロセッサで割込みサービスルーチン
を実行するかは，割込みサービスルーチンが属するクラスの割付け可能プロセッ
サにより決定される（「2.4.4 処理単位を実行するプロセッサ」の節を参照）．</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチンが属するクラスの割付け可能プロセッサは，登録対象
の割込み要求ラインが接続されたプロセッサの集合に含まれていなければなら
ない【NGKI0283】．また，同一の割込み要求ラインに対して登録する割込みサー
ビスルーチンは，同一のクラスに属していなければならない【NGKI0284】．</p>
</div>
<div class="paragraph">
<p>それに対して，割込みハンドラはプロセッサ毎に登録する．そのため，同じ割
込み要求に対応する割込みハンドラであっても，プロセッサ毎に異なる割込み
ハンドラ番号を付与する（図2-5）【NGKI0285】．割込みハンドラが属するクラ
スの初期割付けプロセッサは，割込みが要求されるプロセッサと一致していな
ければならない【NGKI0286】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおける割込み番号の付与方法は，複数のプロ
セッサに接続された割込み要求ラインに対しては，割込み番号の上位ビットを
0とし，1つのプロセッサのみに接続された割込み要求ラインに対しては，割込
み番号の上位ビットに，接続されたプロセッサのID番号を含める方法を基本と
する．また，割込みハンドラ番号の付与方法は，割込みハンドラ番号の上位ビッ
トに，その割込みハンドラを実行するプロセッサのID番号を含める方法を基本
とする（図2-5）．</p>
</div>
<div class="paragraph">
<p>1つのプロセッサのみに接続された割込み要求ラインに対して登録された割込み
サービスルーチンは，そのプロセッサのみを割付け可能プロセッサとするクラ
スに属していなければならない．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>複数のプロセッサで実行することができる割込みサービスルーチンは，それら
のプロセッサのいずれかで実行されるものと設定した場合でも，複数回の割込
み要求により，異なるプロセッサで同時に実行される可能性がある．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル管理外の割込み">2.7.7. カーネル管理外の割込み</h4>
<div class="paragraph">
<p>高い割込み応答性を求められるアプリケーションでは，カーネル内で割込みを
マスクすることにより，割込み応答性の要求を満たせなくなる場合がある．こ
のような要求に対応するために，カーネル内では，ある割込み優先度（これを，
TMIN_INTPRIと書く）よりも高い割込み優先度を持つ割込みをマスクしないこと
としている【NGKI0287】．TMIN_INTPRIを固定するか設定できるようにするか，
設定できるようにする場合の設定方法は，ターゲット定義である【NGKI0288】．</p>
</div>
<div class="paragraph">
<p>TMIN_INTPRIよりも高い割込み優先度を持ち，カーネル内でマスクしない割込み
を，カーネル管理外の割込みと呼ぶ．また，カーネル管理外の割込みによって
起動される割込みハンドラを，カーネル管理外の割込みハンドラと呼ぶ．NMIは，
カーネル管理外の割込みとして扱う．NMI以外にカーネル管理外の割込みを設け
るか（設けられるようにするか）どうかは，ターゲット定義である【NGKI0289】．</p>
</div>
<div class="paragraph">
<p>それに対して，TMIN_INTPRIと同じかそれよりも低い割込み優先度を持つ割込み
をカーネル管理の割込み，カーネル管理の割込みによって起動される割込みハ
ンドラをカーネル管理の割込みハンドラと呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネル管理外の割込みハンドラは，カーネル内の割込み入口処理を経由せず
に実行するのが基本である【NGKI0290】．ただし，すべての割込みで同じ番地
に分岐するプロセッサでは，カーネル内の割込み入口処理を全く経由せずにカー
ネル管理外の割込みハンドラを実行することができず，入口処理の一部分を経
由してカーネル管理外の割込みハンドラが実行されることになる【NGKI0291】．</p>
</div>
<div class="paragraph">
<p>カーネル管理外の割込みハンドラが実行開始される時のシステム状態とコンテ
キスト，割込みハンドラの終了時に行われる処理，割込みハンドラの記述方法
は，ターゲット定義である【NGKI0292】．カーネル管理外の割込みハンドラか
らは，システムインタフェースレイヤのAPIとsns_ker，ext_kerのみを呼び出す
ことができ，その他のサービスコールを呼び出すことはできない【NGKI0293】．
カーネル管理外の割込みハンドラから，その他のサービスコールを呼び出した
場合の動作は，保証されない【NGKI0294】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル管理外の割込みの設定方法">2.7.8. カーネル管理外の割込みの設定方法</h4>
<div class="paragraph">
<p>カーネル管理外の割込みの設定方法は，ターゲット定義で，次の3つの方法のい
ずれかが採用される【NGKI0295】．</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>NMI以外にカーネル管理外の割込みを設けない</p>
</li>
<li>
<p>カーネル構築時に特定の割込みをカーネル管理外にすると決める</p>
<div class="paragraph">
<p>これら場合には，カーネル管理外とする割込みはカーネル構築時（ターゲット
依存部の実装時やカーネルのコンパイル時）に決まるため，カーネル管理外と
する割込みをアプリケーション側で設定する必要はない【NGKI0296】．ここで，
カーネル管理外とされた割込みに対して，カーネルのAPIにより割込みハンドラ
を登録できるかと，割込み要求ラインの属性を設定できるかは，ターゲット定
義である【NGKI0297】．割込みハンドラを登録できる場合には，それを定義す
るAPIにおいて，カーネル管理外であることを示す割込みハンドラ属性
（TA_NONKERNEL）を指定する【NGKI0298】．また，割込み要求ラインの属性を
設定できる場合には，設定する割込み優先度をTMIN_INTPRIよりも高い値とする
【NGKI0299】．</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>カーネル管理外とする割込みをアプリケーションで設定できるようにする</p>
<div class="paragraph">
<p>この場合には，カーネル管理外とする割込みの設定は，次の方法で行う．まず，
カーネル管理外とする割込みハンドラを定義するAPIにおいて，カーネル管理外
であることを示す割込みハンドラ属性（TA_NONKERNEL）を指定する
【NGKI0300】．また，カーネル管理外とする割込みの割込み要求ラインに対し
て設定する割込み優先度を，TMIN_INTPRIよりも高い値とする【NGKI0301】．</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>いずれの場合にも，カーネル管理の割込みの割込み要求ラインに対して設定す
る割込み優先度は，TMIN_INTPRIより高い値であってはならない【NGKI0302】．
また，カーネル管理外の割込みに対して，割込みサービスルーチンを登録する
ことはできない【NGKI0303】．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cpu例外処理モデル">2.8. CPU例外処理モデル</h3>
<div class="paragraph">
<p>プロセッサが検出するCPU例外の種類や，CPU例外検出時のプロセッサの振舞い
は，プロセッサによって大きく異なる．そのため，CPU例外ハンドラをターゲッ
トハードウェアに依存せずに記述することは，少なくとも現時点では困難であ
る．そこでこの仕様では，CPU例外の処理モデルを厳密に標準化するのではなく，
ターゲットハードウェアに依存せずに決められる範囲で規定する．</p>
</div>
<div class="sect3">
<h4 id="_cpu例外処理の流れ">2.8.1. CPU例外処理の流れ</h4>
<div class="paragraph">
<p>アプリケーションは，プロセッサが検出するCPU例外の種類毎に，CPU例外ハン
ドラを登録することができる【NGKI0304】．プロセッサがCPU例外の発生を検出
すると，カーネル内のCPU例外ハンドラの入口処理（CPU例外入口処理）を経由
して，発生したCPU例外に対して登録したCPU例外ハンドラが呼び出される
【NGKI0305】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラの登録対象となるCPU例外を識別するための番号を，CPU例外ハ
ンドラ番号と呼ぶ．CPU例外ハンドラ番号は，符号無しの整数型であるEXCNO型
で表し，ターゲットハードウェアの仕様から決まる自然な番号付けを基本とし
て，ターゲット定義で付与される【NGKI0306】．そのため，1から連続した正の
値であるとは限らない．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，異なるプロセッサで発生するCPU例外は，
異なるCPU例外であると扱う【NGKI0307】．すなわち，同じ種類のCPU例外であっ
ても，異なるプロセッサのCPU例外には異なるCPU例外ハンドラ番号を付与し，
プロセッサ毎にCPU例外ハンドラを登録する．CPU例外ハンドラが属するクラス
の初期割付けプロセッサは，CPU例外が発生するプロセッサと一致していなけれ
ばならない【NGKI0308】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラにおいては，CPU例外が発生した状態からのリカバリ処理を行
う【NGKI0309】．どのようなリカバリ処理を行うかは，一般にはCPU例外の種類
やそれが発生したコンテキストおよび状態に依存するが，大きく次の4つの方法
が考えられる【NGKI0310】．</p>
</div>
<div class="paragraph">
<p>(a) カーネルに依存しない形でCPU例外の原因を取り除き，実行を継続する．</p>
</div>
<div class="paragraph">
<p>(b) CPU例外を起こしたタスクよりも優先度の高いタスクを起動または待ち解除
し，そのタスクでリカバリ処理を行う（例えば，CPU例外を起こしたタスクを強
制終了し，再度起動する）．ただし，CPU例外を起こしたタスクが最高優先度の
場合には，この方法でリカバリ処理を行うことはできない（リカバリ処理を行
うタスクを最高優先度とし，タスクの起動または待ち解除後に優先順位を回転
させることで，リカバリ処理を行える可能性があるが，CPU例外を起こしたタス
クが制約タスクの場合には適用できないなど，推奨できる方法ではない）
【NGKI0311】．</p>
</div>
<div class="paragraph">
<p>(c) CPU例外を起こしたタスクにタスク例外処理を要求し，タスク例外処理ルー
チンでリカバリ処理を行う（例えば，CPU例外を起こしたタスクを終了する）．</p>
</div>
<div class="paragraph">
<p>(d) システム全体に対してリカバリ処理を行う（例えば，システムを再起動す
る）．</p>
</div>
<div class="paragraph">
<p>この中で(a)と(d)の方法は，カーネルの機能を必要としないため，CPU例外が発
生したコンテキストおよび状態に依存せずに常に行える【NGKI0312】．それに
対して(b)と(c)の方法は，CPU例外ハンドラからそのためのサービスコールを呼
び出せることが必要であり，それが行えるかどうかは，CPU例外が発生したコン
テキストおよび状態に依存する【NGKI0313】．</p>
</div>
<div class="paragraph">
<p>なお，発生したCPU例外に対して，CPU例外ハンドラを登録していない場合の振
舞いは，ターゲット定義である【NGKI0314】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>CPU例外入口処理でCPU例外が発生し，それを処理するためのCPU例外ハンドラの
入口処理で同じ原因でCPU例外が発生すると，CPU例外が繰り返し発生し，アプ
リケーションが登録したCPU例外ハンドラまで処理が到達しない状況が考えられ
る．このような状況が発生するかどうかはターゲットによるが，これが許容で
きない場合には，CPU例外入口処理を経由せずに，アプリケーションが用意した
CPU例外ハンドラを直接実行するようにしなければならない．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおけるCPU例外ハンドラ番号の付与方法は，
CPU例外ハンドラ番号の上位ビットに，そのCPU例外が発生するプロセッサのID
番号を含める方法を基本とする．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，CPU例外からのリカバリ処理の方法については，記述され
ていない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_cpu例外ハンドラから呼び出せるサービスコール">2.8.2. CPU例外ハンドラから呼び出せるサービスコール</h4>
<div class="paragraph">
<p>CPU例外ハンドラからは，CPU例外発生時のディスパッチ保留状態を参照するサー
ビスコール（xsns_dpn）と，CPU例外発生時にタスク例外処理ルーチンを実行開
始できない状態であったかを参照するサービスコール（xsns_xpn）を呼び出す
ことができる【NGKI0315】．</p>
</div>
<div class="paragraph">
<p>xsns_dpnは，CPU例外がタスクコンテキストで発生し，そのタスクがディスパッ
チできる状態であった場合にfalseを返す【NGKI0316】．xsns_dpnがfalseを返
した場合，そのCPU例外ハンドラから，非タスクコンテキストから呼び出せるす
べてのサービスコールを呼び出すことができ，(b)の方法によるリカバリ処理が
可能である【NGKI0317】．ただし，CPU例外を起こしたタスクが最高優先度の場
合には，この方法でリカバリ処理を行うことはできない【NGKI0318】．</p>
</div>
<div class="paragraph">
<p>xsns_xpnは，CPU例外がタスクコンテキストで発生し，そのタスクがタスク例外
処理ルーチンを実行できる状態であった場合にfalseを返す【NGKI0319】．
xsns_xpnがfalse を返した場合，そのCPU例外ハンドラから，非タスクコンテキ
ストから呼び出せるすべてのサービスコールを呼び出すことができ，(c)の方法
によるリカバリ処理が可能である【NGKI0320】．</p>
</div>
<div class="paragraph">
<p>xsns_dpnとxsns_xpnのいずれのサービスコールもtrueを返した場合，そのCPU例
外ハンドラからは，xsns_dpnとxsns_xpnに加えて，システムインタフェースレ
イヤのAPIとsns_ker，ext_kerのみを呼び出すことができ，その他のサービスコー
ルを呼び出すことはできない【NGKI0321】．いずれのサービスコールもtrueを
返したにもかかわらず，その他のサービスコールを呼び出した場合の動作は，
保証されない【NGKI0322】．この場合には，(b)と(c)の方法によるリカバリ処
理は行うことはできず，(a)または(d)の方法によるリカバリ処理を行うしかな
いことになる．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラで行える操作に関しては，μITRON4.0仕様を見直し，全面的に
修正した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_エミュレートされたcpu例外ハンドラ">2.8.3. エミュレートされたCPU例外ハンドラ</h4>
<div class="paragraph">
<p>エラーコードによってアプリケーションに通知できないエラーをカーネルが検
出した場合に，アプリケーションが登録したエラー処理を，カーネルが呼び出
す場合がある【NGKI0323】．この場合に，カーネルが検出するエラーをCPU例外
と同等に扱うものとし，エミュレートされたCPU例外と呼ぶ【NGKI0324】．また，
エラー処理のためのプログラムをCPU例外ハンドラと同等に扱うものとし，エミュ
レートされたCPU例外ハンドラと呼ぶ【NGKI0325】．</p>
</div>
<div class="paragraph">
<p>具体的には，エミュレートされたCPU例外ハンドラに対してもCPU例外ハンドラ
番号が付与され，CPU例外ハンドラと同じ方法で登録できる【NGKI0326】．また，
エミュレートされたCPU例外ハンドラからも，CPU例外ハンドラから呼び出せる
サービスコールを呼び出すことができ，CPU例外ハンドラと同様のリカバリ処理
を行うことができる【NGKI0327】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>エミュレートされたCPU例外およびCPU例外ハンドラは，μITRON4.0仕様に定義
されていない概念である．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル管理外のcpu例外">2.8.4. カーネル管理外のCPU例外</h4>
<div class="paragraph">
<p>カーネル非動作状態，カーネル内のクリティカルセクションの実行中，全割込
みロック状態，CPUロック状態，カーネル管理外の割込みハンドラ実行中のいず
れかで発生したCPU例外を，カーネル管理外のCPU例外と呼ぶ．また，それによっ
て起動されるCPU例外ハンドラを，カーネル管理外のCPU例外ハンドラと呼ぶ．
さらに，カーネル管理外のCPU例外ハンドラ実行中に発生したCPU例外も，カー
ネル管理外のCPU例外とする．</p>
</div>
<div class="paragraph">
<p>それに対して，カーネル管理外のCPU例外以外のCPU例外をカーネル管理のCPU例
外，カーネル管理のCPU例外によって起動されるCPU例外ハンドラをカーネル管
理のCPU例外ハンドラと呼ぶ．</p>
</div>
<div class="paragraph">
<p>カーネル管理外のCPU例外ハンドラにおいては，xsns_dpnとxsns_xpnのいずれの
サービスコールもtrueを返す【NGKI0330】．そのため，「2.8.2 CPU例外ハンド
ラから呼び出せるサービスコール」の節で述べた制限［NGKI0321］［NGKI0322］
が課される．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>カーネル管理外のCPU例外は，カーネル管理外の割込みと異なり，特定のCPU例
外をカーネル外とするわけではない．同じCPU例外であっても，CPU例外が起こ
る状況によって，カーネル管理となる場合とカーネル管理外となる場合がある．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_システムの初期化と終了">2.9. システムの初期化と終了</h3>
<div class="sect3">
<h4 id="_システム初期化手順">2.9.1. システム初期化手順</h4>
<div class="paragraph">
<p>システムのリセット後，最初に実行するプログラムを，スタートアップモジュー
ルと呼ぶ．スタートアップモジュールはカーネルの管理外であり，アプリケー
ションで用意するのが基本であるが，スタートアップモジュールで行うべき処
理を明確にするために，カーネルの配布パッケージの中に，標準のスタートアッ
プモジュールが用意されている【NGKI0331】．</p>
</div>
<div class="paragraph">
<p>標準のスタートアップモジュールは，プロセッサのモードとスタックポインタ
等の初期化，NMIを除くすべての割込みのマスク（全割込みロック状態と同等の
状態にする），ターゲットシステム依存の初期化フックの呼出し，非初期化デー
タセクション（bssセクション）のクリア，初期化データセクション（dataセク
ション）の初期化，ソフトウェア環境（ライブラリなど）依存の初期化フック
の呼出しを行った後，カーネルの初期化処理へ分岐する【NGKI0332】．ここで
呼び出すターゲットシステム依存の初期化フックでは，リセット後に速やかに
行うべき初期化処理を行うことが想定されている．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサがスタートアップモ
ジュールを実行し，カーネルの初期化処理へ分岐する【NGKI0333】．ただし，
共有リソースの初期化処理（非初期化データセクションのクリア，初期化デー
タセクションの初期化，ソフトウェア環境依存の初期化フックの呼出しなど）
は，マスタプロセッサのみで実行する【NGKI0334】．各プロセッサがカーネル
の初期化処理へ分岐するのは，共有リソースの初期化処理が完了した後でなけ
ればならないため，スレーブプロセッサは，カーネルの初期化処理へ分岐する
前に，マスタプロセッサによる共有リソースの初期化処理の完了を待ち合わせ
る必要がある【NGKI0335】．</p>
</div>
<div class="paragraph">
<p>カーネルの初期化処理においては，まず，カーネル自身の初期化処理（カーネ
ル内のデータ構造の初期化，カーネルが用いるデバイスの初期化など）と静的
APIの処理（オブジェクトの登録など）が行われる【NGKI0336】．静的APIのパ
ラメータに関するエラーは，コンフィギュレータによって検出されるのが原則
であるが，コンフィギュレータで検出できないエラーが，この処理中に検出さ
れる場合もある【NGKI0337】．</p>
</div>
<div class="paragraph">
<p>静的APIの処理順序によりシステムの規定された振舞いが変化する場合には，シ
ステムコンフィギュレーションファイルにおける静的APIの記述順と同じ順序で
静的APIが処理された場合と，同じ振舞いとなる【NGKI0338】．例えば，静的
APIによって同じ優先度のタスクを複数生成・起動した場合，静的APIの記述順
が先のタスクが高い優先順位を持つ．それに対して，周期ハンドラの動作開始
順序は，同じタイムティックで行うべき処理が複数ある場合の処理順序が規定
されないことから（「4.6.1 システム時刻管理」の節を参照），静的APIの記述
順となるとは限らない．</p>
</div>
<div class="paragraph">
<p>次に，静的API（ATT_INI）により登録した初期化ルーチンが，システムコンフィ
ギュレーションファイルにおける静的APIの記述順と同じ順序で実行される
【NGKI0339】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサがカーネル自身の初
期化処理と静的APIの処理を完了した後に，マスタプロセッサがグローバル初期
化ルーチンを実行する【NGKI0340】．グローバル初期化ルーチンの実行が完了
した後に，各プロセッサは，自プロセッサに割り付けられたローカル初期化ルー
チンを実行する【NGKI0341】．すなわち，ローカル初期化ルーチンは，初期割
付けプロセッサにより実行される．</p>
</div>
<div class="paragraph">
<p>以上が終了すると，カーネル非動作状態から動作状態に遷移し（「2.5.1 カー
ネル動作状態と非動作状態」の節を参照），カーネルの動作が開始される
【NGKI0342】．具体的には，システム状態が，全割込みロック解除状態・CPUロッ
ク解除状態・割込み優先度マスク全解除状態・ディスパッチ許可状態に設定さ
れ（すなわち，割込みがマスク解除され），タスクの実行が開始される．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサがローカル初期化ルー
チンの実行を完了した後に，カーネル非動作状態から動作状態に遷移し，カー
ネルの動作が開始される【NGKI0343】．マルチプロセッサ対応カーネルにおけ
るシステム初期化の流れと，各プロセッサが同期を取るタイミングを，図2-6に
示す【NGKI0344】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様においては，初期化ルーチンの実行は静的APIの処理に含まれる
ものとしていたが，この仕様では，初期化ルーチンを登録する静的APIの処理は，
初期化ルーチンを登録することのみを意味し，初期化ルーチンの実行は含まな
いものとした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_システム終了手順">2.9.2. システム終了手順</h4>
<div class="paragraph">
<p>カーネルを終了させるサービスコール（ext_ker）を呼び出すと，カーネル動作
状態から非動作状態に遷移する（「2.5.1 カーネル動作状態と非動作状態」の
節を参照）【NGKI0345】．具体的には，NMIを除くすべての割込みがマスクされ，
タスクの実行が停止される．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，カーネルを終了させるサービスコール
（ext_ker）は，どのプロセッサからでも呼び出すことができる【NGKI0346】．
1つのプロセッサでカーネルを終了させるサービスコールを呼び出すと，そのプ
ロセッサがカーネル動作状態から非動作状態に遷移した後，他のプロセッサに
対してカーネル終了処理の開始を要求する【NGKI0347】．複数のプロセッサか
ら，カーネルを終了させるサービスコール（ext_ker）を呼び出してもよい
【NGKI0348】．</p>
</div>
<div class="paragraph">
<p>次に，静的API（ATT_TER）により登録した終了処理ルーチンが，システムコン
フィギュレーションファイルにおける静的APIの記述順と逆の順序で実行される
【NGKI0349】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサがカーネル非動作状
態に遷移した後に，各プロセッサが，自プロセッサに割り付けられたローカル
終了処理ルーチンを実行する【NGKI0350】．すなわち，ローカル終了処理ルー
チンは，初期割付けプロセッサにより実行される．すべてのプロセッサでロー
カル終了処理ルーチンの実行が完了した後に，マスタプロセッサがグローバル
終了処理ルーチンを実行する【NGKI0351】．</p>
</div>
<div class="paragraph">
<p>以上が終了すると，ターゲットシステム依存の終了処理が呼び出される
【NGKI0352】．ターゲットシステム依存の終了処理は，カーネルの管理外であ
り，アプリケーションで用意するのが基本であるが，カーネルの配布パッケー
ジの中に，ターゲットシステム毎に標準的なルーチンが用意されている
【NGKI0353】．標準のターゲットシステム依存の終了処理では，ソフトウェア
環境（ライブラリなど）依存の終了処理フックを呼び出す【NGKI0354】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，すべてのプロセッサで，ターゲットシス
テム依存の終了処理が呼び出される【NGKI0355】．マルチプロセッサ対応カー
ネルにおけるシステム終了処理の流れと，各プロセッサが同期を取るタイミン
グを，図2-7に示す【NGKI0356】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，あるプロセッサからカーネルを終了させる
サービスコール（ext_ker）を呼び出しても，他のプロセッサがカーネル動作状
態で割込みをマスクしたまま実行し続けると，カーネルが終了しない．</p>
</div>
<div class="paragraph">
<p>プロセッサが割込みをマスクしたまま実行し続けないようにするのは，アプリ
ケーションの責任である．例えば，ある時間を超えて割込みをマスクしたまま
実行し続けていないかを，ウォッチドッグタイマを用いて監視する方法が考え
られる．割込みをマスクしたまま実行し続けていた場合には，そのプロセッサ
からもカーネルを終了させるサービスコール（ext_ker）を呼び出すことで，カー
ネルを終了させることができる．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様には，システム終了に関する規定はない．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_オブジェクトの登録とその解除">2.10. オブジェクトの登録とその解除</h3>
<div class="sect3">
<h4 id="_id番号で識別するオブジェクト">2.10.1. ID番号で識別するオブジェクト</h4>
<div class="paragraph">
<p>ID番号で識別するオブジェクトは，オブジェクトを生成する静的
API（CRE_YYY），サービスコール（acre_yyy），またはオブジェクトを追加す
る静的API（ATT_YYY，ATA_YYY）によってカーネルに登録する【NGKI0357】．オ
ブジェクトを追加する静的APIによって登録されたオブジェクトはID番号を持た
ないため，ID番号を指定して操作することができない【NGKI0358】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成する静的API（CRE_YYY）は，生成するオブジェクトにID番
号を割り付け，ID番号を指定するパラメータとして記述した識別名を，割り付
けたID番号にマクロ定義する【NGKI0359】．同じ識別名のオブジェクトが生成
済みの場合には，E_OBJエラーとなる【NGKI0360】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成するサービスコール（acre_yyy）は，割付け可能なID番号
の数を指定する静的API（AID_YYY）によって確保されたID番号の中から，使用
されていないID番号を1つ選び，生成するオブジェクトに割り付ける
【NGKI0361】．割り付けたID番号は，サービスコールの返値としてアプリケー
ションに通知する【NGKI0362】．使用されていないID番号が残っていない場合
には，E_NOIDエラーとなる【NGKI0363】．</p>
</div>
<div class="paragraph">
<p>割付け可能なID番号の数を指定する静的API（AID_YYY）は，システムコンフィ
ギュレーションファイル中に複数記述することができる【NGKI0364】．その場
合，各静的APIで指定した数の合計の数のID番号が確保される【NGKI0365】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成するサービスコール（acre_yyy）によって登録したオブジェ
クトは，オブジェクトを削除するサービスコール（del_yyy）によって登録を解
除することができる【NGKI0366】．登録解除したオブジェクトのID番号は，未
使用の状態に戻され，そのID番号を用いて新しいオブジェクトを登録すること
ができる【NGKI0367】．この場合に，登録解除前のオブジェクトに対して行う
つもりの操作が，新たに登録したオブジェクトに対して行われないように，注
意が必要である．</p>
</div>
<div class="paragraph">
<p>オブジェクトを生成または追加する静的APIによって登録したオブジェクトは，
登録を解除することができない．登録を解除しようとした場合には，E_OBJエラー
となる【NGKI0369】．</p>
</div>
<div class="paragraph">
<p>タスク以外の処理単位は，その処理単位が実行されている間でも，登録解除す
ることができる【NGKI0370】．この場合，登録解除された処理単位に実行が強
制的に終了させられることはなく，処理単位が自ら実行を終了するまで，処理
単位の実行は継続される【NGKI0371】．</p>
</div>
<div class="paragraph">
<p>同期・通信オブジェクトを削除した時に，そのオブジェクトを待っているタス
クがあった場合，それらのタスクは待ち解除され，待ち状態に遷移させたサー
ビスコールはE_DLTエラーとなる【NGKI0372】．複数のタスクが待ち解除される
場合には，待ち行列につながれていた順序で待ち解除される【NGKI0373】．削
除した同期・通信オブジェクトが複数の待ち行列を持つ場合には，別の待ち行
列で待っていたタスクの間の待ち解除の順序は，該当するサービスコール毎に
規定する【NGKI0374】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを再初期化するサービスコール（ini_yyy）は，指定したオブジェ
クトを削除した後に，同じパラメータで再度生成したのと等価の振舞いをする
【NGKI0375】．ただし，オブジェクトを生成または追加する静的APIによって登
録したオブジェクトも，再初期化することができる【NGKI0376】．</p>
</div>
<div class="paragraph">
<p>なお，動的生成対応カーネル以外では，オブジェクトを生成するサービスコー
ル（acre_yyy），割付け可能なID番号の数を指定する静的API（AID_YYY），オ
ブジェクトのアクセス許可ベクタを設定するサービスコール（sac_yyy），オブ
ジェクトを削除するサービスコール（del_yyy）は，サポートされない
【NGKI0377】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>ID番号を指定してオブジェクトを生成するサービスコール（cre_yyy）を廃止し
た．また，オブジェクトを生成または追加する静的APIによって登録したオブジェ
クトは，登録解除できないこととした．</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，割付け可能なID番号の数を指定する静的API（AID_YYY）
は規定されていない．</p>
</div>
<div class="paragraph">
<p>複数の待ち行列を持つ同期・通信オブジェクトを削除した時に，別の待ち行列
で待っていたタスクの間の待ち解除の順序は，μITRON4.0仕様では実装依存と
されている．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>アクセス許可ベクタを指定してオブジェクトを生成する静的API（CRA_YYY）は
廃止し，オブジェクトの登録後にアクセス許可ベクタを設定する静的
API（SAC_YYY）をサポートすることとした．これにあわせて，アクセス許可ベ
クタを指定してオブジェクトを登録するサービスコール（cra_yyy，acra_yyy，
ata_yyy）も廃止した．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>ID番号を指定してオブジェクトを生成するサービスコール（cre_yyy）とアクセ
ス許可ベクタを指定してオブジェクトを登録するサービスコール（cra_yyy，
acra_yyy，ata_yyy）を廃止したのは，必要性が低いと考えたためである．
静的APIについても，サービスコールに整合するよう変更した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_オブジェクト番号で識別するオブジェクト">2.10.2. オブジェクト番号で識別するオブジェクト</h4>
<div class="paragraph">
<p>オブジェクト番号で識別するオブジェクトは，オブジェクトを定義する静的
API（DEF_YYY）またはサービスコール（def_yyy）によってカーネルに登録する
【NGKI0378】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを定義するサービスコール（def_yyy）によって登録したオブジェ
クトは，同じサービスコールを，オブジェクトの定義情報を入れたパケットへ
のポインタをNULLとして呼び出すことによって，登録を解除することができる
【NGKI0379】．登録解除したオブジェクト番号は，オブジェクト登録前の状態
に戻され，同じオブジェクト番号に対して新たにオブジェクトを定義すること
ができる【NGKI0380】．登録解除されていないオブジェクト番号に対して再度
オブジェクトを登録しようとした場合には，E_OBJエラーとなる【NGKI0381】．</p>
</div>
<div class="paragraph">
<p>オブジェクトを定義する静的APIによって登録したオブジェクトは，登録を解除
することができない【NGKI0382】．登録を解除しようとした場合には，E_OBJエ
ラーとなる【NGKI0383】．</p>
</div>
<div class="paragraph">
<p>なお，動的生成対応カーネル以外では，オブジェクトを定義するサービスコー
ル（def_yyy）はサポートされない【NGKI0384】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>この仕様では，オブジェクトの定義を変更したい場合には，一度登録解除した
後に，新たにオブジェクトを定義する必要がある．また，オブジェクトを定義
する静的APIによって登録したオブジェクトは，この仕様では，登録解除できな
いこととした．</p>
</div>
</div>
<div class="sect3">
<h4 id="_識別番号を持たないオブジェクト">2.10.3. 識別番号を持たないオブジェクト</h4>
<div class="paragraph">
<p>識別する必要がないために，識別番号を持たないオブジェクトは，オブジェク
トを追加する静的API（ATT_YYY）によってカーネルに登録する．</p>
</div>
</div>
<div class="sect3">
<h4 id="_オブジェクト生成に必要なメモリ領域">2.10.4. オブジェクト生成に必要なメモリ領域</h4>
<div class="paragraph">
<p>カーネルオブジェクトを生成する際に，サイズが一定でないメモリ領域を必要
とする場合には，カーネルオブジェクトを生成する静的APIおよびサービスコー
ルに，使用するメモリ領域の先頭番地を渡すパラメータを設けている
【NGKI0385】．このパラメータをNULLとした場合，必要なメモリ領域は，コン
フィギュレータまたはカーネルにより確保される【NGKI0386】．</p>
</div>
<div class="paragraph">
<p>オブジェクト生成に必要なメモリ領域の中で，カーネルの内部で用いるものを，
カーネルの用いるオブジェクト管理領域と呼ぶ．この仕様では，以下のメモリ
領域が，カーネルの用いるオブジェクト管理領域に該当する．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>データキュー管理領域</p>
</li>
<li>
<p>優先度データキュー管理領域</p>
</li>
<li>
<p>優先度別のメッセージキューヘッダ領域</p>
</li>
<li>
<p>固定長メモリプール管理領域</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトを生成する際には，管理ブロックなどを置くためのメモ
リ領域も必要になるが，サイズが一定のメモリ領域はコンフィギュレータによ
り確保されるため，カーネルオブジェクトを生成する静的APIおよびサービスコー
ルにそれらのメモリ領域の先頭番地を渡すパラメータを設けていない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_オブジェクトが属する保護ドメインの設定">2.10.5. オブジェクトが属する保護ドメインの設定</h4>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，カーネルオブジェクトが属する保護ドメイン
は，オブジェクトの登録時に決定し，登録後に変更することはできない
【NGKI0387】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトを静的APIによって登録する場合には，オブジェクトを登
録する静的APIを，そのオブジェクトを属させる保護ドメインの囲みの中に記述
する【NGKI0388】．無所属のオブジェクトを登録する静的APIは，保護ドメイン
の囲みの外に記述する（「2.12.3 保護ドメインの指定」の節を参照）
【NGKI0389】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトをサービスコールによって登録する場合には，オブジェ
クト属性にTA_DOM(domid)を指定することにより，オブジェクトを属させる保護
ドメインを設定する【NGKI0390】．ここでdomidは，そのオブジェクトを属させ
る保護ドメインのID番号であり，TDOM_KERNEL（＝-1）を指定することでカーネ
ルドメインに属させることができる．また，domidにTDOM_SELF（＝0）を指定す
るか，オブジェクト属性にTA_DOM(domid)を指定しないことで，自タスクが属す
る保護ドメインに属させることができる．さらに，無所属のオブジェクトを登
録する場合には，domidにTDOM_NONE（＝-2）を指定する．</p>
</div>
<div class="paragraph">
<p>ただし，特定の保護ドメインのみに属することができるカーネルオブジェクト
を登録するサービスコールの中には，オブジェクトを属させる保護ドメインを
オブジェクト属性で設定する必要がないものもある【NGKI0391】．</p>
</div>
<div class="paragraph">
<p>割付け可能なID番号の数を指定する静的API（AID_YYY）で確保したID番号は，
どの保護ドメインに属するオブジェクトにも（また，無所属のオブジェクトに
も）割り付けられる【NGKI0392】．これらの静的APIは，保護ドメインの囲みの
外に記述しなければならない．保護ドメインの囲みの中に記述した場合には，
E_RSATRエラーとなる【NGKI0394】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>この仕様では，カーネルオブジェクトの属する保護ドメインを参照する機能は
用意していない．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトをサービスコールによって登録する場合に，オブジェク
トを属させる保護ドメインをオブジェクト属性で指定することにしたのは，保
護機能対応でないカーネルとの互換性のためには，サービスコールのパラメー
タを増やさない方が望ましいためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_オブジェクトが属するクラスの設定">2.10.6. オブジェクトが属するクラスの設定</h4>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，カーネルオブジェクトが属するクラ
スは，オブジェクトの登録時に決定し，登録後に変更することはできない
【NGKI0395】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトを静的APIによって登録する場合には，オブジェクトを登
録する静的APIを，そのオブジェクトを属させるクラスの囲みの中に記述する
【NGKI0396】．クラスに属さないオブジェクトを登録する静的APIは，クラスの
囲みの外に記述する（「2.12.4 クラスの指定」の節を参照）【NGKI0397】．</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトをサービスコールによって登録する場合には，オブジェ
クト属性にTA_CLS(clsid)を指定することにより，オブジェクトを属させるクラ
スを設定する【NGKI0398】．ここでclsidは，そのオブジェクトを属させるクラ
スのID番号であり，clsidにTCLS_SELF（＝0）を指定するか，オブジェクト属性
にTA_CLS(clsid)を指定しないことで，自タスクが属するクラスに属させること
ができる．</p>
</div>
<div class="paragraph">
<p>割付け可能なID番号の数を指定する静的API（AID_YYY）で確保したID番号は，
静的APIを囲むクラスに属するオブジェクトにのみ割り付けられる【NGKI0399】．
これらの静的APIは，確保したID番号を割り付けるオブジェクトの属すべきクラ
スの囲みの中に記述しなければならない．クラスの囲みの外に記述した場合に
は，E_RSATRエラーとなる【NGKI0401】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>この仕様では，カーネルオブジェクトの属するクラスを参照する機能は用意し
ていない．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトをサービスコールによって登録する場合に，オブジェク
トを属させるクラスをオブジェクト属性で指定することにしたのは，マルチプ
ロセッサ対応でないカーネルとの互換性のためには，サービスコールのパラメー
タを増やさない方が望ましいためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_オブジェクトの状態参照">2.10.7. オブジェクトの状態参照</h4>
<div class="paragraph">
<p>ID番号で識別するオブジェクトのすべてと，オブジェクト番号で識別するオブ
ジェクトの一部に対して，オブジェクトの状態を参照するサービスコール
（ref_yyy，get_yyy）を用意する【NGKI0402】．</p>
</div>
<div class="paragraph">
<p>オブジェクトの状態を参照するサービスコールでは，オブジェクトの登録時に
指定し，その後に変化しない情報（例えば，タスクのタスク属性や初期優先度）
を参照するための機能は用意しないことを原則とする【NGKI0403】．自タスク
の拡張情報の参照するサービスコール（get_inf）は，この原則に対する例外で
ある【NGKI0404】．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_オブジェクトのアクセス保護">2.11. オブジェクトのアクセス保護</h3>
<div class="paragraph">
<p>この節では，カーネルオブジェクトのアクセス保護について述べる．この節の
内容は，保護機能対応カーネルにのみ適用される．</p>
</div>
<div class="sect3">
<h4 id="_オブジェクトのアクセス保護とアクセス違反の通知">2.11.1. オブジェクトのアクセス保護とアクセス違反の通知</h4>
<div class="paragraph">
<p>カーネルオブジェクトに対するアクセスは，そのオブジェクトに対して設定さ
れたアクセス許可ベクタによって保護される【NGKI0405】．ただし，アクセス
許可ベクタを持たないオブジェクトに対するアクセスは，システム状態に対す
るアクセス許可ベクタによって保護される【NGKI0406】．また，オブジェクト
を登録するサービスコールと，特定のオブジェクトに関連しないシステムの状
態に対するアクセスについては，システム状態のアクセス許可ベクタによって
保護される【NGKI0407】．</p>
</div>
<div class="paragraph">
<p>アクセス許可ベクタによって許可されていないアクセス（アクセス違反）は，
カーネルによって検出され，以下の方法によって通知される．</p>
</div>
<div class="paragraph">
<p>サービスコールにより，メモリオブジェクト以外のカーネルオブジェクトに対
して，許可されていないアクセスを行おうとした場合，サービスコールから
E_OACVエラーが返る【NGKI0408】．また，メモリオブジェクトに対して，許可
されていない管理操作または参照操作を行おうとした場合も，サービスコール
からE_OACVエラーが返る【NGKI0409】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに対して，通常のメモリアクセスにより，許可されていな
い書込みアクセスまたは読出しアクセス（実行アクセスを含む）を行おうとし
た場合，CPU例外ハンドラが起動される【NGKI0410】．どのCPU例外ハンドラが
起動されるかは，ターゲット定義である【NGKI0411】．ターゲットによっては，
エミュレートされたCPU例外ハンドラの場合もある．また，ターゲット定義で，
アクセス違反の状況に応じて異なるCPU例外ハンドラが起動される場合もある．
この（これらの）CPU例外ハンドラを，メモリアクセス違反ハンドラと呼ぶ．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに対して，サービスコールを通じて，許可されていない書
込みアクセスまたは読出しアクセスを行おうとした場合，サービスコールから
E_MACVエラーが返るか，メモリアクセス違反ハンドラが起動される
【NGKI0412】．E_MACVエラーが返るかメモリアクセス違反ハンドラが起動され
るかは，ターゲット定義である【NGKI0413】．</p>
</div>
<div class="paragraph">
<p>メモリアクセス違反ハンドラでは，アクセス違反を発生させたアクセスに関す
る情報（アクセスした番地，アクセスの種別，アクセスした命令の番地など）
を参照する方法を，ターゲット定義で用意する【NGKI0414】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトとしてカーネルに登録されていないメモリ領域に対して，
ユーザドメインから書込みアクセスまたは読出しアクセス（実行アクセスを含
む）を行おうとした場合には，メモリオブジェクトに対するアクセスが許可さ
れていない場合と同様に扱われる【NGKI0415】．カーネルドメインから同様の
アクセスを行おうとした場合の動作は保証されない【NGKI0416】．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，システム状態のアクセス許可ベクタ
をシステム全体で1つ持つかプロセッサ毎に持つかは，今後の課題である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様では，アクセス保護の実装定義の制限について規定している
が，この仕様では，メモリオブジェクトに対するアクセス許可ベクタのターゲッ
ト定義の制限以外については規定していない．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>オブジェクトを登録するサービスコールを，そのオブジェクトのアクセス許可
ベクタによって保護しないのは，オブジェクトを登録する前には，アクセス許
可ベクタが設定されていないためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_メモリオブジェクトに対するアクセス許可ベクタの制限">2.11.2. メモリオブジェクトに対するアクセス許可ベクタの制限</h4>
<div class="paragraph">
<p>メモリオブジェクトの書込みアクセスと読出しアクセス（実行アクセスを含む）
に対して設定できるアクセス許可パターンは，ターゲット定義で制限される場
合がある【NGKI0417】．</p>
</div>
<div class="paragraph">
<p>ただし，少なくとも，次の5つの組み合わせの設定は，行うことができる．</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>メモリオブジェクトが属する保護ドメインのみに，読出しアクセス（実行
アクセスを含む）のみを許可する【NGKI0418】．これを，専有リードオン
リー（private read only）と呼ぶ．</p>
</li>
<li>
<p>メモリオブジェクトが属する保護ドメインのみに，書込みアクセスと読出
しアクセス（実行アクセスを含む）を許可する【NGKI0419】．これを，専
有リードライト（private read/write）と呼ぶ．</p>
</li>
<li>
<p>すべての保護ドメインに，読出しアクセス（実行アクセスを含む）のみを
許可する【NGKI0420】．これを，共有リードオンリー（shared read only）
と呼ぶ．</p>
</li>
<li>
<p>すべての保護ドメインに，書込みアクセスと読出しアクセス（実行アクセ
スを含む）を許可する【NGKI0421】．これを，共有リードライト（shared
read/write）と呼ぶ．</p>
</li>
<li>
<p>メモリオブジェクトが属する保護ドメインに，書込みアクセスと読出しア
クセス（実行アクセスを含む）を許可し，他の保護ドメインには，読出し
アクセス（実行アクセスを含む）のみを許可する【NGKI0422】．これを，
共有リード専有ライト（shared read private write）と呼ぶ．</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>また，ターゲット定義で，1つの保護ドメインに登録できるメモリオブジェクト
の数が制限される場合がある【NGKI0423】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_デフォルトのアクセス許可ベクタ">2.11.3. デフォルトのアクセス許可ベクタ</h4>
<div class="paragraph">
<p>カーネルオブジェクトを登録した直後は，次に規定されるデフォルトのアクセ
ス許可ベクタが設定される．</p>
</div>
<div class="paragraph">
<p>保護ドメインに属するカーネルオブジェクトに対しては，4つの種別のアクセス
がいずれも，その保護ドメインのみに許可される【NGKI0424】．すなわち，カー
ネルドメインに属するオブジェクトに対しては，4つのアクセス許可パターンが
いずれもTACP_KERNELに，ユーザドメインに属するオブジェクトに対しては，4
つのアクセス許可パターンがいずれもTACP(domid)（domidはオブジェクトが属
する保護ドメインのID番号）に設定される．ただし，カーネルオブジェクトを
サービスコールにより登録した場合には，管理操作に対するアクセスは，サー
ビスコールを呼び出した処理単位が属する保護ドメインにも許可される
【NGKI3427】．</p>
</div>
<div class="paragraph">
<p>無所属のカーネルオブジェクトに対しては，4つの種別のアクセスがいずれも，
すべての保護ドメインに許可される【NGKI0425】．すなわち，4つのアクセス許
可パターンがいずれも，TACP_SHAREDに設定される．</p>
</div>
<div class="paragraph">
<p>システム状態のアクセス許可ベクタは，4つの種別のアクセスがいずれも，カー
ネルドメインのみに許可される【NGKI0426】．すなわち，4つのアクセス許可パ
ターンがいずれも，TACP_KERNELに設定される．</p>
</div>
</div>
<div class="sect3">
<h4 id="_アクセス許可ベクタの設定">2.11.4. アクセス許可ベクタの設定</h4>
<div class="paragraph">
<p>アクセス許可ベクタをデフォルト以外の値に設定するために，カーネルオブジェ
クトのアクセス許可ベクタを設定する静的API（SAC_YYY）と，システム状態の
アクセス許可ベクタを設定する静的API（SAC_SYS）が用意されている
【NGKI0427】．</p>
</div>
<div class="paragraph">
<p>また，動的生成対応カーネルにおいては，カーネルオブジェクトのアクセス許
可ベクタを設定するサービスコール（sac_yyy）と，システム状態のアクセス許
可ベクタを設定するサービスコール（sac_sys）が用意されている【NGKI0428】．
ただし，静的APIによって登録したオブジェクトは，サービスコール（sac_yyy）
によってアクセス許可ベクタを設定することができない．アクセス許可ベクタ
を設定しようとした場合には，E_OBJエラーとなる【NGKI0430】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトに対しては，アクセス許可ベクタを設定する静的APIは用意
されておらず，オブジェクトの登録と同時にアクセス許可ベクタを設定する静
的API（ATA_YYY）が用意されている【NGKI0431】．</p>
</div>
<div class="paragraph">
<p>オブジェクトに対するアクセスが許可されているかは，そのオブジェクトにア
クセスするサービスコールを呼び出した時点でチェックされる【NGKI0432】．
そのため，アクセス許可ベクタを変更しても，変更以前に呼び出されたサービ
スコールの振舞いには影響しない．例えば，待ち行列を持つ同期・通信オブジェ
クトのアクセス許可ベクタを変更しても，呼び出した時点ですでに待ち行列に
つながれているタスクには影響しない．また，ミューテックスのアクセス許可
ベクタを変更しても，呼び出した時点ですでにミューテックをロックしていた
タスクには影響しない．</p>
</div>
<div class="paragraph">
<p>この仕様では，カーネルオブジェクトに設定されたアクセス許可ベクタを参照
する機能は用意していない．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>カーネルオブジェクトのアクセス許可ベクタをデフォルト以外の値に設定する
際に，オブジェクトに対して同じ保護ドメインに属する処理単位からアクセス
できるようにするには，その保護ドメインからアクセスできることを明示的に
指定する必要がある．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>アクセス許可ベクタを指定してオブジェクトを生成する静的API（CRA_YYY）は
廃止し，オブジェクトの登録後にアクセス許可ベクタを設定する静的
API（SAC_YYY）をサポートすることとした．</p>
</div>
<div class="paragraph">
<p>静的APIによって登録したオブジェクトは，サービスコール（sac_yyy）によっ
てアクセス許可ベクタを設定することができないこととした．</p>
</div>
<div class="paragraph">
<p>オブジェクトの状態参照するサービスコール（ref_yyy）により，オブジェクト
に設定されたアクセス許可ベクタを参照する機能サポートしないこととした．
これは，［NGKI0403］の原則に合わせるための修正である．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネルの管理領域のアクセス保護">2.11.5. カーネルの管理領域のアクセス保護</h4>
<div class="paragraph">
<p>カーネルが動作するために，カーネルの内部で用いるメモリ領域を，カーネル
の管理領域と呼ぶ．ユーザタスクからカーネルを保護するためには，カーネル
の管理領域にアクセスできるのは，カーネルドメインのみでなければならない．
そのため，カーネルの管理領域は，書込みアクセスおよび読出しアクセスが可
能で，4つの種別のアクセスがカーネルドメインのみに許可されたメモリオブジェ
クト（これを，カーネル専用のメモリオブジェクトと呼ぶ）の中に置かれる
【NGKI0433】．</p>
</div>
<div class="paragraph">
<p>カーネルの用いるオブジェクト管理領域（カーネルの管理領域に該当する．
「2.10.4 オブジェクト生成に必要なメモリ領域」の節を参照）として，カーネ
ル専用のメモリオブジェクトに含まれないメモリ領域を指定した場合，E_OBJエ
ラーとなる【NGKI0434】．また，カーネルの用いるオブジェクト管理領域の先
頭番地にNULL を指定した場合，必要なメモリ領域が，カーネル専用のメモリオ
ブジェクトの中に確保される【NGKI0435】．</p>
</div>
<div class="paragraph">
<p>システムタスクのスタック領域，ユーザタスクのシステムスタック領域，非タ
スクコンテキスト用のスタック領域は，カーネルの用いるオブジェクト管理領
域には該当しないが，カーネルドメインの実行中にのみアクセスされるため，
カーネルの用いるオブジェクト管理領域と同様の扱いとなる【NGKI0436】．一
方，ユーザタスクのユーザスタック領域と固定長メモリプール領域は，ユーザ
ドメインの実行中にもアクセスされるため，カーネルの用いるオブジェクト管
理領域とは異なる扱いとなる．</p>
</div>
</div>
<div class="sect3">
<h4 id="_ユーザタスクのユーザスタック領域">2.11.6. ユーザタスクのユーザスタック領域</h4>
<div class="paragraph">
<p>ユーザタスクが非特権モードで実行する間に用いるスタック領域を，システム
スタック領域（「4.1 タスク管理機能」の節を参照）と対比させて，ユーザス
タック領域と呼ぶ．ユーザスタック領域は，そのタスクと同じ保護ドメインに
属する1つのメモリオブジェクトとしてカーネルに登録される【NGKI0437】．た
だし，他のメモリオブジェクトとは異なり，次のように扱われる．</p>
</div>
<div class="paragraph">
<p>タスクのユーザスタック領域に対しては，そのタスクのみが書込みアクセスお
よび読出しアクセスを行うことができる【NGKI0438】．そのため，書込みアク
セスと読出しアクセス（実行アクセスを含む）に対するアクセス許可パターン
は意味を持たない【NGKI0439】．ユーザスタック領域に対して実行アクセスを
行えるかどうかは，ターゲット定義である【NGKI0440】．</p>
</div>
<div class="paragraph">
<p>ただし，上記の仕様を実現するために大きいオーバヘッドを生じる場合には，
ターゲット定義で，タスクのユーザスタック領域を，そのタスクが属する保護
ドメイン全体からアクセスできるものとする場合がある【NGKI0441】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>この仕様では，タスクのユーザスタック領域は，そのタスクのみがアクセスで
きるものとした．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_システムコンフィギュレーション手順">2.12. システムコンフィギュレーション手順</h3>
<div class="sect3">
<h4 id="_システムコンフィギュレーションファイル">2.12.1. システムコンフィギュレーションファイル</h4>
<div class="paragraph">
<p>カーネルやシステムサービスが管理するオブジェクトの生成情報や初期状態な
どを記述するファイルを，システムコンフィギュレーションファイル（system
configuration file）と呼ぶ．また，システムコンフィギュレーションファイ
ルを解釈して，カーネルやシステムサービスの構成・初期化情報を含むファイ
ルなどを生成するツールを，コンフィギュレータ（configurator）と呼ぶ．</p>
</div>
<div class="paragraph">
<p>システムコンフィギュレーションファイルには，カーネルの静的API，システム
サービスの静的API，保護ドメインの囲み，クラスの囲み，コンフィギュレータ
に対するINCLUDEディレクティブ，C言語プリプロセッサのインクルードディレ
クティブ（#include）と条件ディレクティブ（#if，#ifdefなど）のみを記述す
ることができる【NGKI0442】．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータに対するINCLUDEディレクティブは，システムコンフィギュ
レーションファイルを複数のファイルに分割して記述するために用いるもので，
その文法は次のいずれかである（両者の違いは，指定されたファイルを探すディ
レクトリの違いのみ）【NGKI0443】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">INCLUDE("ファイル名");
INCLUDE(&lt;ファイル名&gt;);</code></pre>
</div>
</div>
<div class="paragraph">
<p>コンフィギュレータは，INCLUDEディレクティブによって指定されたファイル中
の記述を，システムコンフィギュレーションファイルの一部分として解釈する
【NGKI0444】．すなわち，INCLUDEディレクティブによって指定されたファイル
中には，カーネルの静的API，システムサービスの静的API，コンフィギュレー
タに対するINCLUDEディレクティブ，C言語プリプロセッサのインクルードディ
レクティブと条件ディレクティブのみを記述することができる．</p>
</div>
<div class="paragraph">
<p>C言語プリプロセッサのインクルードディレクティブは，静的APIのパラメータ
を解釈するために必要なC言語のヘッダファイルを指定するために用いる
【NGKI0445】．また，条件ディレクティブは，有効とする静的APIを選択するた
めに用いることができる【NGKI0446】．ただし，インクルードディレクティブ
は，コンフィギュレータが生成するファイルでは先頭に集められる
【NGKI0447】．そのため，条件ディレクティブの中にインクルードディレクティ
ブを記述しても，インクルードディレクティブは常に有効となる．また，1つの
静的APIの記述の途中に，条件ディレクティブを記述することはできない
【NGKI0448】．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，システムコンフィギュレーションファイル中の静的
APIを，その記述順に解釈する【NGKI0449】．そのため例えば，タスクを生成す
る静的APIの前に，そのタスクにタスク例外処理ルーチンを定義する静的APIが
記述されていた場合，タスク例外処理ルーチンを定義する静的APIがE_NOEXSエ
ラーとなる．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>システムコンフィギュレーションファイルにおけるC言語プリプロセッサのディ
レクティブの扱いを全面的に見直し，コンフィギュレータに対するINCLUDEディ
レクティブを設けた．また，共通静的APIを廃止した．μITRON4.0仕様における
#includeディレクティブの役割は，この仕様ではINCLUDEディレクティブに置き
換わる．逆に，μITRON4.0仕様におけるINCLUDE静的APIの役割は，この仕様で
は#includeディレクティブに置き換わる．</p>
</div>
</div>
<div class="sect3">
<h4 id="_静的apiの文法とパラメータ">2.12.2. 静的APIの文法とパラメータ</h4>
<div class="paragraph">
<p>静的APIは，次に述べる例外を除いては，C言語の関数呼出しと同様の文法で記
述する【NGKI0450】．すなわち，静的APIの名称に続けて，静的APIの各パラメー
タを","で区切って列挙したものを"("と")"で囲んで記述し，最後に";"を記述
する．ただし，静的APIのパラメータに構造体（または構造体へのポインタ）を
記述する場合には，構造体の各フィールドを","で区切って列挙したものを"{"
と"}"で囲んだ形で記述する【NGKI0451】．</p>
</div>
<div class="paragraph">
<p>サービスコールに対応する静的APIの場合，静的APIのパラメータは，対応する
サービスコールのパラメータと同一とすることを原則とする【NGKI0452】．</p>
</div>
<div class="paragraph">
<p>静的APIのパラメータは，次の4種類に分類される．</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>オブジェクト識別名</p>
<div class="paragraph">
<p>オブジェクトのID番号を指定するパラメータ．オブジェクトの名称を表す単一
の識別名のみを記述することができる．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，オブジェクト生成のための静的API（CRE_YYY）を処理
する際に，オブジェクトにID番号を割り付け，構成・初期化ヘッダファイルに，
指定された識別名を割り付けたID番号にマクロ定義するC言語プリプロセッサの
ディレクティブ（#define）を生成する【NGKI0453】．</p>
</div>
<div class="paragraph">
<p>オブジェクト生成以外の静的APIが，オブジェクトのID番号をパラメータに取る
場合（カーネルの静的APIでは，SAC_TSKやDEF_TEXのtskidパラメータ等がこれ
に該当する）には，パラメータとして記述する識別名は，生成済みのオブジェ
クトの名称を表す識別名でなければならない．そうでない場合には，コンフィ
ギュレータがエラーを報告する【NGKI0455】．</p>
</div>
<div class="paragraph">
<p>静的APIの整数定数式パラメータの記述に，オブジェクト識別名を使用すること
はできない【NGKI0456】．</p>
</div>
</li>
<li>
<p>整数定数式パラメータ</p>
<div class="paragraph">
<p>オブジェクト番号や機能コード，オブジェクト属性，サイズや数，優先度など，
整数値を指定するパラメータ．プログラムが配置される番地に依存せずに値の
決まる整数定数式を記述することができる．</p>
</div>
<div class="paragraph">
<p>整数定数式の解釈に必要な定義や宣言等は，システムコンフィギュレーション
ファイルからC言語プリプロセッサのインクルードディレクティブによってイン
クルードするファイルに含まれていなければならない【NGKI0457】．</p>
</div>
</li>
<li>
<p>一般定数式パラメータ</p>
<div class="paragraph">
<p>処理単位のエントリ番地，メモリ領域の先頭番地，拡張情報など，番地を指定
する可能性のあるパラメータ．任意の定数式を記述することができる．</p>
</div>
<div class="paragraph">
<p>定数式の解釈に必要な定義や宣言等は，システムコンフィギュレーションファ
イルからC言語プリプロセッサのインクルードディレクティブによってインクルー
ドするファイルに含まれていなければならない【NGKI0458】．</p>
</div>
</li>
<li>
<p>文字列パラメータ</p>
<div class="paragraph">
<p>オブジェクトモジュール名やセクション名など，文字列を指定するパラメータ．
任意の文字列を，C言語の文字列の記法で記述することができる．</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様においては，静的APIのパラメータを次の4種類に分類していた
が，コンフィギュレータの仕組みを見直したことに伴い全面的に見直した．</p>
</div>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>自動割付け対応整数値パラメータ</p>
</li>
<li>
<p>自動割付け非対応整数値パラメータ</p>
</li>
<li>
<p>プリプロセッサ定数式パラメータ</p>
</li>
<li>
<p>一般定数式パラメータ</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>この仕様の(a)が，おおよそμITRON4.0仕様の(A)に相当するが，(a)には整数値
を記述できない点が異なる．(b)〜(c)と(B)〜(D)の間には単純な対応関係がな
いが，記述できる定数式の範囲には，(B)⊂(C)⊂(b)⊂(c)＝(D)の関係がある．</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，静的APIのパラメータは基本的には(D)とし，コンフィギュ
レータが値を知る必要があるパラメータを(B)，構成・初期化ファイルに生成す
るC言語プリプロセッサの条件ディレクティブ（#if）中に含めたい可能性のあ
るパラメータを(C)としていた．</p>
</div>
<div class="paragraph">
<p>それに対して，この仕様におけるコンフィギュレータの処理モデル（「2.12.5
コンフィギュレータの処理モデル」の節を参照）では，コンフィギュレータの
パス2において定数式パラメータの値を知ることができるため，(B)〜(D)の区別
をする必要がない．そのため，静的APIのパラメータは基本的には(b)とし，パ
ス2で値を知ることのできない定数式パラメータのみを(c)としている．</p>
</div>
</div>
<div class="sect3">
<h4 id="_保護ドメインの指定">2.12.3. 保護ドメインの指定</h4>
<div class="paragraph">
<p>保護機能対応カーネルでは，オブジェクトを登録する静的API等を，そのオブジェ
クトが属する保護ドメインの囲みの中に記述する【NGKI0459】．無所属のオブ
ジェクトを登録する静的APIは，保護ドメインの囲みの外に記述する
【NGKI0460】．保護ドメインに属すべきオブジェクトを登録する静的API等を，
保護ドメインの囲みの外に記述した場合には，コンフィギュレータがE_RSATRエ
ラーを報告する【NGKI0461】．</p>
</div>
<div class="paragraph">
<p>ユーザドメインの囲みの文法は次の通り【NGKI0462】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">DOMAIN(保護ドメイン名) {
	ユーザドメインに属するオブジェクトを登録する静的API等
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>保護ドメイン名には，ユーザドメインの名称を表す単一の識別名のみを記述す
ることができる【NGKI0463】．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，ユーザドメインの囲みを処理する際に，ユーザドメイ
ンに保護ドメインIDを割り付け，構成・初期化ヘッダファイルに，指定された
保護ドメイン名を割り付けた保護ドメインIDにマクロ定義するC言語プリプロセッ
サのディレクティブ（#define）を生成する【NGKI0464】．また，ユーザドメイ
ンの囲みの中およびそれ以降に記述する静的APIの整数定数式パラメータの記述
に保護ドメイン名を記述すると，割り付けた保護ドメインIDの値に評価される
【NGKI0465】．</p>
</div>
<div class="paragraph">
<p>ユーザドメインの囲みの中を空にすることで，ユーザドメインへの保護ドメイ
ンIDの割付けのみを行うことができる【NGKI0466】．</p>
</div>
<div class="paragraph">
<p>カーネルドメインの囲みの文法は次の通り【NGKI0467】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">KERNEL_DOMAIN {
	カーネルドメインに属するオブジェクトを登録する静的API等
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>同じ保護ドメイン名を指定したユーザドメインの囲みや，カーネルドメインの
囲みを，複数回記述してもよい【NGKI0468】．保護機能対応でないカーネルで
保護ドメインの囲みを記述した場合や，保護ドメインの囲みの中に保護ドメイ
ンの囲みを記述した場合には，コンフィギュレータがエラーを報告する
【NGKI0469】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>保護ドメインの囲みの文法を変更した．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>保護ドメインに属すべきオブジェクトを登録する静的API等を保護ドメインの囲
みの外に記述した場合のエラーコードをE_RSATRとしたのは，オブジェクトを動
的に登録するAPIにおいては，オブジェクトの属する保護ドメインを，オブジェ
クト属性によって指定するためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_クラスの指定">2.12.4. クラスの指定</h4>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，オブジェクトを登録する静的API等を，そ
のオブジェクトが属するクラスの囲みの中に記述する【NGKI0470】．クラスに
属すべきオブジェクトを登録する静的API等を，クラスの囲みの外に記述した場
合には，コンフィギュレータがE_RSATRエラーを報告する【NGKI0471】．</p>
</div>
<div class="paragraph">
<p>クラスの囲みの文法は次の通り【NGKI0472】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">CLASS(クラスID) {
	クラスに属するオブジェクトを登録する静的API等
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>クラスIDには，静的APIの整数定数式パラメータと同等の定数式を記述すること
ができる【NGKI0473】．使用できないクラスIDを指定した場合には，コンフィ
ギュレータがE_IDエラーを報告する【NGKI0474】．</p>
</div>
<div class="paragraph">
<p>同じクラスIDを指定したクラスの囲みを複数回記述してもよい【NGKI0475】．
マルチプロセッサ対応でないカーネルでクラスの囲みを記述した場合や，クラ
スの囲みの中にクラスの囲みを記述した場合には，コンフィギュレータがエラー
を報告する【NGKI0476】．</p>
</div>
<div class="paragraph">
<p>なお，保護機能とマルチプロセッサの両方に対応するカーネルでは，保護ドメ
インの囲みとクラスの囲みはどちらが外側になっていてもよい【NGKI0477】．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>クラスに属すべきオブジェクトを登録する静的API等をクラスの囲みの外に記述
した場合のエラーコードをE_RSATRとしたのは，オブジェクトを動的に登録する
APIにおいては，オブジェクトの属するクラスを，オブジェクト属性によって指
定するためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_コンフィギュレータの処理モデル">2.12.5. コンフィギュレータの処理モデル</h4>
<div class="paragraph">
<p>コンフィギュレータは，次の3つないしは4つのパスにより，システムコンフィ
ギュレーションファイルを解釈し，構成・初期化情報を含むファイルなどを生
成する（図2-8）．</p>
</div>
<div class="paragraph">
<p>最初のパス1では，システムコンフィギュレーションファイルを解釈し，そこに
含まれる静的APIの整数定数式パラメータの値をCコンパイラを用いて求めるた
めに，パラメータ計算用C言語ファイル（cfg1_out.c）を生成する．この時，シ
ステムコンフィギュレーションファイルに含まれるC言語プリプロセッサのイン
クルードディレクティブは，パラメータ計算用C言語ファイルの先頭に集めて生
成する．また，条件ディレクティブは，順序も含めて，そのままの形でパラメー
タ計算用C言語ファイルに出力する．システムコンフィギュレーションファイル
に文法エラーや未サポートの記述があった場合には，この段階で検出される．</p>
</div>
<div class="paragraph">
<p>次に，Cコンパイラおよび関連ツールを用いて，パラメータ計算用C言語ファイ
ルをコンパイルし，ロードモジュールを生成する．また，それをSレコードフォー
マットの形に変換したSレコードファイル（cfg1_out.srec）と，その中の各シ
ンボルとアドレスの対応表を含むシンボルファイル（cfg1_out.syms）を生成す
る．静的APIの整数定数式パラメータに解釈できない式が記述された場合には，
この段階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータのパス2では，パス1で生成されたロードモジュールのSレコー
ドファイルとシンボルファイルから，C言語プリプロセッサの条件ディレクティ
ブによりどの静的APIが有効となったかと，それらの静的APIの整数定数式パラ
メータの値を取り出し，カーネルおよびシステムサービスの構成・初期化ファ
イル（kernel_cfg.cなど）と構成・初期化ヘッダファイル（kernel_cfg.hなど）
を生成する．構成・初期化ヘッダファイルには，登録できるオブジェクトの数
（動的生成対応カーネル以外では，静的APIによって登録されたオブジェクトの
数に一致）やオブジェクトのID番号などの定義を出力する．静的APIの整数定数
式パラメータに不正がある場合には，この段階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>パス2で生成されたファイルを，他のソースファイルとあわせてコンパイルし，
アプリケーションのロードモジュールを生成する．また，そのSレコードファイ
ル（system.srec）とシンボルファイル（system.syms）を生成する．静的APIの
一般定数式パラメータに解釈できない式が記述された場合には，この段階でエ
ラーが検出される．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータのパス3では，パス1およびパス2で生成されたロードモジュー
ルのSレコードファイルとシンボルファイルから，静的APIのパラメータの値な
どを取り出し，妥当性のチェックを行う．静的APIの一般定数式パラメータに不
正がある場合には，この段階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，メモリ配置を決定し，メモリ保護のための
設定情報を生成するために，さらに以下の処理を行う（図2-9）．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，決定したメモリ配置に従ってロードモジュールを生成
するために，リンクスクリプト（ldscript.ld）を生成する．また，メモリ保護
のための設定情報を，メモリ構成・初期化ファイル（kernel_mem.c）に生成す
る．これらのファイルを生成するためには，パス3以降で初めて得られる情報が
必要となるため，これらのファイルはパス3以降でしか生成できず，最終的なロー
ドモジュールも，パス3以降で生成する．</p>
</div>
<div class="paragraph">
<p>そのため，パス2で生成されたロードモジュールは，仮のロードモジュールとい
う位置付けになる．ここで，パス3以降で必要な情報を取り出し，最終的なロー
ドモジュールのサイズを割り出せるように，パス3以降でメモリ構成・初期化ファ
イルに生成するのと同様のデータ構造を，パス2において仮のメモリ構成・初期
化ファイル（kernel_mem2.c）に生成する．また，これをリンクするための仮の
リンクスクリプト（cfg2_out.ld）を生成し，これらを用いて仮のロードモジュー
ルを生成する．さらに，仮のロードモジュールのSレコードファイル
（cfg2_out.srec）とシンボルファイル（cfg2_out.syms）も，最終的なものと
混同しないように，異なるファイル名で生成する．</p>
</div>
<div class="paragraph">
<p>パス3は，ターゲット依存で用いるパスで，メモリ配置やメモリ保護のための設
定情報のサイズを最適化するための処理を行う．パス2で生成された仮のロード
モジュールのSレコードファイルとシンボルファイルから必要な情報を取り出し，
再度，仮のメモリ構成・初期化ファイル（kernel_mem3.c）と仮のリンクスクリ
プト（cfg3_out.ld）を生成する．また，これらのファイルを他のソースファイ
ルとあわせてコンパイルして仮のロードモジュールを生成し，そのSレコードファ
イル（cfg3_out.srec）とシンボルファイル（cfg3_out.syms）を生成する．こ
の段階で，メモリオブジェクトに重なりがあるなどのエラーが検出される場合
もある．</p>
</div>
<div class="paragraph">
<p>パス4では，パス3（パス3を用いない場合はパス2）で生成された仮のロードモ
ジュールのSレコードファイルとシンボルファイルから必要な情報を取り出し，
最終的なメモリ構成・初期化ファイル（kernel_mem.c）とリンクスクリプト
（ldscript.ld）を生成する．またパス4では，保護機能対応でないカーネルに
おいてパス3で行っていた静的APIパラメータの値などの妥当性のチェックも行
う．そのため，静的APIの一般定数式パラメータに不正がある場合には，この段
階でエラーが検出される．</p>
</div>
<div class="paragraph">
<p>パス4で生成されたファイルを，他のソースファイルとあわせてコンパイルし，
アプリケーションの最終的なロードモジュールを生成する．また，そのSレコー
ドファイル（system.srec，必要な場合のみ）とシンボルファイル
（system.syms）を生成する．</p>
</div>
<div class="paragraph">
<p>最後に，最終的なロードモジュールが，パス3（パス3を用いない場合はパス2）
で生成された仮のロードモジュールと同じメモリ配置であることをチェックす
る．両者のメモリ配置が異なっていた場合には，ロードモジュールが正しく生
成されていない可能性があるが，これは，コンフィギュレーション処理の不具
合を示すものである．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>コンフィギュレータの処理モデルは全面的に変更した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_静的apiのパラメータに関するエラー検出">2.12.6. 静的APIのパラメータに関するエラー検出</h4>
<div class="paragraph">
<p>静的APIのパラメータに関するエラー検出は，同じものがサービスコールとして
呼ばれた場合と同等とすることを原則とする【NGKI0478】．言い換えると，サー
ビスコールによっても検出できないエラーは，静的APIにおいても検出しない．
静的APIの機能説明中の「E_XXXXXエラーとなる」または「E_XXXXXエラーが返る」
という記述は，コンフィギュレータがそのエラーを検出することを意味する．</p>
</div>
<div class="paragraph">
<p>ただし，エラーの種類によっては，サービスコールと同等のエラー検出を行う
ことが難しいため，そのようなものについては例外とする【NGKI0479】．例え
ば，メモリ不足をコンフィギュレータによって検出するのは容易ではない．</p>
</div>
<div class="paragraph">
<p>逆に，オブジェクト属性については，サービスコールより強力なエラーチェッ
クを行える可能性がある．例えば，タスク属性にTA_STAと記述されている場合，
サービスコールではエラーを検出できないが，コンフィギュレータでは検出で
きる可能性がある．ただし，このようなエラー検出を完全に行おうとするとコ
ンフィギュレータが複雑になるため，このようなエラーを検出することは必須
とせず，検出できた場合には警告として報告する【NGKI0480】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，静的APIのパラメータに関するエラー検出について規定さ
れていない．</p>
</div>
</div>
<div class="sect3">
<h4 id="_オブジェクトのid番号の指定">2.12.7. オブジェクトのID番号の指定</h4>
<div class="paragraph">
<p>コンフィギュレータのオプション機能として，アプリケーション設計者がオブ
ジェクトのID番号を指定するための次の機能を用意する．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータのオプション指定により，オブジェクト識別名とID番号の
対応表を含むファイルを渡すと，コンフィギュレータはそれに従ってオブジェ
クトにID番号を割り付ける【NGKI0481】．それに従ったID番号割付けができな
い場合（ID番号に抜けができる場合など）には，コンフィギュレータはエラー
を報告する【NGKI0482】．</p>
</div>
<div class="paragraph">
<p>またコンフィギュレータは，オプション指定により，オブジェクト識別名とコ
ンフィギュレータが割り付けたID番号の対応表を含むファイルを，コンフィギュ
レータに渡すファイルと同じフォーマットで生成する【NGKI0483】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，オブジェクト生成のための静的APIのID番号を指定するパ
ラメータに整数値を記述できるため，このような機能は用意されていない．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_toppersネーミングコンベンション">2.13. TOPPERSネーミングコンベンション</h3>
<div class="paragraph">
<p>この節では，TOPPERSソフトウェアのAPIの構成要素の名称に関するネーミング
コンベンションについて述べる．このネーミングコンベンションは，モジュー
ル間のインタフェースに関わる名称に適用することを想定しているが，モジュー
ル内部の名称に適用してもよい．</p>
</div>
<div class="sect3">
<h4 id="_モジュール識別名">2.13.1. モジュール識別名</h4>
<div class="paragraph">
<p>異なるモジュールのAPIの構成要素の名称が衝突することを避けるために，各モ
ジュールに対して，それを識別するためのモジュール識別名を定める．モジュー
ル識別名は，英文字と数字で構成し，2〜8文字程度の長さとする．</p>
</div>
<div class="paragraph">
<p>カーネルのモジュール識別名は"kernel"，システムインタフェースレイヤのモ
ジュール識別名は"sil"とする．</p>
</div>
<div class="paragraph">
<p>APIの構成要素の名称には，モジュール識別名を含めることを原則とするが，カー
ネルのAPIなど，頻繁に使用されて衝突のおそれが少ない場合には，モジュール
識別名を含めない名称を使用する．</p>
</div>
<div class="paragraph">
<p>以下では，モジュール識別名の英文字を英小文字としたものをwww，英大文字と
したものをWWWと表記する．</p>
</div>
</div>
<div class="sect3">
<h4 id="_データ型名">2.13.2. データ型名</h4>
<div class="paragraph">
<p>各サイズの整数型など，データの意味を定めない基本データ型の名称は，英小
文字，数字，"_"で構成する．データ型であることを明示するために，末尾が
"_t"である名称とする．</p>
</div>
<div class="paragraph">
<p>複合データ型やデータの意味を定めるデータ型の名称は，英大文字，数字，
"<em>"で構成する．データ型であることを明示するために，先頭が"T</em>"または末尾
が"_T"である名称とする場合もある．</p>
</div>
<div class="paragraph">
<p>データ型の種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>パケットのデータ型</p>
<div class="listingblock">
<div class="content">
<pre>	T_CYYY			acre_yyyに渡すパケットのデータ型
	T_DYYY			def_yyyに渡すパケットのデータ型
	T_RYYY			ref_yyyに渡すパケットのデータ型
	T_WWW_CYYY		www_acre_yyyに渡すパケットのデータ型
	T_WWW_DYYY		www_def_yyyに渡すパケットのデータ型
	T_WWW_RYYY		www_ref_yyyに渡すパケットのデータ型</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_関数名">2.14. 関数名</h3>
<div class="paragraph">
<p>関数の名称は，英小文字，数字，"_"で構成する．</p>
</div>
<div class="paragraph">
<p>関数の種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>サービスコール</p>
<div class="paragraph">
<p>サービスコールは，xxx_yyyまたはwww_xxx_yyyの名称とする．ここで，xxxは操
作の方法，yyyは操作の対象を表す．xxx_yyyまたはwww_xxx_yyyから派生したサー
ビスコールは，それぞれzxxx_yyyまたはwww_zxxx_yyyの名称とする．ここでzは，
派生したことを表す文字である．派生したことを表す文字を2つ付加する場合に
は，zzxxx_yyyまたはwww_zzxxx_yyyの名称となる．</p>
</div>
<div class="paragraph">
<p>非タスクコンテキスト専用のサービスコールの名称は，派生したことを表す文
字として"i"を付加し，ixxx_yyy，izxxx_yyy，www_ixxx_yyy，www_izxxx_yyyと
いった名称とする．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>サービスコールの名称を構成する省略名（xxx，yyy，z）の元になった英語につ
いては，「5.10 省略名の元になった英語」の節を参照すること．</p>
</div>
</li>
<li>
<p>コールバック</p>
<div class="paragraph">
<p>コールバックの名称は，サービスコールのネーミングコンベンションに従う．</p>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_変数名">2.14.1. 変数名</h4>
<div class="paragraph">
<p>変数（const修飾子のついたものを含む）の名称は，英小文字，数字，"_"で構
成する．データ型が異なる変数には，異なる名称を付けることを原則とする．</p>
</div>
<div class="paragraph">
<p>変数の名称に関して，次のガイドラインを設ける．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>〜id		〜ID（オブジェクトのID番号，ID型）
〜no		〜番号（オブジェクト番号）
〜atr		〜属性（オブジェクト属性，ATR型）
〜stat		〜状態（オブジェクト状態，STAT型）
〜mode		〜モード（サービスコールの動作モード，MODE型）
〜pri		〜優先度（優先度，PRI型）
〜sz		〜サイズ（単位はバイト数，SIZE型またはuint_t型）
〜cnt		〜の個数（単位は個数，uint_t型）
〜ptn		〜パターン
〜tim		〜時刻，〜時間
〜cd		〜コード
i〜			〜の初期値
max〜		〜の最大値
min〜		〜の最小値
left〜		〜の残り</pre>
</div>
</div>
<div class="paragraph">
<p>また，ポインタ変数（関数ポインタを除く）の名称に関して，次のガイドライ
ンを設ける．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>p_〜		ポインタ
pp_〜		ポインタを入れる領域へのポインタ
pk_〜		パケットへのポインタ
ppk_〜		パケットへのポインタを入れる領域へのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>変数の種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) パケットへのポインタ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>pk_cyyy			acre_yyyに渡すパケットへのポインタ
pk_dyyy			def_yyyに渡すパケットへのポインタ
pk_ryyy			ref_yyyに渡すパケットへのポインタ
pk_www_cyyy		www_acre_yyyに渡すパケットへのポインタ
pk_www_dyyy		www_def_yyyに渡すパケットへのポインタ
pk_www_ryyy		www_ref_yyyに渡すパケットへのポインタ</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_定数名">2.14.2. 定数名</h4>
<div class="paragraph">
<p>定数（C言語プリプロセッサのマクロ定義によるもの）の名称は，英大文字，数
字，"_"で構成する．</p>
</div>
<div class="paragraph">
<p>定数の種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) メインエラーコード</p>
</div>
<div class="paragraph">
<p>メインエラーコードは，先頭が"E_"である名称とする．</p>
</div>
<div class="paragraph">
<p>(B) 機能コード</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TFN_XXX_YYY			xxx_yyyの機能コード
TFN_WWW_XXX_YYY		www_xxx_yyyの機能コード</pre>
</div>
</div>
<div class="paragraph">
<p>(C) その他の定数</p>
</div>
<div class="paragraph">
<p>その他の定数は，先頭がTUU_またはTUU_WWW_である名称とする．ここでUUは，
定数の種類またはデータ型を表す．同じパラメータまたはリターンパラメータ
に用いられる定数の名称については，UUを同一にすることを原則とする．</p>
</div>
<div class="paragraph">
<p>また，定数の名称に関して，次のガイドラインを設ける．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_〜		オブジェクトの属性値
TSZ_〜		〜のサイズ
TBIT_〜		〜のビット数
TMAX_〜		〜の最大値
TMIN_〜		〜の最小値</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_マクロ名">2.14.3. マクロ名</h4>
<div class="paragraph">
<p>マクロ（C言語プリプロセッサのマクロ定義によるもの）の名称は，それが表す
構成要素のネーミングコンベンションに従う．すなわち，関数を表すマクロは
関数のネーミングコンベンションに，定数を表すマクロは定数のネーミングコ
ンベンションに従う．ただし，簡単な関数を表すマクロや，副作用があるなど
の理由でマクロであることを明示したい場合には，英大文字，数字，"_"で構成
する場合もある．</p>
</div>
<div class="paragraph">
<p>マクロの種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) 構成マクロ</p>
</div>
<div class="paragraph">
<p>構成マクロの名称は，英大文字，数字，"_"で構成し，次のガイドラインを設け
る．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_〜		〜のサイズ
TBIT_〜		〜のビット数
TMAX_〜		〜の最大値
TMIN_〜		〜の最小値</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_静的api名">2.14.4. 静的API名</h4>
<div class="paragraph">
<p>静的APIの名称は，英大文字，数字，"_"で構成し，対応するサービスコールの
名称中の英小文字を英大文字で置き換えたものとする．対応するサービスコー
ルがない場合には，サービスコールのネーミングコンベンションに従って定め
た名称中の英小文字を英大文字で置き換えたものとする．</p>
</div>
</div>
<div class="sect3">
<h4 id="_ファイル名">2.14.5. ファイル名</h4>
<div class="paragraph">
<p>ファイルの名称は，英小文字，数字，"_"，"."で構成する．英大文字と英小文
字を区別しないファイルシステムに対応するために，英大文字は使用しない．
また，"-"も使用しない．</p>
</div>
<div class="paragraph">
<p>ファイルの種類毎に，次のネーミングコンベンションを定める．</p>
</div>
<div class="paragraph">
<p>(A) ヘッダファイル</p>
</div>
<div class="paragraph">
<p>モジュールを用いるために必要な定義を含むヘッダファイルは，そのモジュー
ルのモジュール識別名の末尾に".h"を付加した名前（すなわち，www.h）とする．</p>
</div>
</div>
<div class="sect3">
<h4 id="_モジュール内部の名称の衝突回避">2.14.6. モジュール内部の名称の衝突回避</h4>
<div class="paragraph">
<p>モジュール内部の名称が，他のモジュール内部の名称と衝突することを避ける
ために，次のガイドラインを設ける．</p>
</div>
<div class="paragraph">
<p>モジュール内部に閉じて使われる関数や変数などの名称で，オブジェクトファ
イルのシンボル表に登録されて外部から参照できる名称は，C言語レベルで，先
頭が_www_または_WWW_である名称とする．例えば，カーネルの内部シンボルは，
C言語レベルで，先頭が"<em>kernel</em>"または"<em>KERNEL</em>"である名称とする．</p>
</div>
<div class="paragraph">
<p>また，モジュールを用いるために必要な定義を含むヘッダファイル中に用いる
名称で，それをインクルードする他のモジュールで使用する名称と衝突する可
能性のある名称は，"TOPPERS_"で始まる名称とする．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_toppers共通定義">2.15. TOPPERS共通定義</h3>
<div class="paragraph">
<p>TOPPERSソフトウェアに共通に用いる定義を，TOPPERS共通定義と呼ぶ．</p>
</div>
<div class="sect3">
<h4 id="_toppers共通ヘッダファイル">2.15.1. TOPPERS共通ヘッダファイル</h4>
<div class="paragraph">
<p>TOPPERS共通定義（共通データ型，共通定数，共通マクロ）は，TOPPERS共通ヘッ
ダファイル（t_stddef.h）およびそこからインクルードされるファイルに含ま
れている【NGKI0484】．TOPPERS共通定義を用いる場合には，TOPPERS共通ヘッ
ダファイルをインクルードする【NGKI0485】．</p>
</div>
<div class="paragraph">
<p>TOPPERS共通ヘッダファイルは，カーネルヘッダファイル（kernel.h）やシステ
ムインタフェースレイヤヘッダファイル（sil.h）からインクルードされるため，
これらのファイルをインクルードする場合には，TOPPERS共通ヘッダファイルを
直接インクルードする必要はない【NGKI0486】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_toppers共通データ型">2.15.2. TOPPERS共通データ型</h4>
<div class="paragraph">
<p>C90に規定されているデータ型以外で，TOPPERSソフトウェアで共通に用いるデー
タ型は次の通りである【NGKI0487】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>int8_t		符号付き8ビット整数（オプション，C99準拠）
uint8_t		符号無し8ビット整数（オプション，C99準拠）
int16_t		符号付き16ビット整数（C99準拠）
uint16_t	符号無し16ビット整数（C99準拠）
int32_t		符号付き32ビット整数（C99準拠）
uint32_t	符号無し32ビット整数（C99準拠）
int64_t		符号付き64ビット整数（オプション，C99準拠）
uint64_t	符号無し64ビット整数（オプション，C99準拠）
int128_t	符号付き128ビット整数（オプション，C99準拠）
uint128_t	符号無し128ビット整数（オプション，C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>int_least8_t	8ビット以上の符号付き整数（C99準拠）
uint_least8_t	int_least8_t型と同じサイズの符号無し整数（C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>float32_t	IEEE754準拠の32ビット単精度浮動小数点数（オプション）
double64_t	IEEE754準拠の64ビット倍精度浮動小数点数（オプション）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>bool_t		真偽値（trueまたはfalse）
int_t		16ビット以上の符号付き整数
uint_t		int_t型と同じサイズの符号無し整数
long_t		32ビット以上かつint_t型以上のサイズの符号付き整数
ulong_t		long_t型と同じサイズの符号無し整数</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>intptr_t	ポインタを格納できるサイズの符号付き整数（C99準拠）
uintptr_t	intptr_t型と同じサイズの符号無し整数（C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>FN			機能コード（符号付き整数，int_tに定義）
ER			正常終了（E_OK）またはエラーコード（符号付き整数，int_t
			に定義）
ID			オブジェクトのID番号（符号付き整数，int_tに定義）
ATR			オブジェクト属性（符号無し整数，uint_tに定義）
STAT		オブジェクトの状態（符号無し整数，uint_tに定義）
MODE		サービスコールの動作モード（符号無し整数，uint_tに定義）
PRI			優先度（符号付き整数，int_tに定義）
SIZE		メモリ領域のサイズ（符号無し整数，ポインタを格納できる
			サイズの符号無し整数型に定義）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TMO			タイムアウト指定（符号付き整数，単位はミリ秒，int_tに定義）
RELTIM		相対時間（符号無し整数，単位はミリ秒，uint_tに定義）
SYSTIM		システム時刻（符号無し整数，単位はミリ秒，ulong_tに定義）
SYSUTM		性能評価用システム時刻（符号無し整数，単位はマイクロ秒，
			ulong_tに定義）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>FP			プログラムの起動番地（型の定まらない関数ポインタ）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ER_BOOL		エラーコードまたは真偽値（符号付き整数，int_tに定義）
ER_ID		エラーコードまたはID番号（符号付き整数，int_tに定義，
			負のID番号は格納できない）
ER_UINT		エラーコードまたは符号無し整数（符号付き整数，int_tに
			定義，符号無し整数を格納する場合の有効ビット数はuint_t
			より1ビット短い）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>MB_T		オブジェクト管理領域を確保するためのデータ型</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ACPTN		アクセス許可パターン（符号無し32ビット整数，uint32_tに
			定義）
ACVCT		アクセス許可ベクタ</pre>
</div>
</div>
<div class="paragraph">
<p>ここで，データ型が「AまたはB」とは，AかBのいずれかの値を取ることを示す．
例えばER_BOOLは，エラーコードまたは真偽値のいずれかの値を取る．</p>
</div>
<div class="paragraph">
<p>int8_t，uint8_t，int64_t，uint64_t，int128_t，uint128_t，float32_t，
double64_tが使用できるかどうかは，ターゲット定義である【NGKI0488】．こ
れらが使用できるかどうかは，それぞれ，INT8_MAX，UINT8_MAX，INT64_MAX，
UINT64_MAX，INT128_MAX，UINT128_MAX，FLOAT32_MAX，DOUBLE64_MAXがマクロ
定義されているかどうかで判別することができる【NGKI0489】．IEEE754準拠の
浮動小数点数がサポートされていない場合には，ターゲット定義で，
float32_tとdouble64_tは使用できないものとする【NGKI0490】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>B，UB，H，UH，W，UW，D，UD，VP_INTに代えて，C99準拠のint8_t，uint8_t，
int16_t，uint16_t，int32_t，uint32_t，int64_t，uint64_t，intptr_tを用い
ることにした．また，uintptr_t，int128_t，uint128_tを用意することにした．</p>
</div>
<div class="paragraph">
<p>VPは，void *と等価であるため，用意しないことにした．また，ターゲットシ
ステムにより振舞いが一定しないことから，VB，VH，VW，VDに代わるデータ型
は用意しないことにした．</p>
</div>
<div class="paragraph">
<p>INT，UINTに代えて，C99の型名と相性が良いint_t，uint_tを用いることにした．
また，32ビット以上かつint_t型（またはuint_t型）以上のサイズが保証される
整数型として，long_t，ulong_tを用意し，8ビット以上のサイズで必ず存在す
る整数型として，C99準拠のint_least8_t，uint_least8_tを導入することにし
た．int_least16_t，uint_least16_t，int_least32_t，uint_least32_tを導入
しなかったのは，16ビットおよび32ビットの整数型があることを仮定しており，
それぞれint16_t，uint16_t，int32_t，uint32_tで代用できるためである．</p>
</div>
<div class="paragraph">
<p>TECSとの整合性を取るために，BOOLに代えて，bool_tを用いることにした．ま
た，IEEE754準拠の単精度浮動小数点数を表す型としてfloat32_t，IEEE754準拠
の64ビットを表す型としてdouble64_tを導入した．</p>
</div>
<div class="paragraph">
<p>性能評価用システム時刻のためのデータ型としてSYSUTMを，オブジェクト管理
領域を確保するためのデータ型としてMB_Tを用意することにした</p>
</div>
</div>
<div class="sect3">
<h4 id="_toppers共通定数">2.15.3. TOPPERS共通定数</h4>
<div class="paragraph">
<p>C90に規定されている定数以外で，TOPPERSソフトウェアで共通に用いる定数は
次の通りである（一部，C90に規定されているものも含む）．</p>
</div>
<div class="paragraph">
<p>(1) 一般定数【NGKI0491】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NULL					無効ポインタ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>true			1		真
false			0		偽</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>E_OK			0		正常終了</pre>
</div>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>BOOLをbool_tに代えたことから，TRUEおよびFALSEに代えて，trueおよびfalse
を用いることにした．</p>
</div>
<div class="paragraph">
<p>(2) 整数型に格納できる最大値と最小値【NGKI0492】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INT8_MAX			int8_tに格納できる最大値（オプション，C99準拠）
INT8_MIN			int8_tに格納できる最小値（オプション，C99準拠）
UINT8_MAX			uint8_tに格納できる最大値（オプション，C99準拠）
INT16_MAX			int16_tに格納できる最大値（C99準拠）
INT16_MIN			int16_tに格納できる最小値（C99準拠）
UINT16_MAX			uint16_tに格納できる最大値（C99準拠）
INT32_MAX			int32_tに格納できる最大値（C99準拠）
INT32_MIN			int32_tに格納できる最小値（C99準拠）
UINT32_MAX			uint32_tに格納できる最大値（C99準拠）
INT64_MAX			int64_tに格納できる最大値（オプション，C99準拠）
INT64_MIN			int64_tに格納できる最小値（オプション，C99準拠）
UINT64_MAX			uint64_tに格納できる最大値（オプション，C99準拠）
INT128_MAX			int128_tに格納できる最大値（オプション，C99準拠）
INT128_MIN			int128_tに格納できる最小値（オプション，C99準拠）
UINT128_MAX			uint128_tに格納できる最大値（オプション，C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>INT_LEAST8_MAX		int_least8_tに格納できる最大値（C99準拠）
INT_LEAST8_MIN		int_least8_tに格納できる最小値（C99準拠）
UINT_LEAST8_MAX		uint_least8_tに格納できる最大値（C99準拠）
INT_MAX				int_tに格納できる最大値（C90準拠）
INT_MIN				int_tに格納できる最小値（C90準拠）
UINT_MAX			uint_tに格納できる最大値（C90準拠）
LONG_MAX			long_tに格納できる最大値（C90準拠）
LONG_MIN			long_tに格納できる最小値（C90準拠）
ULONG_MAX			ulong_tに格納できる最大値（C90準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>FLOAT32_MIN			float32_tに格納できる最小の正規化された正の浮
					動小数点数（オプション）
FLOAT32_MAX			float32_tに格納できる表現可能な最大の有限浮動
					小数点数（オプション）
DOUBLE64_MIN		double64_tに格納できる最小の正規化された正の浮
					動小数点数（オプション）
DOUBLE64_MAX		double64_tに格納できる表現可能な最大の有限浮動
					小数点数（オプション）</pre>
</div>
</div>
<div class="paragraph">
<p>(3) 整数型のビット数【NGKI0493】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CHAR_BIT			char型のビット数（C90準拠）</pre>
</div>
</div>
<div class="paragraph">
<p>(4) オブジェクト属性【NGKI0494】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_NULL		0U		オブジェクト属性を指定しない</pre>
</div>
</div>
<div class="paragraph">
<p>(5) タイムアウト指定【NGKI0495】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMO_POL		0		ポーリング
TMO_FEVR	-1		永久待ち
TMO_NBLK	-2		ノンブロッキング</pre>
</div>
</div>
<div class="paragraph">
<p>(6) アクセス許可パターン【NGKI0496】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TACP_KERNEL		0U		カーネルドメインのみにアクセスを許可
TACP_SHARED		~0U		すべての保護ドメインにアクセスを許可</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="toppers_errorcode">2.15.4. TOPPERS共通エラーコード</h4>
<div class="paragraph">
<p>TOPPERSソフトウェアで共通に用いるメインエラーコードは次の通りである
【NGKI0497】．</p>
</div>
<div class="paragraph">
<p>(A) 内部エラークラス（EC_SYS，-5〜-8）</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_SYS		-5		システムエラー</pre>
</div>
</div>
<div class="paragraph">
<p>(B) 未サポートエラークラス（EC_NOSPT，-9〜-16）</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_NOSPT		-9		未サポート機能
E_RSFN		-10		予約機能コード
E_RSATR		-11		予約属性</pre>
</div>
</div>
<div class="paragraph">
<p>(C) パラメータエラークラス（EC_PAR，-17〜-24）</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_PAR		-17		パラメータエラー
E_ID		-18		不正ID番号</pre>
</div>
</div>
<div class="paragraph">
<p>(D) 呼出しコンテキストエラークラス（EC_CTX，-25〜-32）</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_CTX		-25		コンテキストエラー
E_MACV		-26		メモリアクセス違反
E_OACV		-27		オブジェクトアクセス違反
E_ILUSE		-28		サービスコール不正使用</pre>
</div>
</div>
<div class="paragraph">
<p>(E) 資源不足エラークラス（EC_NOMEM，-33〜-40）</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_NOMEM		-33		メモリ不足
E_NOID		-34		ID番号不足
E_NORES		-35		資源不足</pre>
</div>
</div>
<div class="paragraph">
<p>(F) オブジェクト状態エラークラス（EC_OBJ，-41〜-48）</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_OBJ		-41		オブジェクト状態エラー
E_NOEXS		-42		オブジェクト未登録
E_QOVR		-43		キューイングオーバフロー</pre>
</div>
</div>
<div class="paragraph">
<p>(G) 待ち解除エラークラス（EC_RLWAI，-49〜-56）</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_RLWAI		-49		待ち禁止状態または待ち状態の強制解除
E_TMOUT		-50		ポーリング失敗またはタイムアウト
E_DLT		-51		待ちオブジェクトの削除または再初期化
E_CLS		-52		待ちオブジェクトの状態変化</pre>
</div>
</div>
<div class="paragraph">
<p>(H) 警告クラス（EC_WARN，-57〜-64）</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_WBLK		-57		ノンブロッキング受付け
E_BOVR		-58		バッファオーバフロー</pre>
</div>
</div>
<div class="paragraph">
<p>このエラークラスに属するエラーコードは，警告を表すエラーコードであり，
［NGKI0019］の原則では例外としている．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>E_NORESは，μITRON4.0仕様に規定されていないエラーコードである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_toppers共通マクロ">2.15.5. TOPPERS共通マクロ</h4>
<div class="paragraph">
<p>(1) 整数定数を作るマクロ【NGKI0498】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INT8_C(val)			int_least8_t型の定数を作るマクロ（C99準拠）
UINT8_C(val)		uint_least8_t型の定数を作るマクロ（C99準拠）
INT16_C(val)		int16_t型の定数を作るマクロ（C99準拠）
UINT16_C(val)		uint16_t型の定数を作るマクロ（C99準拠）
INT32_C(val)		int32_t型の定数を作るマクロ（C99準拠）
UINT32_C(val)		uint32_t型の定数を作るマクロ（C99準拠）
INT64_C(val)		int64_t型の定数を作るマクロ（オプション，C99準拠）
UINT64_C(val)		uint64_t型の定数を作るマクロ（オプション，C99準拠）
INT128_C(val)		int128_t型の定数を作るマクロ（オプション，C99準拠）
UINT128_C(val)		uint128_t型の定数を作るマクロ（オプション，C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>UINT_C(val)			uint_t型の定数を作るマクロ
ULONG_C(val)		ulong_t型の定数を作るマクロ</pre>
</div>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>C99に用意されていないUINT_CとULONG_Cを導入したのは，アセンブリ言語から
も参照する定数を記述するためである．C言語のみで用いる定数をこれらのマク
ロを使って記述する必要はない．</p>
</div>
<div class="paragraph">
<p>(2) 型に関する情報を取り出すためのマクロ【NGKI0499】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>offsetof(structure, field)	構造体structure中のフィールドfieldの
							バイト位置を返すマクロ（C90準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>alignof(type)				型typeのアラインメント単位を返すマクロ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ALIGN_TYPE(addr, type)		番地addrが型typeに対してアラインしてい
							るかどうかを返すマクロ</pre>
</div>
</div>
<div class="paragraph">
<p>(3) assertマクロ【NGKI0500】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>assert(exp)			expが成立しているかを検査するマクロ（C90準拠）</pre>
</div>
</div>
<div class="paragraph">
<p>(4) コンパイラの拡張機能のためのマクロ【NGKI0501】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>inline				インライン関数
Inline				ファイルローカルなインライン関数
asm					インラインアセンブラ
Asm					インラインアセンブラ（最適化抑止）
throw()				例外を発生しない関数
NoReturn			リターンしない関数</pre>
</div>
</div>
<div class="paragraph">
<p>(5) エラーコード構成・分解マクロ【NGKI0502】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ERCD(mercd, sercd)	メインエラーコードmercdとサブエラーコードsercdか
					ら，エラーコードを構成するためのマクロ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>MERCD(ercd)			エラーコードercdからメインエラーコードを抽出する
					ためのマクロ
SERCD(ercd)			エラーコードercdからサブエラーコードを抽出するた
					めのマクロ</pre>
</div>
</div>
<div class="paragraph">
<p>(6) アクセス許可パターン構成マクロ【NGKI0503】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TACP(domid)			domidで指定されるユーザドメインのみにアクセスを
					許可するアクセス許可パターンを構成するためのマ
					クロ</pre>
</div>
</div>
<div class="paragraph">
<p>ここで，TACPのパラメータ（domid）には，ユーザドメインのID番号のみを指定
することができる【NGKI0504】．TDOM_SELF，TDOM_KERNEL，TDOM_NONEを指定し
た場合，どのようなアクセス許可パターンが構成されるかは保証されない
【NGKI0505】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_toppers共通構成マクロ">2.15.6. TOPPERS共通構成マクロ</h4>
<div class="paragraph">
<p>(1) 相対時間の範囲【NGKI0506】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_RELTIM		相対時間に指定できる最大値</pre>
</div>
</div>
<div class="paragraph">
<p>2.15 カーネル共通定義</p>
</div>
<div class="paragraph">
<p>カーネルの複数の機能で共通に用いる定義を，カーネル共通定義と呼ぶ．</p>
</div>
<div class="paragraph">
<p>2.15.1 カーネルヘッダファイル</p>
</div>
<div class="paragraph">
<p>カーネルを用いるために必要な定義は，カーネルヘッダファイル（kernel.h）
およびそこからインクルードされるファイルに含まれている【NGKI0507】．カー
ネルを用いる場合には，カーネルヘッダファイルをインクルードする
【NGKI0508】．</p>
</div>
<div class="paragraph">
<p>ただし，カーネルを用いるために必要な定義の中で，コンフィギュレータによっ
て生成されるものは，カーネル構成・初期化ヘッダファイル（kernel_cfg.h）
に含まれる【NGKI0509】．具体的には，登録できるオブジェクトの数
（TNUM_YYY）やオブジェクトのID番号などの定義が，これに該当する．これら
の定義を用いる場合には，カーネル構成・初期化ヘッダファイルをインクルー
ドする【NGKI0510】．</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様で規定されており，この仕様で廃止されたデータ型および定数
を用いる場合には，ITRON仕様互換ヘッダファイル（itron.h）をインクルード
する【NGKI0511】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>この仕様では，コンフィギュレータが生成するヘッダファイルに，オブジェク
トのID番号の定義に加えて，登録できるオブジェクトの数（TNUM_YYY）の定義
が含まれることとした．これに伴い，ヘッダファイルの名称を，μITRON4.0仕
様の自動割付け結果ヘッダファイル（kernel_id.h）から，カーネル構成・初期
化ヘッダファイル（kernel_cfg.h）に変更した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル共通定数">2.15.7. カーネル共通定数</h4>
<div class="paragraph">
<p>(1) オブジェクト属性【NGKI0512】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI			0x01U	タスクの待ち行列をタスクの優先度順に</pre>
</div>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>値が0のオブジェクト属性（TA_HLNG，TA_TFIFO，TA_MFIFO，TA_WSGL）は，デフォ
ルトの扱いにして廃止した．これは，「(tskatr &amp; TA_HLNG) != 0U」のような
間違いを防ぐためである．TA_ASMは，有効な使途がないために廃止した．
TA_MPRIは，メールボックス機能でのみ使用するため，カーネル共通定義から外
した．</p>
</div>
<div class="paragraph">
<p>(2) 保護ドメインID【NGKI0513】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TDOM_SELF		0		自タスクの属する保護ドメイン
TDOM_KERNEL		-1		カーネルドメイン
TDOM_NONE		-2		無所属（保護ドメインに属さない）</pre>
</div>
</div>
<div class="paragraph">
<p>(3) その他のカーネル共通定数【NGKI0514】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TCLS_SELF		0		自タスクの属するクラス</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TPRC_NONE		0		割付けプロセッサの指定がない
TPRC_INI		0		初期割付けプロセッサ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TSK_SELF		0		自タスク指定
TSK_NONE		0		該当するタスクがない</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TPRI_SELF		0		自タスクのベース優先度の指定
TPRI_INI		0		タスクの起動時優先度の指定</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TIPM_ENAALL		0		割込み優先度マスク全解除</pre>
</div>
</div>
<div class="paragraph">
<p>(4) カーネルで用いるメインエラーコード</p>
</div>
<div class="paragraph">
<p>「<a href="#toppers_errorcode">TOPPERS共通エラーコード</a>」の節で定義したメインエラーコードの中
で，E_CLS，E_WBLK，E_BOVRの3つは，カーネルでは使用しない【NGKI0515】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，サービスコールから，E_RSFN，E_RSATR，E_MACV，E_OACV，
E_NOMEM，E_NOID，E_NORES，E_NOEXSが返る状況は起こらない【ASPS0011】．
E_RSATRは，コンフィギュレータによって検出される【ASPS0012】．ただし，動
的生成機能拡張パッケージでは，サービスコールから，E_RSATR，E_NOMEM，
E_NOID，E_NOEXSが返る状況が起こる【ASPS0013】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，サービスコールから，E_RSFN，E_RSATR，E_MACV，E_OACV，
E_NOMEM，E_NOID，E_NORES，E_NOEXSが返る状況は起こらない【FMPS0007】．
E_RSATRとE_NORESは，コンフィギュレータによって検出される【FMPS0008】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，サービスコールから，E_RSATR，E_NOMEM，E_NOID，
E_NORES，E_NOEXSが返る状況は起こらない【HRPS0006】．E_RSATRは，コンフィ
ギュレータによって検出される【HRPS0007】．ただし，動的生成機能拡張パッ
ケージでは，サービスコールから，E_RSATR，E_NOMEM，E_NOID，E_NOEXSが返る
状況が起こる【HRPS0011】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，サービスコールから，E_RSFN，E_RSATR，E_MACV，E_OACV，
E_ILUSE，E_NOMEM，E_NOID，E_NORES，E_NOEXS，E_RLWAI，E_TMOUT，E_DLTが返
る状況は起こらない【SSPS0008】．E_RSATRは，コンフィギュレータによって検
出される【SSPS0009】．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル共通マクロ">2.15.8. カーネル共通マクロ</h4>
<div class="paragraph">
<p>(1) スタック領域をアプリケーションで確保するためのデータ型とマクロ</p>
</div>
<div class="paragraph">
<p>スタック領域をアプリケーションで確保するために，次のデータ型とマクロを
用意している【NGKI0516】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>STK_T				スタック領域を確保するためのデータ型</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>COUNT_STK_T(sz)		サイズszのスタック領域を確保するために必要な
					STK_T型の配列の要素数
ROUND_STK_T(sz)		要素数COUNT_STK_T(sz)のSTK_T型の配列のサイズ（sz
					を，STK_T型のサイズの倍数になるように大きい方に
					丸めた値）</pre>
</div>
</div>
<div class="paragraph">
<p>これらを用いてスタック領域を確保する方法は次の通り【NGKI0517】．</p>
</div>
<div class="paragraph">
<p>STK_T	&lt;スタック領域の変数名&gt;[COUNT_STK_T(&lt;スタック領域のサイズ&gt;)];</p>
</div>
<div class="paragraph">
<p>この方法で確保したスタック領域を，サービスコールまたは静的APIに渡す場合
には，スタック領域の先頭番地に&lt;スタック領域の変数名&gt;を，スタック領域の
サイズにROUND_STK_T(&lt;スタック領域のサイズ&gt;)を指定する【NGKI0518】．</p>
</div>
<div class="paragraph">
<p>ただし，保護機能対応カーネルにおいては，上の方法によりタスクのユーザス
タック領域を確保することはできない【NGKI0519】．詳しくは，「4.1 タスク
管理機能」の節のCRE_TSKの機能の項を参照すること．</p>
</div>
<div class="paragraph">
<p>(2) オブジェクト属性を作るマクロ</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，オブジェクトが属する保護ドメインを指定するた
めのオブジェクト属性を作るマクロとして，次のマクロを用意している
【NGKI0520】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_DOM(domid)		domidで指定される保護ドメインに属する</pre>
</div>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，オブジェクトが属するクラスを指定する
ためのオブジェクト属性を作るマクロとして，次のマクロを用意している
【NGKI0521】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_CLS(clsid)		clsidで指定されるクラスに属する</pre>
</div>
</div>
<div class="paragraph">
<p>(3) サービスコールの呼出し方法を指定するマクロ</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，サービスコールの呼出し方法を指定するためのマ
クロとして，次のマクロを用意している【NGKI0522】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SVC_CALL(svc)		svcで指定されるサービスコールを関数呼出しによっ
					て呼び出すための名称</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル共通構成マクロ">2.15.9. カーネル共通構成マクロ</h4>
<div class="paragraph">
<p>(1) サポートする機能【NGKI0523】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_PROTECT			保護機能対応のカーネル
TOPPERS_SUPPORT_MULTI_PRC		マルチプロセッサ対応のカーネル
TOPPERS_SUPPORT_DYNAMIC_CRE		動的生成対応のカーネル</pre>
</div>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>マクロ名は，今後変更する可能性がある．</p>
</div>
<div class="paragraph">
<p>(2) 優先度の範囲【NGKI0524】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_TPRI		タスク優先度の最小値（＝1）
TMAX_TPRI		タスク優先度の最大値</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている
【ASPS0014】．ただし，タスク優先度拡張パッケージを用いると，TMAX_TPRIを
256に拡張することができる【ASPS0015】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている
【FMPS0009】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている
【HRPS0008】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，タスク優先度の最大値（TMAX_TPRI）は16に固定されている
【SSPS0010】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>メッセージ優先度の最小値（TMIN_MPRI）と最大値（TMAX_MPRI）は，メールボッ
クス機能でのみ使用するため，カーネル共通定義から外した．</p>
</div>
<div class="paragraph">
<p>(3) プロセッサの数</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，プロセッサの数を知るためのマクロとし
て，次の構成マクロを用意している【NGKI0525】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_PRCID		プロセッサの数</pre>
</div>
</div>
<div class="paragraph">
<p>(4) 特殊な役割を持ったプロセッサ</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，特殊な役割を持ったプロセッサを知るた
めのマクロとして，次の構成マクロを用意している【NGKI0526】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_MASTER_PRCID		マスタプロセッサのID番号
TOPPERS_SYSTIM_PRCID		システム時刻管理プロセッサのID番号（グ
							ローバルタイマ方式の場合のみ）</pre>
</div>
</div>
<div class="paragraph">
<p>(5) タイマ方式</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，システム時刻の方式を知るためのマクロ
として，次の構成マクロを用意している【NGKI0527】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SYSTIM_LOCAL		ローカルタイマ方式の場合にマクロ定義
TOPPERS_SYSTIM_GLOBAL		グローバルタイマ方式の場合にマクロ定義</pre>
</div>
</div>
<div class="paragraph">
<p>(6) バージョン情報【NGKI0528】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TKERNEL_MAKER		カーネルのメーカコード（＝0x0118）
TKERNEL_PRID		カーネルの識別番号
TKERNEL_SPVER		カーネル仕様のバージョン番号
TKERNEL_PRVER		カーネルのバージョン番号</pre>
</div>
</div>
<div class="paragraph">
<p>カーネルのメーカコード（TKERNEL_MAKER）は，TOPPERSプロジェクトから配布
するカーネルでは，TOPPERSプロジェクトを表す値（0x0118）に設定されている．</p>
</div>
<div class="paragraph">
<p>カーネルの識別番号（TKERNEL_PRID）は，TOPPERSカーネルの種類を表す．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0x0001		TOPPERS/JSPカーネル
0x0002		予約（IIMPカーネル）
0x0003		予約（IDLカーネル）
0x0004		TOPPERS/FI4カーネル
0x0005		TOPPERS/FDMPカーネル
0x0006		TOPPERS/HRPカーネル
0x0007		TOPPERS/ASPカーネル
0x0008		TOPPERS/FMPカーネル
0x0009		TOPPERS/SSPカーネル
0x000a		TOPPERS/ASP Safetyカーネル</pre>
</div>
</div>
<div class="paragraph">
<p>カーネル仕様のバージョン番号（TKERNEL_SPVER）は，上位8ビット（0xf5）が
TOPPERS新世代カーネル仕様であることを，中位4ビットがメジャーバージョン
番号，下位4ビットがマイナーバージョン番号を表す．</p>
</div>
<div class="paragraph">
<p>カーネルのバージョン番号（TKERNEL_PRVER）は，上位4ビットがメジャーバー
ジョン番号，中位8ビットがマイナーバージョン番号，下位4ビットがパッチレ
ベルを表す．</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_システムインタフェースレイヤapi仕様">3. システムインタフェースレイヤAPI仕様</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_システムインタフェースレイヤの概要">3.1. システムインタフェースレイヤの概要</h3>
<div class="paragraph">
<p>システムインタフェースレイヤ（この章では，SILと略記する）は，デバイスを
直接操作するプログラムが用いるための機能である．ITRONデバイスドライバ設
計ガイドラインの一部分として検討されたものをベースに，TOPPERSプロジェク
トにおいて修正を加えて用いている．</p>
</div>
<div class="paragraph">
<p>SILの機能は，プロセッサの特権モードで実行されているプログラムが使用する
ことを想定している【NGKI0801】．非特権モードで実行されているプログラム
からSILの機能を呼び出した場合の動作は，次の例外を除いては保証されない
【NGKI0802】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>微少時間待ちの機能を呼び出すこと</p>
</li>
<li>
<p>エンディアンの取得のためのマクロを参照すること</p>
</li>
<li>
<p>メモリ空間アクセス関数により，アクセスを許可されたメモリ領域にアクセスすること</p>
</li>
<li>
<p>I/O空間アクセス関数により，アクセスを許可されたI/O領域にアクセスすること</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_silヘッダファイル">3.2. SILヘッダファイル</h3>
<div class="paragraph">
<p>SILを用いるために必要な定義は，SILヘッダファイル（sil.h）およびそこから
インクルードされるファイルに含まれている【NGKI0803】．SILを用いる場合に
は，SILヘッダファイルをインクルードする【NGKI0804】．</p>
</div>
</div>
<div class="sect2">
<h3 id="_全割込みロック状態の制御">3.3. 全割込みロック状態の制御</h3>
<div class="paragraph">
<p>デバイスを扱うプログラムの中では，すべての割込み（NMIを除く，以下同じ）
をマスクしたい場合がある．カーネルで制御できるCPUロック状態は，カーネル
管理外の割込み（NMI以外にカーネル管理外の割込みがあるかはターゲット定義）
をマスクしないため，このような場合に用いることはできない．</p>
</div>
<div class="paragraph">
<p>そこで，SILでは，すべての割込みをマスクする全割込みロック状態を制御する
ための以下の機能を用意している．</p>
</div>
<div class="paragraph">
<p>(1) SIL_PRE_LOC</p>
</div>
<div class="paragraph">
<p>全割込みロック状態の制御に必要な変数を宣言するマクロ【NGKI0805】．通常
は，型と変数名を並べたもので，最後に";"を含まない．</p>
</div>
<div class="paragraph">
<p>このマクロは，SIL_LOC_INT，SIL_UNL_INTを用いる関数またはブロックの先頭
の変数宣言部に記述しなければならない【NGKI0806】．SIL_LOC_INT，
SIL_UNL_INTを1つの関数内でネストして用いることは可能であるが，その場合
には，ネストレベル毎にブロックを作り，そのブロックの先頭の変数宣言部に
SIL_PRE_LOCを記述しなければならない【NGKI0807】．そのように記述しなかっ
た場合の動作は保証されない【NGKI0808】．</p>
</div>
<div class="paragraph">
<p>(2) SIL_LOC_INT()</p>
</div>
<div class="paragraph">
<p>全割込みロックフラグをセットすることで，NMIを除くすべての割込みをマスク
し，全割込みロック状態に遷移する【NGKI0809】．</p>
</div>
<div class="paragraph">
<p>(3) SIL_UNL_INT()</p>
</div>
<div class="paragraph">
<p>全割込みロックフラグを，対応するSIL_LOC_INTを実行する前の状態に戻す
【NGKI0810】．SIL_LOC_INTを実行せずにSIL_UNL_INTを呼び出した場合の動作
は保証されない【NGKI0811】．</p>
</div>
<div class="paragraph">
<p>なお，全割込みロック状態で呼び出せるサービスコールなどの制限事項につい
ては，「2.5.4 全割込みロック状態と全割込みロック解除状態」の節を参照す
ること．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>全割込みロック状態の制御機能の使用例は次の通り．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	{
		SIL_PRE_LOC;

		SIL_LOC_INT();
		// この間はNMIを除くすべての割込みがマスクされる．
		// この間にサービスコールを呼び出してはならない（一部例外あり）．
		SIL_UNL_INT();
	}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_silスピンロック">3.4. SILスピンロック</h3>
<div class="paragraph">
<p>マルチプロセッサシステムにおいて，カーネルの機能を用いずに，他のプロセッ
サとの間でも排他制御を実現したい場合がある．そこでSILでは，割込みのマス
クとプロセッサ間ロックの取得により排他制御を行うためのスピンロックの機
能を用意している．これを，カーネルのスピンロック機能と区別するために，
SILスピンロックと呼ぶ．</p>
</div>
<div class="paragraph">
<p>プロセッサ間ロックを取得している間は，全割込みロック状態にすることです
べての割込み（NMIを除く）がマスクされる【NGKI0812】．ロックが他のプロセッ
サに取得されている場合には，ロックが取得できるまでループによって待つ
【NGKI0813】．ロックの取得を待つ間は，割込みはマスクされない（ロックの
取得を試みる前にマスクしていた割込みは，マスク解除されない）
【NGKI0814】．プロセッサ間ロックを取得し割込みをマスクすることを，SILス
ピンロックを取得するという．また，プロセッサ間ロックを返却し割込みをマ
スク解除することを，SILスピンロックを返却するという．</p>
</div>
<div class="paragraph">
<p>SILで取得・返却するプロセッサ間ロックは，システムに唯一存在する
【NGKI0815】．</p>
</div>
<div class="paragraph">
<p>(1) SIL_PRE_LOC</p>
</div>
<div class="paragraph">
<p>全割込みロック状態の制御に必要な変数を宣言するマクロであるが，SILスピン
ロックの取得・解放にも兼用する【NGKI0816】．</p>
</div>
<div class="paragraph">
<p>このマクロは，SIL_LOC_SPN，SIL_UNL_SPNを用いる関数またはブロックの先頭
の変数宣言部に記述しなければならない【NGKI0817】．SIL_LOC_SPN，
SIL_UNL_SPNを，同じ関数内のSIL_LOC_INT，SIL_UNL_INTとネストして用いるこ
とは可能であるが，その場合には，ネストレベル毎にブロックを作り，そのブ
ロックの先頭の変数宣言部にSIL_PRE_LOCを記述しなければならない
【NGKI0818】．そのように記述しなかった場合の動作は保証されない
【NGKI0819】．</p>
</div>
<div class="paragraph">
<p>(2) SIL_LOC_SPN()</p>
</div>
<div class="paragraph">
<p>SILスピンロックが取得されていない状態である場合には，プロセッサ間ロック
の取得を試みる【NGKI0820】．ロックが他のプロセッサに取得されている状態
である場合や，他のプロセッサがロックの取得に成功した場合には，ロックが
返却されるまでループによって待ち，返却されたらロックの取得を試みる
【NGKI0821】．ロックの取得に成功した場合には，全割込みロックフラグをセッ
トし，全割込みロック状態に遷移する【NGKI0822】．</p>
</div>
<div class="paragraph">
<p>(3) SIL_UNL_SPN()</p>
</div>
<div class="paragraph">
<p>プロセッサ間ロックを返却し，全割込みロックフラグを対応するSIL_LOC_SPNを
実行する前の状態に戻す【NGKI0823】．</p>
</div>
<div class="paragraph">
<p>SILスピンロックを取得している状態でSIL_LOC_SPNを呼び出した場合の動作は
保証されない【NGKI0824】．逆に，SILスピンロックを取得していない状態で
SIL_UNL_SPNを呼び出した場合の動作も保証されない【NGKI0825】．</p>
</div>
<div class="paragraph">
<p>なお，SILスピンロック取得中は全割込みロック状態となっているため，SILス
ピンロック取得中に呼び出せるサービスコールなどについては，「2.5.4 全割
込みロック状態と全割込みロック解除状態」の節の制限事項が適用される．</p>
</div>
<div class="paragraph">
<p>なお，マルチプロセッサシステム以外では，SIL_LOC_SPNとSIL_UNL_SPNは用意
されていない【NGKI0826】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>全割込ロック状態やCPUロック状態でSIL_LOC_SPNを呼び出すことはできるが，
割込みがマスクされている時間が長くなるために，そのような使い方は避ける
べきである．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>SILスピンロック機能の使用例は次の通り．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	{
		SIL_PRE_LOC;

		SIL_LOC_SPN();
		// この間はSILスピンロックを取得している．
		// この間はNMIを除くすべての割込みがマスクされる．
		// この間にサービスコールを呼び出してはならない（一部例外あり）．
		SIL_UNL_SPN();
	}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_微少時間待ち">3.5. 微少時間待ち</h3>
<div class="paragraph">
<p>デバイスをアクセスする際に，微少な時間待ちを入れなければならない場合が
ある．そのような場合に，NOP命令をいくつか入れるなどの方法で対応すると，
ポータビリティを損なうことになる．そこで，SILでは，微少な時間待ちを行う
ための以下の機能を用意している．</p>
</div>
<div class="paragraph">
<p>(1) void sil_dly_nse(ulong_t dlytim)</p>
</div>
<div class="paragraph">
<p>dlytimで指定された以上の時間（単位はナノ秒），ループなどによって待つ
【NGKI0827】．指定した値によっては，指定した時間よりもかなり長く待つ場
合があるので注意すること．</p>
</div>
</div>
<div class="sect2">
<h3 id="_エンディアンの取得">3.6. エンディアンの取得</h3>
<div class="paragraph">
<p>プロセッサのバイトエンディアンを取得するためのマクロとして，SILでは，以
下のマクロを定義している．</p>
</div>
<div class="paragraph">
<p>(1) SIL_ENDIAN_BIG，SIL_ENDIAN_LITTLE</p>
</div>
<div class="paragraph">
<p>ビッグエンディアンプロセッサではSIL_ENDIAN_BIGを，リトルエンディアンプ
ロセッサではSIL_ENDIAL_LITTLEを，マクロ定義している【NGKI0828】．</p>
</div>
</div>
<div class="sect2">
<h3 id="_メモリ空間アクセス関数">3.7. メモリ空間アクセス関数</h3>
<div class="paragraph">
<p>メモリ空間にマッピングされたデバイスレジスタや，デバイスとの共有メモリ
をアクセスするために，SILでは，以下の関数を用意している．</p>
</div>
<div class="paragraph">
<p>(1) uint8_t sil_reb_mem(const uint8_t *mem)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスから8ビット単位で読み出した値を返す【NGKI0829】．</p>
</div>
<div class="paragraph">
<p>(2) void sil_wrb_mem(uint8_t *mem, uint8_t data)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスにdataで指定される値を8ビット単位で書き込む
【NGKI0830】．</p>
</div>
<div class="paragraph">
<p>(3) uint16_t sil_reh_mem(const uint16_t *mem)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスから16ビット単位で読み出した値を返す【NGKI0831】．</p>
</div>
<div class="paragraph">
<p>(4) void sil_wrh_mem(uint16_t *mem, uint16_t data)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスにdataで指定される値を16ビット単位で書き込む
【NGKI0832】．</p>
</div>
<div class="paragraph">
<p>(5) uint16_t sil_reh_lem(const uint16_t *mem)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスから16ビット単位でリトルエンディアンで読み出した
値を返す【NGKI0833】．リトルエンディアンプロセッサでは，sil_reh_memと一
致する．ビッグエンディアンプロセッサでは，sil_reh_memが返す値を，エンディ
アン変換した値を返す．</p>
</div>
<div class="paragraph">
<p>(6) void sil_wrh_lem(uint16_t *mem, uint16_t data)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスにdataで指定される値を16ビット単位でリトルエンディ
アンで書き込む【NGKI0834】．リトルエンディアンプロセッサでは，
sil_wrh_memと一致する．ビッグエンディアンプロセッサでは，dataをエンディ
アン変換した値を，sil_wrh_memで書き込むのと同じ結果となる．</p>
</div>
<div class="paragraph">
<p>(7) uint16_t sil_reh_bem(const uint16_t *mem)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスから16ビット単位でビッグエンディアンで読み出した
値を返す【NGKI0835】．ビッグエンディアンプロセッサでは，sil_reh_memと一
致する．リトルエンディアンプロセッサでは，sil_reh_memが返す値を，エンディ
アン変換した値を返す．</p>
</div>
<div class="paragraph">
<p>(8) void sil_wrh_bem(uint16_t *mem, uint16_t data)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスにdataで指定される値を16ビット単位でビッグエンディ
アンで書き込む【NGKI0836】．ビッグエンディアンプロセッサでは，
sil_wrh_memと一致する．リトルエンディアンプロセッサでは，dataをエンディ
アン変換した値を，sil_wrh_memで書き込むのと同じ結果となる．</p>
</div>
<div class="paragraph">
<p>(9) uint32_t sil_rew_mem(const uint32_t *mem)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスから32ビット単位で読み出した値を返す【NGKI0837】．</p>
</div>
<div class="paragraph">
<p>(10) void sil_wrw_mem(uint32_t *mem, uint32_t data)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスにdataで指定される値を32ビット単位で書き込む
【NGKI0838】．</p>
</div>
<div class="paragraph">
<p>(11) uint32_t sil_rew_lem(const uint32_t *mem)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスから32ビット単位でリトルエンディアンで読み出した
値を返す【NGKI0839】．リトルエンディアンプロセッサでは，sil_rew_memと一
致する．ビッグエンディアンプロセッサでは，sil_rew_memが返す値を，エンディ
アン変換した値を返す．</p>
</div>
<div class="paragraph">
<p>(12) void sil_wrw_lem(uint32_t *mem, uint32_t data)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスにdataで指定される値を32ビット単位でリトルエンディ
アンで書き込む【NGKI0840】．リトルエンディアンプロセッサでは，
sil_wrw_memと一致する．ビッグエンディアンプロセッサでは，dataをエンディ
アン変換した値を，sil_wrw_memで書き込むのと同じ結果となる．</p>
</div>
<div class="paragraph">
<p>(13) uint32_t sil_rew_bem(const uint32_t *mem)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスから32ビット単位でビッグエンディアンで読み出した
値を返す【NGKI0841】．ビッグエンディアンプロセッサでは，sil_rew_memと一
致する．リトルエンディアンプロセッサでは，sil_rew_memが返す値を，エンディ
アン変換した値を返す．</p>
</div>
<div class="paragraph">
<p>(14) void sil_wrw_bem(uint32_t *mem, uint32_t data)</p>
</div>
<div class="paragraph">
<p>memで指定されるアドレスにdataで指定される値を32ビット単位でビッグエンディ
アンで書き込む【NGKI0842】．ビッグエンディアンプロセッサでは，
sil_wrw_memと一致する．リトルエンディアンプロセッサでは，dataをエンディ
アン変換した値を，sil_wrw_memで書き込むのと同じ結果となる．</p>
</div>
</div>
<div class="sect2">
<h3 id="_i_o空間アクセス関数">3.8. I/O空間アクセス関数</h3>
<div class="paragraph">
<p>メモリ空間とは別にI/O空間を持つプロセッサでは，I/O空間にあるデバイスレ
ジスタをアクセスするために，メモリ空間アクセス関数と同等の以下の関数を
用意している【NGKI0843】．</p>
</div>
<div class="paragraph">
<p>(1) uint8_t sil_reb_iop(const uint8_t *iop)<br>
(2) void sil_wrb_iop(uint8_t *iop, uint8_t data)<br>
(3) uint16_t sil_reh_iop(const uint16_t *iop)<br>
(4) void sil_wrh_iop(uint16_t *iop, uint16_t data)<br>
(5) uint16_t sil_reh_lep(const uint16_t *iop)<br>
(6) void sil_wrh_lep(uint16_t *iop, uint16_t data)<br>
(7) uint16_t sil_reh_bep(const uint16_t *iop)<br>
(8) void sil_wrh_bep(uint16_t *iop, uint16_t data)<br>
(9) uint32_t sil_rew_iop(const uint32_t *iop)<br>
(10) void sil_wrw_iop(uint32_t *iop, uint32_t data)<br>
(11) uint32_t sil_rew_lep(const uint32_t *iop)<br>
(12) void sil_wrw_lep(uint32_t *iop, uint32_t data)<br>
(13) uint32_t sil_rew_bep(const uint32_t *iop)<br>
(14) void sil_wrw_bep(uint32_t *iop, uint32_t data)</p>
</div>
</div>
<div class="sect2">
<h3 id="_プロセッサidの参照">3.9. プロセッサIDの参照</h3>
<div class="paragraph">
<p>マルチプロセッサシステムにおいては，プログラムがどのプロセッサで実行さ
れているかを参照するために，以下の関数を用意している．</p>
</div>
<div class="paragraph">
<p>(1) void sil_get_pid(ID *p_prcid)</p>
</div>
<div class="paragraph">
<p>この関数を呼び出したプログラムを実行しているプロセッサのID番号を参照し，
p_prcidで指定したメモリ領域に返す【NGKI0844】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>タスクは，sil_get_pidを用いて，自タスクを実行しているプロセッサを正しく
参照できるとは限らない．これは，sil_get_pidを呼び出し，自タスクを実行し
ているプロセッサのID番号を参照した直後に割込みが発生した場合，
sil_get_pidから戻ってきた時には自タスクを実行しているプロセッサが変化し
ている可能性があるためである．</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch4_kernel_api">4. カーネルAPI仕様</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この章では，カーネルのAPI仕様について規定する．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TOPPERS共通データ型に従い，パラメータのデータ型を次の通り変更した．これ
らの変更については，個別のAPI仕様では記述しない．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INT → int_t
UINT → uint_t
VP → void *
VP_INT → intptr_t</pre>
</div>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>ID番号で識別するオブジェクトのアクセス許可ベクタをデフォルト以外に設定
する場合には，オブジェクトを生成した後に設定することとし，アクセス許可
ベクタを設定する静的API（SAC_YYY）を新設した．逆に，アクセス許可ベクタ
を指定してオブジェクトを生成する機能（CRA_YYY，cra_yyy，acra_yyy）は廃
止した．これらの変更については，個別のAPI仕様では記述しない．</p>
</div>
<div class="sect2">
<h3 id="_タスク管理機能">4.1. タスク管理機能</h3>
<div class="paragraph">
<p>タスクは，プログラムの並行実行の単位で，カーネルが実行を制御する処理単
位である．タスクは，タスクIDと呼ぶID番号によって識別する【NGKI1001】．</p>
</div>
<div class="paragraph">
<p>タスク管理機能に関連して，各タスクが持つ情報は次の通り【NGKI1002】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>タスク属性</p>
</li>
<li>
<p>タスク状態</p>
</li>
<li>
<p>ベース優先度</p>
</li>
<li>
<p>現在優先度</p>
</li>
<li>
<p>起動要求キューイング数</p>
</li>
<li>
<p>割付けプロセッサ（マルチプロセッサ対応カーネルの場合）</p>
</li>
<li>
<p>次回起動時の割付けプロセッサ（マルチプロセッサ対応カーネルの場合）</p>
</li>
<li>
<p>拡張情報</p>
</li>
<li>
<p>メインルーチンの先頭番地</p>
</li>
<li>
<p>起動時優先度</p>
</li>
<li>
<p>実行時優先度（TOPPERS/SSPカーネルの場合）</p>
</li>
<li>
<p>スタック領域</p>
</li>
<li>
<p>システムスタック領域（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>タスクのベース優先度は，タスクの現在優先度を決定するために使われる優先
度であり，タスクの起動時に起動時優先度に初期化される【NGKI1003】．</p>
</div>
<div class="paragraph">
<p>タスクの現在優先度は，タスクの実行順位を決定するために使われる優先度で
ある．単にタスクの優先度と言った場合には，現在優先度のことを指す．タス
クがミューテックスをロックしていない間は，タスクの現在優先度はベース優
先度に一致する【NGKI1004】．ミューテックスをロックしている間のタスクの
現在優先度については，「4.4.6 ミューテックス」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>タスクの起動要求キューイング数は，処理されていないタスクの起動要求の数
であり，タスクの生成時に0に初期化される【NGKI1005】．</p>
</div>
<div class="paragraph">
<p>割付けプロセッサは，マルチプロセッサ対応カーネルにおいて，タスクを実行
するプロセッサで，タスクの生成時に，タスクが属するクラスによって定まる
初期割付けプロセッサに初期化される【NGKI1006】．</p>
</div>
<div class="paragraph">
<p>次回起動時の割付けプロセッサは，マルチプロセッサ対応カーネルにおいて，
タスクが次に起動される時に割り付けられるプロセッサで，タスクの生成時に
未設定の状態に初期化される【NGKI1007】．タスクの起動時に，次回起動時の
割付けプロセッサが設定されていれば，タスクの割付けプロセッサがそのプロ
セッサに変更され，次回起動時の割付けプロセッサは未設定の状態に戻される
【NGKI1008】．次回起動時の割付けプロセッサが未設定の場合には，タスクの
割付けプロセッサは変更されない（つまり，タスクが前に実行されていたのと
同じプロセッサで実行される）【NGKI1009】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいては，スタック領域の扱いは，ユーザタスクとシ
ステムタスクで異なる．ユーザタスクのスタック領域は，ユーザタスクが非特
権モードで実行する間に用いるスタック領域であり，ユーザスタック領域と呼
ぶ【NGKI1010】．その扱いについては，「2.11.6 ユーザタスクのユーザスタッ
ク領域」の節を参照すること．システムタスクのスタック領域は，カーネルの
用いるオブジェクト管理領域と同様に扱われる【NGKI1011】．</p>
</div>
<div class="paragraph">
<p>システムスタック領域は，保護機能対応カーネルにおいて，ユーザタスクがサー
ビスコール（拡張サービスコールを含む）を呼び出し，特権モードで実行する
間に用いるスタック領域である【NGKI1012】．システムスタック領域は，カー
ネルの用いるオブジェクト管理領域と同様に扱われる【NGKI1013】．</p>
</div>
<div class="paragraph">
<p>タスク属性には，次の属性を指定することができる【NGKI1014】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_ACT		0x02U	タスクの生成時にタスクを起動する
TA_RSTR		0x04U	生成するタスクを制約タスクとする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_ACTを指定しない場合，タスクの生成直後には，タスクは休止状態となる
【NGKI1015】．また，ターゲットによっては，ターゲット定義のタスク属性を
指定できる場合がある【NGKI1016】．ターゲット定義のタスク属性として，次
の属性を予約している【NGKI1017】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_FPU				FPUレジスタをコンテキストに含める</pre>
</div>
</div>
<div class="paragraph">
<p>タスク終了時には，次の処理が行われる．まず，終了するタスク（対象タスク）
に対してタスク終了時に行うべきその他の処理が行われた後，対象タスクは休
止状態になる【NGKI1178】．対象タスクの起動要求キューイング数が0でない場
合には，対象タスクに対してタスク起動時に行うべき処理が行われ，対象タス
クは実行できる状態になる【NGKI1179】．またこの時，起動要求キューイング
数から1が減ぜられる【NGKI1180】．</p>
</div>
<div class="paragraph">
<p>C言語によるタスクの記述形式は次の通り【NGKI1018】．</p>
</div>
<div class="listingblock c">
<div class="content">
<pre class="highlight"><code>	void task(intptr_t exinf)
	{
		タスク本体
		ext_tsk();
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，タスクの拡張情報が渡される【NGKI1019】．ext_tskを呼び出さず，
タスクのメインルーチンからリターンした場合，ext_tskを呼び出した場合と同
じ動作をする【NGKI1020】．</p>
</div>
<div class="paragraph">
<p>タスク管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_ACTCNT		タスクの起動要求キューイング数の最大値【NGKI1021】</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_TSKID		登録できるタスクの数（動的生成対応でないカーネルで
				は，静的APIによって登録されたタスクの数に一致）
				【NGKI1022】</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，TMAX_ACTCNTは1に固定されている【ASPS0101】．また，制約
タスクはサポートしていない【ASPS0102】．ただし，制約タスク拡張パッケー
ジを用いると，制約タスクの機能を追加することができる【ASPS0103】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，TMAX_ACTCNTは1に固定されている【FMPS0101】．また，制約
タスクはサポートしていない【FMPS0102】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，TMAX_ACTCNTは1に固定されている【HRPS0101】．また，制
約タスクはサポートしていない【HRPS0102】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，TMAX_ACTCNTは1に固定されている【SSPS0101】．</p>
</div>
<div class="paragraph">
<p>SSPカーネルは，制約タスクのみをサポートすることから，すべてのタスクでス
タック領域を共有しており，タスク毎にスタック領域の情報を持たない
【SSPS0102】．</p>
</div>
<div class="paragraph">
<p>SSPカーネルにおける追加機能として，タスクに対して，実行時優先度の情報を
持つ【SSPS0103】．SSPカーネルにおいては，タスクが起動された後，最初に実
行状態になる時に，タスクのベース優先度が，タスクの実行時優先度に設定さ
れる【SSPS0104】．実行時優先度の機能は，起動時優先度よりも高い優先度で
タスクを実行することで，同時期に共有スタック領域を使用している状態にな
るタスクの組み合わせを限定し，スタック領域を節約するための機能である．</p>
</div>
<div class="paragraph">
<p>タスクの実行時優先度は，実行時優先度を定義する静的API（DEF_EPR）によっ
て設定する【SSPS0105】．実行時優先度を定義しない場合，タスクの実行時優
先度は，起動時優先度と同じ値に設定される【SSPS0106】．</p>
</div>
<div class="paragraph">
<p>〔実行時優先度によるスタック領域の節約〕</p>
</div>
<div class="paragraph">
<p>いずれのタスクにも実行時優先度が設定されていない場合には，すべてのタス
クが同時期に共有スタック領域を使用している状態になる可能性があるため，
すべてのタスクのスタック領域のサイズの和に，非タスクコンテキスト用のス
タック領域のサイズを加えたものが，共有スタック領域に必要なサイズとなる．</p>
</div>
<div class="paragraph">
<p>タスクAに対して実行時優先度が設定されており，タスクAの起動時優先度より
も高く，タスクAの実行時優先度と同じかそれよりも低い起動時優先度を持つタ
スクBがある場合，タスクAとタスクBは同時期に共有スタック領域を使用してい
る状態にならない．そのため，タスクAとタスクBの内，サイズが小さい方のス
タック領域のサイズは，共有スタック領域のサイズに加える必要がなくなり，
スタック領域を節約できることになる．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>この仕様では，自タスクの拡張情報の参照するサービスコール（get_inf）をサ
ポートし，起動コードを指定してタスクを起動するサービスコール（sta_tsk），
タスクを終了と同時に削除するサービスコール（exd_tsk），タスクの状態を参
照するサービスコールの簡易版（ref_tst）はサポートしないこととした．</p>
</div>
<div class="paragraph">
<p>TNUM_TSKIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_TSK" class="paragraph">
<p>CRE_TSK		タスクの生成〔S〕【NGKI1023】<br>
acre_tsk	タスクの生成〔TD〕【NGKI1024】</p>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="paragraph">
<p>保護機能対応でないカーネルの場合</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">CRE_TSK(ID tskid, { ATR tskatr, intptr_t exinf, TASK task,
		PRI itskpri, SIZE stksz, STK_T *stk })</code></pre>
</div>
</div>
<div class="paragraph">
<p>保護機能対応カーネルの場合</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	CRE_TSK(ID tskid, { ATR tskatr, intptr_t exinf, TASK task,
			PRI itskpri, SIZE stksz, STK_T *stk, SIZE sstksz, STK_T *sstk })</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>※ sstkszおよびsstkの記述は省略することができる【NGKI1025】．</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID tskid = acre_tsk(const T_CTSK *pk_ctsk)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		生成するタスクのID番号（CRE_TSKの場合）
	T_CTSK *	pk_ctsk		タスクの生成情報を入れたパケットへのポイン
							タ（静的APIを除く）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>　＊タスクの生成情報（パケットの内容）
	ATR			tskatr		タスク属性
	intptr_t	exinf		タスクの拡張情報
	TASK		task		タスクのメインルーチンの先頭番地
	PRI			itskpri		タスクの起動時優先度
	SIZE		stksz		タスクのスタック領域のサイズ（バイト数）
	STK_T *		stk			タスクのスタック領域の先頭番地
	SIZE		sstksz		タスクのシステムスタック領域のサイズ（バイ
							ト数，保護機能対応カーネルの場合，静的API
							においては省略可）
	STK_T *		sstk		タスクのシステムスタック領域の先頭番地（保
							護機能対応カーネルの場合，静的APIにおいて
							は省略可）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		tskid		生成されたタスクのID番号（正の値）またはエ
							ラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1026】
				・CPUロック状態からの呼出し〔s〕【NGKI1027】
	E_RSATR		予約属性
				・tskatrが無効【NGKI1028】
				・属する保護ドメインの指定が有効範囲外または無所属〔sP〕
				　【NGKI1029】
				・保護ドメインの囲みの中に記述されていない〔SP〕【NGKI1030】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI1031】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI1032】
	E_PAR		パラメータエラー
				・taskがプログラムの先頭番地として正しくない【NGKI1033】
				・itskpriが有効範囲外【NGKI1034】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI1035】
	E_MACV		メモリアクセス違反
				・pk_ctskが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI1036】
	E_NOID		ID番号不足
				・割り付けられるタスクIDがない〔sD〕【NGKI1037】
	E_NOMEM		メモリ不足
				・スタック領域が確保できない【NGKI1038】
				・システムスタック領域が確保できない〔P〕【NGKI1039】
	E_OBJ		オブジェクト状態エラー
				・tskidで指定したタスクが登録済み（CRE_TSKの場合）【NGKI1040】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したタスク生成情報に従って，タスクを生成する．具体的
な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>まず，stkとstkszからタスクが用いるスタック領域が設定される【NGKI1041】．
ただし，保護機能対応カーネルで，生成するタスクがシステムタスクの場合に
は，スタック領域の設定にsstkszも用いられる．stkszに0以下の値を指定した
時や，設定されるスタック領域のサイズがターゲット定義の最小値よりも小さ
くなる時には，E_PARエラーとなる【NGKI1042】．</p>
</div>
<div class="paragraph">
<p>また，保護機能対応カーネルで，生成するタスクがユーザタスクの場合には，
sstkとsstkszからシステムスタック領域が設定される【NGKI1043】．この場合，
sstkszに0以下の値を指定した時や，ターゲット定義の最小値よりも小さい値を
指定した時には，E_PARエラーとなる【NGKI1044】．</p>
</div>
<div class="paragraph">
<p>次に，生成されたタスクに対してタスク生成時に行うべき初期化処理が行われ，
生成されたタスクは休止状態になる【NGKI1045】．さらに，tskatrにTA_ACTを
指定した場合には，タスク起動時に行うべき初期化処理が行われ，生成された
タスクは実行できる状態になる【NGKI1046】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，tskidはオブジェクト識別名，tskatr，itskpri，stkszは
整数定数式パラメータ，exinf，task，stkは一般定数式パラメータである
【NGKI1047】．コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラー
を検出することができない【NGKI1048】．</p>
</div>
<div class="paragraph">
<p>〔stkにNULLを指定した場合〕</p>
</div>
<div class="paragraph">
<p>stkをNULLとした場合，stkszで指定したサイズのスタック領域が，コンフィギュ
レータまたはカーネルにより確保される【NGKI1049】．stkszにターゲット定義
の制約に合致しないサイズを指定した時には，ターゲット定義の制約に合致す
るように大きい方に丸めたサイズで確保される【NGKI1050】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，生成するタスクがユーザタスクの場合，コン
フィギュレータまたはカーネルにより確保されるスタック領域（ユーザスタッ
ク領域）は，「2.11.6 ユーザタスクのユーザスタック領域」の節の規定に従っ
て，メモリオブジェクトとしてカーネルに登録される【NGKI1051】．</p>
</div>
<div class="paragraph">
<p>静的APIにより制約タスクを生成する場合（tskatrにTA_RSTRを指定して生成す
る場合），スタック領域は，制約タスクの起動時優先度毎に確保され，同じ起
動時優先度を持つ制約タスクで共有される【NGKI1052】．確保されるスタック
領域のサイズは，それを共有する制約タスクのスタック領域のサイズ（stksz）
の最大値となる【NGKI1053】．マルチプロセッサ対応カーネルでは，以上のス
タック領域の確保処理を，制約タスクの初期割付けプロセッサ毎に行う
【NGKI1054】．</p>
</div>
<div class="paragraph">
<p>〔stkにNULL以外を指定した場合〕</p>
</div>
<div class="paragraph">
<p>stkにNULL以外を指定した場合，stkとstkszで指定したスタック領域は，アプリ
ケーションで確保しておく必要がある【NGKI1055】．スタック領域をアプリケー
ションで確保する方法については，「2.15.3 カーネル共通マクロ」の節を参照
すること．その方法に従わず，stkやstkszにターゲット定義の制約に合致しな
い先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI1056】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，生成するタスクがシステムタスクの場合に，
stkとstkszで指定したスタック領域がカーネル専用のメモリオブジェクトに含
まれない場合，E_OBJエラーとなる【NGKI1057】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，生成するタスクがユーザタスクの場合，stkと
stkszで指定したスタック領域（ユーザスタック領域）は，「2.11.6 ユーザタ
スクのユーザスタック領域」の節の規定に従って，メモリオブジェクトとして
カーネルに登録される【NGKI1058】．そのため，上の方法を用いてスタック領
域を確保しても，ターゲット定義の制約に合致する先頭番地とサイズとなると
は限らず，スタック領域をアプリケーションで確保する方法は，ターゲット定
義である【NGKI1059】．また，stkとstkszで指定したスタック領域が，登録済
みのメモリオブジェクトとメモリ領域が重なる場合には，E_OBJエラーとなる
【NGKI1060】．</p>
</div>
<div class="paragraph">
<p>〔sstkとsstkszの扱い〕</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおけるsstkとsstkszの扱いは，生成するタスクがユー
ザタスクの場合とシステムタスクの場合で異なる．</p>
</div>
<div class="paragraph">
<p>生成するタスクがユーザタスクの場合の扱いは次の通り．</p>
</div>
<div class="paragraph">
<p>sstkの記述を省略するか，sstkをNULLとした場合，sstkszで指定したサイズの
システムスタック領域が，コンフィギュレータまたはカーネルにより確保され
る【NGKI1061】．sstkszにターゲット定義の制約に合致しないサイズを指定し
た時には，ターゲット定義の制約に合致するように大きい方に丸めたサイズで
確保される【NGKI1062】．sstkszの記述も省略した場合には，ターゲット定義
のデフォルトのサイズで確保される【NGKI1063】．</p>
</div>
<div class="paragraph">
<p>sstkにNULL以外を指定した場合，sstkとsstkszで指定したスタック領域は，ア
プリケーションで確保しておく必要がある【NGKI1064】．スタック領域をアプ
リケーションで確保する方法については，「2.15.3 カーネル共通マクロ」の節
を参照すること．その方法に従わず，sstkやsstkszにターゲット定義の制約に
合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる
【NGKI1065】．また，stkとstkszで指定したシステムスタック領域がカーネル
専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる【NGKI1066】．</p>
</div>
<div class="paragraph">
<p>生成するタスクがシステムタスクの場合の扱いは次の通り．</p>
</div>
<div class="paragraph">
<p>sstkに指定することができるのは，NULLのみである．sstkにNULL以外を指定し
た場合には，E_PARエラーとなる【NGKI1068】．</p>
</div>
<div class="paragraph">
<p>sstkszに0以外の値を指定した場合で，stkがNULLの場合には，コンフィギュレー
タまたはカーネルにより確保されるスタック領域のサイズに，sstkszが加えら
れる【NGKI1069】．stkszにsstkszを加えた値が，ターゲット定義の制約に合致
しないサイズになる時には，ターゲット定義の制約に合致するように大きい方
に丸めたサイズで確保される【NGKI1070】．</p>
</div>
<div class="paragraph">
<p>sstkszに0以外の値を指定した場合で，stkがNULLでない場合には，E_PARエラー
となる【NGKI1071】．</p>
</div>
<div class="paragraph">
<p>sstkszに0を指定した場合，これらの処理は行わず，E_PARエラーにもならない
【NGKI1072】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_TSKのみをサポートする【ASPS0104】．ただし，動的生
成機能拡張パッケージでは，acre_tskもサポートする【ASPS0105】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_TSKのみをサポートする【FMPS0103】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_TSKのみをサポートする【HRPS0103】．</p>
</div>
<div class="paragraph">
<p>動的生成機能拡張パッケージでは，acre_tskもサポートする【HRPS0175】．た
だし，生成するタスクがユーザタスクの場合，stkにNULLが指定されるとカーネ
ルがスタック領域を確保する機能はサポートしない．stkにNULLを指定した場合
には，E_NOSPTエラーとなる【HRPS0176】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，CRE_TSKのみをサポートする【SSPS0107】．</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，複数のタスクに対して，同じ起動時優先度を設定することは
できない．設定した場合には，コンフィギュレータがE_PARエラーを報告する
【SSPS0109】．</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，制約タスクのみをサポートするため，タスク属性にTA_RSTR
を指定しない場合でも，生成されるタスクは制約タスクとなる【SSPS0110】．</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，stkにはNULLを指定しなくてはならず，その場合でも，コン
フィギュレータはタスクのスタック領域を確保しない【SSPS0111】．これは，
SSPカーネルでは，すべての処理単位が共有スタック領域を使用し，タスク毎に
スタック領域を持たないためである．stkにNULL以外を指定した場合には，
E_PARエラーとなる【SSPS0112】．</p>
</div>
<div class="paragraph">
<p>共有スタック領域の設定方法については，DEF_STKの項を参照すること．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>taskのデータ型をTASKに，stkのデータ型をSTK_T *に変更した．COUNT_STK_Tと
ROUND_STK_Tを新設し，スタック領域をアプリケーションで確保する方法を規定
した．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>sstkのデータ型をSTK_T *に変更した．システムスタック領域をアプリケーショ
ンで確保する方法を規定した．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>サービスコール（acre_tsk）により，stkにNULLを指定して制約タスクを生成し
た場合のスタック領域の確保方法については，今後の課題である．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，sstkszおよびsstkの記述は省略することがで
きることとしたのは，保護機能対応でないカーネル用のシステムコンフィギュ
レーションファイルを，保護機能対応カーネルにも変更なしに使えるようにす
るためである．</p>
</div>
<div id="API_AID_TSK" class="listingblock">
<div class="content">
<pre>AID_TSK		割付け可能なタスクIDの数の指定〔SD〕【NGKI1073】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_TSK(uint_t notsk)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		notsk		割付け可能なタスクIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3428】
				・クラスの囲みの中に記述されていない〔M〕【NGKI1075】
	E_PAR		パラメータエラー
				・notskが負の値【NGKI3276】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>notskで指定した数のタスクIDを，タスクを生成するサービスコールによって割
付け可能なタスクIDとして確保する【NGKI1076】．</p>
</div>
<div class="paragraph">
<p>notskは整数定数式パラメータである【NGKI1077】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_TSKをサポートする
【ASPS0210】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_TSKをサポートする
【HRPS0211】．</p>
</div>
<div id="API_SAC_TSK" class="listingblock">
<div class="content">
<pre>SAC_TSK		タスクのアクセス許可ベクタの設定〔SP〕【NGKI1078】
sac_tsk		タスクのアクセス許可ベクタの設定〔TPD〕【NGKI1079】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_TSK(ID tskid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_tsk(ID tskid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1080】
				・CPUロック状態からの呼出し〔s〕【NGKI1081】
	E_ID		不正ID番号
				・tskidが有効範囲外〔s〕【NGKI1082】
	E_RSATR		予約属性
				・対象タスクが属する保護ドメインの囲みの中に記述されて
				　いない〔S〕【NGKI1083】
				・対象タスクが属するクラスの囲みの中に記述されていない
				　〔SM〕【NGKI1084】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録【NGKI1085】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する管理操作が許可されていない〔s〕【NGKI1086】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI1087】
	E_OBJ		オブジェクト状態エラー
				・対象タスクは静的APIで生成された〔s〕【NGKI1088】
				・対象タスクに対してアクセス許可ベクタが設定済み〔S〕
				　【NGKI1089】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）のアクセス許可ベクタ（4つのアクセス
許可パターンの組）を，各パラメータで指定した値に設定する【NGKI1090】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，tskidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI1091】．</p>
</div>
<div class="paragraph">
<p>sac_tskにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI1092】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_TSKのみをサポートする【HRPS0104】．ただし，動的生
成機能拡張パッケージでは，sac_tskもサポートする【HRPS0177】．</p>
</div>
<div id="DEF_EPR" class="listingblock">
<div class="content">
<pre>DEF_EPR		タスクの実行時優先度の定義〔S〕【NGKI1093】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_EPR(ID tskid, { PRI exepri })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	PRI			exepri		タスクの実行時優先度</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_PAR		パラメータエラー
				・exepriが有効範囲外【NGKI1094】
	E_ILUSE		サービスコール不正使用
				・条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・対象タスクに対して実行優先度が設定済み【NGKI1095】</pre>
</div>
</div>
<div class="paragraph">
<p>【サポートするカーネル】</p>
</div>
<div class="paragraph">
<p>DEF_EPRは，TOPPERS/SSPカーネルのみがサポートする静的APIである．他のカー
ネルは，DEF_EPRをサポートしない【NGKI1096】．</p>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）の実行時優先度を，exepriで指定した優
先度に設定する【NGKI1097】．</p>
</div>
<div class="paragraph">
<p>tskidはオブジェクト識別名，exepriは整数定数式パラメータである【NGKI1098】．</p>
</div>
<div class="paragraph">
<p>exepriが，対象タスクの起動時優先度よりも低い場合には，E_ILUSEエラーとな
る【NGKI1099】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div id="API_del_tsk" class="listingblock">
<div class="content">
<pre>del_tsk		タスクの削除〔TD〕【NGKI1100】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_tsk(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1101】
				・CPUロック状態からの呼出し【NGKI1102】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1103】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録【NGKI1104】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する管理操作が許可されていない〔P〕【NGKI1105】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態でない【NGKI1106】
				・対象タスクは静的APIで生成された【NGKI1107】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）を削除する．具体的な振舞いは以下の通
り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態である場合には，対象タスクの登録が解除され，そのタ
スクIDが未使用の状態に戻される【NGKI1108】．また，タスクの生成時にタス
クのスタック領域およびシステムスタック領域がカーネルによって確保された
場合は，それらのメモリ領域が解放される【NGKI1109】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_tskをサポートしない【ASPS0107】．ただし，動的生成
機能拡張パッケージでは，del_tskをサポートする【ASPS0108】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_tskをサポートしない【FMPS0105】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_tskをサポートしない【HRPS0105】．ただし，動的生成
機能拡張パッケージでは，del_tskをサポートする【HRPS0178】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，del_tskをサポートしない【SSPS0114】．</p>
</div>
<div id="API_act_tsk" class="listingblock">
<div class="content">
<pre>act_tsk		タスクの起動〔T〕【NGKI1110】
iact_tsk	タスクの起動〔I〕【NGKI1111】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = act_tsk(ID tskid)
	ER ercd = iact_tsk(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（act_tskの場合）【NGKI1112】
				・タスクコンテキストからの呼出し（iact_tskの場合）【NGKI1113】
				・CPUロック状態からの呼出し【NGKI1114】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1115】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1116】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作1が許可されていない（act_tsk
				　の場合）〔P〕【NGKI1117】
	E_QOVR		キューイングオーバフロー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）に対して起動要求を行う．具体的な振舞
いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態である場合には，対象タスクに対してタスク起動時に行
うべき初期化処理が行われ，対象タスクは実行できる状態になる【NGKI1118】．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，対象タスクの起動要求キューイング数
に1が加えられる【NGKI1119】．起動要求キューイング数に1を加えると
TMAX_ACTCNTを超える場合には，E_QOVRエラーとなる【NGKI1120】．</p>
</div>
<div class="paragraph">
<p>act_tskにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI1121】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，act_tsk／iact_tskは，対象タスクの次回
起動時の割付けプロセッサを変更しない．</p>
</div>
<div id="API_act_tsk" class="listingblock">
<div class="content">
<pre>mact_tsk	割付けプロセッサ指定でのタスクの起動〔TM〕【NGKI1122】
imact_tsk	割付けプロセッサ指定でのタスクの起動〔IM〕【NGKI1123】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = mact_tsk(ID tskid, ID prcid)
	ER ercd = imact_tsk(ID tskid, ID prcid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	ID			prcid		タスクの割付け対象のプロセッサのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（mact_tskの場合）
				　【NGKI1124】
				・タスクコンテキストからの呼出し（imact_tskの場合）
				　【NGKI1125】
				・CPUロック状態からの呼出し【NGKI1126】
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1127】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1128】
				・prcidが有効範囲外【NGKI1129】
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1130】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作1が許可されていない（mact_tsk
				　の場合）〔P〕【NGKI1131】
	E_QOVR		キューイングオーバフロー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>prcidで指定したプロセッサを割付けプロセッサとして，tskidで指定したタス
ク（対象タスク）に対して起動要求を行う．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態である場合には，対象タスクの割付けプロセッサが
prcidで指定したプロセッサに変更された後，対象タスクに対してタスク起動時
に行うべき初期化処理が行われ，対象タスクは実行できる状態になる
【NGKI1132】．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，対象タスクの起動要求キューイング数
に1が加えられ，次回起動時の割付けプロセッサがprcidで指定したプロセッサ
に変更される【NGKI1133】．起動要求キューイング数に1を加えると
TMAX_ACTCNTを超える場合には，E_QOVRエラーとなる【NGKI1134】．</p>
</div>
<div class="paragraph">
<p>mact_tskにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タス
クとなる【NGKI1135】．</p>
</div>
<div class="paragraph">
<p>対象タスクの属するクラスの割付け可能プロセッサが，prcidで指定したプロセッ
サを含んでいない場合には，E_PARエラーとなる【NGKI1136】．</p>
</div>
<div class="paragraph">
<p>prcidにTPRC_INI（＝0）を指定すると，対象タスクの割付けプロセッサを，そ
れが属するクラスの初期割付けプロセッサとする【NGKI1137】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>TMAX_ACTCNTが2以上の場合でも，対象タスクが次に起動される時の割付けプロ
セッサは，キューイングされない．すなわち，プロセッサAに割り付けられた休
止状態でないタスクを対象として，プロセッサBを割付けプロセッサとして
mact_tskを呼び出し，さらにプロセッサCを割付けプロセッサとしてmact_tskを
呼び出すと，対象タスクの次回起動時の割付けプロセッサがプロセッサCに変更
され，対象タスクがプロセッサBで実行されることはない．なお，TMAX_ACTCNT
が1の場合には，プロセッサCを割付けプロセッサとした2回目のmact_tskが
E_QOVRエラーとなるため，次回起動時の割付けプロセッサはプロセッサBのまま
変更されない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，mact_tsk，imact_tskをサポートしない【ASPS0109】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，mact_tsk，imact_tskをサポートしない【HRPS0106】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，mact_tsk，imact_tskをサポートしない【SSPS0115】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_can_act" class="listingblock">
<div class="content">
<pre>can_act		タスク起動要求のキャンセル〔T〕【NGKI1138】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_UINT	actcnt = can_act(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_UINT		actcnt		キューイングされていた起動要求の数（正の値
							または0）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1139】
				・CPUロック状態からの呼出し【NGKI1140】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1141】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1142】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作1が許可されていない〔P〕
				　【NGKI1143】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）に対する処理されていない起動要求をす
べてキャンセルし，キャンセルした起動要求の数を返す．具体的な振舞いは以
下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクの起動要求キューイング数が0に設定され，0に設定する前の起動要
求キューイング数が，サービスコールの返値として返される【NGKI1144】．ま
た，マルチプロセッサ対応カーネルにおいては，対象タスクの次回起動時の割
付けプロセッサが未設定状態に戻される【NGKI1145】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI1146】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，can_actをサポートしない【SSPS0116】．</p>
</div>
<div id="API_mig_tsk" class="listingblock">
<div class="content">
<pre>mig_tsk		タスクの割付けプロセッサの変更〔TM〕【NGKI1147】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = mig_tsk(ID tskid, ID prcid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	ID			prcid		タスクの割付けプロセッサのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1148】
				・CPUロック状態からの呼出し【NGKI1149】
				・その他の条件については機能の項を参照
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1150】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1151】
				・prcidが有効範囲外【NGKI1152】
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1153】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作1が許可されていない〔P〕
				　【NGKI1154】
	E_OBJ		オブジェクト状態エラー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスクの割付けプロセッサを，prcidで指定したプロセッサに
変更する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが，自タスクが割り付けられたプロセッサに割り付けられている場
合には，対象タスクをprcidで指定したプロセッサに割り付ける【NGKI1155】．
対象タスクが実行できる状態の場合には，prcidで指定したプロセッサに割り付
けられた同じ優先度のタスクの中で，最も優先順位が低い状態となる
【NGKI1156】．</p>
</div>
<div class="paragraph">
<p>対象タスクが，自タスクが割付けられたプロセッサと異なるプロセッサに割り
付けられている場合には，E_OBJエラーとなる【NGKI1157】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI1158】．</p>
</div>
<div class="paragraph">
<p>ディスパッチ保留状態で，対象タスクを自タスクとしてmig_tskを呼び出すと，
E_CTXエラーとなる【NGKI1159】．</p>
</div>
<div class="paragraph">
<p>対象タスクの属するクラスの割付け可能プロセッサが，prcidで指定したプロセッ
サを含んでいない場合には，E_PARエラーとなる【NGKI1160】．</p>
</div>
<div class="paragraph">
<p>prcidにTPRC_INI（＝0）を指定すると，対象タスクの割付けプロセッサを，そ
れが属するクラスの初期割付けプロセッサに変更する【NGKI1161】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>この仕様では，タスクをマイグレーションさせることができるのは，そのタス
クと同じプロセッサに割り付けられたタスクのみである．そのため，CPUロック
状態やディスパッチ禁止状態を用いて，他のタスクへのディスパッチが起こら
ないようにすることで，自タスクが他のプロセッサへマイグレーションされる
のを防ぐことができる．</p>
</div>
<div class="paragraph">
<p>対象タスクが，最初からprcidで指定したプロセッサに割り付けられている場合
には，割付けプロセッサの変更は起こらないが，優先順位が同一優先度のタス
クの中で最低となる．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，mig_tskをサポートしない【ASPS0110】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，mig_tskをサポートしない【HRPS0107】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，mig_tskをサポートしない【SSPS0117】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ext_tsk" class="listingblock">
<div class="content">
<pre>ext_tsk		自タスクの終了〔T〕【NGKI1162】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ext_tsk()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		エラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_SYS		システムエラー
				・カーネルの誤動作【NGKI1163】
	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1164】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>自タスクを終了させる．具体的には，自タスクに対してタスク終了時に行うべ
き処理が行われる【NGKI3449】．</p>
</div>
<div class="paragraph">
<p>ext_tskは，CPUロック解除状態，割込み優先度マスク全解除状態，ディスパッ
チ許可状態で呼び出すのが原則であるが，そうでない状態で呼び出された場合
には，CPUロック解除状態，割込み優先度マスク全解除状態，ディスパッチ許可
状態に遷移させた後，自タスクを終了させる【NGKI1168】．</p>
</div>
<div class="paragraph">
<p>ext_tskが正常に処理された場合，ext_tskからはリターンしない【NGKI1169】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ext_tskをサポートしない【SSPS0118】．自タスクを終了さ
せる場合には，タスクのメインルーチンからリターンする【SSPS0119】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>ext_tskを非タスクコンテキストから呼び出した場合に，E_CTXエラーが返るこ
ととした．μITRON4.0仕様においては，ext_tskからはリターンしないと規定さ
れている．</p>
</div>
<div id="API_ter_tsk" class="listingblock">
<div class="content">
<pre>ter_tsk		タスクの強制終了〔T〕【NGKI1170】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ter_tsk(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1171】
				・CPUロック状態からの呼出し【NGKI1172】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1173】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1174】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない〔P〕
				　【NGKI1175】
	E_ILUSE		サービスコール不正使用
				・対象タスクが自タスク【NGKI1176】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1177】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）を終了させる．具体的には，対象タスク
が休止状態でない場合には，対象タスクに対してタスク終了時に行うべき処理
が行われる【NGKI3450】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクは，自タスクと同じプロセッ
サに割り付けられているタスクに限られる．対象タスクが自タスクと異なるプ
ロセッサに割り付けられている場合には，E_OBJエラーとなる【NGKI1182】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける使用上の注意】</p>
</div>
<div class="paragraph">
<p>現時点のFMPカーネルの実装では，デッドロック回避のためのリトライ処理によ
り，サービスコールの処理時間に上限がないため，注意が必要である（ロック
方式にも依存する）．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ter_tskをサポートしない【SSPS0120】．</p>
</div>
<div id="API_chg_pri" class="listingblock">
<div class="content">
<pre>chg_pri		タスクのベース優先度の変更〔T〕【NGKI1183】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = chg_pri(ID tskid, PRI tskpri)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	PRI			tskpri		ベース優先度</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1184】
				・CPUロック状態からの呼出し【NGKI1185】
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1186】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1187】
	E_PAR		パラメータエラー
				・tskpriが有効範囲外【NGKI1188】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1189】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない〔P〕
				　【NGKI1190】
	E_ILUSE		サービスコール不正使用
				・条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1191】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）のベース優先度を，tskpriで指定した優
先度に変更する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，対象タスクのベース優先度が，tskpri
で指定した優先度に変更される【NGKI1192】．それに伴って，対象タスクの現
在優先度も変更される【NGKI1193】．</p>
</div>
<div class="paragraph">
<p>対象タスクが，優先度上限ミューテックスをロックしていない場合には，次の
処理が行われる．対象タスクが実行できる状態の場合には，同じ優先度のタス
クの中で最低優先順位となる【NGKI1194】．対象タスクが待ち状態で，タスク
の優先度順の待ち行列につながれている場合には，対象タスクの変更後の現在
優先度に従って，その待ち行列中での順序が変更される【NGKI1195】．待ち行
列中に同じ現在優先度のタスクがある場合には，対象タスクの順序はそれらの
中で最後になる【NGKI1196】．</p>
</div>
<div class="paragraph">
<p>対象タスクが，優先度上限ミューテックスをロックしている場合には，対象タ
スクの現在優先度が変更されることはなく，優先順位も変更されない
【NGKI1197】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI1198】．また，tskpriにTPRI_INI（＝0）を指定すると，対象タスクのベー
ス優先度が，起動時優先度に変更される【NGKI1199】．</p>
</div>
<div class="paragraph">
<p>対象タスクが優先度上限ミューテックスをロックしているかロックを待ってい
る場合，tskpriは，それらのミューテックスの上限優先度と同じかそれより低
くなければならない．そうでない場合には，E_ILUSEエラーとなる【NGKI1201】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルで，chg_priを呼び出した処理単位がユーザドメインに属
する場合，tskpriは，そのユーザドメインが指定できる最高のタスク優先度と
同じかそれより低くなければならない．そうでない場合には，E_ILUSEエラーと
なる【NGKI3440】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，chg_priをサポートしない【SSPS0121】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>対象タスクが，同じ優先度のタスクの中で最低の優先順位となる（対象タスク
が待ち状態で，タスクの優先度順の待ち行列につながれている場合には，同じ
優先度のタスクの中での順序が最後になる）条件を変更した．</p>
</div>
<div id="API_get_pri" class="listingblock">
<div class="content">
<pre>get_pri		タスク優先度の参照〔T〕【NGKI1202】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_pri(ID tskid, PRI *p_tskpri)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	PRI *		p_tskpri	現在優先度を入れるメモリ領域へのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	PRI			tskpri		現在優先度</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1203】
				・CPUロック状態からの呼出し【NGKI1204】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1205】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1206】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する参照操作が許可されていない〔P〕【NGKI1207】
	E_MACV		メモリアクセス違反
				・p_tskpriが指すメモリ領域への書込みアクセスが許可され
				　ていない〔P〕【NGKI1208】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1209】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）の現在優先度を参照する．具体的な振舞
いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，対象タスクの現在優先度が，p_tskpri
が指すメモリ領域に返される【NGKI1210】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI1211】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，get_priをサポートしない【SSPS0122】．</p>
</div>
<div id="API_get_inf" class="listingblock">
<div class="content">
<pre>get_inf		自タスクの拡張情報の参照〔T〕【NGKI1212】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_inf(intptr_t *p_exinf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	intptr_t *	p_exinf		拡張情報を入れるメモリ領域へのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	intptr_t	exinf		拡張情報</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1213】
				・CPUロック状態からの呼出し【NGKI1214】
	E_MACV		メモリアクセス違反
				・p_exinfが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1215】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>自タスクの拡張情報を参照する．参照した拡張情報は，p_exinfが指すメモリ領
域に返される【NGKI1216】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，get_infをサポートしない【SSPS0123】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_tsk" class="listingblock">
<div class="content">
<pre>ref_tsk		タスクの状態参照〔T〕【NGKI1217】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_tsk(ID tskid, T_RTSK *pk_rtsk)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	T_RTSK *	pk_rtsk		タスクの現在状態を入れるパケットへのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊タスクの現在状態（パケットの内容）
	STAT		tskstat		タスク状態
	PRI			tskpri		タスクの現在優先度
	PRI			tskbpri		タスクのベース優先度
	STAT		tskwait		タスクの待ち要因
	ID			wobjid		タスクの待ち対象のオブジェクトのID
	TMO			lefttmo		タスクがタイムアウトするまでの時間
	uint_t		actcnt		タスクの起動要求キューイング数
	uint_t		wupcnt		タスクの起床要求キューイング数
	bool_t		texmsk		タスクがタスク例外処理マスク状態か否か（保
							護機能対応カーネルの場合）
	bool_t		waifbd		タスクが待ち禁止状態か否か（保護機能対応カー
							ネルの場合）
	uint_t		svclevel	タスクの拡張サービスコールのネストレベル（保
							護機能対応カーネルの場合）
	ID			prcid		タスクの割付けプロセッサのID（マルチプロセッ
							サ対応カーネルの場合）
	ID			actprc		タスクの次回起動時の割付けプロセッサのID（マ
							ルチプロセッサ対応カーネルの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1218】
				・CPUロック状態からの呼出し【NGKI1219】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1220】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1221】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する参照操作が許可されていない〔P〕【NGKI1222】
	E_MACV		メモリアクセス違反
				・pk_rtskが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1223】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）の現在状態を参照する．参照した現在状
態は，pk_rtskで指定したメモリ領域に返される【NGKI1224】．</p>
</div>
<div class="paragraph">
<p>tskstatには，対象タスクの現在のタスク状態を表す次のいずれかの値が返され
る【NGKI1225】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TTS_RUN		0x01U		実行状態
TTS_RDY		0x02U		実行可能状態
TTS_WAI		0x04U		待ち状態
TTS_SUS		0x08U		強制待ち状態
TTS_WAS		0x0cU		二重待ち状態
TTS_DMT		0x10U		休止状態</pre>
</div>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクが自タスクの場合にも，
tskstatがTTS_SUSとなる場合がある【NGKI1226】．この状況は，自タスクに対
してref_tskを発行するのと同じタイミングで，他のプロセッサで実行されてい
るタスクから同じタスクに対してsus_tskが発行された場合に発生する可能性が
ある．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，tskpriには対象タスクの現在優先度が，
tskbpriには対象タスクのベース優先度が返される【NGKI1227】．対象タスクが
休止状態である場合には，tskpriとtskbpriの値は保証されない【NGKI1228】．</p>
</div>
<div class="paragraph">
<p>対象タスクが待ち状態である場合には，tskwaitには，対象タスクが何を待って
いる状態であるかを表す次のいずれかの値が返される【NGKI1229】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TTW_SLP		0x0001U		起床待ち
TTW_DLY		0x0002U		時間経過待ち
TTW_SEM		0x0004U		セマフォの資源獲得待ち
TTW_FLG		0x0008U		イベントフラグ待ち
TTW_SDTQ	0x0010U		データキューへの送信待ち
TTW_RDTQ	0x0020U		データキューからの受信待ち
TTW_SPDQ	0x0100U		優先度データキューへの送信待ち
TTW_RPDQ	0x0200U		優先度データキューからの受信待ち
TTW_MBX		0x0040U		メールボックスからの受信待ち
TTW_MTX		0x0080U		ミューテックスのロック待ち状態
TTW_SMBF	0x0400U		メッセージバッファへの送信待ち
TTW_RMBF	0x0800U		メッセージバッファからの受信待ち
TTW_MPF		0x2000U		固定長メモリブロックの獲得待ち</pre>
</div>
</div>
<div class="paragraph">
<p>対象タスクが待ち状態でない場合には，tskwaitの値は保証されない
【NGKI1230】．</p>
</div>
<div class="paragraph">
<p>対象タスクが起床待ち状態および時間経過待ち状態以外の待ち状態である場合
には，wobjidに，対象タスクが待っているオブジェクトのID番号が返される
【NGKI1231】．対象タスクが待ち状態でない場合や，起床待ち状態または時間
経過待ち状態である場合には，wobjidの値は保証されない【NGKI1232】．</p>
</div>
<div class="paragraph">
<p>対象タスクが時間経過待ち状態以外の待ち状態である場合には，lefttmoに，タ
スクがタイムアウトを起こすまでの相対時間が返される【NGKI1233】．タスク
がタイムアウトを起こさない場合には，TMO_FEVR（＝-1）が返される
【NGKI1234】．</p>
</div>
<div class="paragraph">
<p>対象タスクが時間経過待ち状態である場合には，lefttmoに，タスクの遅延時間
が経過して待ち解除されるまでの相対時間が返される【NGKI1235】．ただし，
返されるべき相対時間がTMO型に格納することができない場合がありうる．この
場合には，相対時間（RELTIM型，uint_t型に定義される）をTMO型（int_t型に
定義される）に型キャストした値が返される【NGKI1236】．</p>
</div>
<div class="paragraph">
<p>対象タスクが待ち状態でない場合には，lefttmoの値は保証されない
【NGKI1237】．</p>
</div>
<div class="paragraph">
<p>actcntには，対象タスクの起動要求キューイング数が返される【NGKI1238】．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，wupcntに，タスクの起床要求キューイ
ング数が返される【NGKI1239】．対象タスクが休止状態である場合には，
wupcntの値は保証されない【NGKI1240】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルで，対象タスクが休止状態でない場合には，texmskに，
対象タスクがタスク例外処理マスク状態の場合にtrue，そうでない場合に
falseが返される【NGKI1241】．waifbdには，対象タスクが待ち禁止状態の場合
にtrue，そうでない場合にfalseが返される【NGKI1242】．またsvclevelには，
対象タスクが拡張サービスコールを呼び出していない場合には0，呼び出してい
る場合には，実行中の拡張サービスコールがネスト段数が返される
【NGKI1243】．対象タスクが休止状態である場合には，texmsk，waifbd，
svclevelの値は保証されない【NGKI1244】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，prcidに，対象タスクの割付けプロセッサ
のID番号が返される【NGKI1245】．またactprcには，対象タスクの次回起動時
の割付けプロセッサのID番号が返される【NGKI1246】．次回起動時の割付けプ
ロセッサが未設定の場合には，actprcにTPRC_NONE（＝0）が返される
【NGKI1247】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI1248】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>対象タスクが時間経過待ち状態である場合に，lefttmo（TMO型）に返される値
をRELTIM型に型キャストすることで，タスクが待ち解除されるまでの相対時間
を正しく得ることができる．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，tskwaitにTTW_MTX，TTW_SMBF，TTW_RMBFが返ることはない
【ASPS0111】．ただし，ミューテックス機能拡張パッケージを用いると，
tskwaitにTTW_MTXが返る場合がある【ASPS0112】．また，メッセージバッファ
機能拡張パッケージを用いると，tskwaitにTTW_SMBFとTTW_RMBFが返る場合があ
る【ASPS0208】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，tskwaitにTTW_MTX，TTW_SMBF，TTW_RMBFが返ることはない
【FMPS0106】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，tskwaitにTTW_MBX，TTW_SMBF，TTW_RMBFが返ることはない
【HRPS0108】．ただし，メッセージバッファ機能拡張パッケージを用いると，
tskwaitにTTW_SMBFとTTW_RMBFが返る場合がある【HRPS0174】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ref_tskをサポートしない【SSPS0124】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_tskはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_tskを呼び出し，対象タスクの現在状態を参照した直後に割
込みが発生した場合，ref_tskから戻ってきた時には対象タスクの状態が変化し
ている可能性があるためである．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>対象タスクが時間経過待ち状態の時にlefttmoに返される値について規定した．
また，参照できるタスクの状態から，強制待ち要求ネスト数（suscnt）を除外
した．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで参照できる情報として，割付けプロセッサの
ID（prcid）と次回起動時の割付けプロセッサのID（actprc）を追加した．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルで参照できる情報として，タスク例外処理マスク状態か
否か（texmsk），待ち禁止状態か否か（waifbd），拡張サービスコールのネス
トレベル（svclevel）を追加した．</p>
</div>
</div>
<div class="sect2">
<h3 id="_タスク付属同期機能">4.2. タスク付属同期機能</h3>
<div class="paragraph">
<p>タスク付属同期機能は，タスクとタスクの間，または非タスクコンテキストの
処理とタスクの間で同期を取るために，タスク単独で持っている機能である．</p>
</div>
<div class="paragraph">
<p>タスク付属同期機能に関連して，各タスクが持つ情報は次の通り【NGKI1249】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>起床要求キューイング数</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>タスクの起床要求キューイング数は，処理されていないタスクの起床要求の数
であり，タスクの起動時に0に初期化される【NGKI1250】．</p>
</div>
<div class="paragraph">
<p>タスク付属同期機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_WUPCNT		タスクの起床要求キューイング数の最大値【NGKI1251】</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，TMAX_WUPCNTは1に固定されている【ASPS0113】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，TMAX_WUPCNTは1に固定されている【FMPS0107】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，TMAX_WUPCNTは1に固定されている【HRPS0109】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，タスク付属同期機能をサポートしない【SSPS0125】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>この仕様では，強制待ち要求をネストする機能をサポートしないこととした．
言い換えると，強制待ち要求ネスト数の最大値を1に固定する．これに伴い，強
制待ち状態から強制再開するサービスコール（frsm_tsk）とタスクの強制待ち
要求ネスト数の最大値を表すカーネル構成マクロ（TMAX_SUSCNT）は廃止した．
また，ref_tskで参照できる情報（T_RTSKのフィールド）から，強制待ち要求ネ
スト数（suscnt）を除外した．</p>
</div>
<div id="API_slp_tsk" class="listingblock">
<div class="content">
<pre>slp_tsk		起床待ち〔T〕【NGKI1252】
tslp_tsk	起床待ち（タイムアウト付き）〔T〕【NGKI1253】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = slp_tsk()
	ER ercd = tslp_tsk(TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	TMO			tmout		タイムアウト時間（tslp_tskの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・ディスパッチ保留状態からの呼出し【NGKI1254】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し【NGKI1255】
	E_PAR		パラメータエラー
				・tmoutが無効（tslp_tskの場合）【NGKI1256】
	E_TMOUT		ポーリング失敗またはタイムアウト（slp_tskを除く）【NGKI1257】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除【NGKI1258】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>自タスクを起床待ちさせる．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>自タスクの起床要求キューイング数が0でない場合には，起床要求キューイング
数から1が減ぜられる【NGKI1259】．起床要求キューイング数が0の場合には，
自タスクは起床待ち状態となる【NGKI1260】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>自タスクの起床要求キューイング数が0でない場合には，自タスクは実行できる
状態を維持し，自タスクの優先順位は変化しない．</p>
</div>
<div id="API_wup_tsk" class="listingblock">
<div class="content">
<pre>wup_tsk		タスクの起床〔T〕【NGKI1261】
iwup_tsk	タスクの起床〔I〕【NGKI1262】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = wup_tsk(ID tskid)
	ER ercd = iwup_tsk(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（wup_tskの場合）【NGKI1263】
				・タスクコンテキストからの呼出し（iwup_tskの場合）【NGKI1264】
				・CPUロック状態からの呼出し【NGKI1265】
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1266】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1267】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1268】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作1が許可されていない（wup_tsk
				　の場合）〔P〕【NGKI1269】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1270】
	E_QOVR		キューイングオーバフロー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）を起床する．具体的な振舞いは以下の通
り．</p>
</div>
<div class="paragraph">
<p>対象タスクが起床待ち状態である場合には，対象タスクが待ち解除される
【NGKI1271】．待ち解除されたタスクには，待ち状態となったサービスコール
からE_OKが返る【NGKI1272】．</p>
</div>
<div class="paragraph">
<p>対象タスクが起床待ち状態でなく，休止状態でもない場合には，対象タスクの
起床要求キューイング数に1が加えられる【NGKI1273】．起床要求キューイング
数に1を加えるとTMAX_WUPCNTを超える場合には，E_QOVRエラーとなる
【NGKI1274】．</p>
</div>
<div class="paragraph">
<p>wup_tskにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI1275】．</p>
</div>
<div id="API_can_wup" class="listingblock">
<div class="content">
<pre>can_wup		タスク起床要求のキャンセル〔T〕【NGKI1276】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_UINT wupcnt = can_wup(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_UINT		wupcnt		キューイングされていた起床要求の数（正の値
							または0）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1277】
				・CPUロック状態からの呼出し【NGKI1278】
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1279】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1280】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1281】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作1が許可されていない〔P〕
				　【NGKI1282】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1283】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）に対する処理されていない起床要求をす
べてキャンセルし，キャンセルした起床要求の数を返す．具体的な振舞いは以
下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが休止状態でない場合には，対象タスクの起床要求キューイング数
が0に設定され，0に設定する前の起床要求キューイング数が，サービスコール
の返値として返される【NGKI1284】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI1285】．</p>
</div>
<div id="API_rel_wai" class="listingblock">
<div class="content">
<pre>rel_wai		強制的な待ち解除〔T〕【NGKI1286】
irel_wai	強制的な待ち解除〔I〕【NGKI1287】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = rel_wai(ID tskid)
	ER ercd = irel_wai(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（rel_waiの場合）【NGKI1288】
				・タスクコンテキストからの呼出し（irel_waiの場合）【NGKI1289】
				・CPUロック状態からの呼出し【NGKI1290】
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1291】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1292】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1293】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない（rel_wai
				　の場合）〔P〕【NGKI1294】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが待ち状態でない【NGKI1295】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）を，強制的に待ち解除する．具体的な振
舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが待ち状態である場合には，対象タスクが待ち解除される
【NGKI1296】．待ち解除されたタスクには，待ち状態となったサービスコール
からE_RLWAIが返る【NGKI1297】．</p>
</div>
<div id="API_sus_tsk" class="listingblock">
<div class="content">
<pre>sus_tsk		強制待ち状態への遷移〔T〕【NGKI1298】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sus_tsk(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1299】
				・CPUロック状態からの呼出し【NGKI1300】
				・その他の条件については機能の項を参照
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1301】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1302】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1303】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない〔P〕
				　【NGKI1304】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1305】
	E_QOVR		キューイングオーバフロー
				・対象タスクが強制待ち状態（二重待ち状態を含む）【NGKI1306】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）を強制待ちにする．具体的な振舞いは以
下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが実行できる状態である場合には，対象タスクは強制待ち状態とな
る【NGKI1307】．また，待ち状態（二重待ち状態を除く）である場合には，二
重待ち状態となる【NGKI1308】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクが自タスクの場合にも，
E_QOVRエラーとなる場合がある【NGKI1309】．この状況は，自タスクに対して
sus_tskを発行するのと同じタイミングで，他のプロセッサで実行されているタ
スクから同じタスクに対してsus_tskが発行された場合に発生する可能性がある．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI1310】．</p>
</div>
<div class="paragraph">
<p>ディスパッチ保留状態で，対象タスクを自タスクとしてsus_tskを呼び出すと，
E_CTXエラーとなる【NGKI1311】．なお，sus_tskは，自タスクを広義の待ち状
態に遷移させる可能性のあるサービスコールであるが，対象タスクが自タスク
でない場合には，割込み優先度マスクが全解除でない状態やディスパッチ禁止
状態で呼び出しても，E_CTXエラーにはならない【NGKI3604】．これは，
［NGKI0175］と［NGKI0179］の原則の例外となっている．</p>
</div>
<div id="API_rsm_tsk" class="listingblock">
<div class="content">
<pre>rsm_tsk		強制待ち状態からの再開〔T〕【NGKI1312】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = rsm_tsk(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1313】
				・CPUロック状態からの呼出し【NGKI1314】
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1315】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1316】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1317】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない〔P〕
				　【NGKI1318】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが強制待ち状態（二重待ち状態を含む）でない
				　【NGKI1319】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）を，強制待ちから再開する．具体的な振
舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが強制待ち状態である場合には，対象タスクは強制待ちから再開さ
れる【NGKI1320】．</p>
</div>
<div id="API_dis_wai" class="listingblock">
<div class="content">
<pre>dis_wai		待ち禁止状態への遷移〔TP〕【NGKI1321】
idis_wai	待ち禁止状態への遷移〔IP〕【NGKI1322】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = dis_wai(ID tskid)
	ER ercd = idis_wai(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（dis_waiの場合）【NGKI1323】
				・タスクコンテキストからの呼出し（idis_waiの場合）【NGKI1324】
				・CPUロック状態からの呼出し【NGKI1325】
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1326】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1327】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1328】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない（dis_wai
				　の場合）【NGKI1329】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1330】
				・対象タスクがタスク例外処理マスク状態でない【NGKI1331】
	E_QOVR		キューイングオーバフロー
				・対象タスクが待ち禁止状態【NGKI1332】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）を待ち禁止状態にする．具体的な振舞い
は以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクがタスク例外処理マスク状態であり，待ち禁止状態でない場合には，
対象タスクは待ち禁止状態になる【NGKI1333】．</p>
</div>
<div class="paragraph">
<p>dis_waiにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI1334】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，dis_waiをサポートしない【ASPS0114】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，dis_waiをサポートしない【FMPS0108】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>dis_waiは，対象タスクの待ち解除は行わない．対象タスクを待ち禁止状態にす
ることに加えて待ち解除したい場合には，dis_waiを呼び出した後に，rel_wai
を呼び出せばよい．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクを，自タスクと同じプロセッ
サに割り付けられているタスクに限るなどの制限を導入する可能性があるが，
現時点では未決定である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ena_wai" class="listingblock">
<div class="content">
<pre>ena_wai		待ち禁止状態の解除〔TP〕【NGKI1335】
iena_wai	待ち禁止状態の解除〔IP〕【NGKI1336】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ena_wai(ID tskid)
	ER ercd = iena_wai(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（ena_waiの場合）【NGKI1337】
				・タスクコンテキストからの呼出し（iena_waiの場合）【NGKI1338】
				・CPUロック状態からの呼出し【NGKI1339】
	E_NOSPT		未サポート機能
				・対象タスクが制約タスク【NGKI1340】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1341】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1342】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない（ena_wai
				　の場合）【NGKI1343】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1344】
				・対象タスクが待ち禁止状態でない【NGKI1345】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）の待ち禁止状態を解除する．具体的な振
舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクが待ち禁止状態である場合には，待ち禁止状態は解除される
【NGKI1346】．</p>
</div>
<div class="paragraph">
<p>ena_waiにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI1347】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ena_waiをサポートしない【ASPS0115】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ena_waiをサポートしない【FMPS0109】．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，対象タスクを，自タスクと同じプロセッ
サに割り付けられているタスクに限るなどの制限を導入する可能性があるが，
現時点では未決定である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_dly_tsk" class="listingblock">
<div class="content">
<pre>dly_tsk		自タスクの遅延〔T〕【NGKI1348】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = dly_tsk(RELTIM dlytim)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	RELTIM		dlytim		遅延時間</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・ディスパッチ保留状態からの呼出し【NGKI1349】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し【NGKI1350】
	E_PAR		パラメータエラー
				・dlytimがTMAX_RELTIMより大きい【NGKI1351】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除【NGKI1352】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>dlytimで指定した時間，自タスクを遅延させる．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>自タスクは，dlytimで指定した時間が経過するまでの間，時間経過待ち状態と
なる【NGKI1353】．dly_tskを呼び出してからdlytimで指定した相対時間後に，
自タスクは待ち解除され，dly_tskからE_OKが返る【NGKI1354】．</p>
</div>
</div>
<div class="sect2">
<h3 id="_タスク例外処理機能">4.3. タスク例外処理機能</h3>
<div class="paragraph">
<p>タスク例外処理ルーチンは，カーネルが実行を制御する処理単位で，タスクと
同一のコンテキスト内で実行される．タスク例外処理ルーチンは，各タスクに
1つのみ登録できるため，タスクIDによって識別する【NGKI1355】．</p>
</div>
<div class="paragraph">
<p>タスク例外処理機能に関連して，各タスクが持つ情報は次の通り【NGKI1356】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>タスク例外処理ルーチン属性</p>
</li>
<li>
<p>タスク例外処理禁止フラグ</p>
</li>
<li>
<p>保留例外要因</p>
</li>
<li>
<p>タスク例外処理ルーチンの先頭番地</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチン属性に指定できる属性はない【NGKI1357】．そのため，
タスク例外処理ルーチン属性には，TA_NULLを指定しなければならない
【NGKI1358】．</p>
</div>
<div class="paragraph">
<p>タスクは，タスク例外処理ルーチンの実行を保留するためのタスク例外処理禁
止フラグを持つ【NGKI1359】．タスク例外処理禁止フラグがセットされた状態
をタスク例外処理禁止状態，クリアされた状態をタスク例外処理許可状態と呼
ぶ．タスク例外処理禁止フラグは，タスクの起動時に，セットした状態に初期
化される【NGKI1361】．</p>
</div>
<div class="paragraph">
<p>タスクの保留例外要因は，タスクに対して要求された例外要因を蓄積するため
のビットマップであり，タスクの起動時に0に初期化される【NGKI1362】．</p>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチンは，「タスク例外処理許可状態である」「保留例外要
因が0でない」「タスクが実行状態である」「タスクコンテキストが実行されて
いる」「割込み優先度マスク全解除状態である」「CPUロック状態でない」の6
つの条件が揃った場合に実行が開始される【NGKI1363】．保護機能対応カーネ
ルにおいては，さらに，「タスク例外処理マスク状態でない」という条件が追
加される【NGKI1364】．タスク例外処理マスク状態については，「2.6.5 タス
ク例外処理マスク状態と待ち禁止状態」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチンの実行が開始される時，タスク例外処理禁止フラグは
セットされ，保留例外要因は0にクリアされる【NGKI1365】．また，タスク例外
処理ルーチンからのリターン時には，タスク例外処理禁止フラグはクリアされ
る【NGKI1366】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，ユーザタスクのタスク例外処理ルーチンの実行開
始時に，リターン先の番地やシステム状態等が，ユーザスタック上に保存され
る【NGKI1367】．ここで，ユーザスタック領域に十分な空きがない場合や，ユー
ザスタックポインタがユーザスタック領域以外を指している場合，カーネルは，
エミュレートされたCPU例外を発生させる【NGKI1368】．これを，タスク例外実
行開始時スタック不正例外と呼ぶ．</p>
</div>
<div class="paragraph">
<p>逆に，タスク例外処理ルーチンからのリターン時には，リターン先の番地やシ
ステム状態等が，ユーザスタック上から取り出される【NGKI1369】．ここで，
ユーザスタック領域に積まれている情報が足りない場合や，ユーザスタックポ
インタがユーザスタック領域以外を指している場合，カーネルは，エミュレー
トされたCPU例外を発生させる【NGKI1370】．これを，タスク例外リターン時ス
タック不正例外と呼ぶ．</p>
</div>
<div class="paragraph">
<p>タスク例外実行開始時スタック不正例外またはタスク例外リターン時スタック
不正例外を起こしたタスクの実行を継続した場合の動作は保証されないため，
アプリケーションは，これらのCPU例外を処理するCPU例外ハンドラで，
「2.8.1 CPU例外処理の流れ」の節の(b)または(d)の方法でリカバリ処理を行う
必要がある【NGKI1371】．この方法に従わなかった場合の動作は，保証されな
い【NGKI1372】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，タスク例外処理ルーチンは，タスクと同じ保
護ドメインに属する【NGKI1373】．</p>
</div>
<div class="paragraph">
<p>タスク例外処理機能に用いるデータ型は次の通り．</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	TEXPTN		タスク例外要因のビットパターン（符号無し整数，uint_tに
				定義）【NGKI1374】</pre>
</div>
</div>
<div class="paragraph">
<p>C言語によるタスク例外処理ルーチンの記述形式は次の通り【NGKI1375】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void task_exception_routine(TEXPTN texptn, intptr_t exinf)
	{
		タスク例外処理ルーチン本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>texptnにはタスク例外処理ルーチン起動時の保留例外要因が，exinfにはタスク
の拡張情報が，それぞれ渡される【NGKI1376】．</p>
</div>
<div class="paragraph">
<p>タスク例外処理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	TBIT_TEXPTN		タスク例外要因のビット数（TEXPTNの有効ビット数）
					【NGKI1377】</pre>
</div>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>保護機能対応でないカーネルでは，タスク例外処理ルーチンの実行開始条件の
内，「CPUロック状態でない」は省いても同じ結果になる．これは，CPUロック
状態で他の条件が揃うことはないためである．一方，保護機能対応カーネルで
は，CPUロック状態で拡張サービスコールからリターンした場合（言い換えると，
タスク例外処理マスク状態が解除された場合）に，CPUロック状態で他の条件が
揃うことになる．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，タスク例外要因のビット数（TBIT_TEXPTN）は16以上である
【ASPS0116】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，タスク例外要因のビット数（TBIT_TEXPTN）は16以上である
【FMPS0110】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，タスク例外要因のビット数（TBIT_TEXPTN）は16以上である
【HRPS0110】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，タスク例外処理機能をサポートしない【SSPS0126】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>割込み優先度マスク全解除状態でない場合には，タスク例外処理ルーチンの実
行が開始されないという仕様に変更した．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>ユーザタスクのタスク例外処理ルーチンの実行開始時とリターン時にユーザス
タックが不正となる問題に関して，μITRON4.0/PX仕様では考慮されていない．</p>
</div>
<div class="paragraph">
<p>【仕様変更の経緯】</p>
</div>
<div class="paragraph">
<p>この仕様のRelease 1.2以前では，タスク例外処理ルーチンの実行開始条件に
「割込み優先度マスク全解除状態である」の条件がなかったが，Release1.3以
降で追加した．これは，マルチプロセッサ対応カーネルにおいて，他プロセッ
サで実行中のタスクに対してタスク例外処理を要求した場合に，割込み優先度
マスクが全解除でないと，タスク例外処理ルーチンをただちに実行開始するこ
とができないためである．なお，ASPカーネル Release 1.6以前と，FMPカーネ
ル Release 1.1.1以前のバージョンは，古い仕様に従って実装されている．</p>
</div>
<div id="API_DEF_TEX" class="listingblock">
<div class="content">
<pre>DEF_TEX		タスク例外処理ルーチンの定義〔S〕【NGKI1378】
def_tex		タスク例外処理ルーチンの定義〔TD〕【NGKI1379】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_TEX(ID tskid, { ATR texatr, TEXRTN texrtn })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = def_tex(ID tskid, const T_DTEX *pk_dtex)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	T_DTEX *	pk_dtex		タスク例外処理ルーチンの定義情報を入れたパ
							ケットへのポインタ（静的APIを除く）

　＊タスク例外処理ルーチンの定義情報（パケットの内容）
	ATR			texatr		タスク例外処理ルーチン属性
	TEXRTN		texrtn		タスク例外処理ルーチンの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1380】
				・CPUロック状態からの呼出し〔s〕【NGKI1381】
	E_ID		不正ID番号
				・tskidが有効範囲外〔s〕【NGKI1382】
	E_RSATR		予約属性
				・texatrが無効【NGKI1383】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・texrtnがプログラムの先頭番地として正しくない【NGKI1384】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録【NGKI1385】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する管理操作が許可されていない〔sP〕
				　【NGKI1386】
	E_MACV		メモリアクセス違反
				・pk_dtexが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI1387】
	E_OBJ		オブジェクト状態エラー
				・対象タスクは静的APIで生成された〔s〕【NGKI1388】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）に対して，各パラメータで指定したタス
ク例外処理ルーチン定義情報に従って，タスク例外処理ルーチンを定義する
【NGKI1389】．</p>
</div>
<div class="paragraph">
<p>ただし，def_texにおいてpk_dtexをNULLにした場合には，対象タスクに対する
タスク例外処理ルーチンの定義を解除する【NGKI1390】．また，対象タスクの
タスク例外処理禁止フラグをセットし，保留例外要因を0に初期化する
【NGKI1391】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，tskidはオブジェクト識別名，texatrは整数定数式パラメー
タ，texrtnは一般定数式パラメータである【NGKI1392】．</p>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチンを定義する場合（DEF_TEXの場合およびdef_texにおい
てpk_dtexをNULL以外にした場合）で，対象タスクに対してすでにタスク例外処
理ルーチンが定義されている場合には，E_OBJエラーとなる【NGKI1393】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，DEF_TEXは，対象タスクが属する保護ドメイン
の囲みの中に記述しなければならない．そうでない場合には，E_RSATRエラーと
なる【NGKI1395】．また，def_texでタスク例外処理ルーチンを定義する場合に
は，タスク例外処理ルーチンの属する保護ドメインを設定する必要はなく，タ
スク例外処理ルーチン属性にTA_DOM(domid)を指定した場合にはE_RSATRエラー
となる【NGKI1396】．ただし，TA_DOM(TDOM_SELF)を指定した場合には，指定が
無視され，E_RSATRエラーは検出されない【NGKI1397】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，DEF_TEXは，対象タスクが属するクラ
スの囲みの中に記述しなければならない．そうでない場合には，E_RSATRエラー
となる【NGKI1399】．また，def_texでタスク例外処理ルーチンを定義する場合
には，タスク例外処理ルーチンの属するクラスを設定する必要はなく，タスク
例外処理ルーチン属性にTA_CLS(clsid)を指定した場合にはE_RSATRエラーとな
る【NGKI1400】．ただし，TA_CLS(CLS_SELF)を指定した場合には，指定が無視
され，E_RSATRエラーは検出されない【NGKI1401】．</p>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチンの定義を解除する場合（def_texにおいてpk_dtexを
NULLにした場合）で，対象タスクに対してタスク例外処理ルーチンが定義され
ていない場合には，E_OBJエラーとなる【NGKI1402】．</p>
</div>
<div class="paragraph">
<p>def_texにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI1403】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，DEF_TEXのみをサポートする【ASPS0117】．ただし，動的生
成機能拡張パッケージでは，def_texもサポートする【ASPS0118】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，DEF_TEXのみをサポートする【FMPS0111】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，DEF_TEXのみをサポートする【HRPS0111】．ただし，動的生
成機能拡張パッケージでは，def_texもサポートする【HRPS0179】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>texrtnのデータ型をTEXRTNに変更した．</p>
</div>
<div class="paragraph">
<p>def_texによって，定義済みのタスク例外処理ルーチンを再定義しようとした場
合に，E_OBJエラーとすることにした．</p>
</div>
<div id="API_ras_tex" class="listingblock">
<div class="content">
<pre>ras_tex		タスク例外処理の要求〔T〕【NGKI1404】
iras_tex	タスク例外処理の要求〔I〕【NGKI1405】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ras_tex(ID tskid, TEXPTN rasptn)
	ER ercd = iras_tex(ID tskid, TEXPTN rasptn)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	TEXPTN		rasptn		要求するタスク例外処理のタスク例外要因</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（ras_texの場合）【NGKI1406】
				・タスクコンテキストからの呼出し（iras_texの場合）【NGKI1407】
				・CPUロック状態からの呼出し【NGKI1408】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1409】
	E_PAR		パラメータエラー
				・rasptnが0【NGKI1410】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1411】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない（ras_tex
				　の場合）〔P〕【NGKI1412】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1413】
				・対象タスクに対してタスク例外処理ルーチンが定義されてい
				　ない【NGKI1414】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）に対して，rasptnで指定したタスク例外
要因のタスク例外処理を要求する．対象タスクの保留例外要因が，それまでの
値とrasptnで指定した値のビット毎論理和（C言語の"|"）に更新される
【NGKI1415】．</p>
</div>
<div class="paragraph">
<p>ras_texにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI1416】．</p>
</div>
<div id="API_dis_tex" class="listingblock">
<div class="content">
<pre>dis_tex		タスク例外処理の禁止〔T〕【NGKI1417】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = dis_tex()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1419】
				・CPUロック状態からの呼出し【NGKI1420】
	E_OBJ		オブジェクト状態エラー
				・自タスクに対してタスク例外処理ルーチンが定義されていな
				　い【NGKI1421】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>自タスクのタスク例外処理禁止フラグをセットする【NGKI1422】．すなわち，
自タスクをタスク例外処理禁止状態に遷移させる．</p>
</div>
<div id="API_ena_tex" class="listingblock">
<div class="content">
<pre>ena_tex		タスク例外処理の許可〔T〕【NGKI1423】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ena_tex()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1424】
				・CPUロック状態からの呼出し【NGKI1425】
	E_OBJ		オブジェクト状態エラー
				・自タスクに対してタスク例外処理ルーチンが定義されていな
				　い【NGKI1426】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>自タスクのタスク例外処理禁止フラグをクリアする【NGKI1427】．すなわち，
自タスクをタスク例外処理許可状態に遷移させる．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチン中でena_texを呼び出すことにより，タスク例外処理ルー
チンの多重起動を行うことができる．ただし，多重起動の最大段数を制限する
のは，アプリケーションの責任である．</p>
</div>
<div id="API_sns_tex" class="listingblock">
<div class="content">
<pre>sns_tex		タスク例外処理禁止状態の参照〔TI〕【NGKI1428】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t state = sns_tex()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t		state		タスク例外処理禁止状態</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>実行状態のタスクのタスク例外処理禁止フラグを参照する．具体的な振舞いは
以下の通り．</p>
</div>
<div class="paragraph">
<p>実行状態のタスクが，タスク例外処理禁止状態の場合にtrue，タスク例外処理
許可状態の場合にfalseが返る【NGKI1429】．sns_texを非タスクコンテキスト
から呼び出した場合で，実行状態のタスクがない場合には，trueが返る
【NGKI1430】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，サービスコールを呼び出した処理
単位を実行しているプロセッサにおいて実行状態のタスクのタスク例外処理禁
止フラグを参照する【NGKI1431】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>sns_texをタスクコンテキストから呼び出した場合，実行状態のタスクは自タス
クに一致する．</p>
</div>
<div id="API_ref_tex" class="listingblock">
<div class="content">
<pre>ref_tex		タスク例外処理の状態参照〔T〕【NGKI1432】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_tex(ID tskid, T_RTEX *pk_rtex)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	T_RTEX *	pk_rtex		タスク例外処理の現在状態を入れるパケットへ
							のポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊タスク例外処理の現在状態（パケットの内容）
	STAT		texstat		タスク例外処理の状態
	TEXPTN		pndptn		タスクの保留例外要因</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1433】
				・CPUロック状態からの呼出し【NGKI1434】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI1435】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI1436】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する参照操作が許可されていない〔P〕【NGKI1437】
	E_MACV		メモリアクセス違反
				・pk_rtexが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1438】
	E_OBJ		オブジェクト状態エラー
				・対象タスクが休止状態【NGKI1439】
				・対象タスクに対してタスク例外処理ルーチンが定義されてい
				　ない【NGKI1440】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）のタスク例外処理に関する現在状態を参
照する．参照した現在状態は，pk_rtexで指定したパケットに返される
【NGKI1441】．</p>
</div>
<div class="paragraph">
<p>texstatには，対象タスクの現在のタスク例外処理禁止フラグを表す次のいずれ
かの値が返される【NGKI1442】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TTEX_ENA	0x01U		タスク例外処理許可状態
TTEX_DIS	0x02U		タスク例外処理禁止状態</pre>
</div>
</div>
<div class="paragraph">
<p>pndptnには，対象タスクの現在の保留例外要因が返される【NGKI1443】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI1444】．</p>
</div>
</div>
<div class="sect2">
<h3 id="_同期_通信機能">4.4. 同期・通信機能</h3>
<div class="paragraph">
<p>同期・通信機能は，タスクとは独立したオブジェクトにより，タスクとタスク
の間，または非タスクコンテキストの処理とタスクの間で同期・通信を行うた
めの機能である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，同期・通信機能をサポートしない【SSPS0127】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>この仕様では，ランデブ機能はサポートしていない．今後の検討により，ラン
デブ機能をサポートすることに変更する可能性もある．</p>
</div>
<div class="sect3">
<h4 id="_セマフォ">4.4.1. セマフォ</h4>
<div class="paragraph">
<p>セマフォは，資源の数を表す0以上の整数値を取るカウンタ（資源数）を介して，
排他制御やイベント通知を行うための同期・通信オブジェクトである．セマフォ
の資源数から1を減ずることを資源の獲得，資源数に1を加えることを資源の返
却と呼ぶ．セマフォは，セマフォIDと呼ぶID番号によって識別する【NGKI1445】．</p>
</div>
<div class="paragraph">
<p>各セマフォが持つ情報は次の通り【NGKI1446】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>セマフォ属性</p>
</li>
<li>
<p>資源数（の現在値）</p>
</li>
<li>
<p>待ち行列（セマフォの資源獲得待ち状態のタスクのキュー）</p>
</li>
<li>
<p>初期資源数</p>
</li>
<li>
<p>最大資源数</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>待ち行列は，セマフォの資源が獲得できるまで待っている状態（セマフォの資
源獲得待ち状態）のタスクが，資源を獲得できる順序でつながれているキュー
である．</p>
</div>
<div class="paragraph">
<p>セマフォの初期資源数は，セマフォを生成または再初期化した際の，資源数の
初期値である．また，セマフォの最大資源数は，資源数が取りうる最大値であ
る．資源数が最大資源数に一致している時に資源を返却しようとすると，
E_QOVRエラーとなる【NGKI1447】．</p>
</div>
<div class="paragraph">
<p>セマフォ属性には，次の属性を指定することができる【NGKI1448】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI		0x01U	待ち行列をタスクの優先度順にする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，待ち行列はFIFO順になる【NGKI1449】．</p>
</div>
<div class="paragraph">
<p>セマフォ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_MAXSEM		セマフォの最大資源数の最大値（＝UINT_MAX）【NGKI1450】</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_SEMID		登録できるセマフォの数（動的生成対応でないカーネル
				では，静的APIによって登録されたセマフォの数に一致）
				【NGKI1451】</pre>
</div>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TNUM_SEMIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_SEM" class="listingblock">
<div class="content">
<pre>CRE_SEM		セマフォの生成〔S〕【NGKI1452】
acre_sem	セマフォの生成〔TD〕【NGKI1453】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_SEM(ID semid, { ATR sematr, uint_t isemcnt, uint_t maxsem })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID semid = acre_sem(const T_CSEM *pk_csem)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			semid		生成するセマフォのID番号（CRE_SEMの場合）
	T_CSEM *	pk_csem		セマフォの生成情報を入れたパケットへのポイ
							ンタ（静的APIを除く）

　＊セマフォの生成情報（パケットの内容）
	ATR			sematr		セマフォ属性
	uint_t		isemcnt		セマフォの初期資源数
	uint_t		maxsem		セマフォの最大資源数</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		semid		生成されたセマフォのID番号（正の値）または
							エラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1454】
				・CPUロック状態からの呼出し〔s〕【NGKI1455】
	E_RSATR		予約属性
				・sematrが無効【NGKI1456】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI1457】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI1458】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI1459】
	E_PAR		パラメータエラー
				・maxsemが有効範囲（1以上TMAX_MAXSEM以下）外【NGKI1468】
				・isemcntが有効範囲（0以上maxsem以下）外【NGKI1466】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI1460】
	E_MACV		メモリアクセス違反
				・pk_csemが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI1461】
	E_NOID		ID番号不足
				・割り付けられるセマフォIDがない〔sD〕【NGKI1462】
	E_OBJ		オブジェクト状態エラー
				・semidで指定したセマフォが登録済み（CRE_SEMの場合）
				　【NGKI1463】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したセマフォ生成情報に従って，セマフォを生成する．生
成されたセマフォの資源数は初期資源数に，待ち行列は空の状態に初期化され
る【NGKI1464】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，semidはオブジェクト識別名，sematr，isemcnt，maxsemは
整数定数式パラメータである【NGKI1465】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_SEMのみをサポートする【ASPS0119】．ただし，動的生
成機能拡張パッケージでは，acre_semもサポートする【ASPS0120】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_SEMのみをサポートする【FMPS0112】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_SEMのみをサポートする【HRPS0112】．ただし，動的生
成機能拡張パッケージでは，acre_semもサポートする【HRPS0180】．</p>
</div>
<div id="API_AID_SEM" class="listingblock">
<div class="content">
<pre>AID_SEM		割付け可能なセマフォIDの数の指定〔SD〕【NGKI1469】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_SEM(uint_t nosem)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nosem		割付け可能なセマフォIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3429】
				・クラスの囲みの中に記述されていない〔M〕【NGKI1470】
	E_PAR		パラメータエラー
				・nosemが負の値【NGKI3277】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nosemで指定した数のセマフォIDを，セマフォを生成するサービスコールによっ
て割付け可能なセマフォIDとして確保する【NGKI1471】．</p>
</div>
<div class="paragraph">
<p>nosemは整数定数式パラメータである【NGKI1472】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_SEMをサポートする
【ASPS0211】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_SEMをサポートする
【HRPS0212】．</p>
</div>
<div id="API_SAC_SEM" class="listingblock">
<div class="content">
<pre>SAC_SEM		セマフォのアクセス許可ベクタの設定〔SP〕【NGKI1473】
sac_sem		セマフォのアクセス許可ベクタの設定〔TPD〕【NGKI1474】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_SEM(ID semid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_sem(ID semid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			semid		対象セマフォのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1475】
				・CPUロック状態からの呼出し〔s〕【NGKI1476】
	E_ID		不正ID番号
				・semidが有効範囲外〔s〕【NGKI1477】
	E_RSATR		予約属性
				・対象セマフォが属する保護ドメインの囲みの中（対象セマ
				　フォが無所属の場合は，保護ドメインの囲みの外）に記述
				　されていない〔S〕【NGKI1478】
				・対象セマフォが属するクラスの囲みの中に記述されていな
				　い〔SM〕【NGKI1479】
	E_NOEXS		オブジェクト未登録
				・対象セマフォが未登録【NGKI1480】
	E_OACV		オブジェクトアクセス違反
				・対象セマフォに対する管理操作が許可されていない〔s〕
				　【NGKI1481】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI1482】
	E_OBJ		オブジェクト状態エラー
				・対象セマフォは静的APIで生成された〔s〕【NGKI1483】
				・対象セマフォに対してアクセス許可ベクタが設定済み〔S〕
				　【NGKI1484】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>semidで指定したセマフォ（対象セマフォ）のアクセス許可ベクタ（4つのアク
セス許可パターンの組）を，各パラメータで指定した値に設定する
【NGKI1485】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，semidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI1486】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_SEMのみをサポートする【HRPS0113】．ただし，動的生
成機能拡張パッケージでは，sac_semもサポートする【HRPS0181】．</p>
</div>
<div id="API_del_sem" class="listingblock">
<div class="content">
<pre>del_sem		セマフォの削除〔TD〕【NGKI1487】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_sem(ID semid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			semid		対象セマフォのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1488】
				・CPUロック状態からの呼出し【NGKI1489】
	E_ID		不正ID番号
				・semidが有効範囲外【NGKI1490】
	E_NOEXS		オブジェクト未登録
				・対象セマフォが未登録【NGKI1491】
	E_OACV		オブジェクトアクセス違反
				・対象セマフォに対する管理操作が許可されていない〔P〕
				　【NGKI1492】
	E_OBJ		オブジェクト状態エラー
				・対象セマフォは静的APIで生成された【NGKI1493】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>semidで指定したセマフォ（対象セマフォ）を削除する．具体的な振舞いは以下
の通り．</p>
</div>
<div class="paragraph">
<p>対象セマフォの登録が解除され，そのセマフォIDが未使用の状態に戻される
【NGKI1494】．また，対象セマフォの待ち行列につながれたタスクは，待ち行
列の先頭のタスクから順に待ち解除される【NGKI1495】．待ち解除されたタス
クには，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1496】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>del_semにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_semをサポートしない【ASPS0122】．ただし，動的生成
機能拡張パッケージでは，del_semをサポートする【ASPS0123】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_semをサポートしない【FMPS0114】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_semをサポートしない【HRPS0114】．ただし，動的生成
機能拡張パッケージでは，del_semをサポートする【HRPS0182】．</p>
</div>
<div id="API_sig_sem" class="listingblock">
<div class="content">
<pre>sig_sem		セマフォの資源の返却〔T〕【NGKI1497】
isig_sem	セマフォの資源の返却〔I〕【NGKI1498】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sig_sem(ID semid)
	ER ercd = isig_sem(ID semid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			semid		対象セマフォのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（sig_semの場合）【NGKI1499】
				・タスクコンテキストからの呼出し（isig_semの場合）【NGKI1500】
				・CPUロック状態からの呼出し【NGKI1501】
	E_ID		不正ID番号
				・semidが有効範囲外【NGKI1502】
	E_NOEXS		オブジェクト未登録
				・対象セマフォが未登録〔D〕【NGKI1503】
	E_OACV		オブジェクトアクセス違反
				・対象セマフォに対する通常操作1が許可されていない（sig_sem
				　の場合）〔P〕【NGKI1504】
	E_QOVR		キューイングオーバフロー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>semidで指定したセマフォ（対象セマフォ）に資源を返却する．具体的な振舞い
は以下の通り．</p>
</div>
<div class="paragraph">
<p>対象セマフォの待ち行列にタスクが存在する場合には，待ち行列の先頭のタス
クが待ち解除される【NGKI1505】．この時，待ち解除されたタスクが資源を獲
得したことになるため，対象セマフォの資源数は変化しない【NGKI1506】．待
ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る
【NGKI1507】．</p>
</div>
<div class="paragraph">
<p>待ち行列にタスクが存在しない場合には，対象セマフォの資源数に1が加えられ
る【NGKI1508】．資源数に1を加えるとそのセマフォの最大資源数を越える場合
には，E_QOVRエラーとなる【NGKI1509】．</p>
</div>
<div id="API_wai_sem" class="listingblock">
<div class="content">
<pre>wai_sem		セマフォの資源の獲得〔T〕【NGKI1510】
pol_sem		セマフォの資源の獲得（ポーリング）〔T〕【NGKI1511】
twai_sem	セマフォの資源の獲得（タイムアウト付き）〔T〕【NGKI1512】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = wai_sem(ID semid)
	ER ercd = pol_sem(ID semid)
	ER ercd = twai_sem(ID semid, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			semid		対象セマフォのID番号
	TMO			tmout		タイムアウト時間（twai_semの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1513】
				・CPUロック状態からの呼出し【NGKI1514】
				・ディスパッチ保留状態からの呼出し（pol_semを除く）【NGKI1515】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（pol_semを除く）【NGKI1516】
	E_ID		不正ID番号
				・semidが有効範囲外【NGKI1517】
	E_PAR		パラメータエラー
				・tmoutが無効（twai_semの場合）【NGKI1518】
	E_NOEXS		オブジェクト未登録
				・対象セマフォが未登録〔D〕【NGKI1519】
	E_OACV		オブジェクトアクセス違反
				・対象セマフォに対する通常操作2が許可されていない〔P〕
				　【NGKI1520】
	E_TMOUT		ポーリング失敗またはタイムアウト（wai_semを除く）【NGKI1521】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（pol_semを除く）
				【NGKI1522】
	E_DLT		待ちオブジェクトの削除または再初期化（pol_semを除く）
				【NGKI1523】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>semidで指定したセマフォ（対象セマフォ）から資源を獲得する．具体的な振舞
いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象セマフォの資源数が1以上の場合には，資源数から1が減ぜられる
【NGKI1524】．資源数が0の場合には，自タスクはセマフォの資源獲得待ち状態
となり，対象セマフォの待ち行列につながれる【NGKI1525】．</p>
</div>
<div id="API_ini_sem" class="listingblock">
<div class="content">
<pre>ini_sem		セマフォの再初期化〔T〕【NGKI1526】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ini_sem(ID semid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			semid		対象セマフォのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1527】
				・CPUロック状態からの呼出し【NGKI1528】
	E_ID		不正ID番号
				・semidが有効範囲外【NGKI1529】
	E_NOEXS		オブジェクト未登録
				・対象セマフォが未登録〔D〕【NGKI1530】
	E_OACV		オブジェクトアクセス違反
				・対象セマフォに対する管理操作が許可されていない〔P〕
				　【NGKI1531】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>semidで指定したセマフォ（対象セマフォ）を再初期化する．具体的な振舞いは
以下の通り．</p>
</div>
<div class="paragraph">
<p>対象セマフォの資源数は，初期資源数に初期化される【NGKI1532】．また，対
象セマフォの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順
に待ち解除される【NGKI1533】．待ち解除されたタスクには，待ち状態となっ
たサービスコールからE_DLTエラーが返る【NGKI1534】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ini_semにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>セマフォを再初期化した場合に，アプリケーションとの整合性を保つのは，ア
プリケーションの責任である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_sem" class="listingblock">
<div class="content">
<pre>ref_sem		セマフォの状態参照〔T〕【NGKI1535】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_sem(ID semid, T_RSEM *pk_rsem)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			semid		対象セマフォのID番号
	T_RSEM *	pk_rsem		セマフォの現在状態を入れるパケットへのポイ
							ンタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊セマフォの現在状態（パケットの内容）
	ID			wtskid		セマフォの待ち行列の先頭のタスクのID番号
	uint_t		semcnt		セマフォの資源数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1536】
				・CPUロック状態からの呼出し【NGKI1537】
	E_ID		不正ID番号
				・semidが有効範囲外【NGKI1538】
	E_NOEXS		オブジェクト未登録
				・対象セマフォが未登録〔D〕【NGKI1539】
	E_OACV		オブジェクトアクセス違反
				・対象セマフォに対する参照操作が許可されていない〔P〕
				　【NGKI1540】
	E_MACV		メモリアクセス違反
				・pk_rsemが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1541】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>semidで指定したセマフォ（対象セマフォ）の現在状態を参照する．参照した現
在状態は，pk_rsemで指定したパケットに返される【NGKI1542】．</p>
</div>
<div class="paragraph">
<p>対象セマフォの待ち行列にタスクが存在しない場合，wtskidにはTSK_NONE（＝
0）が返る【NGKI1543】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_semはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_semを呼び出し，対象セマフォの現在状態を参照した直後に
割込みが発生した場合，ref_semから戻ってきた時には対象セマフォの状態が変
化している可能性があるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_イベントフラグ">4.4.2. イベントフラグ</h4>
<div class="paragraph">
<p>イベントフラグは，イベントの発生の有無を表すビットの集合（ビットパター
ン）を介して，イベント通知を行うための同期・通信オブジェクトである．イ
ベントが発生している状態を1，発生していない状態を0とし，ビットパターン
により複数のイベントの発生の有無を表す【NGKI1544】．イベントフラグは，
イベントフラグIDと呼ぶID番号によって識別する【NGKI1545】．</p>
</div>
<div class="paragraph">
<p>1つまたは複数のビットをセットする1にする（セットする）ことを，イベント
フラグをセットするといい，0にする（クリアする）ことを，イベントフラグを
クリアするという．イベントフラグによりイベントを通知する側のタスクは，
イベントフラグをセットまたはクリアすることで，イベントの発生を通知する．</p>
</div>
<div class="paragraph">
<p>イベントフラグによりイベントの通知を受ける側のタスクは，待ちビットパター
ンと待ちモードにより，どのビットがセットされるのを待つかを指定する．待
ちモードにTWF_ORW（＝0x01U）を指定した場合，待ちビットパターンに含まれ
るいずれかのビットがセットされるのを待つ【NGKI1546】．待ちモードに
TWF_ANDW（＝0x02U）を指定した場合，待ちビットパターンに含まれるすべての
ビットがセットされるのを待つ【NGKI1547】．この条件を，イベントフラグの
待ち解除の条件と呼ぶ．</p>
</div>
<div class="paragraph">
<p>各イベントフラグが持つ情報は次の通り【NGKI1548】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>イベントフラグ属性</p>
</li>
<li>
<p>ビットパターン（の現在値）</p>
</li>
<li>
<p>待ち行列（イベントフラグ待ち状態のタスクのキュー）</p>
</li>
<li>
<p>初期ビットパターン</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>待ち行列は，イベントフラグが指定した待ち解除の条件を満たすまで待ってい
る状態（イベントフラグ待ち状態）のタスクがつながれているキューである．
待ち行列につながれたタスクの待ち解除は，待ち解除の条件を満たした中で，
待ち行列の前方につながれたものから順に行われる（〔NGKI0216〕に該当）
【NGKI1549】．</p>
</div>
<div class="paragraph">
<p>イベントフラグの初期ビットパターンは，イベントフラグを生成または再初期
化した際の，ビットパターンの初期値である．</p>
</div>
<div class="paragraph">
<p>イベントフラグ属性には，次の属性を指定することができる【NGKI1550】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI		0x01U	待ち行列をタスクの優先度順にする
TA_WMUL		0x02U	複数のタスクが待つのを許す
TA_CLR		0x04U	タスクの待ち解除時にイベントフラグをクリアする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，待ち行列はFIFO順になる【NGKI1551】．TA_WMULを
指定しない場合，1つのイベントフラグに複数のタスクが待つことを禁止する
【NGKI1552】．</p>
</div>
<div class="paragraph">
<p>TA_CLRを指定した場合，タスクの待ち解除時に，イベントフラグのビットパター
ンを0にクリアする【NGKI1553】．TA_CLRを指定しない場合，タスクの待ち解除
時にイベントフラグをクリアしない【NGKI1554】．</p>
</div>
<div class="paragraph">
<p>イベントフラグ機能に用いるデータ型は次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FLGPTN		イベントフラグのビットパターン（符号無し整数，uint_tに
			定義）【NGKI1555】</pre>
</div>
</div>
<div class="paragraph">
<p>イベントフラグ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TBIT_FLGPTN		イベントフラグのビット数（FLGPTNの有効ビット数）
				【NGKI1556】</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_FLGID		登録できるイベントフラグの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたイベントフラグの
				数に一致）【NGKI1557】</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，イベントフラグのビット数（TBIT_FLGPTN）は16以上である
【ASPS0124】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，イベントフラグのビット数（TBIT_FLGPTN）は16以上である
【FMPS0115】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，イベントフラグのビット数（TBIT_FLGPTN）は16以上である
【HRPS0115】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TNUM_FLGIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_FLG" class="listingblock">
<div class="content">
<pre>CRE_FLG		イベントフラグの生成〔S〕【NGKI1558】
acre_flg	イベントフラグの生成〔TD〕【NGKI1559】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_FLG(ID flgid, { ATR flgatr, FLGPTN iflgptn })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID flgid = acre_flg(const T_CFLG *pk_cflg)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			flgid		生成するイベントフラグのID番号（CRE_FLGの
							場合）
	T_CFLG *	pk_cflg		イベントフラグの生成情報を入れたパケットへ
							のポインタ（静的APIを除く）

　＊イベントフラグの生成情報（パケットの内容）
	ATR			flgatr		イベントフラグ属性
	FLGPTN		iflgptn		イベントフラグの初期ビットパターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		flgid		生成されたイベントフラグのID番号（正の値）
							またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1560】
				・CPUロック状態からの呼出し〔s〕【NGKI1561】
	E_RSATR		予約属性
				・flgatrが無効【NGKI1562】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI1563】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI1564】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI1565】
	E_PAR		パラメータエラー
				・iflgptnがFLGPTNに格納できない〔S〕【NGKI3275】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI1566】
	E_MACV		メモリアクセス違反
				・pk_cflgが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI1567】
	E_NOID		ID番号不足
				・割り付けられるイベントフラグIDがない〔sD〕【NGKI1568】
	E_OBJ		オブジェクト状態エラー
				・flgidで指定したイベントフラグが登録済み（CRE_FLGの場合）
				　【NGKI1569】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したイベントフラグ生成情報に従って，イベントフラグを
生成する．生成されたイベントフラグのビットパターンは初期ビットパターン
に，待ち行列は空の状態に初期化される【NGKI1570】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，flgidはオブジェクト識別名，flgatrとiflgptnは整数定数
式パラメータである【NGKI1571】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_FLGのみをサポートする【ASPS0125】．ただし，動的生
成機能拡張パッケージでは，acre_flgもサポートする【ASPS0126】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_FLGのみをサポートする【FMPS0116】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_FLGのみをサポートする【HRPS0116】．ただし，動的生
成機能拡張パッケージでは，acre_flgもサポートする【HRPS0183】．</p>
</div>
<div id="API_AID_FLG" class="listingblock">
<div class="content">
<pre>AID_FLG		割付け可能なイベントフラグIDの数の指定〔SD〕【NGKI1572】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_FLG(uint_t noflg)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		noflg		割付け可能なイベントフラグIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3430】
				・クラスの囲みの中に記述されていない〔M〕【NGKI1573】
	E_PAR		パラメータエラー
				・noflgが負の値【NGKI3278】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>noflgで指定した数のイベントフラグIDを，イベントフラグを生成するサービス
コールによって割付け可能なイベントフラグIDとして確保する【NGKI1574】．</p>
</div>
<div class="paragraph">
<p>noflgは整数定数式パラメータである【NGKI1575】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_FLGをサポートする
【ASPS0212】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_FLGをサポートする
【HRPS0213】．</p>
</div>
<div id="API_SAC_FLG" class="listingblock">
<div class="content">
<pre>SAC_FLG		イベントフラグのアクセス許可ベクタの設定〔SP〕【NGKI1576】
sac_flg		イベントフラグのアクセス許可ベクタの設定〔TPD〕【NGKI1577】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_FLG(ID flgid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_flg(ID flgid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			flgid		対象イベントフラグのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1578】
				・CPUロック状態からの呼出し〔s〕【NGKI1579】
	E_ID		不正ID番号
				・flgidが有効範囲外〔s〕【NGKI1580】
	E_RSATR		予約属性
				・対象イベントフラグが属する保護ドメインの囲みの中（対
				　象イベントフラグが無所属の場合は，保護ドメインの囲み
				　の外）に記述されていない〔S〕【NGKI1581】
				・対象イベントフラグが属するクラスの囲みの中に記述され
				　ていない〔SM〕【NGKI1582】
	E_NOEXS		オブジェクト未登録
				・対象イベントフラグが未登録【NGKI1583】
	E_OACV		オブジェクトアクセス違反
				・対象イベントフラグに対する管理操作が許可されていない〔s〕
				　【NGKI1584】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI1585】
	E_OBJ		オブジェクト状態エラー
				・対象イベントフラグは静的APIで生成された〔s〕【NGKI1586】
				・対象イベントフラグに対してアクセス許可ベクタが設定済
				　み〔S〕【NGKI1587】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>flgidで指定したイベントフラグ（対象イベントフラグ）のアクセス許可ベクタ
（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する
【NGKI1588】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，flgidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI1589】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_FLGのみをサポートする【HRPS0117】．ただし，動的生
成機能拡張パッケージでは，sac_flgもサポートする【HRPS0184】．</p>
</div>
<div id="API_del_flg" class="listingblock">
<div class="content">
<pre>del_flg		イベントフラグの削除〔TD〕【NGKI1590】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_flg(ID flgid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			flgid		対象イベントフラグのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1591】
				・CPUロック状態からの呼出し【NGKI1592】
	E_ID		不正ID番号
				・flgidが有効範囲外【NGKI1593】
	E_NOEXS		オブジェクト未登録
				・対象イベントフラグが未登録【NGKI1594】
	E_OACV		オブジェクトアクセス違反
				・対象イベントフラグに対する管理操作が許可されていない〔P〕
				　【NGKI1595】
	E_OBJ		オブジェクト状態エラー
				・対象イベントフラグは静的APIで生成された【NGKI1596】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>flgidで指定したイベントフラグ（対象イベントフラグ）を削除する．具体的な
振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグの登録が解除され，そのイベントフラグIDが未使用の状態
に戻される【NGKI1597】．また，対象イベントフラグの待ち行列につながれた
タスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI1598】．待
ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが
返る【NGKI1599】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>del_flgにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_flgをサポートしない【ASPS0128】．ただし，動的生成
機能拡張パッケージでは，del_flgをサポートする【ASPS0129】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_flgをサポートしない【FMPS0118】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_flgをサポートしない【HRPS0118】．ただし，動的生成
機能拡張パッケージでは，del_flgをサポートする【HRPS0185】．</p>
</div>
<div id="API_set_flg" class="listingblock">
<div class="content">
<pre>set_flg		イベントフラグのセット〔T〕【NGKI1600】
iset_flg	イベントフラグのセット〔I〕【NGKI1601】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = set_flg(ID flgid, FLGPTN setptn)
	ER ercd = iset_flg(ID flgid, FLGPTN setptn)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			flgid		対象イベントフラグのID番号
	FLGPTN		setptn		セットするビットパターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（set_flgの場合）【NGKI1602】
				・タスクコンテキストからの呼出し（iset_flgの場合）【NGKI1603】
				・CPUロック状態からの呼出し【NGKI1604】
	E_ID		不正ID番号
				・flgidが有効範囲外【NGKI1605】
	E_NOEXS		オブジェクト未登録
				・対象イベントフラグが未登録〔D〕【NGKI1606】
	E_OACV		オブジェクトアクセス違反
				・対象イベントフラグに対する通常操作1が許可されていない
				　（set_flgの場合）〔P〕【NGKI1607】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>flgidで指定したイベントフラグ（対象イベントフラグ）のsetptnで指定したビッ
トをセットする．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグのビットパターンは，それまでの値とsetptnで指定した値
のビット毎論理和（C言語の"|"）に更新される【NGKI1608】．対象イベントフ
ラグの待ち行列にタスクが存在する場合には，待ち解除の条件を満たしたタス
クが，待ち行列の前方につながれたものから順に待ち解除される【NGKI1609】．
待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る
【NGKI1610】．</p>
</div>
<div class="paragraph">
<p>ただし，対象イベントフラグがTA_CLR属性である場合には，待ち解除の条件を
満たしたタスクを1つ待ち解除した時点で，対象イベントフラグのビットパター
ンが0にクリアされるため，他のタスクが待ち解除されることはない．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>対象イベントフラグが，TA_WMUL属性であり，TA_CLR属性でない場合，set_flg
またはiset_flgにより複数のタスクが待ち解除される場合がある．この場合，
サービスコールの処理時間およびカーネル内での割込み禁止時間が，待ち解除
されるタスクの数に比例して長くなる．特に，多くのタスクが待ち解除される
場合，カーネル内での割込み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div id="API_clr_flg" class="listingblock">
<div class="content">
<pre>clr_flg		イベントフラグのクリア〔T〕【NGKI1611】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = clr_flg(ID flgid, FLGPTN clrptn)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			flgid		対象イベントフラグのID番号
	FLGPTN		clrptn		クリアするビットパターン（クリアしないビッ
							トを1，クリアするビットを0とする）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1612】
				・CPUロック状態からの呼出し【NGKI1613】
	E_ID		不正ID番号
				・flgidが有効範囲外【NGKI1614】
	E_NOEXS		オブジェクト未登録
				・対象イベントフラグが未登録〔D〕【NGKI1615】
	E_OACV		オブジェクトアクセス違反
				・対象イベントフラグに対する通常操作1が許可されていない〔P〕
				　【NGKI1616】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>flgidで指定したイベントフラグ（対象イベントフラグ）のclrptnで指定したビッ
トをクリアする．対象イベントフラグのビットパターンは，それまでの値と
clrptnで指定した値のビット毎論理積（C言語の"&amp;"）に更新される
【NGKI1617】．</p>
</div>
<div id="API_wai_flg" class="listingblock">
<div class="content">
<pre>wai_flg		イベントフラグ待ち〔T〕【NGKI1618】
pol_flg		イベントフラグ待ち（ポーリング）〔T〕【NGKI1619】
twai_flg	イベントフラグ待ち（タイムアウト付き）〔T〕【NGKI1620】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = wai_flg(ID flgid, FLGPTN waiptn, MODE wfmode, FLGPTN *p_flgptn)
	ER ercd = pol_flg(ID flgid, FLGPTN waiptn, MODE wfmode, FLGPTN *p_flgptn)
	ER ercd = twai_flg(ID flgid, FLGPTN waiptn,
									MODE wfmode, FLGPTN *p_flgptn, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			flgid		対象イベントフラグのID番号
	FLGPTN		waiptn		待ちビットパターン
	MODE		wfmode		待ちモード
	FLGPTN *	p_flgptn	待ち解除時のビットパターンを入れるメモリ領
							域へのポインタ
	TMO			tmout		タイムアウト時間（twai_flgの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	FLGPTN		flgptn		待ち解除時のビットパターン</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1621】
				・CPUロック状態からの呼出し【NGKI1622】
				・ディスパッチ保留状態からの呼出し（pol_flgを除く）【NGKI1623】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（pol_flgを除く）【NGKI1624】
	E_ID		不正ID番号
				・flgidが有効範囲外【NGKI1625】
	E_PAR		パラメータエラー
				・waiptnが0【NGKI1626】
				・wfmodeが無効（TWF_ORWまたはTWF_ANDWでない）【NGKI1627】
				・tmoutが無効（twai_flgの場合）【NGKI1628】
	E_NOEXS		オブジェクト未登録
				・対象イベントフラグが未登録〔D〕【NGKI1629】
	E_OACV		オブジェクトアクセス違反
				・対象イベントフラグに対する通常操作2が許可されていない〔P〕
				　【NGKI1630】
	E_MACV		メモリアクセス違反
				・p_flgptnが指すメモリ領域への書込みアクセスが許可され
				　ていない〔P〕【NGKI1631】
	E_ILUSE		サービスコール不正使用
				・TA_WMUL属性でないイベントフラグで待ちタスクあり【NGKI1632】
	E_TMOUT		ポーリング失敗またはタイムアウト（wai_flgを除く）【NGKI1633】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（pol_flgを除く）
				【NGKI1634】
	E_DLT		待ちオブジェクトの削除または再初期化（pol_flgを除く）
				【NGKI1635】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>flgidで指定したイベントフラグ（対象イベントフラグ）が，waiptnとwfmodeで
指定した待ち解除の条件を満たすのを待つ．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグが，waiptnとwfmodeで指定した待ち解除の条件を満たして
いる場合には，対象イベントフラグのビットパターンの現在値がp_flgptnが指
すメモリ領域に返される【NGKI1636】．対象イベントフラグがTA_CLR属性であ
る場合には，対象イベントフラグのビットパターンが0にクリアされる
【NGKI1637】．</p>
</div>
<div class="paragraph">
<p>待ち解除の条件を満たしていない場合には，自タスクはイベントフラグ待ち状
態となり，対象イベントフラグの待ち行列につながれる【NGKI1638】．</p>
</div>
<div id="API_ini_flg" class="listingblock">
<div class="content">
<pre>ini_flg		イベントフラグの再初期化〔T〕【NGKI1639】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ini_flg(ID flgid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			flgid		対象イベントフラグのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1640】
				・CPUロック状態からの呼出し【NGKI1641】
	E_ID		不正ID番号
				・flgidが有効範囲外【NGKI1642】
	E_NOEXS		オブジェクト未登録
				・対象イベントフラグが未登録〔D〕【NGKI1643】
	E_OACV		オブジェクトアクセス違反
				・対象イベントフラグに対する管理操作が許可されていない〔P〕
				　【NGKI1644】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>flgidで指定したイベントフラグ（対象イベントフラグ）を再初期化する．具体
的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグのビットパターンは，初期ビットパターンに初期化される
【NGKI1645】．また，対象イベントフラグの待ち行列につながれたタスクは，
待ち行列の先頭のタスクから順に待ち解除される【NGKI1646】．待ち解除され
たタスクには，待ち状態となったサービスコールからE_DLTエラーが返る
【NGKI1647】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ini_flgにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>イベントフラグを再初期化した場合に，アプリケーションとの整合性を保つの
は，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_flg" class="listingblock">
<div class="content">
<pre>ref_flg		イベントフラグの状態参照〔T〕【NGKI1648】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_flg(ID flgid, T_RFLG *pk_rflg)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			flgid		対象イベントフラグのID番号
	T_RFLG *	pk_rflg		イベントフラグの現在状態を入れるパケットへ
							のポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊イベントフラグの現在状態（パケットの内容）
	ID			wtskid		イベントフラグの待ち行列の先頭のタスクのID
							番号
	uint_t		flgptn		イベントフラグのビットパターン</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1649】
				・CPUロック状態からの呼出し【NGKI1650】
	E_ID		不正ID番号
				・flgidが有効範囲外【NGKI1651】
	E_NOEXS		オブジェクト未登録
				・対象イベントフラグが未登録〔D〕【NGKI1652】
	E_OACV		オブジェクトアクセス違反
				・対象イベントフラグに対する参照操作が許可されていない
				　〔P〕【NGKI1653】
	E_MACV		メモリアクセス違反
				・pk_rflgが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1654】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>flgidで指定したイベントフラグ（対象イベントフラグ）の現在状態を参照する．
参照した現在状態は，pk_rflgで指定したパケットに返される【NGKI1655】．</p>
</div>
<div class="paragraph">
<p>対象イベントフラグの待ち行列にタスクが存在しない場合，wtskidには
TSK_NONE（＝0）が返る【NGKI1656】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_flgはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_flgを呼び出し，対象イベントフラグの現在状態を参照した
直後に割込みが発生した場合，ref_flgから戻ってきた時には対象イベントフラ
グの状態が変化している可能性があるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_データキュー">4.4.3. データキュー</h4>
<div class="paragraph">
<p>データキューは，1ワードのデータをメッセージとして，FIFO順で送受信するた
めの同期・通信オブジェクトである．より大きいサイズのメッセージを送受信
したい場合には，メッセージを置いたメモリ領域へのポインタを1ワードのデー
タとして送受信する方法がある．データキューは，データキューIDと呼ぶID番
号によって識別する【NGKI1657】．</p>
</div>
<div class="paragraph">
<p>各データキューが持つ情報は次の通り【NGKI1658】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>データキュー属性</p>
</li>
<li>
<p>データキュー管理領域</p>
</li>
<li>
<p>送信待ち行列（データキューへの送信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>受信待ち行列（データキューからの受信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>データキュー管理領域は，データキューに送信されたデータを，送信された順
に格納しておくためのメモリ領域である．データキュー生成時に，データキュー
管理領域に格納できるデータ数を0とすることで，データキュー管理領域のサイ
ズを0とすることができる【NGKI1659】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，データキュー管理領域は，カーネルの用いる
オブジェクト管理領域として扱われる【NGKI1660】．</p>
</div>
<div class="paragraph">
<p>送信待ち行列は，データキューに対してデータが送信できるまで待っている状
態（データキューへの送信待ち状態）のタスクが，データを送信できる順序で
つながれているキューである．また，受信待ち行列は，データキューからデー
タが受信できるまで待っている状態（データキューからの受信待ち状態）のタ
スクが，データを受信できる順序でつながれているキューである．</p>
</div>
<div class="paragraph">
<p>データキュー属性には，次の属性を指定することができる【NGKI1661】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI		0x01U	送信待ち行列をタスクの優先度順にする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，送信待ち行列はFIFO順になる【NGKI1662】．受信待
ち行列は，FIFO順に固定されている【NGKI1663】．</p>
</div>
<div class="paragraph">
<p>データキュー機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_DTQID		登録できるデータキューの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたデータキューの数
				に一致）【NGKI1664】</pre>
</div>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TNUM_DTQIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_DTQ" class="listingblock">
<div class="content">
<pre>CRE_DTQ		データキューの生成〔S〕【NGKI1665】
acre_dtq	データキューの生成〔TD〕【NGKI1666】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_DTQ(ID dtqid, { ATR dtqatr, uint_t dtqcnt, void *dtqmb })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID dtqid = acre_dtq(const T_CDTQ *pk_cdtq)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			dtqid		生成するデータキューのID番号（CRE_DTQの場合）
	T_CDTQ *	pk_cdtq		データキューの生成情報を入れたパケットへの
							ポインタ（静的APIを除く）

　＊データキューの生成情報（パケットの内容）
	ATR			dtqatr		データキュー属性
	uint_t		dtqcnt		データキュー管理領域に格納できるデータ数
	void *		dtqmb		データキュー管理領域の先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		dtqid		生成されたデータキューのID番号（正の値）ま
							たはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1667】
				・CPUロック状態からの呼出し〔s〕【NGKI1668】
	E_RSATR		予約属性
				・dtqatrが無効【NGKI1669】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI1670】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI1671】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI1672】
	E_NOSPT		未サポート機能
				・条件については各カーネルにおける規定の項を参照
	E_PAR		パラメータエラー
				・dtqcntが負の値〔S〕【NGKI3288】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI1673】
	E_MACV		メモリアクセス違反
				・pk_cdtqが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI1674】
	E_NOID		ID番号不足
				・割り付けられるデータキューIDがない〔sD〕【NGKI1675】
	E_NOMEM		メモリ不足
				・データキュー管理領域が確保できない【NGKI1676】
	E_OBJ		オブジェクト状態エラー
				・dtqidで指定したデータキューが登録済み（CRE_DTQの場合）
				　【NGKI1677】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したデータキュー生成情報に従って，データキューを生成
する．dtqcntとdtqmbからデータキュー管理領域が設定され，格納されているデー
タがない状態に初期化される【NGKI1678】．また，送信待ち行列と受信待ち行
列は，空の状態に初期化される【NGKI1679】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，dtqidはオブジェクト識別名，dtqatrとdtqcntは整数定数
式パラメータ，dtqmbは一般定数式パラメータである【NGKI1680】．コンフィギュ
レータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができない
【NGKI1681】．</p>
</div>
<div class="paragraph">
<p>dtqmbをNULLとした場合，dtqcntで指定した数のデータを格納できるデータキュー
管理領域が，コンフィギュレータまたはカーネルにより確保される【NGKI1682】．</p>
</div>
<div class="paragraph">
<p>〔dtqmbにNULL以外を指定した場合〕</p>
</div>
<div class="paragraph">
<p>dtqmbにNULL以外を指定した場合，dtqmbを先頭番地とするデータキュー管理領
域は，アプリケーションで確保しておく必要がある【NGKI1683】．データキュー
管理領域をアプリケーションで確保するために，次のマクロを用意している
【NGKI1684】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_DTQMB(dtqcnt)	dtqcntで指定した数のデータを格納できるデータ
					キュー管理領域のサイズ（バイト数）
TCNT_DTQMB(dtqcnt)	dtqcntで指定した数のデータを格納できるデータ
					キュー管理領域を確保するために必要なMB_T型の配
					列の要素数</pre>
</div>
</div>
<div class="paragraph">
<p>これらを用いてデータキュー管理領域を確保する方法は次の通り【NGKI1685】．</p>
</div>
<div class="paragraph">
<p>MB_T	&lt;データキュー管理領域の変数名&gt;[TCNT_DTQMB(dtqcnt)];</p>
</div>
<div class="paragraph">
<p>この時，dtqmbには&lt;データキュー管理領域の変数名&gt;を指定する【NGKI1686】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，dtqmbにターゲット定義の制約に合致しない先頭番地を指定
した時には，E_PARエラーとなる【NGKI1687】．また，保護機能対応カーネルに
おいて，dtqmbで指定したデータキュー管理領域がカーネル専用のメモリオブジェ
クトに含まれない場合，E_OBJエラーとなる【NGKI1688】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_DTQのみをサポートする【ASPS0130】．また，dtqmbには
NULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラー
となる【ASPS0132】．ただし，動的生成機能拡張パッケージでは，acre_dtqも
サポートする【ASPS0133】．acre_dtqに対しては，dtqmbにNULL以外を指定でき
ないという制限はない【ASPS0134】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_DTQのみをサポートする【FMPS0119】．また，dtqmbには
NULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラー
となる【FMPS0121】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_DTQのみをサポートする【HRPS0119】．また，dtqmbに
はNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエ
ラーとなる【HRPS0121】．ただし，動的生成機能拡張パッケージでは，
acre_dtqもサポートする【HRPS0186】．acre_dtqに対しては，dtqmbにNULL以外
を指定できないという制限はない【HRPS0187】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様にあわせて，データキュー生成情報の最後のパラメータを，
dtq（データキュー領域の先頭番地）から，dtqmb（データキュー管理領域の先
頭番地）に改名した．また，TSZ_DTQをTSZ_DTQMBに改名した．</p>
</div>
<div class="paragraph">
<p>TCNT_DTQMBを新設し，データキュー管理領域をアプリケーションで確保する方
法を規定した．</p>
</div>
<div id="API_AID_DTQ" class="listingblock">
<div class="content">
<pre>AID_DTQ		割付け可能なデータキューIDの数の指定〔SD〕【NGKI1689】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_DTQ(uint_t nodtq)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nodtq		割付け可能なデータキューIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3431】
				・クラスの囲みの中に記述されていない〔M〕【NGKI1690】
	E_PAR		パラメータエラー
				・nodtqが負の値【NGKI3279】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nodtqで指定した数のデータキューIDを，データキューを生成するサービスコー
ルによって割付け可能なデータキューIDとして確保する【NGKI1691】．</p>
</div>
<div class="paragraph">
<p>nodtqは整数定数式パラメータである【NGKI1692】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_DTQをサポートする
【ASPS0213】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_DTQをサポートする
【HRPS0214】．</p>
</div>
<div id="API_SAC_DTQ" class="listingblock">
<div class="content">
<pre>SAC_DTQ		データキューのアクセス許可ベクタの設定〔SP〕【NGKI1693】
sac_dtq		データキューのアクセス許可ベクタの設定〔TPD〕【NGKI1694】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_DTQ(ID dtqid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_dtq(ID dtqid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			dtqid		対象データキューのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1695】
				・CPUロック状態からの呼出し〔s〕【NGKI1696】
	E_ID		不正ID番号
				・dtqidが有効範囲外〔s〕【NGKI1697】
	E_RSATR		予約属性
				・対象データキューが属する保護ドメインの囲みの中（対象
				　データキューが無所属の場合は，保護ドメインの囲みの外）
				　に記述されていない〔S〕【NGKI1698】
				・対象データキューが属するクラスの囲みの中に記述されて
				　いない〔SM〕【NGKI1699】
	E_NOEXS		オブジェクト未登録
				・対象データキューが未登録【NGKI1700】
	E_OACV		オブジェクトアクセス違反
				・対象データキューに対する管理操作が許可されていない〔s〕
				　【NGKI1701】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI1702】
	E_OBJ		オブジェクト状態エラー
				・対象データキューは静的APIで生成された〔s〕【NGKI1703】
				・対象データキューに対してアクセス許可ベクタが設定済み〔S〕
				　【NGKI1704】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>dtqidで指定したデータキュー（対象データキュー）のアクセス許可ベクタ（4
つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する
【NGKI1705】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，dtqidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI1706】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_DTQのみをサポートする【HRPS0122】．ただし，動的生
成機能拡張パッケージでは，sac_dtqもサポートする【HRPS0188】．</p>
</div>
<div id="API_del_dtq" class="listingblock">
<div class="content">
<pre>del_dtq		データキューの削除〔TD〕【NGKI1707】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_dtq(ID dtqid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			dtqid		対象データキューのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1708】
				・CPUロック状態からの呼出し【NGKI1709】
	E_ID		不正ID番号
				・dtqidが有効範囲外【NGKI1710】
	E_NOEXS		オブジェクト未登録
				・対象データキューが未登録【NGKI1711】
	E_OACV		オブジェクトアクセス違反
				・対象データキューに対する管理操作が許可されていない〔P〕
				　【NGKI1712】
	E_OBJ		オブジェクト状態エラー
				・対象データキューは静的APIで生成された【NGKI1713】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>dtqidで指定したデータキュー（対象データキュー）を削除する．具体的な振舞
いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューの登録が解除され，そのデータキューIDが未使用の状態に戻
される【NGKI1714】．また，対象データキューの送信待ち行列と受信待ち行列
につながれたタスクは，それぞれの待ち行列の先頭のタスクから順に待ち解除
される【NGKI1715】．待ち解除されたタスクには，待ち状態となったサービス
コールからE_DLTエラーが返る【NGKI1716】．</p>
</div>
<div class="paragraph">
<p>データキューの生成時に，データキュー管理領域がカーネルによって確保され
た場合は，そのメモリ領域が解放される【NGKI1717】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，
別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がな
い．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>del_dtqにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_dtqをサポートしない【ASPS0136】．ただし，動的生成
機能拡張パッケージでは，del_dtqをサポートする【ASPS0137】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_dtqをサポートしない【FMPS0123】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_dtqをサポートしない【HRPS0123】．ただし，動的生成
機能拡張パッケージでは，del_dtqをサポートする【HRPS0189】．</p>
</div>
<div id="API_snd_dtq" class="listingblock">
<div class="content">
<pre>snd_dtq		データキューへの送信〔T〕【NGKI1718】
psnd_dtq	データキューへの送信（ポーリング）〔T〕【NGKI1719】
ipsnd_dtq	データキューへの送信（ポーリング）〔I〕【NGKI1720】
tsnd_dtq	データキューへの送信（タイムアウト付き）〔T〕【NGKI1721】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = snd_dtq(ID dtqid, intptr_t data)
	ER ercd = psnd_dtq(ID dtqid, intptr_t data)
	ER ercd = ipsnd_dtq(ID dtqid, intptr_t data)
	ER ercd = tsnd_dtq(ID dtqid, intptr_t data, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			dtqid		対象データキューのID番号
	intptr_t	data		送信データ
	TMO			tmout		タイムアウト時間（tsnd_dtqの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（ipsnd_dtqを除く）
				　【NGKI1722】
				・タスクコンテキストからの呼出し（ipsnd_dtqの場合）
				　【NGKI1723】
				・CPUロック状態からの呼出し【NGKI1724】
				・ディスパッチ保留状態からの呼出し（snd_dtqとtsnd_dtqの
				　場合）【NGKI1725】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（snd_dtqとtsnd_dtqの場合）【NGKI1726】
	E_ID		不正ID番号
				・dtqidが有効範囲外【NGKI1727】
	E_PAR		パラメータエラー
				・tmoutが無効（tsnd_dtqの場合）【NGKI1728】
	E_NOEXS		オブジェクト未登録
				・対象データキューが未登録〔D〕【NGKI1729】
	E_OACV		オブジェクトアクセス違反
				・対象データキューに対する通常操作1が許可されていない
				　（ipsnd_dtqを除く）〔P〕【NGKI1730】
	E_TMOUT		ポーリング失敗またはタイムアウト（snd_dtqを除く）【NGKI1731】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（snd_dtqとtsnd_dtq
				の場合）【NGKI1732】
	E_DLT		待ちオブジェクトの削除または再初期化（snd_dtqとtsnd_dtq
				の場合）【NGKI1733】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>dtqidで指定したデータキュー（対象データキュー）に，dataで指定したデータ
を送信する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在する場合には，受信待ち行列
の先頭のタスクが，dataで指定したデータを受信し，待ち解除される
【NGKI1734】．待ち解除されたタスクには，待ち状態となったサービスコール
からE_OKが返る【NGKI1735】．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在せず，データキュー管理領域
にデータを格納するスペースがある場合には，dataで指定したデータが，FIFO
順でデータキュー管理領域に格納される【NGKI1736】．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在せず，データキュー管理領域
にデータを格納するスペースがない場合には，自タスクはデータキューへの送
信待ち状態となり，対象データキューの送信待ち行列につながれる
【NGKI1737】．</p>
</div>
<div id="API_fsnd_dtq" class="listingblock">
<div class="content">
<pre>fsnd_dtq	データキューへの強制送信〔T〕【NGKI1738】
ifsnd_dtq	データキューへの強制送信〔I〕【NGKI1739】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = fsnd_dtq(ID dtqid, intptr_t data)
	ER ercd = ifsnd_dtq(ID dtqid, intptr_t data)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			dtqid		対象データキューのID番号
	intptr_t	data		送信データ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（fsnd_dtqの場合）【NGKI1740】
				・タスクコンテキストからの呼出し（ifsnd_dtqの場合）【NGKI1741】
				・CPUロック状態からの呼出し【NGKI1742】
	E_ID		不正ID番号
				・dtqidが有効範囲外【NGKI1743】
	E_NOEXS		オブジェクト未登録
				・対象データキューが未登録〔D〕【NGKI1744】
	E_OACV		オブジェクトアクセス違反
				・対象データキューに対する通常操作1が許可されていない
				　（fsnd_dtqの場合）〔P〕【NGKI1745】
	E_ILUSE		サービスコール不正使用
				・対象データキューのデータキュー管理領域のサイズが0【NGKI1746】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>dtqidで指定したデータキュー（対象データキュー）に，dataで指定したデータ
を強制送信する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在する場合には，受信待ち行列
の先頭のタスクが，dataで指定したデータを受信し，待ち解除される
【NGKI1747】．待ち解除されたタスクには，待ち状態となったサービスコール
からE_OKが返る【NGKI1748】．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在せず，データキュー管理領域
にデータを格納するスペースがある場合には，dataで指定したデータが，FIFO
順でデータキュー管理領域に格納される【NGKI1749】．</p>
</div>
<div class="paragraph">
<p>対象データキューの受信待ち行列にタスクが存在せず，データキュー管理領域
にデータを格納するスペースがない場合には，データキュー管理領域の先頭に
格納されたデータを削除し，空いたスペースを用いて，dataで指定したデータ
が，FIFO順でデータキュー管理領域に格納される【NGKI1750】．</p>
</div>
<div id="API_rcv_dtq" class="listingblock">
<div class="content">
<pre>rcv_dtq		データキューからの受信〔T〕【NGKI1751】
prcv_dtq	データキューからの受信（ポーリング）〔T〕【NGKI1752】
trcv_dtq	データキューからの受信（タイムアウト付き）〔T〕【NGKI1753】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = rcv_dtq(ID dtqid, intptr_t *p_data)
	ER ercd = prcv_dtq(ID dtqid, intptr_t *p_data)
	ER ercd = trcv_dtq(ID dtqid, intptr_t *p_data, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			dtqid		対象データキューのID番号
	intptr_t *	p_data		受信データを入れるメモリ領域へのポインタ
	TMO			tmout		タイムアウト時間（trcv_dtqの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	intptr_t	data		受信データ</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1754】
				・CPUロック状態からの呼出し【NGKI1755】
				・ディスパッチ保留状態からの呼出し（prcv_dtqを除く）
				　【NGKI1756】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（prcv_dtqを除く）【NGKI1757】
	E_ID		不正ID番号
				・dtqidが有効範囲外【NGKI1758】
	E_PAR		パラメータエラー
				・tmoutが無効（trcv_dtqの場合）【NGKI1759】
	E_NOEXS		オブジェクト未登録
				・対象データキューが未登録〔D〕【NGKI1760】
	E_OACV		オブジェクトアクセス違反
				・対象データキューに対する通常操作2が許可されていない〔P〕
				　【NGKI1761】
	E_MACV		メモリアクセス違反
				・p_dataが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1762】
	E_TMOUT		ポーリング失敗またはタイムアウト（rcv_dtqを除く）【NGKI1763】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（prcv_dtqを除く）
				【NGKI1764】
	E_DLT		待ちオブジェクトの削除または再初期化（prcv_dtqを除く）
				【NGKI1765】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>dtqidで指定したデータキュー（対象データキュー）からデータを受信する．デー
タの受信に成功した場合，受信したデータはp_dataが指すメモリ領域に返され
る【NGKI3421】．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューのデータキュー管理領域にデータが格納されている場合には，
データキュー管理領域の先頭に格納されたデータを受信する【NGKI1766】．ま
た，送信待ち行列にタスクが存在する場合には，送信待ち行列の先頭のタスク
の送信データが，FIFO順でデータキュー管理領域に格納され，そのタスクは待
ち解除される【NGKI1767】．待ち解除されたタスクには，待ち状態となったサー
ビスコールからE_OKが返る【NGKI1768】．</p>
</div>
<div class="paragraph">
<p>対象データキューのデータキュー管理領域にデータが格納されておらず，送信
待ち行列にタスクが存在する場合には，送信待ち行列の先頭のタスクの送信デー
タを受信する【NGKI1769】．送信待ち行列の先頭のタスクは，待ち解除される
【NGKI3422】．待ち解除されたタスクには，待ち状態となったサービスコール
からE_OKが返る【NGKI1770】．</p>
</div>
<div class="paragraph">
<p>対象データキューのデータキュー管理領域にデータが格納されておらず，送信
待ち行列にタスクが存在しない場合には，自タスクはデータキューからの受信
待ち状態となり，対象データキューの受信待ち行列につながれる【NGKI1771】．</p>
</div>
<div id="API_ini_dtq" class="listingblock">
<div class="content">
<pre>ini_dtq		データキューの再初期化〔T〕【NGKI1772】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ini_dtq(ID dtqid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			dtqid		対象データキューのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1773】
				・CPUロック状態からの呼出し【NGKI1774】
	E_ID		不正ID番号
				・dtqidが有効範囲外【NGKI1775】
	E_NOEXS		オブジェクト未登録
				・対象データキューが未登録〔D〕【NGKI1776】
	E_OACV		オブジェクトアクセス違反
				・対象データキューに対する管理操作が許可されていない〔P〕
				　【NGKI1777】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>dtqidで指定したデータキュー（対象データキュー）を再初期化する．具体的な
振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象データキューのデータキュー管理領域は，格納されているデータがない状
態に初期化される【NGKI1778】．また，対象データキューの送信待ち行列と受
信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタスクから順
に待ち解除される【NGKI1779】．待ち解除されたタスクには，待ち状態となっ
たサービスコールからE_DLTエラーが返る【NGKI1780】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，
別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がな
い．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ini_dtqにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>データキューを再初期化した場合に，アプリケーションとの整合性を保つのは，
アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_dtq" class="listingblock">
<div class="content">
<pre>ref_dtq		データキューの状態参照〔T〕【NGKI1781】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_dtq(ID dtqid, T_RDTQ *pk_rdtq)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			dtqid		対象データキューのID番号
	T_RDTQ *	pk_rdtq		データキューの現在状態を入れるパケットへの
							ポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊データキューの現在状態（パケットの内容）
	ID			stskid		データキューの送信待ち行列の先頭のタスクの
							ID番号
	ID			rtskid		データキューの受信待ち行列の先頭のタスクの
							ID番号
	uint_t		sdtqcnt		データキュー管理領域に格納されているデータ
							の数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1782】
				・CPUロック状態からの呼出し【NGKI1783】
	E_ID		不正ID番号
				・dtqidが有効範囲外【NGKI1784】
	E_NOEXS		オブジェクト未登録
				・対象データキューが未登録〔D〕【NGKI1785】
	E_OACV		オブジェクトアクセス違反
				・対象データキューに対する参照操作が許可されていない〔P〕
				　【NGKI1786】
	E_MACV		メモリアクセス違反
				・pk_rdtqが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1787】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>dtqidで指定したデータキュー（対象データキュー）の現在状態を参照する．参
照した現在状態は，pk_rdtqで指定したパケットに返される【NGKI1788】．</p>
</div>
<div class="paragraph">
<p>対象データキューの送信待ち行列にタスクが存在しない場合，stskidには
TSK_NONE（＝0）が返る【NGKI1789】．また，受信待ち行列にタスクが存在しな
い場合，rtskidにはTSK_NONE（＝0）が返る【NGKI1790】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_dtqはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_dtqを呼び出し，対象データキューの現在状態を参照した直
後に割込みが発生した場合，ref_dtqから戻ってきた時には対象データキューの
状態が変化している可能性があるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_優先度データキュー">4.4.4. 優先度データキュー</h4>
<div class="paragraph">
<p>優先度データキューは，1ワードのデータをメッセージとして，データの優先度
順で送受信するための同期・通信カーネルオブジェクトである．より大きいサ
イズのメッセージを送受信したい場合には，メッセージを置いたメモリ領域へ
のポインタを1ワードのデータとして送受信する方法がある．優先度データキュー
は，優先度データキューIDと呼ぶID番号によって識別する【NGKI1791】．</p>
</div>
<div class="paragraph">
<p>各優先度データキューが持つ情報は次の通り【NGKI1792】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>優先度データキュー属性</p>
</li>
<li>
<p>優先度データキュー管理領域</p>
</li>
<li>
<p>送信待ち行列（優先度データキューへの送信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>受信待ち行列（優先度データキューからの受信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>送信できるデータ優先度の最大値</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>優先度データキュー管理領域は，優先度データキューに送信されたデータを，
データの優先度順に格納しておくためのメモリ領域である．優先度データキュー
生成時に，優先度データキュー管理領域に格納できるデータ数を0とすることで，
優先度データキュー管理領域のサイズを0とすることができる【NGKI1793】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，優先度データキュー管理領域は，カーネルの
用いるオブジェクト管理領域として扱われる【NGKI1794】．</p>
</div>
<div class="paragraph">
<p>送信待ち行列は，優先度データキューに対してデータが送信できるまで待って
いる状態（優先度データキューへの送信待ち状態）のタスクが，データを送信
できる順序でつながれているキューである．また，受信待ち行列は，優先度デー
タキューからデータが受信できるまで待っている状態（優先度データキューか
らの受信待ち状態）のタスクが，データを受信できる順序でつながれている
キューである．</p>
</div>
<div class="paragraph">
<p>優先度データキュー属性には，次の属性を指定することができる【NGKI1795】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI		0x01U	送信待ち行列をタスクの優先度順にする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，送信待ち行列はFIFO順になる【NGKI1796】．受信待
ち行列は，FIFO順に固定されている【NGKI1797】．</p>
</div>
<div class="paragraph">
<p>優先度データキュー機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_DPRI		データ優先度の最小値（＝1）	【NGKI1798】
TMAX_DPRI		データ優先度の最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_PDQID		登録できる優先度データキューの数（動的生成対応でな
				いカーネルでは，静的APIによって登録された優先度デー
				タキューの数に一致）【NGKI1799】</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，データ優先度の最大値（TMAX_DPRI）は16に固定されている
【ASPS0138】．ただし，タスク優先度拡張パッケージでは，TMAX_DPRIを256に
拡張する【ASPS0139】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，データ優先度の最大値（TMAX_DPRI）は16に固定されている
【FMPS0124】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，データ優先度の最大値（TMAX_DPRI）は16に固定されている
【HRPS0124】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>データの優先度が使われるのは，データが優先度データキュー管理領域に格納
される場合のみであり，データを送信するタスクが送信待ち行列につながれて
いる間には使われない．そのため，送信待ち行列につながれているタスクが，
優先度データキュー管理領域に格納されているデータよりも高い優先度のデー
タを送信しようとしている場合でも，最初に送信されるのは，優先度データ
キュー管理領域に格納されているデータである．また，TA_TPRI属性の優先度デー
タキューにおいても，送信待ち行列はタスクの優先度順となり，タスクが送信
しようとしているデータの優先度順となるわけではない．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に規定されていない機能である．</p>
</div>
<div id="API_CRE_PDQ" class="listingblock">
<div class="content">
<pre>CRE_PDQ		優先度データキューの生成〔S〕【NGKI1800】
acre_pdq	優先度データキューの生成〔TD〕【NGKI1801】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_PDQ(ID pdqid, { ATR pdqatr, uint_t pdqcnt, PRI maxdpri, void *pdqmb })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID pdqid = acre_pdq(const T_CPDQ *pk_cpdq)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			pdqid		生成する優先度データキューのID番号（CRE_PDQ
							の場合）
	T_CPDQ *	pk_cpdq		優先度データキューの生成情報を入れたパケッ
							トへのポインタ（静的APIを除く）

　＊優先度データキューの生成情報（パケットの内容）
	ATR			pdqatr		優先度データキュー属性
	uint_t		pdqcnt		優先度データキュー管理領域に格納できるデー
							タ数
	PRI			maxdpri		優先度データキューに送信できるデータ優先度
							の最大値
	void *		pdqmb		優先度データキュー管理領域の先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		pdqid		生成された優先度データキューのID番号（正の
							値）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1802】
				・CPUロック状態からの呼出し〔s〕【NGKI1803】
	E_RSATR		予約属性
				・pdqatrが無効【NGKI1804】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI1805】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI1806】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI1807】
	E_NOSPT		未サポート機能
				・条件については各カーネルにおける規定の項を参照
	E_PAR		パラメータエラー
				・pdqcntが負の値〔S〕【NGKI3289】
				・maxdpriがTMIN_DPRIより小さい，またはTMAX_DPRIより大き
				　い【NGKI1819】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI1808】
	E_MACV		メモリアクセス違反
				・pk_cpdqが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI1809】
	E_NOID		ID番号不足
				・割り付けられる優先度データキューIDがない〔sD〕【NGKI1810】
	E_NOMEM		メモリ不足
				・優先度データキュー管理領域が確保できない【NGKI1811】
	E_OBJ		オブジェクト状態エラー
				・pdqidで指定した優先度データキューが登録済み（CRE_PDQ
				　の場合）【NGKI1812】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した優先度データキュー生成情報に従って，優先度データ
キューを生成する．pdqcntとpdqmbから優先度データキュー管理領域が設定され，
格納されているデータがない状態に初期化される【NGKI1813】．また，送信待
ち行列と受信待ち行列は，空の状態に初期化される【NGKI1814】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，pdqidはオブジェクト識別名，pdqatr，pdqcnt，maxdpriは
整数定数式パラメータ，pdqmbは一般定数式パラメータである【NGKI1815】．コ
ンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出すること
ができない【NGKI1816】．</p>
</div>
<div class="paragraph">
<p>pdqmbをNULLとした場合，pdqcntで指定した数のデータを格納できる優先度デー
タキュー管理領域が，コンフィギュレータまたはカーネルにより確保される
【NGKI1817】．</p>
</div>
<div class="paragraph">
<p>〔pdqmbにNULL以外を指定した場合〕</p>
</div>
<div class="paragraph">
<p>pdqmbにNULL以外を指定した場合，pdqmbを先頭番地とする優先度データキュー
管理領域は，アプリケーションで確保しておく必要がある【NGKI1820】．優先
度データキュー管理領域をアプリケーションで確保するために，次のマクロを
用意している【NGKI1821】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_PDQMB(pdqcnt)	pdqcntで指定した数のデータを格納できる優先度デー
					タキュー管理領域のサイズ（バイト数）
TCNT_PDQMB(pdqcnt)	pdqcntで指定した数のデータを格納できる優先度デー
					タキュー管理領域を確保するために必要なMB_T型の
					配列の要素数</pre>
</div>
</div>
<div class="paragraph">
<p>これらを用いて優先度データキュー管理領域を確保する方法は次の通り
【NGKI1822】．</p>
</div>
<div class="paragraph">
<p>MB_T	&lt;優先度データキュー管理領域の変数名&gt;[TCNT_PDQMB(pdqcnt)];</p>
</div>
<div class="paragraph">
<p>この時，pdqmbには&lt;優先度データキュー管理領域の変数名&gt;を指定する
【NGKI1823】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，pdqmbにターゲット定義の制約に合致しない先頭番地を指定
した時には，E_PARエラーとなる【NGKI1824】．また，保護機能対応カーネルに
いて，pdqmbで指定した優先度データキュー管理領域がカーネル専用のメモリ
オブジェクトに含まれない場合，E_OBJエラーとなる【NGKI1825】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_PDQのみをサポートする【ASPS0140】．また，pdqmbには
NULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラー
となる【ASPS0142】．ただし，動的生成機能拡張パッケージでは，acre_pdqも
サポートする【ASPS0143】．acre_pdqに対しては，pdqmbにNULL以外を指定でき
ないという制限はない【ASPS0144】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_PDQのみをサポートする【FMPS0125】．また，pdqmbには
NULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラー
となる【FMPS0127】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_PDQのみをサポートする【HRPS0125】．また，pdqmbに
はNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエ
ラーとなる【HRPS0127】．ただし，動的生成機能拡張パッケージでは，
acre_pdqもサポートする【HRPS0190】．acre_pdqに対しては，pdqmbにNULL以外
を指定できないという制限はない【HRPS0191】．</p>
</div>
<div id="API_AID_PDQ" class="listingblock">
<div class="content">
<pre>AID_PDQ		割付け可能な優先度データキューIDの数の指定〔SD〕【NGKI1826】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_PDQ(uint_t nopdq)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nopdq		割付け可能な優先度データキューIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3432】
				・クラスの囲みの中に記述されていない〔M〕【NGKI1827】
	E_PAR		パラメータエラー
				・nopdqが負の値【NGKI3280】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nopdqで指定した数の優先度データキューIDを，優先度データキューを生成する
サービスコールによって割付け可能な優先度データキューIDとして確保する
【NGKI1828】．</p>
</div>
<div class="paragraph">
<p>nopdqは整数定数式パラメータである【NGKI1829】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_PDQをサポートする
【ASPS0214】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_PDQをサポートする
【HRPS0215】．</p>
</div>
<div id="API_SAC_PDQ" class="listingblock">
<div class="content">
<pre>SAC_PDQ		優先度データキューのアクセス許可ベクタの設定〔SP〕【NGKI1830】
sac_pdq		優先度データキューのアクセス許可ベクタの設定〔TPD〕【NGKI1831】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_PDQ(ID pdqid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_pdq(ID pdqid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			pdqid		対象優先度データキューのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1832】
				・CPUロック状態からの呼出し〔s〕【NGKI1833】
	E_ID		不正ID番号
				・pdqidが有効範囲外〔s〕【NGKI1834】
	E_RSATR		予約属性
				・対象優先度データキューが属する保護ドメインの囲みの中
				　（対象優先度データキューが無所属の場合は，保護ドメイ
				　ンの囲みの外）に記述されていない〔S〕【NGKI1835】
				・対象優先度データキューが属するクラスの囲みの中に記述
				　されていない〔SM〕【NGKI1836】
	E_NOEXS		オブジェクト未登録
				・対象優先度データキューが未登録【NGKI1837】
	E_OACV		オブジェクトアクセス違反
				・対象優先度データキューに対する管理操作が許可されてい
				　ない〔s〕【NGKI1838】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI1839】
	E_OBJ		オブジェクト状態エラー
				・対象優先度データキューは静的APIで生成された〔s〕【NGKI1840】
				・対象優先度データキューに対してアクセス許可ベクタが設
				　定済み〔S〕【NGKI1841】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）のアクセス許
可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に
設定する【NGKI1842】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，pdqidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI1843】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_PDQのみをサポートする【HRPS0128】．ただし，動的生
成機能拡張パッケージでは，sac_pdqもサポートする【HRPS0192】．</p>
</div>
<div id="API_del_pdq" class="listingblock">
<div class="content">
<pre>del_pdq		優先度データキューの削除〔TD〕【NGKI1844】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_pdq(ID pdqid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			pdqid		対象優先度データキューのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1845】
				・CPUロック状態からの呼出し【NGKI1846】
	E_ID		不正ID番号
				・pdqidが有効範囲外【NGKI1847】
	E_NOEXS		オブジェクト未登録
				・対象優先度データキューが未登録【NGKI1848】
	E_OACV		オブジェクトアクセス違反
				・対象優先度データキューに対する管理操作が許可されてい
				　ない〔P〕【NGKI1849】
	E_OBJ		オブジェクト状態エラー
				・対象優先度データキューは静的APIで生成された【NGKI1850】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）を削除する．
具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの登録が解除され，その優先度データキューIDが未使
用の状態に戻される【NGKI1851】．また，対象優先度データキューの送信待ち
行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタス
クから順に待ち解除される【NGKI1852】．待ち解除されたタスクには，待ち状
態となったサービスコールからE_DLTエラーが返る【NGKI1853】．</p>
</div>
<div class="paragraph">
<p>優先度データキューの生成時に，優先度データキュー管理領域がカーネルによっ
て確保された場合は，そのメモリ領域が解放される【NGKI1854】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，
別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がな
い．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>del_pdqにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_pdqをサポートしない【ASPS0146】．ただし，動的生成
機能拡張パッケージでは，del_pdqをサポートする【ASPS0147】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_pdqをサポートしない【FMPS0129】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_pdqをサポートしない【HRPS0129】．ただし，動的生成
機能拡張パッケージでは，del_pdqをサポートする【HRPS0193】．</p>
</div>
<div id="API_snd_pdq" class="listingblock">
<div class="content">
<pre>snd_pdq		優先度データキューへの送信〔T〕【NGKI1855】
psnd_pdq	優先度データキューへの送信（ポーリング）〔T〕【NGKI1856】
ipsnd_pdq	優先度データキューへの送信（ポーリング）〔I〕【NGKI1857】
tsnd_pdq	優先度データキューへの送信（タイムアウト付き）〔T〕【NGKI1858】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = snd_pdq(ID pdqid, intptr_t data, PRI datapri)
	ER ercd = psnd_pdq(ID pdqid, intptr_t data, PRI datapri)
	ER ercd = ipsnd_pdq(ID pdqid, intptr_t data, PRI datapri)
	ER ercd = tsnd_pdq(ID pdqid, intptr_t data, PRI datapri, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			pdqid		対象優先度データキューのID番号
	intptr_t	data		送信データ
	PRI			datapri		送信データの優先度
	TMO			tmout		タイムアウト時間（tsnd_pdqの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（ipsnd_pdqを除く）
				　【NGKI1859】
				・タスクコンテキストからの呼出し（ipsnd_pdqの場合）【NGKI1860】
				・CPUロック状態からの呼出し【NGKI1861】
				・ディスパッチ保留状態からの呼出し（snd_pdqとtsnd_pdqの
				　場合）【NGKI1862】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（snd_pdqとtsnd_pdqの場合）【NGKI1863】
	E_ID		不正ID番号
				・pdqidが有効範囲外【NGKI1864】
	E_PAR		パラメータエラー
				・tmoutが無効（tsnd_pdqの場合）【NGKI1865】
				・その他の条件については機能の項を参照
	E_NOEXS		オブジェクト未登録
				・対象優先度データキューが未登録〔D〕【NGKI1866】
	E_OACV		オブジェクトアクセス違反
				・対象優先度データキューに対する通常操作1が許可されてい
				　ない（ipsnd_pdqを除く）〔P〕【NGKI1867】
	E_TMOUT		ポーリング失敗またはタイムアウト（snd_pdqを除く）【NGKI1868】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（snd_pdqとtsnd_pdq
				の場合）【NGKI1869】
	E_DLT		待ちオブジェクトの削除または再初期化（snd_pdqとtsnd_pdq
				の場合）【NGKI1870】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）に，dataで指
定したデータを，datapriで指定した優先度で送信する．具体的な振舞いは以下
の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの受信待ち行列にタスクが存在する場合には，受信待
ち行列の先頭のタスクが，dataで指定したデータを受信し，待ち解除される
【NGKI1871】．待ち解除されたタスクには，待ち状態となったサービスコール
からE_OKが返る【NGKI1872】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの受信待ち行列にタスクが存在せず，優先度データ
キュー管理領域にデータを格納するスペースがある場合には，dataで指定した
データが，datapriで指定したデータの優先度順で優先度データキュー管理領域
に格納される【NGKI1873】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの受信待ち行列にタスクが存在せず，優先度データ
キュー管理領域にデータを格納するスペースがない場合には，自タスクは優先
度データキューへの送信待ち状態となり，対象優先度データキューの送信待ち
行列につながれる【NGKI1874】．</p>
</div>
<div class="paragraph">
<p>datapriは，TMIN_DPRI以上で，対象データキューに送信できるデータ優先度の
最大値以下でなければならない．そうでない場合には，E_PARエラーとなる
【NGKI1876】．</p>
</div>
<div id="API_rcv_pdq" class="listingblock">
<div class="content">
<pre>rcv_pdq		優先度データキューからの受信〔T〕【NGKI1877】
prcv_pdq	優先度データキューからの受信（ポーリング）〔T〕【NGKI1878】
trcv_pdq	優先度データキューからの受信（タイムアウト付き）〔T〕【NGKI1879】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = rcv_pdq(ID pdqid, intptr_t *p_data, PRI *p_datapri)
	ER ercd = prcv_pdq(ID pdqid, intptr_t *p_data, PRI *p_datapri)
	ER ercd = trcv_pdq(ID pdqid, intptr_t *p_data, PRI *p_datapri, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			pdqid		対象優先度データキューのID番号
	intptr_t *	p_data		受信データを入れるメモリ領域へのポインタ
	PRI *		p_datapri	受信データの優先度を入れるメモリ領域へのポ
							インタ
	TMO			tmout		タイムアウト時間（trcv_pdqの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	intptr_t	data		受信データ
	PRI			datapri		受信データの優先度</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1880】
				・CPUロック状態からの呼出し【NGKI1881】
				・ディスパッチ保留状態からの呼出し（prcv_pdqを除く）【NGKI1882】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（prcv_pdqを除く）【NGKI1883】
	E_ID		不正ID番号
				・pdqidが有効範囲外【NGKI1884】
	E_PAR		パラメータエラー
				・tmoutが無効（trcv_pdqの場合）【NGKI1885】
	E_NOEXS		オブジェクト未登録
				・対象優先度データキューが未登録〔D〕【NGKI1886】
	E_OACV		オブジェクトアクセス違反
				・対象優先度データキューに対する通常操作2が許可されてい
				　ない〔P〕【NGKI1887】
	E_MACV		メモリアクセス違反
				・p_dataが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1888】
				・p_datapriが指すメモリ領域への書込みアクセスが許可され
				　ていない〔P〕【NGKI1889】
	E_TMOUT		ポーリング失敗またはタイムアウト（rcv_pdqを除く）【NGKI1890】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（prcv_pdqを除く）
				【NGKI1891】
	E_DLT		待ちオブジェクトの削除または再初期化（prcv_pdqを除く）
				【NGKI1892】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）からデータを
受信する．データの受信に成功した場合，受信したデータはp_dataが指すメモ
リ領域に，その優先度はp_datapriが指すメモリ領域に返される【NGKI1894】．
具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの優先度データキュー管理領域にデータが格納されて
いる場合には，優先度データキュー管理領域の先頭に格納されたデータを受信
する【NGKI1893】．また，送信待ち行列にタスクが存在する場合には，送信待
ち行列の先頭のタスクの送信データが，データの優先度順で優先度データキュー
管理領域に格納され，そのタスクは待ち解除される【NGKI1895】．待ち解除さ
れたタスクには，待ち状態となったサービスコールからE_OKが返る
【NGKI1896】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの優先度データキュー管理領域にデータが格納されて
おらず，送信待ち行列にタスクが存在する場合には，送信待ち行列の先頭のタ
スクの送信データを受信する【NGKI1897】．送信待ち行列の先頭のタスクは，
待ち解除される【NGKI1899】．待ち解除されたタスクには，待ち状態となった
サービスコールからE_OKが返る【NGKI1900】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの優先度データキュー管理領域にデータが格納されて
おらず，送信待ち行列にタスクが存在しない場合には，自タスクは優先度デー
タキューからの受信待ち状態となり，対象優先度データキューの受信待ち行列
につながれる【NGKI1901】．</p>
</div>
<div id="API_ini_pdq" class="listingblock">
<div class="content">
<pre>ini_pdq		優先度データキューの再初期化〔T〕【NGKI1902】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ini_pdq(ID pdqid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			pdqid		対象優先度データキューのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1903】
				・CPUロック状態からの呼出し【NGKI1904】
	E_ID		不正ID番号
				・pdqidが有効範囲外【NGKI1905】
	E_NOEXS		オブジェクト未登録
				・対象優先度データキューが未登録〔D〕【NGKI1906】
	E_OACV		オブジェクトアクセス違反
				・対象優先度データキューに対する管理操作が許可されてい
				　ない〔P〕【NGKI1907】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）を再初期化す
る．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの優先度データキュー管理領域は，格納されているデー
タがない状態に初期化される【NGKI1908】．また，対象優先度データキューの
送信待ち行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先
頭のタスクから順に待ち解除される【NGKI1909】．待ち解除されたタスクには，
待ち状態となったサービスコールからE_DLTエラーが返る【NGKI1910】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，
別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がな
い．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ini_pdqにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>優先度データキューを再初期化した場合に，アプリケーションとの整合性を保
つのは，アプリケーションの責任である．</p>
</div>
<div id="API_ref_pdq" class="listingblock">
<div class="content">
<pre>ref_pdq		優先度データキューの状態参照〔T〕【NGKI1911】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_pdq(ID pdqid, T_RPDQ *pk_rpdq)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			pdqid		対象優先度データキューのID番号
	T_RPDQ *	pk_rpdq		優先度データキューの現在状態を入れるパケッ
							トへのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊優先度データキューの現在状態（パケットの内容）
	ID			stskid		優先度データキューの送信待ち行列の先頭のタ
							スクのID番号
	ID			rtskid		優先度データキューの受信待ち行列の先頭のタ
							スクのID番号
	uint_t		spdqcnt		優先度データキュー管理領域に格納されている
							データの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1912】
				・CPUロック状態からの呼出し【NGKI1913】
	E_ID		不正ID番号
				・pdqidが有効範囲外【NGKI1914】
	E_NOEXS		オブジェクト未登録
				・対象優先度データキューが未登録〔D〕【NGKI1915】
	E_OACV		オブジェクトアクセス違反
				・対象優先度データキューに対する参照操作が許可されてい
				　ない〔P〕【NGKI1916】
	E_MACV		メモリアクセス違反
				・pk_rpdqが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI1917】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>pdqidで指定した優先度データキュー（対象優先度データキュー）の現在状態を
参照する．参照した現在状態は，pk_rpdqで指定したパケットに返される
【NGKI1918】．</p>
</div>
<div class="paragraph">
<p>対象優先度データキューの送信待ち行列にタスクが存在しない場合，stskidに
はTSK_NONE（＝0）が返る【NGKI1919】．また，受信待ち行列にタスクが存在し
ない場合，rtskidにはTSK_NONE（＝0）が返る【NGKI1920】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_pdqはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_pdqを呼び出し，対象優先度データキューの現在状態を参照
した直後に割込みが発生した場合，ref_pdqから戻ってきた時には対象優先度デー
タキューの状態が変化している可能性があるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_メールボックス">4.4.5. メールボックス</h4>
<div class="paragraph">
<p>メールボックスは，共有メモリ上に置いたメッセージを，FIFO順またはメッセー
ジの優先度順で送受信するための同期・通信オブジェクトである．メールボッ
クスは，メールボックスIDと呼ぶID番号によって識別する【NGKI1921】．</p>
</div>
<div class="paragraph">
<p>各メールボックスが持つ情報は次の通り【NGKI1922】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メールボックス属性</p>
</li>
<li>
<p>メッセージキュー</p>
</li>
<li>
<p>待ち行列（メールボックスからの受信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>送信できるメッセージ優先度の最大値</p>
</li>
<li>
<p>優先度別のメッセージキューヘッダ領域</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メッセージキューは，メールボックスに送信されたメッセージを，FIFO順また
はメッセージの優先度順につないでおくためのキューである．</p>
</div>
<div class="paragraph">
<p>待ち行列は，メールボックスからメッセージが受信できるまで待っている状態
（メールボックスからの受信待ち状態）のタスクが，メッセージを受信できる
順序でつながれているキューである．</p>
</div>
<div class="paragraph">
<p>メールボックス属性には，次の属性を指定することができる【NGKI1923】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI		0x01U	待ち行列をタスクの優先度順にする
TA_MPRI		0x02U	メッセージキューをメッセージの優先度順にする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，待ち行列はFIFO順になる【NGKI1924】．TA_MPRIを
指定しない場合，メッセージキューはFIFO順になる【NGKI1925】．</p>
</div>
<div class="paragraph">
<p>優先度別のメッセージキューヘッダ領域は，TA_MPRI属性のメールボックスに対
して，メッセージキューを優先度別に設ける場合に使用する領域である．</p>
</div>
<div class="paragraph">
<p>カーネルは，メールボックスに送信されたメッセージをメッセージキューにつ
なぐために，メッセージの先頭のメモリ領域を使用する【NGKI1926】．そのた
めアプリケーションは，メールボックスに送信するメッセージの先頭に，カー
ネルが利用するためのメッセージヘッダを置かなければならない【NGKI1927】．
メッセージヘッダのデータ型として，メールボックス属性にTA_MPRIが指定され
ているか否かにより，以下のいずれかを用いる【NGKI1928】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>T_MSG			TA_MPRI属性でないメールボックス用のメッセージヘッダ
T_MSG_PRI		TA_MPRI属性のメールボックス用のメッセージヘッダ</pre>
</div>
</div>
<div class="paragraph">
<p>メッセージヘッダの領域は，メッセージがメッセージキューにつながれている
間（すなわち，メールボックスに送信してから受信するまでの間），カーネル
によって使用される【NGKI1929】．そのため，メッセージキューにつながれて
いるメッセージのメッセージヘッダの領域をアプリケーションが書き換えた場
合や，メッセージキューにつながれているメッセージを再度メールボックスに
送信した場合の動作は保証されない【NGKI1930】．</p>
</div>
<div class="paragraph">
<p>TA_MPRI属性のメールボックスにメッセージを送信する場合，アプリケーション
は，メッセージの優先度を，T_MSG_PRI型のメッセージヘッダ中のmsgpriフィー
ルドに設定する【NGKI1931】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，メールボックス機能はサポートしない【NGKI1932】．</p>
</div>
<div class="paragraph">
<p>メールボックス機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_MPRI		メッセージ優先度の最小値（＝1）	【NGKI1933】
TMAX_MPRI		メッセージ優先度の最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_MBXID		登録できるメールボックスの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたメールボックスの
				数に一致）【NGKI1934】</pre>
</div>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>TOPPERS新世代カーネルの現時点の実装では，優先度別のメッセージキューヘッ
ダ領域は用いていない．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>メールボックス機能は，μITRON4.0仕様との互換性のために残した機能であり，
保護機能対応カーネルではサポートしないため，使用することは推奨しない．
メールボックス機能は，ほとんどの場合に，データキュー機能または優先度デー
タキュー機能を用いて，メッセージを置いたメモリ領域へのポインタを送受信
する方法で置き換えることができる．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，メールボックス機能をサポートする【ASPS0147】．メッセー
ジ優先度の最大値（TMAX_MPRI）は16に固定されている【ASPS0148】．ただし，
タスク優先度拡張パッケージでは，TMAX_MPRIを256に拡張する【ASPS0149】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，メールボックス機能をサポートする【FMPS0130】．メッセー
ジ優先度の最大値（TMAX_MPRI）は16に固定されている【FMPS0131】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，メールボックス機能をサポートしない【HRPS0130】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TNUM_MBXIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_MBX" class="listingblock">
<div class="content">
<pre>CRE_MBX		メールボックスの生成〔Sp〕【NGKI1935】
acre_mbx	メールボックスの生成〔TpD〕【NGKI1936】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_MBX(ID mbxid, { ATR mbxatr, PRI maxmpri, void *mprihd })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID mbxid = acre_mbx(const T_CMBX *pk_cmbx)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbxid		生成するメールボックスのID番号（CRE_MBXの場
							合）
	T_CMBX *	pk_cmbx		メールボックスの生成情報を入れたパケットへ
							のポインタ（静的APIを除く）

　＊メールボックスの生成情報（パケットの内容）
	ATR			mbxatr		メールボックス属性
	PRI			maxmpri		優先度メールボックスに送信できるメッセージ
							優先度の最大値
	void *		mprihd		優先度別のメッセージキューヘッダ領域の先頭
							番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		mbxid		生成されたメールボックスのID番号（正の値）
							またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI1937】
				・CPUロック状態からの呼出し〔s〕【NGKI1938】
	E_RSATR		予約属性
				・mbxatrが無効【NGKI1939】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI1940】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI1941】
	E_NOSPT		未サポート機能
				・条件については各カーネルにおける規定の項を参照
	E_PAR		パラメータエラー
				・maxmpriがTMIN_MPRIより小さい，またはTMAX_MPRIより大き
				　い【NGKI1951】
	E_NOID		ID番号不足
				・割り付けられるメールボックスIDがない〔sD〕【NGKI1942】
	E_NOMEM		メモリ不足
				・優先度別のメッセージキューヘッダ領域が確保できない
				　【NGKI1943】
	E_OBJ		オブジェクト状態エラー
				・mbxidで指定したメールボックスが登録済み（CRE_MBXの場
				　合）【NGKI1944】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したメールボックス生成情報に従って，メールボックスを
生成する．メッセージキューはつながれているメッセージがない状態に初期化
され，mprihdとmaxmpriから優先度別のメッセージキューヘッダ領域が設定され
る【NGKI1945】．また，待ち行列は空の状態に初期化される【NGKI1946】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mbxidはオブジェクト識別名，mbxatrとmaxmpriは整数定数
式パラメータ，mprihdは一般定数式パラメータである【NGKI1947】．コンフィ
ギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができ
ない【NGKI1948】．</p>
</div>
<div class="paragraph">
<p>mprihdをNULLとした場合，maxmpriの指定に合致したサイズの優先度別のメッセー
ジキューヘッダ領域が，コンフィギュレータまたはカーネルにより確保される
【NGKI1949】．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>mprihdにNULL以外を指定した場合の扱いについては，この仕様では規定してい
ない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_MBXのみをサポートする【ASPS0150】．また，優先度別
のメッセージキューヘッダ領域は使用しておらず，mprihdにはNULLのみを指定
することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる
【ASPS0152】．ただし，動的生成機能拡張パッケージでは，acre_mbxもサポー
トする【ASPS0153】．acre_mbxに対しても，mprihdにはNULLのみを指定するこ
とができる【ASPS0154】．優先度別のメッセージキューヘッダ領域を使用しな
いため，E_NOMEMが返ることはない【ASPS0155】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_MBXのみをサポートする【FMPS0132】．また，優先度別
のメッセージキューヘッダ領域は使用しておらず，mprihdにはNULLのみを指定
することができる．NULL以外を指定した場合には，E_NOSPTエラーとなる
【FMPS0134】．優先度別のメッセージキューヘッダ領域を使用しないため，
E_NOMEMが返ることはない【FMPS0135】．</p>
</div>
<div id="API_AID_MBX" class="listingblock">
<div class="content">
<pre>AID_MBX		割付け可能なメールボックスIDの数の指定〔SpD〕【NGKI1952】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_MBX(uint_t nombx)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nombx		割付け可能なメールボックスIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・クラスの囲みの中に記述されていない〔M〕【NGKI1953】
	E_PAR		パラメータエラー
				・nombxが負の値【NGKI3281】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nombxで指定した数のメールボックスIDを，メールボックスを生成するサービス
コールによって割付け可能なメールボックスIDとして確保する【NGKI1954】．</p>
</div>
<div class="paragraph">
<p>nombxは整数定数式パラメータである【NGKI1955】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_MBXをサポートする
【ASPS0215】．</p>
</div>
<div id="API_del_mbx" class="listingblock">
<div class="content">
<pre>del_mbx		メールボックスの削除〔TpD〕【NGKI1956】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_mbx(ID mbxid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbxid		対象メールボックスのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1957】
				・CPUロック状態からの呼出し【NGKI1958】
	E_ID		不正ID番号
				・mbxidが有効範囲外【NGKI1959】
	E_NOEXS		オブジェクト未登録
				・対象メールボックスが未登録【NGKI1960】
	E_OBJ		オブジェクト状態エラー
				・対象メールボックスは静的APIで生成された【NGKI1961】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbxidで指定したメールボックス（対象メールボックス）を削除する．具体的な
振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メールボックスの登録が解除され，そのメールボックスIDが未使用の状態
に戻される【NGKI1962】．また，対象メールボックスの待ち行列につながれた
タスクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI1963】．待
ち解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが
返る【NGKI1964】．</p>
</div>
<div class="paragraph">
<p>メールボックスの生成時に，優先度別のメッセージキューヘッダ領域がカーネ
ルによって確保された場合は，そのメモリ領域が解放される【NGKI1965】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>del_mbxにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_mbxをサポートしない【ASPS0156】．ただし，動的生成
機能拡張パッケージでは，del_mbxをサポートする【ASPS0157】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_mbxをサポートしない【FMPS0136】．</p>
</div>
<div id="API_snd_mbx" class="listingblock">
<div class="content">
<pre>snd_mbx		メールボックスへの送信〔Tp〕【NGKI1966】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = snd_mbx(ID mbxid, T_MSG *pk_msg)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbxid		対象メールボックスのID番号
	T_MSG		*pk_msg		送信メッセージの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1967】
				・CPUロック状態からの呼出し【NGKI1968】
	E_ID		不正ID番号
				・mbxidが有効範囲外【NGKI1969】
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_NOEXS		オブジェクト未登録
				・対象メールボックスが未登録〔D〕【NGKI1970】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbxidで指定したメールボックス（対象メールボックス）に，pk_msgで指定した
メッセージを送信する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メールボックスの待ち行列にタスクが存在する場合には，待ち行列の先頭
のタスクが，pk_msgで指定したメッセージを受信し，待ち解除される
【NGKI1971】．待ち解除されたタスクには，待ち状態となったサービスコール
からE_OKが返る【NGKI1972】．</p>
</div>
<div class="paragraph">
<p>対象メールボックスの待ち行列にタスクが存在しない場合には，pk_msgで指定
したメッセージが，メールボックス属性のTA_MPRI指定の有無によって指定され
る順序で，メッセージキューにつながれる【NGKI1973】．</p>
</div>
<div class="paragraph">
<p>対象メールボックスがTA_MPRI属性である場合には，pk_msgで指定したメッセー
ジの先頭のメッセージヘッダ中のmsgpriフィールドの値が，TMIN_MPRI以上で，
対象メールボックスに送信できるメッセージ優先度の最大値以下でなければな
らない．そうでない場合には，E_PARエラーとなる【NGKI1975】．</p>
</div>
<div id="API_rcv_mbx" class="listingblock">
<div class="content">
<pre>rcv_mbx		メールボックスからの受信〔Tp〕【NGKI1976】
prcv_mbx	メールボックスからの受信（ポーリング）〔Tp〕【NGKI1977】
trcv_mbx	メールボックスからの受信（タイムアウト付き）〔Tp〕【NGKI1978】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = rcv_mbx(ID mbxid, T_MSG **ppk_msg)
	ER ercd = prcv_mbx(ID mbxid, T_MSG **ppk_msg)
	ER ercd = trcv_mbx(ID mbxid, T_MSG **ppk_msg, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbxid		対象メールボックスのID番号
	T_MSG **	ppk_msg		受信メッセージの先頭番地を入れるメモリ領域
							へのポインタ
	TMO			tmout		タイムアウト時間（trcv_mbxの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	T_MSG *		ppk_msg		受信メッセージの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1979】
				・CPUロック状態からの呼出し【NGKI1980】
				・ディスパッチ保留状態からの呼出し（prcv_mbxを除く）【NGKI1981】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（prcv_mbxを除く）【NGKI1982】
	E_ID		不正ID番号
				・mbxidが有効範囲外【NGKI1983】
	E_PAR		パラメータエラー
				・tmoutが無効（trcv_mbxの場合）【NGKI1984】
	E_NOEXS		オブジェクト未登録
				・対象メールボックスが未登録〔D〕【NGKI1985】
	E_TMOUT		ポーリング失敗またはタイムアウト（rcv_mbxを除く）【NGKI1986】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（prcv_mbxを除く）
				【NGKI1987】
	E_DLT		待ちオブジェクトの削除または再初期化（prcv_mbxを除く）
				【NGKI1988】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbxidで指定したメールボックス（対象メールボックス）からメッセージを受信
する．受信したメッセージの先頭番地は，ppk_msgで指定したメモリ領域に返さ
れる．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メールボックスのメッセージキューにメッセージがつながれている場合に
は，メッセージキューの先頭につながれたメッセージが取り出され，ppk_msgで
指定したメモリ領域に返される【NGKI1989】．</p>
</div>
<div class="paragraph">
<p>対象メールボックスのメッセージキューにメッセージがつながれていない場合
には，自タスクはメールボックスからの受信待ち状態となり，対象メールボッ
クスの待ち行列につながれる【NGKI1990】．</p>
</div>
<div id="API_ini_mbx" class="listingblock">
<div class="content">
<pre>ini_mbx		メールボックスの再初期化〔Tp〕【NGKI1991】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ini_mbx(ID mbxid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbxid		対象メールボックスのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI1992】
				・CPUロック状態からの呼出し【NGKI1993】
	E_ID		不正ID番号
				・mbxidが有効範囲外【NGKI1994】
	E_NOEXS		オブジェクト未登録
				・対象メールボックスが未登録〔D〕【NGKI1995】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbxidで指定したメールボックス（対象メールボックス）を再初期化する．具体
的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メールボックスのメールボックス管理領域は，メッセージキューはつなが
れているメッセージがない状態に初期化される【NGKI1996】．また，対象メー
ルボックスの待ち行列につながれたタスクは，待ち行列の先頭のタスクから順
に待ち解除される【NGKI1997】．待ち解除されたタスクには，待ち状態となっ
たサービスコールからE_DLTエラーが返る【NGKI1998】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ini_mbxにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>メールボックスを再初期化した場合に，アプリケーションとの整合性を保つのは，
アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_mbx" class="listingblock">
<div class="content">
<pre>ref_mbx		メールボックスの状態参照〔Tp〕【NGKI1999】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_mbx(ID mbxid, T_RMBX *pk_rmbx)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbxid		対象メールボックスのID番号
	T_RMBX *	pk_rmbx		メールボックスの現在状態を入れるパケットへ
							のポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊メールボックスの現在状態（パケットの内容）
	ID			wtskid		メールボックスの待ち行列の先頭のタスクのID
							番号
	T_MSG *		pk_msg		メッセージキューの先頭につながれたメッセー
							ジの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2000】
				・CPUロック状態からの呼出し【NGKI2001】
	E_ID		不正ID番号
				・mbxidが有効範囲外【NGKI2002】
	E_NOEXS		オブジェクト未登録
				・対象メールボックスが未登録〔D〕【NGKI2003】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbxidで指定したメールボックス（対象メールボックス）の現在状態を参照する．
参照した現在状態は，pk_rmbxで指定したパケットに返される【NGKI2004】．</p>
</div>
<div class="paragraph">
<p>対象メールボックスの待ち行列にタスクが存在しない場合，wtskidには
TSK_NONE（＝0）が返る【NGKI2005】．また，メッセージキューにメッセージが
つながれていない場合，pk_msgにはNULLが返る【NGKI2006】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_mbxはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_mbxを呼び出し，対象メールボックスの現在状態を参照した
直後に割込みが発生した場合，ref_mbxから戻ってきた時には対象メールボック
スの状態が変化している可能性があるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_ミューテックス">4.4.6. ミューテックス</h4>
<div class="paragraph">
<p>ミューテックスは，タスク間の排他制御を行うための同期・通信オブジェクト
である．タスクは，排他制御区間に入る時にミューテックスをロックし，排他
制御区間を出る時にロック解除する．ミューテックスは，ミューテックスIDと
呼ぶID番号によって識別する【NGKI2007】．</p>
</div>
<div class="paragraph">
<p>ミューテックスは，排他制御に伴う優先度逆転の時間を最小限に抑えるための
優先度上限プロトコル（priority ceiling protocol）をサポートする．ミュー
テックス属性により優先度上限ミューテックスであると指定することで，その
ミューテックスの操作時に，優先度上限プロトコルに従った現在優先度の制御
が行われる．</p>
</div>
<div class="paragraph">
<p>各ミューテックスが持つ情報は次の通り【NGKI2008】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ミューテックス属性</p>
</li>
<li>
<p>ロック状態（ロックされている状態とロック解除されている状態）</p>
</li>
<li>
<p>ミューテックスをロックしているタスク</p>
</li>
<li>
<p>待ち行列（ミューテックスのロック待ち状態のタスクのキュー）</p>
</li>
<li>
<p>上限優先度（優先度上限ミューテックスの場合）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>待ち行列は，ミューテックスをロックできるまで待っている状態（ミューテッ
クスのロック待ち状態）のタスクが，ミューテックスをロックできる順序でつ
ながれているキューである．</p>
</div>
<div class="paragraph">
<p>上限優先度は，優先度上限ミューテックスに対してのみ有効で，ミューテック
スの生成時に，そのミューテックスをロックする可能性のあるタスクのベース
優先度の中で最も高い優先度（または，それより高い優先度）に設定する
【NGKI2009】．</p>
</div>
<div class="paragraph">
<p>ミューテックス属性には，次の属性を指定することができる【NGKI2010】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI		0x01U	待ち行列をタスクの優先度順にする
TA_CEILING	0x03U	優先度上限ミューテックスとする．待ち行列をタス
					クの優先度順にする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_TPRI，TA_CEILINGのいずれも指定しない場合，待ち行列はFIFO順になる
【NGKI2011】．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能に関連して，各タスクが持つ情報は次の通り【NGKI2012】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ロックしているミューテックスのリスト</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ロックしているミューテックスのリストは，タスクの起動時に空に初期化され
る【NGKI2013】．</p>
</div>
<div class="paragraph">
<p>タスクの現在優先度は，そのタスクのベース優先度と，そのタスクがロックし
ている優先度上限ミューテックスの優先度上限の中で，最も高い優先度に設定
される【NGKI2014】．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能によりタスクの現在優先度が変化する場合には，次の処理
が行われる．現在優先度を変化させるサービスコールの前後とも，当該タスク
が実行できる状態である場合には，同じ優先度のタスクの中で最高優先順位と
なる【NGKI2015】．そのサービスコールにより，当該タスクが実行できる状態
に遷移する場合には，同じ優先度のタスクの中で最低優先順位となる
【NGKI2016】．そのサービスコールの後で，当該タスクが待ち状態で，タスク
の優先度順の待ち行列につながれている場合には，当該タスクの変更後の現在
優先度に従って，その待ち行列中での順序が変更される【NGKI2017】．待ち行
列中に同じ現在優先度のタスクがある場合には，当該タスクの順序はそれらの
中で最後になる【NGKI2018】．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能に関連して，タスクの終了時に行うべき処理として，タス
クがロックしているミューテックスのロック解除がある．タスクの終了時にロッ
クしているミューテックスが残っている場合，それらのミューテックスは，ロッ
クしたのと逆の順序でロック解除される【NGKI2019】．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_MTXID		登録できるミューテックスの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたミューテックスの
				数に一致）【NGKI2020】</pre>
</div>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>優先度上限プロトコルには，(a) 優先度の低いタスクの排他制御区間に最大1回
しかブロックされない，(b) タスクの実行が開始された以降は優先度の低いタ
スクにブロックされないという利点があるが，これは，タスク間の同期に優先
度上限ミューテックスのみを用い，他の方法でタスクのスケジューリングに関
与しない場合に得られる利点である．</p>
</div>
<div class="paragraph">
<p>これらの利点を得るためには，タスクの優先順位の回転やディスパッチの禁止
を行ってはならないことに加えて，優先度上限ミューテックスをロックしたタ
スクを待ち状態にしてはならない．特に，優先度上限ミューテックスに対して，
タスクがロック待ち状態になる状況に注意が必要である（優先度上限プロトコ
ルでは，タスクがミューテックスのロック待ち状態になることはない）．</p>
</div>
<div class="paragraph">
<p>例えば，着目するタスクAと，タスクAよりベース優先度の低いタスクBとタスク
C，タスクAよりも高い上限優先度を持った優先度上限ミューテックスがある場
合を考える．タスクAがミューテックスをロックし，タスクBとタスクCがミュー
テックスを待っている状況で，タスクAがミューテックスをロック解除すると，
タスクBがミューテックスをロックして優先度が上がり，タスクBに切り換わる．
さらにタスクBがミューテックスをロック解除すると，タスクCがミューテック
スをロックして優先度が上がり，タスクCに切り換わる．タスクAが実行される
のは，タスクCがミューテックスをロック解除した後である．この例では，タス
クAが実行開始後に，タスクBとタスクCの排他制御区間にブロックされることに
なる．</p>
</div>
<div class="paragraph">
<p>優先度上限ミューテックスに対してタスクがロック待ち状態になる状況を回避
するためには，優先度上限ミューテックスをロックする場合に，待ち状態にな
らないploc_mtxを用いるのが安全である．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>この仕様で優先度上限プロトコルと呼んでいる方式は，オリジナルのpriority
ceiling protocolとは異なるものである．この仕様の方式は，OSEK/VDX OS仕様
でもpriority ceiling protocolと呼ばれているが，学術論文や他のOSでは，
immediate ceiling priority protocol，priority protection protocol，
priority ceiling emulation，highest locker protocolなどと呼ばれている．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ミューテックス機能をサポートしない【ASPS0158】．ただし，
ミューテックス機能拡張パッケージを用いると，ミューテックス機能を追加す
ることができる【ASPS0159】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ミューテックス機能をサポートしない【FMPS0137】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ミューテックス機能をサポートする【HRPS0131】．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサにおいては，タスク間の同期に優先度上限ミューテックスの
みを用い，他の方法でタスクのスケジューリングに関与しない場合でも，優先
度上限ミューテックスに対してタスクがロック待ち状態になる．マルチプロセッ
サ対応カーネルにおける優先度上限ミューテックスの扱いについては，今後の
課題である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様の厳密な優先度制御規則を採用し，簡略化した優先度制御規則
はサポートしていない．また，μITRON4.0仕様でサポートしている優先度継承
プロトコル（priority inheritance protocol）は，現時点ではサポートしてい
ない．</p>
</div>
<div class="paragraph">
<p>ミューテックス機能によりタスクの現在優先度が変化する場合の振舞いは，
μITRON4.0仕様では実装依存となっているが，この仕様では規定している．</p>
</div>
<div class="paragraph">
<p>TNUM_MTXIDは，μITRON4.0仕様に規定されていないカーネル構成マクロであ
る．</p>
</div>
<div id="API_CRE_MTX" class="listingblock">
<div class="content">
<pre>CRE_MTX		ミューテックスの生成〔S〕【NGKI2021】
acre_mtx	ミューテックスの生成〔TD〕【NGKI2022】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_MTX(ID mtxid, { ATR mtxatr, PRI ceilpri })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID mtxid = acre_mtx(const T_CMTX *pk_cmtx)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mtxid		生成するミューテックスのID番号（CRE_MTXの
							場合）
	T_CMTX *	pk_cmtx		ミューテックスの生成情報を入れたパケット
							へのポインタ（静的APIを除く）

　＊ミューテックスの生成情報（パケットの内容）
	ATR			mtxatr		ミューテックス属性
	PRI			ceilpri		ミューテックスの上限優先度</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		mtxid		生成されたミューテックスのID番号（正の値）
							またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2023】
				・CPUロック状態からの呼出し〔s〕【NGKI2024】
	E_RSATR		予約属性
				・mtxatrが無効【NGKI2025】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI2026】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI2027】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI2028】
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2029】
	E_MACV		メモリアクセス違反
				・pk_cmtxが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2030】
	E_NOID		ID番号不足
				・割り付けられるミューテックスIDがない〔sD〕【NGKI2031】
	E_OBJ		オブジェクト状態エラー
				・mtxidで指定したセマフォが登録済み（CRE_MTXの場合）【NGKI2032】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したミューテックス生成情報に従って，ミューテックスを
生成する．生成されたミューテックスのロック状態はロックされていない状態
に，待ち行列は空の状態に初期化される【NGKI2033】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mtxidはオブジェクト識別名，mtxatrとceilpriは整数定数
式パラメータである【NGKI2034】．優先度上限ミューテックス以外の場合には，
ceilpriの指定を省略することができる【NGKI2035】．</p>
</div>
<div class="paragraph">
<p>優先度上限ミューテックスを生成する場合，ceilpriは，TMIN_TPRI以上，
TMAX_TPRI以下でなければならない．そうでない場合には，E_PARエラーとなる
【NGKI2037】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルのミューテックス機能拡張パッケージでは，CRE_MTXのみをサポー
トする【ASPS0160】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_MTXのみをサポートする【HRPS0132】．ただし，動的生
成機能拡張パッケージでは，acre_mtxもサポートする【HRPS0194】．</p>
</div>
<div id="API_AID_MTX" class="listingblock">
<div class="content">
<pre>AID_MTX		割付け可能なミューテックスIDの数の指定〔SD〕【NGKI2038】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_MTX(uint_t nomtx)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nomtx		割付け可能なミューテックスIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3433】
				・クラスの囲みの中に記述されていない〔M〕【NGKI2039】
	E_PAR		パラメータエラー
				・nomtxが負の値【NGKI3282】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nomtxで指定した数のミューテックスIDを，ミューテックスを生成するサービス
コールによって割付け可能なミューテックスIDとして確保する【NGKI2040】．</p>
</div>
<div class="paragraph">
<p>nomtxは整数定数式パラメータである【NGKI2041】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_MTXをサポートする
【HRPS0216】．</p>
</div>
<div id="API_SAC_MTX" class="listingblock">
<div class="content">
<pre>SAC_MTX		ミューテックスのアクセス許可ベクタの設定〔SP〕【NGKI2042】
sac_mtx		ミューテックスのアクセス許可ベクタの設定〔TPD〕【NGKI2043】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_MTX(ID mtxid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_mtx(ID mtxid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mtxid		対象ミューテックスのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2044】
				・CPUロック状態からの呼出し〔s〕【NGKI2045】
	E_ID		不正ID番号
				・mtxidが有効範囲外〔s〕【NGKI2046】
	E_RSATR		予約属性
				・対象ミューテックスが属する保護ドメインの囲みの中（対
				　象ミューテックスが無所属の場合は，保護ドメインの囲み
				　の外）に記述されていない〔S〕【NGKI2047】
				・対象ミューテックスが属するクラスの囲みの中に記述され
				　ていない〔SM〕【NGKI2048】
	E_NOEXS		オブジェクト未登録
				・対象ミューテックスが未登録【NGKI2049】
	E_OACV		オブジェクトアクセス違反
				・対象ミューテックスに対する管理操作が許可されていない〔s〕
				　【NGKI2050】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI2051】
	E_OBJ		オブジェクト状態エラー
				・対象ミューテックスは静的APIで生成された〔s〕【NGKI2052】
				・対象ミューテックスに対してアクセス許可ベクタが設定済
				　み〔S〕【NGKI2053】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mtxidで指定したミューテックス（対象ミューテックス）のアクセス許可ベクタ
（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する
【NGKI2054】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mtxidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI2055】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_MTXのみをサポートする【HRPS0133】．ただし，動的生
成機能拡張パッケージでは，sac_mtxもサポートする【HRPS0195】．</p>
</div>
<div id="API_del_mtx" class="listingblock">
<div class="content">
<pre>del_mtx		ミューテックスの削除〔TD〕【NGKI2056】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_mtx(ID mtxid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mtxid		対象ミューテックスのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2057】
				・CPUロック状態からの呼出し【NGKI2058】
	E_ID		不正ID番号
				・mtxidが有効範囲外【NGKI2059】
	E_NOEXS		オブジェクト未登録
				・対象ミューテックスが未登録【NGKI2060】
	E_OACV		オブジェクトアクセス違反
				・対象ミューテックスに対する管理操作が許可されていない〔P〕
				　【NGKI2061】
	E_OBJ		オブジェクト状態エラー
				・対象ミューテックスは静的APIで生成された【NGKI2062】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mtxidで指定したミューテックス（対象ミューテックス）を削除する．具体的な
振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスの登録が解除され，そのミューテックスIDが未使用の状態
に戻される【NGKI2063】．対象ミューテックスをロックしているタスクがある
場合には，そのタスクがロックしているミューテックスのリストから対象ミュー
テックスが削除され，必要な場合にはそのタスクの現在優先度が変更される
【NGKI2064】．また，対象ミューテックスの待ち行列につながれたタスクは，
待ち行列の先頭のタスクから順に待ち解除される【NGKI2065】．待ち解除され
たタスクには，待ち状態となったサービスコールからE_DLTエラーが返る
【NGKI2066】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>対象ミューテックスをロックしているタスクには，ミューテックスが削除され
たことが通知されず，そのミューテックスをロック解除する時点でエラーとな
る．これが不都合な場合には，ミューテックスを削除しようとするタスクが
ミューテックスをロックした状態で，ミューテックスを削除すればよい．</p>
</div>
<div class="paragraph">
<p>del_mtxにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルのミューテックス機能拡張パッケージでは，del_mtxをサポートし
ない【ASPS0162】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_mtxをサポートしない【HRPS0134】．ただし，動的生成
機能拡張パッケージでは，del_mtxをサポートする【HRPS0196】．</p>
</div>
<div id="API_loc_mtx" class="listingblock">
<div class="content">
<pre>loc_mtx		ミューテックスのロック〔T〕【NGKI2067】
ploc_mtx	ミューテックスのロック（ポーリング）〔T〕【NGKI2068】
tloc_mtx	ミューテックスのロック（タイムアウト付き）〔T〕【NGKI2069】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = loc_mtx(ID mtxid)
	ER ercd = ploc_mtx(ID mtxid)
	ER ercd = tloc_mtx(ID mtxid, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mtxid		対象ミューテックスのID番号
	TMO			tmout		タイムアウト時間（tloc_mtxの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2070】
				・CPUロック状態からの呼出し【NGKI2071】
				・ディスパッチ保留状態からの呼出し（ploc_mtxを除く）【NGKI2072】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（ploc_mtxを除く）【NGKI2073】
	E_ID		不正ID番号
				・mtxidが有効範囲外【NGKI2074】
	E_PAR		パラメータエラー
				・tmoutが無効（tloc_mtxの場合）【NGKI2075】
	E_NOEXS		オブジェクト未登録
				・対象ミューテックスが未登録〔D〕【NGKI2076】
	E_OACV		オブジェクトアクセス違反
				・対象ミューテックスに対する通常操作1が許可されていない〔P〕
				　【NGKI2077】
	E_ILUSE		サービスコール不正使用
				・条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・対象ミューテックスが自タスクによってロックされている
				　【NGKI3609】
	E_TMOUT		ポーリング失敗またはタイムアウト（loc_mtxを除く）【NGKI2078】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（ploc_mtxを除く）
				【NGKI2079】
	E_DLT		待ちオブジェクトの削除または再初期化（ploc_mtxを除く）
				【NGKI2080】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mtxidで指定したミューテックス（対象ミューテックス）をロックする．具体的
な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスがロックされていない場合には，自タスクによってロック
されている状態になる【NGKI2081】．自タスクがロックしているミューテック
スのリストに対象ミューテックスが追加され，必要な場合には自タスクの現在
優先度が変更される【NGKI2082】．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスが自タスク以外のタスクによってロックされている場合に
は，自タスクはミューテックスのロック待ち状態となり，対象ミューテックス
の待ち行列につながれる【NGKI2083】．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスが優先度上限ミューテックスで，その上限優先度より自タ
スクのベース優先度が高い場合には，E_ILUSEエラーとなる【NGKI2085】．</p>
</div>
<div class="paragraph">
<p>【仕様変更の経緯】</p>
</div>
<div class="paragraph">
<p>この仕様のRelease 1.6以前では，対象ミューテックスが自タスクによってロッ
クされている場合には，E_ILUSEエラーとなることとしていたが，Release 1.7
以降でE_OBJエラーに変更した．これは，ミューテックスを用いて，リエントラ
ントロックを実現できるようにするためである．</p>
</div>
<div id="API_unl_mtx" class="listingblock">
<div class="content">
<pre>unl_mtx		ミューテックスのロック解除〔T〕【NGKI2086】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = unl_mtx(ID mtxid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mtxid		対象ミューテックスのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2087】
				・CPUロック状態からの呼出し【NGKI2088】
	E_ID		不正ID番号
				・mtxidが有効範囲外【NGKI2089】
	E_NOEXS		オブジェクト未登録
				・対象ミューテックスが未登録〔D〕【NGKI2090】
	E_OACV		オブジェクトアクセス違反
				・対象ミューテックスに対する通常操作1が許可されていない〔P〕
				　【NGKI3273】
	E_OBJ		オブジェクト状態エラー
				・対象ミューテックスが自タスクによってロックされていな
				　い【NGKI3610】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mtxidで指定したミューテックス（対象ミューテックス）をロック解除する．具
体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>まず，自タスクがロックしているミューテックスのリストから対象ミューテッ
クスが削除され，必要な場合には自タスクの現在優先度が変更される
【NGKI2091】．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスの待ち行列にタスクが存在する場合には，待ち行列の先頭
のタスクが待ち解除される【NGKI2092】．対象ミューテックスは，待ち解除さ
れたタスクによってロックされている状態になる【NGKI2093】．待ち解除され
たタスクがロックしているミューテックスのリストに対象ミューテックスが追
加され，必要な場合にはそのタスクの現在優先度が変更される【NGKI2094】．
待ち解除されたタスクには，待ち状態となったサービスコールからE_OKが返る
【NGKI2095】．</p>
</div>
<div class="paragraph">
<p>待ち行列にタスクが存在しない場合には，対象ミューテックスはロックされて
いない状態になる【NGKI2096】．</p>
</div>
<div id="API_ini_mtx" class="listingblock">
<div class="content">
<pre>ini_mtx		ミューテックスの再初期化〔T〕【NGKI2098】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ini_mtx(ID mtxid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mtxid		対象ミューテックスのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2099】
				・CPUロック状態からの呼出し【NGKI2100】
	E_ID		不正ID番号
				・mtxidが有効範囲外【NGKI2101】
	E_NOEXS		オブジェクト未登録
				・対象ミューテックスが未登録〔D〕【NGKI2102】
	E_OACV		オブジェクトアクセス違反
				・対象ミューテックスに対する管理操作が許可されていない〔P〕
				　【NGKI2103】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mtxidで指定したミューテックス（対象ミューテックス）を再初期化する．具体
的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスのロック状態は，ロックされていない状態に初期化される
【NGKI2104】．対象ミューテックスをロックしているタスクがある場合には，
そのタスクがロックしているミューテックスのリストから対象ミューテックス
が削除され，必要な場合にはそのタスクの現在優先度が変更される
【NGKI2105】．また，対象ミューテックスの待ち行列につながれたタスクは，
待ち行列の先頭のタスクから順に待ち解除される【NGKI2106】．待ち解除され
たタスクには，待ち状態となったサービスコールからE_DLTエラーが返る
【NGKI2107】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>対象ミューテックスをロックしているタスクには，ミューテックスが再初期化
されたことが通知されず，そのミューテックスをロック解除する時点でエラー
となる．これが不都合な場合には，ミューテックスを再初期化しようとするタ
スクがミューテックスをロックした状態で，ミューテックスを再初期化すれば
よい．</p>
</div>
<div class="paragraph">
<p>ini_mtxにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>ミューテックスを再初期化した場合に，アプリケーションとの整合性を保つの
は，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_rex_mtx" class="listingblock">
<div class="content">
<pre>ref_mtx		ミューテックスの状態参照〔T〕【NGKI2108】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_mtx(ID mtxid, T_RMTX *pk_rmtx)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mtxid		対象ミューテックスのID番号
	T_RMTX *	pk_rmtx		ミューテックスの現在状態を入れるパケットへ
							のポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊ミューテックスの現在状態（パケットの内容）
	ID			htskid		ミューテックスをロックしているタスクのID番号
	ID			wtskid		ミューテックスの待ち行列の先頭のタスクのID
							番号</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2109】
				・CPUロック状態からの呼出し【NGKI2110】
	E_ID		不正ID番号
				・mtxidが有効範囲外【NGKI2111】
	E_NOEXS		オブジェクト未登録
				・対象ミューテックスが未登録〔D〕【NGKI2112】
	E_OACV		オブジェクトアクセス違反
				・対象ミューテックスに対する参照操作が許可されていない〔P〕
				　【NGKI2113】
	E_MACV		メモリアクセス違反
				・pk_rmtxが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI2114】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mtxidで指定したミューテックス（対象ミューテックス）の現在状態を参照する．
参照した現在状態は，pk_rmtxで指定したパケットに返される．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスがロックされていない場合，htskidにはTSK_NONE（＝0）が
返る【NGKI2115】．</p>
</div>
<div class="paragraph">
<p>対象ミューテックスの待ち行列にタスクが存在しない場合，wtskidには
TSK_NONE（＝0）が返る【NGKI2116】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_mtxはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_mtxを呼び出し，対象ミューテックスの現在状態を参照した
直後に割込みが発生した場合，ref_mtxから戻ってきた時には対象ミューテック
スの状態が変化している可能性があるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_メッセージバッファ">4.4.7. メッセージバッファ</h4>
<div class="paragraph">
<p>メッセージバッファは，指定した長さのバイト列をメッセージとして，FIFO順
で送受信するための同期・通信オブジェクトである．メッセージバッファは，
メッセージバッファIDと呼ぶID番号によって識別する【NGKI3291】．</p>
</div>
<div class="paragraph">
<p>各メッセージバッファが持つ情報は次の通り【NGKI3292】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>メッセージバッファ属性</p>
</li>
<li>
<p>最大メッセージサイズ</p>
</li>
<li>
<p>メッセージバッファ管理領域</p>
</li>
<li>
<p>送信待ち行列（メッセージバッファへの送信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>受信待ち行列（メッセージバッファからの受信待ち状態のタスクのキュー）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メッセージバッファ管理領域は，メッセージバッファに送信されたメッセージ
を，送信された順に格納しておくためのメモリ領域である．メッセージバッファ
生成時の指定により，メッセージバッファ管理領域のサイズを0とすることがで
きる【NGKI3293】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，メッセージバッファ管理領域は，カーネルの
用いるオブジェクト管理領域として扱われる【NGKI3294】．</p>
</div>
<div class="paragraph">
<p>送信待ち行列は，メッセージバッファに対してメッセージが送信できるまで待っ
ている状態（メッセージバッファへの送信待ち状態）のタスクが，メッセージ
を送信できる順序でつながれているキューである．また，受信待ち行列は，メッ
セージバッファからメッセージが受信できるまで待っている状態（メッセージ
バッファからの受信待ち状態）のタスクが，メッセージを受信できる順序でつ
ながれているキューである．</p>
</div>
<div class="paragraph">
<p>メッセージバッファ属性には，次の属性を指定することができる【NGKI3295】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI		0x01U	送信待ち行列をタスクの優先度順にする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，送信待ち行列はFIFO順になる【NGKI3296】．受信待
ち行列は，FIFO順に固定されている【NGKI3297】．</p>
</div>
<div class="paragraph">
<p>メッセージバッファ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_MBFID		登録できるメッセージバッファの数（動的生成対応でな
				いカーネルでは，静的APIによって登録されたメッセー
				ジバッファの数に一致）【NGKI3298】</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，メッセージバッファ機能をサポートしない【ASPS0202】．た
だし，メッセージバッファ機能拡張パッケージを用いると，メッセージバッファ
機能を追加することができる【ASPS0203】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，メッセージバッファ機能をサポートしない【FMPS0167】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，メッセージバッファ機能をサポートしない【HRPS0168】．
ただし，メッセージバッファ機能拡張パッケージを用いると，メッセージバッ
ファ機能を追加することができる【HRPS0169】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TNUM_MBFIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_MBF" class="listingblock">
<div class="content">
<pre>CRE_MBF		メッセージバッファの生成〔S〕【NGKI3299】
acre_mbf	メッセージバッファの生成〔TD〕【NGKI3300】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_MBF(ID mbfid, { ATR mbfatr, uint_t maxmsz, SIZE mbfsz, void *mbfmb })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID mbfid = acre_mbf(const T_CMBF *pk_cmbf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbfid		生成するメッセージバッファのID番号（CRE_MBF
							の場合）
	T_CMBF *	pk_cmbf		メッセージバッファの生成情報を入れたパケッ
							トへのポインタ（静的APIを除く）

　＊メッセージバッファの生成情報（パケットの内容）
	ATR			mbfatr		メッセージバッファ属性
	uint_t		maxmsz		メッセージバッファの最大メッセージサイズ（バ
							イト数）
	SIZE		mbfsz		メッセージバッファ管理領域のサイズ（バイト数）
	void *		mbfmb		メッセージバッファ管理領域の先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		mbfid		生成されたメッセージバッファのID番号（正の
							値）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI3301】
				・CPUロック状態からの呼出し〔s〕【NGKI3302】
	E_RSATR		予約属性
				・mbfatrが無効【NGKI3303】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI3304】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI3305】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI3306】
	E_NOSPT		未サポート機能
				・条件については各カーネルにおける規定の項を参照
	E_PAR		パラメータエラー
				・maxmszが0以下【NGKI3307】
				・mbfszが負の値〔S〕【NGKI3308】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI3309】
	E_MACV		メモリアクセス違反
				・pk_cmbfが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI3310】
	E_NOID		ID番号不足
				・割り付けられるメッセージバッファIDがない〔sD〕【NGKI3311】
	E_NOMEM		メモリ不足
				・メッセージバッファ管理領域が確保できない【NGKI3312】
	E_OBJ		オブジェクト状態エラー
				・mbfidで指定したメッセージバッファが登録済み（CRE_MBF
				　の場合）【NGKI3313】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したメッセージバッファ生成情報に従って，メッセージバッ
ファを生成する．mbfszとmbfmbからメッセージバッファ管理領域が設定され，
格納されているメッセージがない状態に初期化される【NGKI3314】．また，送
信待ち行列と受信待ち行列は，空の状態に初期化される【NGKI3315】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mbfidはオブジェクト識別名，mbfatr，maxmsz，mbfszは整
数定数式パラメータ，mbfmbは一般定数式パラメータである【NGKI3316】．コン
フィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することが
できない【NGKI3317】．</p>
</div>
<div class="paragraph">
<p>mbfmbをNULLとした場合，mbfszで指定したサイズのメッセージバッファ管理領
域が，コンフィギュレータまたはカーネルにより確保される【NGKI3318】．
mbfszにターゲット定義の制約に合致しないサイズを指定した時には，ターゲッ
ト定義の制約に合致するように大きい方に丸めたサイズで確保される
【NGKI3319】．</p>
</div>
<div class="paragraph">
<p>〔mbfmbにNULL以外を指定した場合〕</p>
</div>
<div class="paragraph">
<p>mbfmbにNULL以外を指定した場合，mbfmbとmbfszで指定したメッセージバッファ
管理領域は，アプリケーションで確保しておく必要がある【NGKI3320】．メッ
セージバッファ管理領域をアプリケーションで確保するために，次のマクロを
用意している【NGKI3321】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_MBFMB(msgcnt, msgsz)	msgszで指定したサイズのメッセージを，
							msgcntで指定した数だけ格納できるメッセー
							ジバッファ管理領域のサイズ（バイト数）
TCNT_MBFMB(msgcnt, msgsz)	msgszで指定したサイズのメッセージを，
							msgcntで指定した数だけ格納できるメッセー
							ジバッファ管理領域を確保するために必要
							なMB_T型の配列の要素数</pre>
</div>
</div>
<div class="paragraph">
<p>これらを用いてメッセージバッファ管理領域を確保する方法は次の通り
【NGKI3322】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MB_T	&lt;メッセージバッファ管理領域の変数名&gt;[TCNT_MBFMB(msgcnt, msgsz)];</pre>
</div>
</div>
<div class="paragraph">
<p>この時，mbfszにはTSZ_MBFMB(msgcnt, msgsz)を，mbfmbには&lt;メッセージバッファ
管理領域の変数名&gt;を指定する【NGKI3323】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，mbfmbとmbfszにターゲット定義の制約に合致しない先頭番
地やサイズを指定した時には，E_PARエラーとなる【NGKI3324】．また，保護機
能対応カーネルにおいて，mbfmbとmbfszで指定したメッセージバッファ管理領
域がカーネル専用のメモリオブジェクトに含まれない場合，E_OBJエラーとなる
【NGKI3325】．</p>
</div>
<div class="paragraph">
<p>なお，TSZ_MBFMBは，mbfmbにNULLを指定した場合にも，メッセージバッファ管
理領域のサイズを決めるために用いることができる．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルのメッセージバッファ機能拡張パッケージでは，CRE_MBFのみをサ
ポートする【ASPS0204】．また，mbfmbにはNULLのみを指定することができる．
NULL以外を指定した場合には，E_NOSPTエラーとなる【ASPS0205】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルのメッセージバッファ機能拡張パッケージでは，CRE_MBFのみをサ
ポートする【HRPS0170】．また，mbfmbにはNULLのみを指定することができる．
NULL以外を指定した場合には，E_NOSPTエラーとなる【HRPS0171】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様にあわせて，メッセージバッファ生成情報の最後のパラメー
タを，mbf（メッセージバッファ領域の先頭番地）から，mbfmb（メッセージバッ
ファ管理領域の先頭番地）に改名した．また，TSZ_MBFをTSZ_MBFMBに改名した．</p>
</div>
<div class="paragraph">
<p>TCNT_MBFMBを新設し，メッセージバッファ管理領域をアプリケーションで確保
する方法を規定した．</p>
</div>
<div id="API_AID_MBF" class="listingblock">
<div class="content">
<pre>AID_MBF		割付け可能なメッセージバッファIDの数の指定〔SD〕【NGKI3326】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_MBF(uint_t nombf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nombf		割付け可能なメッセージバッファIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3434】
				・クラスの囲みの中に記述されていない〔M〕【NGKI3327】
	E_PAR		パラメータエラー
				・nombfが負の値【NGKI3328】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nombfで指定した数のメッセージバッファIDを，メッセージバッファを生成する
サービスコールによって割付け可能なメッセージバッファIDとして確保する
【NGKI3329】．</p>
</div>
<div class="paragraph">
<p>nombfは整数定数式パラメータである【NGKI3330】．</p>
</div>
<div id="API_SAC_MBF" class="listingblock">
<div class="content">
<pre>SAC_MBF		メッセージバッファのアクセス許可ベクタの設定〔SP〕【NGKI3331】
sac_mbf		メッセージバッファのアクセス許可ベクタの設定〔TPD〕【NGKI3332】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_MBF(ID mbfid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_mbf(ID mbfid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbfid		対象メッセージバッファのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI3333】
				・CPUロック状態からの呼出し〔s〕【NGKI3334】
	E_ID		不正ID番号
				・mbfidが有効範囲外〔s〕【NGKI3335】
	E_RSATR		予約属性
				・対象メッセージバッファが属する保護ドメインの囲みの中
				　（対象メッセージバッファが無所属の場合は，保護ドメイ
				　ンの囲みの外）に記述されていない〔S〕【NGKI3336】
				・対象メッセージバッファが属するクラスの囲みの中に記述
				　されていない〔SM〕【NGKI3337】
	E_NOEXS		オブジェクト未登録
				・対象メッセージバッファが未登録【NGKI3338】
	E_OACV		オブジェクトアクセス違反
				・対象メッセージバッファに対する管理操作が許可されてい
				　ない〔s〕【NGKI3339】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI3340】
	E_OBJ		オブジェクト状態エラー
				・対象メッセージバッファは静的APIで生成された〔s〕【NGKI3341】
				・対象メッセージバッファに対してアクセス許可ベクタが設
				　定済み〔S〕【NGKI3342】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）のアクセス許
可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に
設定する【NGKI3343】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mbfidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI3344】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルのメッセージバッファ機能拡張パッケージでは，SAC_MBFのみをサ
ポートする【HRPS0172】．</p>
</div>
<div id="API_del_mbf" class="listingblock">
<div class="content">
<pre>del_mbf		メッセージバッファの削除〔TD〕【NGKI3345】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_mbf(ID mbfid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbfid		対象メッセージバッファのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3346】
				・CPUロック状態からの呼出し【NGKI3347】
	E_ID		不正ID番号
				・mbfidが有効範囲外【NGKI3348】
	E_NOEXS		オブジェクト未登録
				・対象メッセージバッファが未登録【NGKI3349】
	E_OACV		オブジェクトアクセス違反
				・対象メッセージバッファに対する管理操作が許可されてい
				　ない〔P〕【NGKI3350】
	E_OBJ		オブジェクト状態エラー
				・対象メッセージバッファは静的APIで生成された【NGKI3351】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）を削除する．
具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの登録が解除され，そのメッセージバッファIDが未使
用の状態に戻される【NGKI3352】．また，対象メッセージバッファの送信待ち
行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の先頭のタス
クから順に待ち解除される【NGKI3353】．待ち解除されたタスクには，待ち状
態となったサービスコールからE_DLTエラーが返る【NGKI3354】．</p>
</div>
<div class="paragraph">
<p>メッセージバッファの生成時に，メッセージバッファ管理領域がカーネルによっ
て確保された場合は，そのメモリ領域が解放される【NGKI3355】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，
別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がな
い．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>del_mbfにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルのメッセージバッファ機能拡張パッケージでは，del_mbfをサポー
トしない【ASPS0207】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルのメッセージバッファ機能拡張パッケージでは，del_mbfをサポー
トしない【HRPS0173】．</p>
</div>
<div id="API_snd_mbf" class="listingblock">
<div class="content">
<pre>snd_mbf		メッセージバッファへの送信〔T〕【NGKI3356】
psnd_mbf	メッセージバッファへの送信（ポーリング）〔T〕【NGKI3357】
tsnd_mbf	メッセージバッファへの送信（タイムアウト付き）〔T〕【NGKI3358】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = snd_mbf(ID mbfid, const void *msg, uint_t msgsz)
	ER ercd = psnd_mbf(ID mbfid, const void *msg, uint_t msgsz)
	ER ercd = tsnd_mbf(ID mbfid, const void *msg, uint_t msgsz, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbfid		対象メッセージバッファのID番号
	void *		msg			送信メッセージの先頭番地
	uint_t		msgsz		送信メッセージのサイズ（バイト数）
	TMO			tmout		タイムアウト時間（tsnd_mbfの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3359】
				・CPUロック状態からの呼出し【NGKI3360】
				・ディスパッチ保留状態からの呼出し（psnd_mbfを除く）
				　【NGKI3361】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（psnd_mbfを除く）【NGKI3362】
	E_ID		不正ID番号
				・mbfidが有効範囲外【NGKI3363】
	E_PAR		パラメータエラー
				・msgszが有効範囲（0より大きく対象メッセージバッファの
				　最大メッセージサイズ以下）外【NGKI3364】
				・tmoutが無効（tsnd_mbfの場合）【NGKI3365】
	E_NOEXS		オブジェクト未登録
				・対象メッセージバッファが未登録〔D〕【NGKI3366】
	E_OACV		オブジェクトアクセス違反
				・対象メッセージバッファに対する通常操作1が許可されて
				　いない〔P〕【NGKI3367】
	E_MACV		メモリアクセス違反
				・msgとmsgszが指すメモリ領域への読出しアクセスが許可さ
				　れていない〔P〕【NGKI3368】
	E_TMOUT		ポーリング失敗またはタイムアウト（snd_mbfを除く）【NGKI3369】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（psnd_mbfを除く）
				【NGKI3370】
	E_DLT		待ちオブジェクトの削除または再初期化（psnd_mbfを除く）
				【NGKI3371】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）に，msgと
msgszで指定したメッセージ（送信メッセージ）を送信する．具体的な振舞いは
以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの受信待ち行列にタスクが存在する場合には，受信待
ち行列の先頭のタスクが，送信メッセージを受信し，待ち解除される
【NGKI3372】．待ち解除されたタスクには，待ち状態となったサービスコール
から，受信したメッセージのサイズが返る【NGKI3373】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの受信待ち行列にタスクが存在しない場合で，送信待
ち行列に自タスクより優先してメッセージを送信できるタスクが存在せず，メッ
セージバッファ管理領域に送信メッセージを格納するスペースがある場合には，
送信メッセージが，FIFO順でメッセージバッファ管理領域に格納される
【NGKI3374】．ここで，送信待ち行列に自タスクより優先してメッセージを送
信できるタスクが存在するとは，送信待ち行列がFIFO順の場合には送信待ち行
列に何らかのタスクが存在すること，タスクの優先度順の場合には自タスクと
優先度が同じかより高いタスクが存在することを意味する．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの受信待ち行列にタスクが存在しない場合で，送信待
ち行列に自タスクより優先してメッセージを送信できるタスクが存在するか，
メッセージバッファ管理領域に送信メッセージを格納するスペースがない場合
には，自タスクはメッセージバッファへの送信待ち状態となり，対象メッセー
ジバッファの送信待ち行列につながれる【NGKI3375】．</p>
</div>
<div class="paragraph">
<p>メッセージバッファの送信待ち行列の先頭につながれているタスクが，
ter_tskにより強制終了した場合や，rel_wai／irel_waiやタイムアウトにより
待ち解除された場合，新たに送信待ち行列の先頭になったタスクの送信メッセー
ジを，メッセージバッファ管理領域に格納できる可能性がある．そのため，こ
れらの場合には，メッセージバッファからの受信によりメッセージバッファ管
理領域に空きができた時の処理［NGKI3393］［NGKI3394］［NGKI3395］と同じ
処理が行われる【NGKI3419】．さらに，送信待ち行列がタスクの優先度順の時
には，chg_priやミューテックスの操作によりタスクの優先度が変化し，送信待
ち行列の先頭につながれているタスクが変わった場合にも，同じ処理が行われ
る【NGKI3420】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>送信待ち行列の先頭につながれているタスクの強制終了，待ち解除，優先度変
更に伴う処理で，送信待ち行列につながれていたタスクが複数待ち解除される
場合がある．この時，サービスコールの処理時間およびカーネル内での割込み
禁止時間が，待ち解除されるタスクの数に比例して長くなる．特に，多くのタ
スクが待ち解除される場合，カーネル内での割込み禁止時間が長くなるため，
注意が必要である．</p>
</div>
<div id="API_rcv_mbf" class="listingblock">
<div class="content">
<pre>rcv_mbf		メッセージバッファからの受信〔T〕【NGKI3376】
prcv_mbf	メッセージバッファからの受信（ポーリング）〔T〕【NGKI3377】
trcv_mbf	メッセージバッファからの受信（タイムアウト付き）〔T〕【NGKI3378】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_UINT	msgsz = rcv_mbf(ID mbfid, void *msg)
	ER_UINT	msgsz = prcv_mbf(ID mbfid, void *msg)
	ER_UINT	msgsz = trcv_mbf(ID mbfid, void *msg, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbfid		対象メッセージバッファのID番号
	void *		msg			受信メッセージを入れるメモリ領域の先頭番地
	TMO			tmout		タイムアウト時間（trcv_mbfの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_UINT		msgsz		受信メッセージサイズ（正の値）またはエラー
							コード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3379】
				・CPUロック状態からの呼出し【NGKI3380】
				・ディスパッチ保留状態からの呼出し（prcv_mbfを除く）
				　【NGKI3381】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（prcv_mbfを除く）【NGKI3382】
	E_ID		不正ID番号
				・mbfidが有効範囲外【NGKI3383】
	E_PAR		パラメータエラー
				・tmoutが無効（trcv_mbfの場合）【NGKI3384】
	E_NOEXS		オブジェクト未登録
				・対象メッセージバッファが未登録〔D〕【NGKI3385】
	E_OACV		オブジェクトアクセス違反
				・対象メッセージバッファに対する通常操作2が許可されてい
				　ない〔P〕【NGKI3386】
	E_MACV		メモリアクセス違反
				・msgを先頭番地とし，対象メッセージバッファの最大メッセー
				　ジサイズ分のメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI3387】
	E_TMOUT		ポーリング失敗またはタイムアウト（rcv_mbfを除く）【NGKI3388】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（prcv_mbfを除く）
				【NGKI3389】
	E_DLT		待ちオブジェクトの削除または再初期化（prcv_mbfを除く）
				【NGKI3390】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）からメッセー
ジを受信する．メッセージの受信に成功した場合，受信したメッセージはmsgを
先頭番地とするメモリ領域に格納され，そのサイズはサービスコールの返値と
して返される【NGKI3391】．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファのメッセージバッファ管理領域にメッセージが格納さ
れている場合には，メッセージバッファ管理領域の先頭に格納されたメッセー
ジを受信する【NGKI3392】．また，送信待ち行列にタスクが存在し，メッセー
ジバッファ管理領域に送信待ち行列の先頭のタスクの送信メッセージを格納す
るスペースがある場合には，送信メッセージがFIFO順でデータキュー管理領域
に格納され，そのタスクは待ち解除される【NGKI3393】．待ち解除されたタス
クには，待ち状態となったサービスコールからE_OKが返る【NGKI3394】．この
処理を，送信待ち行列にタスクが存在しなくなるか，メッセージバッファ管理
領域に送信待ち行列の先頭のタスクの送信メッセージを格納するスペースがな
くなるまで繰り返す【NGKI3395】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファのメッセージバッファ管理領域にメッセージが格納さ
れておらず，送信待ち行列にタスクが存在する場合には，送信待ち行列の先頭
のタスクの送信メッセージを受信する【NGKI3396】．送信待ち行列の先頭のタ
スクは，待ち解除される【NGKI3397】．待ち解除されたタスクには，待ち状態
となったサービスコールからE_OKが返る【NGKI3398】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファのメッセージバッファ管理領域にメッセージが格納さ
れておらず，送信待ち行列にタスクが存在しない場合には，自タスクはメッセー
ジバッファからの受信待ち状態となり，対象メッセージバッファの受信待ち行
列につながれる【NGKI3399】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>メッセージバッファ管理領域に格納されたメッセージを受信した結果，送信待
ち行列につながれていたタスクが複数待ち解除される場合がある．この時，サー
ビスコールの処理時間およびカーネル内での割込み禁止時間が，待ち解除され
るタスクの数に比例して長くなる．特に，多くのタスクが待ち解除される場合，
カーネル内での割込み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div id="API_ini_mbf" class="listingblock">
<div class="content">
<pre>ini_mbf		メッセージバッファの再初期化〔T〕【NGKI3400】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ini_mbf(ID mbfid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbfid		対象メッセージバッファのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3401】
				・CPUロック状態からの呼出し【NGKI3402】
	E_ID		不正ID番号
				・mbfidが有効範囲外【NGKI3403】
	E_NOEXS		オブジェクト未登録
				・対象メッセージバッファが未登録〔D〕【NGKI3404】
	E_OACV		オブジェクトアクセス違反
				・対象メッセージバッファに対する管理操作が許可されてい
				　ない〔P〕【NGKI3405】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）を再初期化す
る．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファのメッセージバッファ管理領域は，格納されているメッ
セージがない状態に初期化される【NGKI3406】．また，対象メッセージバッファ
の送信待ち行列と受信待ち行列につながれたタスクは，それぞれの待ち行列の
先頭のタスクから順に待ち解除される【NGKI3407】．待ち解除されたタスクに
は，待ち状態となったサービスコールからE_DLTエラーが返る【NGKI3408】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>送信待ち行列と受信待ち行列の両方にタスクがつながれていることはないため，
別の待ち行列で待っていたタスクの間の待ち解除の順序は，規定する必要がな
い．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ini_mbfにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>メッセージバッファを再初期化した場合に，アプリケーションとの整合性を保
つのは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_mbf" class="listingblock">
<div class="content">
<pre>ref_mbf		メッセージバッファの状態参照〔T〕【NGKI3409】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_mbf(ID mbfid, T_RMBF *pk_rmbf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mbfid		対象メッセージバッファのID番号
	T_RMBF *	pk_rmbf		メッセージバッファの現在状態を入れるパケッ
							トへのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊メッセージバッファの現在状態（パケットの内容）
	ID			stskid		メッセージバッファの送信待ち行列の先頭のタ
							スクのID番号
	ID			rtskid		メッセージバッファの受信待ち行列の先頭のタ
							スクのID番号
	uint_t		smbfcnt		メッセージバッファ管理領域に格納されている
							メッセージの数
	SIZE		fmbfsz		メッセージバッファ管理領域中の空き領域のサ
							イズ</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3410】
				・CPUロック状態からの呼出し【NGKI3411】
	E_ID		不正ID番号
				・mbfidが有効範囲外【NGKI3412】
	E_NOEXS		オブジェクト未登録
				・対象メッセージバッファが未登録〔D〕【NGKI3413】
	E_OACV		オブジェクトアクセス違反
				・対象メッセージバッファに対する参照操作が許可されてい
				　ない〔P〕【NGKI3414】
	E_MACV		メモリアクセス違反
				・pk_rmbfが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI3415】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mbfidで指定したメッセージバッファ（対象メッセージバッファ）の現在状態を
参照する．参照した現在状態は，pk_rmbfで指定したパケットに返される
【NGKI3416】．</p>
</div>
<div class="paragraph">
<p>対象メッセージバッファの送信待ち行列にタスクが存在しない場合，stskidには
TSK_NONE（＝0）が返る【NGKI3417】．また，受信待ち行列にタスクが存在しな
い場合，rtskidにはTSK_NONE（＝0）が返る【NGKI3418】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_mbfはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_mbfを呼び出し，対象メッセージバッファの現在状態を参照
した直後に割込みが発生した場合，ref_mbfから戻ってきた時には対象メッセー
ジバッファの状態が変化している可能性があるためである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_スピンロック">4.4.8. スピンロック</h4>
<div class="paragraph">
<p>スピンロックは，マルチプロセッサ対応カーネルにおいて，割込みのマスクと
プロセッサ間ロックの取得により，排他制御を行うための同期・通信オブジェ
クトである．スピンロックは，スピンロックIDと呼ぶID番号によって識別する
【NGKI2117】．</p>
</div>
<div class="paragraph">
<p>プロセッサ間ロックを取得している間は，CPUロック状態にすることですべての
カーネル管理の割込みがマスクされ，ディスパッチが保留される【NGKI2118】．
ロックが他のプロセッサに取得されている場合には，ロックが取得できるまで
ループによって待つ【NGKI2119】．ロックの取得を待つ間は，CPUロック解除状
態であり，割込みはマスクされない【NGKI2120】．プロセッサ間ロックを取得
し，CPUロック状態に遷移することを，スピンロックを取得するという．また，
プロセッサ間ロックを返却し，CPUロック状態を解除することを，スピンロック
を返却するという．</p>
</div>
<div class="paragraph">
<p>タスクが取得したスピンロックを返却せずに終了した場合や，タスク例外処理
ルーチン，割込みハンドラ，割込みサービスルーチン，タイムイベントハンド
ラが取得したスピンロックを返却せずにリターンした場合には，カーネルによっ
てスピンロックが返却される【NGKI2121】．また，スピンロックを取得してい
ない状態で発生したCPU例外によって呼び出されたCPU例外ハンドラが，取得し
たスピンロックを返却せずにリターンした場合には，カーネルによってスピン
ロックが返却される【NGKI2122】．一方，拡張サービスコールからのリターン
では，スピンロックは返却されない【NGKI2123】．</p>
</div>
<div class="paragraph">
<p>各スピンロックが持つ情報は次の通り【NGKI2124】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>スピンロック属性</p>
</li>
<li>
<p>ロック状態（取得されている状態と取得されていない状態）</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>スピンロック属性に指定できる属性はない【NGKI2125】．そのためスピンロッ
ク属性には，TA_NULLを指定しなければならない【NGKI2126】．</p>
</div>
<div class="paragraph">
<p>スピンロック機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_SPNID		登録できるスピンロックの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたスピンロックの数
				に一致）【NGKI2127】</pre>
</div>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>CPUロック状態では，スピンロックを取得するサービスコールを呼び出すことが
できないため，スピンロックを取得しているプロセッサが，さらにスピンロッ
クを取得することはできない．そのため，1つの処理単位が，複数のスピンロッ
クを取得した状態になることはできない．</p>
</div>
<div class="paragraph">
<p>スピンロックを取得した状態でCPU例外が発生した場合，起動されるCPU例外ハ
ンドラはカーネル管理外のCPU例外ハンドラであり（xsns_dpn，xsns_xpnとも
trueを返す），CPU例外ハンドラ中でiunl_spnを呼び出してスピンロックを返却
しようとした場合の動作は保証されない．保証されないにも関わらずiunl_spn
を呼び出した場合には，CPU例外ハンドラからのリターン時に元の状態に戻らな
い．これは，CPUロック状態の扱いと一貫していないため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，スピンロック機能をサポートしない【ASPS0163】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，スピンロック機能をサポートする【FMPS0138】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，スピンロック機能をサポートしない【HRPS0135】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>スピンロック機能は，μITRON4.0仕様に定義されていない機能である．</p>
</div>
<div id="API_CRE_SPN" class="listingblock">
<div class="content">
<pre>CRE_SPN		スピンロックの生成〔SM〕【NGKI2128】
acre_spn	スピンロックの生成〔TMD〕【NGKI2129】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_SPN(ID spnid, { ATR spnatr })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID spnid = acre_spn(const T_CSPN *pk_cspn)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			spnid		生成するスピンロックのID番号（CRE_SPNの場合）
	T_CSPN *	pk_cspn		スピンロックの生成情報を入れたパケットへの
							ポインタ（静的APIを除く）

　＊スピンロックの生成情報（パケットの内容）
	ATR			spnatr		スピンロック属性</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		spnid		生成されたスピンロックのID番号（正の値）ま
							たはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2130】
				・CPUロック状態からの呼出し〔s〕【NGKI2131】
	E_RSATR		予約属性
				・spnatrが無効【NGKI2132】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI2133】
				・属するクラスの指定が有効範囲外〔s〕【NGKI2134】
				・クラスの囲みの中に記述されていない〔S〕【NGKI2135】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2136】
	E_MACV		メモリアクセス違反
				・pk_cspnが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2137】
	E_NOID		ID番号不足
				・割り付けられるスピンロックIDがない〔sD〕【NGKI2138】
	E_NORES		資源不足
				・条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・spnidで指定したスピンロックが登録済み（CRE_SPNの場合）
				　【NGKI2139】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したスピンロック生成情報に従って，スピンロックを生成
する．生成されたスピンロックのロック状態は，取得されていない状態に初期
化される【NGKI2140】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，spnidはオブジェクト識別名，spnatrは整数定数式パラメー
タである【NGKI2141】．</p>
</div>
<div class="paragraph">
<p>スピンロックをハードウェアによって実現している場合には，ターゲット定義
で，生成できるスピンロックの数に上限がある【NGKI2142】．この上限を超え
てスピンロックを生成しようとした場合には，E_NORESエラーとなる
【NGKI2143】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>スピンロックを動的に生成する場合に，生成できるスピンロックの数の上限は
AID_SPNによってチェックされるため，acre_spnでE_NORESエラーが返ることは
ない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_SPNのみをサポートする【FMPS0139】．</p>
</div>
<div id="API_AID_SPN" class="listingblock">
<div class="content">
<pre>AID_SPN		割付け可能なスピンロックIDの数の指定〔SMD〕【NGKI2144】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_SPN(uint_t nospn)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nospn		割付け可能なスピンロックIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3435】
				・クラスの囲みの中に記述されていない【NGKI2145】
	E_PAR		パラメータエラー
				・nospnが負の値【NGKI3283】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nospnで指定した数のスピンロックIDを，スピンロックを生成するサービスコー
ルによって割付け可能なスピンロックIDとして確保する【NGKI2146】．</p>
</div>
<div class="paragraph">
<p>nospnは整数定数式パラメータである【NGKI2147】．</p>
</div>
<div id="API_SAC_SPN" class="listingblock">
<div class="content">
<pre>SAC_SPN		スピンロックのアクセス許可ベクタの設定〔SPM〕【NGKI2148】
sac_spn		スピンロックのアクセス許可ベクタの設定〔TPMD〕【NGKI2149】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_SPN(ID spnid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_spn(ID spnid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			spnid		対象スピンロックのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2150】
				・CPUロック状態からの呼出し〔s〕【NGKI2151】
	E_ID		不正ID番号
				・spnidが有効範囲外〔s〕【NGKI2152】
	E_RSATR		予約属性
				・対象スピンロックが属する保護ドメインの囲みの中（対象
				　スピンロックが無所属の場合は，保護ドメインの囲みの外）
				　に記述されていない〔S〕【NGKI2153】
				・対象スピンロックが属するクラスの囲みの中に記述されて
				　いない〔S〕【NGKI2154】
	E_NOEXS		オブジェクト未登録
				・対象スピンロックが未登録【NGKI2155】
	E_OACV		オブジェクトアクセス違反
				・対象スピンロックに対する管理操作が許可されていない〔s〕
				　【NGKI2156】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI2157】
	E_OBJ		オブジェクト状態エラー
				・対象スピンロックは静的APIで生成された〔s〕【NGKI2158】
				・対象スピンロックに対してアクセス許可ベクタが設定済み〔S〕
				　【NGKI2159】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>spnidで指定したスピンロック（対象スピンロック）のアクセス許可ベクタ（4
つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する
【NGKI2160】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，spnidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI2161】．</p>
</div>
<div id="API_del_spn" class="listingblock">
<div class="content">
<pre>del_spn		スピンロックの削除〔TMD〕【NGKI2162】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_spn(ID spnid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			spnid		対象スピンロックのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2163】
				・CPUロック状態からの呼出し【NGKI2164】
	E_ID		不正ID番号
				・spnidが有効範囲外【NGKI2165】
	E_NOEXS		オブジェクト未登録
				・対象スピンロックが未登録【NGKI2166】
	E_OACV		オブジェクトアクセス違反
				・対象スピンロックに対する管理操作が許可されていない〔P〕
				　【NGKI2167】
	E_OBJ		オブジェクト状態エラー
				・対象スピンロックは静的APIで生成された【NGKI2168】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>spnidで指定したスピンロック（対象スピンロック）を削除する．具体的な振舞
いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象スピンロックの登録が解除され，そのスピンロックIDが未使用の状態に戻
される【NGKI2169】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_spnをサポートしない【FMPS0141】．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>対象スピンロックが取得されている状態の場合の振舞いは，今後の課題である．</p>
</div>
<div id="API_loc_spn" class="listingblock">
<div class="content">
<pre>loc_spn		スピンロックの取得〔TM〕【NGKI2170】
iloc_spn	スピンロックの取得〔IM〕【NGKI2171】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = loc_spn(ID spnid)
	ER ercd = iloc_spn(ID spnid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			spnid		対象スピンロックのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（loc_spnの場合）【NGKI2172】
				・タスクコンテキストからの呼出し（iloc_spnの場合）【NGKI2173】
				・CPUロック状態からの呼出し【NGKI2174】
	E_ID		不正ID番号
				・spnidが有効範囲外【NGKI2175】
	E_NOEXS		オブジェクト未登録
				・対象スピンロックが未登録〔D〕【NGKI2176】
	E_OACV		オブジェクトアクセス違反
				・対象スピンロックに対する通常操作1が許可されていない
				　（loc_spnの場合）〔P〕【NGKI2177】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>spnidで指定したスピンロック（対象スピンロック）を取得する．具体的な振舞
いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが取得されていない状態である場合には，プロセッサ間ロッ
クの取得を試みる【NGKI2178】．ロックが他のプロセッサによって取得されて
いる状態である場合や，他のプロセッサがロックの取得に成功した場合には，
ロックが返却されるまでループによって待ち，返却されたらロックの取得を試
みる【NGKI2179】．これを，ロックの取得に成功するまで繰り返す
【NGKI2180】．</p>
</div>
<div class="paragraph">
<p>ロックの取得に成功した場合には，スピンロックは取得されている状態になる
【NGKI2181】．また，CPUロックフラグをセットしてCPUロック状態へ遷移し，
サービスコールからリターンする【NGKI2182】．</p>
</div>
<div class="paragraph">
<p>なお，複数のプロセッサがロックの取得を待っている時に，どのプロセッサが
最初にロックを取得できるかは，現時点ではターゲット定義とする【NGKI2183】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>対象スピンロックが，loc_spn／iloc_spnを呼び出したプロセッサによって取得
されている状態である場合には，スピンロックの取得によりCPUロック状態になっ
ているため，loc_spn／iloc_spnはE_CTXエラーとなる．</p>
</div>
<div class="paragraph">
<p>プロセッサがロックを取得できる順序を，現時点ではターゲット定義としたが，
リアルタイム性保証のためには，（ロックの取得待ちの間に割込みが発生しな
い限りは）loc_spn／iloc_spnを呼び出した順序でロックを取得できるとするの
が望ましい．ただし，ターゲットハードウェアの制限で，そのような実装がで
きるとは限らないため，現時点ではターゲット定義としている．</p>
</div>
<div id="API_try_spn" class="listingblock">
<div class="content">
<pre>try_spn		スピンロックの取得（ポーリング）〔TM〕【NGKI2184】
itry_spn	スピンロックの取得（ポーリング）〔IM〕【NGKI2185】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = try_spn(ID spnid)
	ER ercd = itry_spn(ID spnid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			spnid		対象スピンロックのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（try_spnの場合）【NGKI2186】
				・タスクコンテキストからの呼出し（itry_spnの場合）【NGKI2187】
				・CPUロック状態からの呼出し【NGKI2188】
	E_ID		不正ID番号
				・spnidが有効範囲外【NGKI2189】
	E_NOEXS		オブジェクト未登録
				・対象スピンロックが未登録〔D〕【NGKI2190】
	E_OACV		オブジェクトアクセス違反
				・対象スピンロックに対する通常操作1が許可されていない
				　（try_spnの場合）〔P〕【NGKI2191】
	E_OBJ		オブジェクト状態エラー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>spnidで指定したスピンロック（対象スピンロック）の取得を試みる．具体的な
振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが取得されていない状態である場合には，プロセッサ間ロッ
クの取得を試みる【NGKI2192】．ロックの取得に成功した場合には，スピンロッ
クは取得されている状態になる【NGKI2193】．また，CPUロックフラグをセット
してCPUロック状態へ遷移し，サービスコールからリターンする【NGKI2194】．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが他のプロセッサによって取得されている状態である場合や，
ロックの取得に失敗した場合（他のプロセッサがロックの取得に成功した場合）
には，E_OBJエラーとする【NGKI2195】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>try_spn／itry_spnを，ロックの取得に成功するまで繰り返し呼び出すことによ
りスピンロックを取得する方法は，loc_spn／iloc_spnによりスピンロックを取
得する方法と，プロセッサがロックを取得できる順序が異なる可能性ある．</p>
</div>
<div id="API_unl_spn" class="listingblock">
<div class="content">
<pre>unl_spn		スピンロックの返却〔TM〕【NGKI2196】
iunl_spn	スピンロックの返却〔IM〕【NGKI2197】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = unl_spn(ID spnid)
	ER ercd = iunl_spn(ID spnid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			spnid		対象スピンロックのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（unl_spnの場合）【NGKI2198】
				・タスクコンテキストからの呼出し（iunl_spnの場合）【NGKI2199】
	E_ID		不正ID番号
				・spnidが有効範囲外【NGKI2200】
	E_NOEXS		オブジェクト未登録
				・対象スピンロックが未登録〔D〕【NGKI2201】
	E_OACV		オブジェクトアクセス違反
				・対象スピンロックに対する通常操作1が許可されていない
				　（unl_spnの場合）〔P〕【NGKI2202】
	E_ILUSE		サービスコール不正使用
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>spnidで指定したスピンロック（対象スピンロック）を返却する．具体的な振舞
いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが，unl_spn／iunl_spnを呼び出したプロセッサによって取得
されている状態である場合には，ロックを返却し，スピンロックを取得されて
いない状態とする【NGKI2203】．また，CPUロックフラグをクリアし，CPUロッ
ク解除状態へ遷移する【NGKI2204】．</p>
</div>
<div class="paragraph">
<p>対象スピンロックが，取得されていない状態である場合や，他のプロセッサに
よって取得されている状態である場合には，E_ILUSEエラーとなる【NGKI2205】．</p>
</div>
<div class="paragraph">
<p>[[API_ref_spn]</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ref_spn		スピンロックの状態参照〔TM〕【NGKI2206】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_spn(ID spnid, T_RSPN *pk_rspn)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			spnid		対象スピンロックのID番号
	T_RSPN *	pk_rspn		スピンロックの現在状態を入れるパケットへの
							ポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊スピンロックの現在状態（パケットの内容）
	STAT		spnstat		ロック状態</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2207】
				・CPUロック状態からの呼出し【NGKI2208】
	E_ID		不正ID番号
				・spnidが有効範囲外【NGKI2209】
	E_NOEXS		オブジェクト未登録
				・対象スピンロックが未登録〔D〕【NGKI2210】
	E_OACV		オブジェクトアクセス違反
				・対象スピンロックに対する参照操作が許可されていない〔P〕
				　【NGKI2211】
	E_MACV		メモリアクセス違反
				・pk_rspnが指すメモリ領域への書込みアクセスが許可されて
				　いない）〔P〕【NGKI2212】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>spnidで指定したスピンロック（対象スピンロック）の現在状態を参照する．参
照した現在状態は，pk_rspnで指定したパケットに返される【NGKI2213】．</p>
</div>
<div class="paragraph">
<p>spnstatには，対象スピンロックの現在のロック状態を表す次のいずれかの値が
返される【NGKI2214】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TSPN_UNL	0x01U		取得されていない状態
TSPN_LOC	0x02U		取得されている状態</pre>
</div>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_spnはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_spnを呼び出し，対象スピンロックの現在状態を参照した直
後に割込みが発生した場合，ref_spnから戻ってきた時には対象スピンロックの
状態が変化している可能性があるためである．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_メモリプール管理機能">4.5. メモリプール管理機能</h3>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，メモリプール管理機能をサポートしない【SSPS0128】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>この仕様では，可変長メモリプール機能はサポートしないこととした．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>可変長メモリプール機能をサポートしないこととしたのは，メモリ割付けの処
理時間とフラグメンテーションの発生を考えると，最適なメモリ管理アルゴリ
ズムはアプリケーション依存となるため，カーネル内で実現するより，ライブ
ラリとして実現する方が適切と考えたためである．</p>
</div>
<div class="sect3">
<h4 id="_固定長メモリプール">4.5.1. 固定長メモリプール</h4>
<div class="paragraph">
<p>固定長メモリプールは，生成時に決めたサイズのメモリブロック（固定長メモ
リブロック）を動的に獲得・返却するための同期・通信オブジェクトである．
固定長メモリプールは，固定長メモリプールIDと呼ぶID番号で識別する
【NGKI2215】．</p>
</div>
<div class="paragraph">
<p>各固定長メモリプールが持つ情報は次の通り【NGKI2216】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>固定長メモリプール属性</p>
</li>
<li>
<p>待ち行列（固定長メモリブロックの獲得待ち状態のタスクのキュー）</p>
</li>
<li>
<p>固定長メモリプール領域</p>
</li>
<li>
<p>固定長メモリプール管理領域</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>待ち行列は，固定長メモリブロックが獲得できるまで待っている状態（固定長
メモリブロックの獲得待ち状態）のタスクが，固定長メモリブロックを獲得で
きる順序でつながれているキューである．</p>
</div>
<div class="paragraph">
<p>固定長メモリプール領域は，その中から固定長メモリブロックを割り付けるた
めのメモリ領域である．</p>
</div>
<div class="paragraph">
<p>固定長メモリプール管理領域は，固定長メモリプール領域中の割当て済みの固
定長メモリブロックと未割当てのメモリ領域に関する情報を格納しておくため
のメモリ領域である．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，固定長メモリプール管理領域は，カーネルの
用いるオブジェクト管理領域として扱われる【NGKI2217】．</p>
</div>
<div class="paragraph">
<p>固定長メモリプール属性には，次の属性を指定することができる【NGKI2218】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI		0x01U	待ち行列をタスクの優先度順にする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_TPRIを指定しない場合，待ち行列はFIFO順になる【NGKI2219】．</p>
</div>
<div class="paragraph">
<p>固定長メモリプール機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_MPFID		登録できる固定長メモリプールの数（動的生成対応でない
				カーネルでは，静的APIによって登録された固定長メモリ
				プールの数に一致）【NGKI2220】</pre>
</div>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>固定長メモリプール領域として確保すべき領域のサイズを返すカーネル構成マ
クロ（TSZ_MPF）は廃止した．これは，固定長メモリプール領域をアプリケーショ
ンで確保する方法を定めた結果，そのサイズは(blkcnt * ROUND_MPF_T(blksz))
で求めることができるようになったためである．</p>
</div>
<div class="paragraph">
<p>TNUM_MPFIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_MPF" class="listingblock">
<div class="content">
<pre>CRE_MPF		固定長メモリプールの生成〔S〕【NGKI2221】
acre_mpf	固定長メモリプールの生成〔TD〕【NGKI2222】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_MPF(ID mpfid, { ATR mpfatr, uint_t blkcnt, uint_t blksz,
										MPF_T *mpf, void *mpfmb })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID mpfid = acre_mpf(const T_CMPF *pk_cmpf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mpfid		生成する固定長メモリプールのID番号（CRE_MPF
							の場合）
	T_CMPF *	pk_cmpf		固定長メモリプールの生成情報を入れたパケッ
							トへのポインタ（静的APIを除く）

　＊固定長メモリプールの生成情報（パケットの内容）
	ATR			mpfatr		固定長メモリプール属性
	uint_t		blkcnt		獲得できる固定長メモリブロックの数
	uint_t		blksz		固定長メモリブロックのサイズ（バイト数）
	MPF_T *		mpf			固定長メモリプール領域の先頭番地
	void *		mpfmb		固定長メモリプール管理領域の先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		mpfid		生成された固定長メモリプールのID番号（正の
							値）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2223】
				・CPUロック状態からの呼出し〔s〕【NGKI2224】
	E_RSATR		予約属性
				・mpfatrが無効【NGKI2225】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI2226】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI2227】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI2228】
	E_NOSPT		未サポート機能
				・条件については各カーネルにおける規定の項を参照
	E_PAR		パラメータエラー
				・blkcntが0以下【NGKI2229】
				・blkszが0以下【NGKI2230】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2231】
	E_MACV		メモリアクセス違反
				・pk_cmpfが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2232】
	E_NOID		ID番号不足
				・割り付けられる固定長メモリプールIDがない〔sD〕【NGKI2233】
	E_NOMEM		メモリ不足
				・固定長メモリプール領域が確保できない【NGKI2234】
				・固定長メモリプール管理領域が確保できない【NGKI2235】
	E_OBJ		オブジェクト状態エラー
				・mpfidで指定した固定長メモリプールが登録済み（CRE_MPF
				　の場合）【NGKI2236】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した固定長メモリプール生成情報に従って，固定長メモリ
プールを生成する．mpf，blkcnt，blkszから固定長メモリプール領域が，
mpfmbとblkcntから固定長メモリプール管理領域がそれぞれ設定され，メモリプー
ル領域全体が未割当ての状態に初期化される【NGKI2237】．また，待ち行列は
空の状態に初期化される【NGKI2238】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mpfidはオブジェクト識別名，mpfatr，blkcnt，blkszは整
数定数式パラメータ，mpfとmpfmbは一般定数式パラメータである【NGKI2239】．
コンフィギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出するこ
とができない【NGKI2240】．</p>
</div>
<div class="paragraph">
<p>mpfをNULLとした場合，blkcntとblkszから決まるサイズの固定長メモリプール
領域が，コンフィギュレータまたはカーネルにより確保される【NGKI2241】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，コンフィギュレータまたはカーネルにより確保さ
れる固定長メモリプール領域は，固定長メモリプールと同じ保護ドメインに属
し，固定長メモリプールと同じアクセス許可ベクタを持ったメモリオブジェク
ト中に確保される【NGKI2242】．</p>
</div>
<div class="paragraph">
<p>mpfmbをNULLとした場合，blkcntから決まるサイズの固定長メモリプール管理領
域が，コンフィギュレータまたはカーネルにより確保される【NGKI2243】．</p>
</div>
<div class="paragraph">
<p>〔mpfにNULL以外を指定した場合〕</p>
</div>
<div class="paragraph">
<p>mpfにNULL以外を指定した場合，mpfを先頭番地とする固定長メモリプール領域
は，アプリケーションで確保しておく必要がある【NGKI2244】．固定長メモリ
プール領域をアプリケーションで確保するために，次のデータ型とマクロを用
意している【NGKI2245】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>MPF_T				固定長メモリプール領域を確保するためのデータ型</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>COUNT_MPF_T(blksz)	固定長メモリブロックのサイズがblkszの固定長メモ
					リプール領域を確保するために，固定長メモリブロッ
					ク1つあたりに必要なMPF_T型の配列の要素数
ROUND_MPF_T(blksz)	要素数COUNT_MPF_T(blksz)のMPF_T型の配列のサイズ
					（blkszを，MPF_T型のサイズの倍数になるように大き
					い方に丸めた値）</pre>
</div>
</div>
<div class="paragraph">
<p>これらを用いて固定長メモリプール領域を確保する方法は次の通り【NGKI2246】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MPF_T	&lt;固定長メモリプール領域の変数名&gt;[(blkcnt) * COUNT_MPF_T(blksz)];</pre>
</div>
</div>
<div class="paragraph">
<p>この時，mpfには&lt;固定長メモリプール領域の変数名&gt;を指定する【NGKI2247】．</p>
</div>
<div class="paragraph">
<p>これ以外の方法で固定長メモリプール領域を確保する場合には，上記の配列と
同じサイズのメモリ領域を確保しなければならない【NGKI2248】．また，その
先頭番地がターゲット定義の制約に合致していなければならない．mpfにターゲッ
ト定義の制約に合致しない先頭番地を指定した時には，E_PARエラーとなる
【NGKI2249】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，アプリケーションで確保する固定長メモリプール
領域は，カーネルに登録されたメモリオブジェクトに含まれていなければなら
ない．指定した固定長メモリプール領域が，カーネルに登録されたメモリオブ
ジェクトに含まれていない場合，E_OBJエラーとなる【NGKI2251】．</p>
</div>
<div class="paragraph">
<p>〔mpfmbにNULL以外を指定した場合〕</p>
</div>
<div class="paragraph">
<p>mpfmbにNULL以外を指定した場合，mpfmbを先頭番地とする固定長メモリプール
管理領域は，アプリケーションで確保しておく必要がある【NGKI2252】．固定
長メモリプール管理領域をアプリケーションで確保するために，次のマクロを
用意している【NGKI2253】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_MPFMB(blkcnt)	blkcntで指定した数の固定長メモリブロックを管理
					することができる固定長メモリプール管理領域のサ
					イズ（バイト数）
TCNT_MPFMB(blkcnt)	blkcntで指定した数の固定長メモリブロックを管理
					することができる固定長メモリプール管理領域を確
					保するために必要なMB_T型の配列の要素数</pre>
</div>
</div>
<div class="paragraph">
<p>これらを用いて固定長メモリプール管理領域を確保する方法は次の通り
【NGKI2254】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MB_T	&lt;固定長メモリプール管理領域の変数名&gt;[TCNT_MPFMB(blkcnt)];</pre>
</div>
</div>
<div class="paragraph">
<p>この時，mpfmbには&lt;固定長メモリプール管理領域の変数名&gt;を指定する
【NGKI2255】．</p>
</div>
<div class="paragraph">
<p>この方法に従わず，mpfmbにターゲット定義の制約に合致しない先頭番地を指定
した時には，E_PARエラーとなる【NGKI2256】．また，保護機能対応カーネルに
おいて，mpfmbで指定した固定長メモリプール管理領域がカーネル専用のメモリ
オブジェクトに含まれない場合，E_OBJエラーとなる【NGKI2257】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，固定長メモリプール領域をアプリケーション
で確保する場合には，固定長メモリプール領域が属する保護ドメインとアクセ
ス権の設定は変更されない．これらを適切に設定することは，アプリケーショ
ンの責任である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_MPFのみをサポートする【ASPS0164】．また，mpfmbには
NULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラー
となる【ASPS0166】．ただし，動的生成機能拡張パッケージでは，acre_mpfも
サポートする【ASPS0167】．acre_mpfに対しては，mpfmbにNULL以外を指定でき
ないという制限はない【ASPS0168】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_MPFのみをサポートする【FMPS0142】．また，mpfmbには
NULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエラー
となる【FMPS0144】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_MPFのみをサポートする【HRPS0136】．また，mpfmbに
はNULLのみを指定することができる．NULL以外を指定した場合には，E_NOSPTエ
ラーとなる【HRPS0138】．</p>
</div>
<div class="paragraph">
<p>動的生成機能拡張パッケージでは，acre_mpfもサポートする【HRPS0197】．
acre_mpfに対しては，mpfmbにNULL以外を指定できないという制限はない
【HRPS0198】．ただし，mpfにNULLが指定されるとカーネルが固定長メモリプー
ル領域を確保する機能はサポートしない．mpfにNULLを指定した場合には，
E_NOSPTエラーとなる【HRPS0199】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>mpfのデータ型をMPF_T *に変更した．COUNT_MPF_TとROUND_MPF_Tを新設し，固
定長メモリプール領域をアプリケーションで確保する方法を規定した．また，
μITRON4.0/PX仕様にあわせて，固定長メモリプール生成情報に，mpfmbを追加
した．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>TCNT_MPFMBを新設し，固定長メモリプール管理領域をアプリケーションで確保
する方法を規定した．</p>
</div>
<div id="API_AID_MPF" class="listingblock">
<div class="content">
<pre>AID_MPF		割付け可能な固定長メモリプールIDの数の指定〔SD〕【NGKI2258】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_MPF(uint_t nompf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nompf		割付け可能な固定長メモリプールIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3436】
				・クラスの囲みの中に記述されていない〔M〕【NGKI2259】
	E_PAR		パラメータエラー
				・nompfが負の値【NGKI3284】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nompfで指定した数の固定長メモリプールIDを，固定長メモリプールを生成する
サービスコールによって割付け可能な固定長メモリプールIDとして確保する
【NGKI2260】．</p>
</div>
<div class="paragraph">
<p>nompfは整数定数式パラメータである【NGKI2261】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_MPFをサポートする
【ASPS0216】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_MPFをサポートする
【HRPS0217】．</p>
</div>
<div id="API_SAC_MPF" class="listingblock">
<div class="content">
<pre>SAC_MPF		固定長メモリプールのアクセス許可ベクタの設定〔SP〕【NGKI2262】
sac_mpf		固定長メモリプールのアクセス許可ベクタの設定〔TPD〕【NGKI2263】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_MPF(ID mpfid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_mpf(ID mpfid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mpfid		対象固定長メモリプールのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2264】
				・CPUロック状態からの呼出し〔s〕【NGKI2265】
	E_ID		不正ID番号
				・mpfidが有効範囲外〔s〕【NGKI2266】
	E_RSATR		予約属性
				・対象固定長メモリプールが属する保護ドメインの囲みの中
				　（対象固定長メモリプールが無所属の場合は，保護ドメイ
				　ンの囲みの外）に記述されていない〔S〕【NGKI2267】
				・対象固定長メモリプールが属するクラスの囲みの中に記述
				　されていない〔SM〕【NGKI2268】
	E_NOEXS		オブジェクト未登録
				・対象固定長メモリプールが未登録【NGKI2269】
	E_OACV		オブジェクトアクセス違反
				・対象固定長メモリプールに対する管理操作が許可されてい
				　ない〔s〕【NGKI2270】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI2271】
	E_OBJ		オブジェクト状態エラー
				・対象固定長メモリプールは静的APIで生成された〔s〕【NGKI2272】
				・対象固定長メモリプールに対してアクセス許可ベクタが設
				　定済み〔S〕【NGKI2273】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）のアクセス許
可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に
設定する【NGKI2274】．対象固定長メモリプールの固定長メモリプール領域が
コンフィギュレータまたはカーネルにより確保されたものである場合には，固
定長メモリプール領域のアクセス許可ベクタも，各パラメータで指定した値に
設定する【NGKI2275】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mpfidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI2276】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_MPFのみをサポートする【HRPS0139】．ただし，動的生
成機能拡張パッケージでは，sac_mpfもサポートする【HRPS0200】．</p>
</div>
<div id="API_del_mpf" class="listingblock">
<div class="content">
<pre>del_mpf		固定長メモリプールの削除〔TD〕【NGKI2277】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_mpf(ID mpfid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mpfid		対象固定長メモリプールのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2278】
				・CPUロック状態からの呼出し【NGKI2279】
	E_ID		不正ID番号
				・mpfidが有効範囲外【NGKI2280】
	E_NOEXS		オブジェクト未登録
				・対象固定長メモリプールが未登録【NGKI2281】
	E_OACV		オブジェクトアクセス違反
				・対象固定長メモリプールに対する管理操作が許可されてい
				　ない〔P〕【NGKI2282】
	E_OBJ		オブジェクト状態エラー
				・対象固定長メモリプールは静的APIで生成された【NGKI2283】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）を削除する．
具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールの登録が解除され，その固定長メモリプールIDが未使
用の状態に戻される【NGKI2284】．また，対象固定長メモリプールの待ち行列
につながれたタスクは，待ち行列の先頭のタスクから順に待ち解除される
【NGKI2285】．待ち解除されたタスクには，待ち状態となったサービスコール
からE_DLTエラーが返る【NGKI2286】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>del_mpfにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_mpfをサポートしない【ASPS0170】．ただし，動的生成
機能拡張パッケージでは，del_mpfをサポートする【ASPS0171】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_mpfをサポートしない【FMPS0146】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_mpfをサポートしない【HRPS0140】．ただし，動的生成
機能拡張パッケージでは，del_mpfをサポートする【HRPS0201】．</p>
</div>
<div id="API_get_mpf" class="listingblock">
<div class="content">
<pre>get_mpf		固定長メモリブロックの獲得〔T〕【NGKI2287】
pget_mpf	固定長メモリブロックの獲得（ポーリング）〔T〕【NGKI2288】
tget_mpf	固定長メモリブロックの獲得（タイムアウト付き）〔T〕【NGKI2289】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_mpf(ID mpfid, void **p_blk)
	ER ercd = pget_mpf(ID mpfid, void **p_blk)
	ER ercd = tget_mpf(ID mpfid, void **p_blk, TMO tmout)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mpfid		対象固定長メモリプールのID番号
	void **		p_blk		獲得した固定長メモリブロックの先頭番地を入
							れるメモリ領域へのポインタ
	TMO			tmout		タイムアウト時間（twai_mpfの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	void *		blk			獲得した固定長メモリブロックの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2290】
				・CPUロック状態からの呼出し【NGKI2291】
				・ディスパッチ保留状態からの呼出し（pget_mpfを除く）
				　【NGKI2292】
	E_NOSPT		未サポート機能
				・制約タスクからの呼出し（pget_mpfを除く）【NGKI2293】
	E_ID		不正ID番号
				・mpfidが有効範囲外【NGKI2294】
	E_PAR		パラメータエラー
				・tmoutが無効（tget_mpfの場合）【NGKI2295】
	E_NOEXS		オブジェクト未登録
				・対象固定長メモリプールが未登録〔D〕【NGKI2296】
	E_OACV		オブジェクトアクセス違反
				・対象固定長メモリプールに対する通常操作1が許可されてい
				　ない〔P〕【NGKI2297】
	E_MACV		メモリアクセス違反
				・p_blkが指すメモリ領域への書込みアクセスが許可されてい
				　ない）〔P〕【NGKI2298】
	E_TMOUT		ポーリング失敗またはタイムアウト（get_mpfを除く）【NGKI2299】
	E_RLWAI		待ち禁止状態または待ち状態の強制解除（pget_mpfを除く）
				【NGKI2300】
	E_DLT		待ちオブジェクトの削除または再初期化（pget_mpfを除く）
				【NGKI2301】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）から固定長メ
モリブロックを獲得し，その先頭番地をp_blkが指すメモリ領域に返す．具体的
な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールの固定長メモリプール領域の中に，固定長メモリブロッ
クを割り付けることのできる未割当てのメモリ領域がある場合には，固定長メ
モリブロックが1つ割り付けられ，その先頭番地がblkに返される【NGKI2302】．</p>
</div>
<div class="paragraph">
<p>未割当てのメモリ領域がない場合には，自タスクは固定長メモリプールの獲得
待ち状態となり，対象固定長メモリプールの待ち行列につながれる【NGKI2303】．</p>
</div>
<div id="API_rel_mpf" class="listingblock">
<div class="content">
<pre>rel_mpf		固定長メモリブロックの返却〔T〕【NGKI2304】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = rel_mpf(ID mpfid, void *blk)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mpfid		対象固定長メモリプールのID番号
	void *		blk			返却する固定長メモリブロックの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2305】
				・CPUロック状態からの呼出し【NGKI2306】
	E_ID		不正ID番号
				・mpfidが有効範囲外【NGKI2307】
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_NOEXS		オブジェクト未登録
				・対象固定長メモリプールが未登録〔D〕【NGKI2308】
	E_OACV		オブジェクトアクセス違反
				・対象固定長メモリプールに対する通常操作2が許可されてい
				　ない〔P〕【NGKI2309】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）に，blkで指
定した固定長メモリブロックを返却する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールの待ち行列にタスクが存在する場合には，待ち行列の
先頭のタスクが，blkで指定した固定長メモリブロックを獲得し，待ち解除され
る【NGKI2310】．待ち解除されたタスクには，待ち状態となったサービスコー
ルからE_OKが返る【NGKI2311】．</p>
</div>
<div class="paragraph">
<p>待ち行列にタスクが存在しない場合には，blkで指定した固定長メモリブロック
は，対象固定長メモリプールのメモリプール領域に返却される【NGKI2312】．</p>
</div>
<div class="paragraph">
<p>blkが，対象固定長メモリプールから獲得した固定長メモリブロックの先頭番地
でない場合には，E_PARエラーとなる【NGKI2313】．</p>
</div>
<div id="API_ini_mpf" class="listingblock">
<div class="content">
<pre>ini_mpf		固定長メモリプールの再初期化〔T〕【NGKI2314】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ini_mpf(ID mpfid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mpfid		対象固定長メモリプールのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2315】
				・CPUロック状態からの呼出し【NGKI2316】
	E_ID		不正ID番号
				・mpfidが有効範囲外【NGKI2317】
	E_NOEXS		オブジェクト未登録
				・対象固定長メモリプールが未登録〔D〕【NGKI2318】
	E_OACV		オブジェクトアクセス違反
				・対象固定長メモリプールに対する管理操作が許可されてい
				　ない〔P〕【NGKI2319】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）を再初期化す
る．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールのメモリプール領域全体が未割当ての状態に初期化さ
れる【NGKI2320】．また，対象固定長メモリプールの待ち行列につながれたタ
スクは，待ち行列の先頭のタスクから順に待ち解除される【NGKI2321】．待ち
解除されたタスクには，待ち状態となったサービスコールからE_DLTエラーが返
る【NGKI2322】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ini_mpfにより複数のタスクが待ち解除される場合，サービスコールの処理時間
およびカーネル内での割込み禁止時間が，待ち解除されるタスクの数に比例し
て長くなる．特に，多くのタスクが待ち解除される場合，カーネル内での割込
み禁止時間が長くなるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>固定長メモリプールを再初期化した場合に，アプリケーションとの整合性を保
つのは，アプリケーションの責任である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_mpf" class="listingblock">
<div class="content">
<pre>ref_mpf		固定長メモリプールの状態参照〔T〕【NGKI2323】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_mpf(ID mpfid, T_RMPF *pk_rmpf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			mpfid		対象固定長メモリプールのID番号
	T_RMPF *	pk_rmpf		固定長メモリプールの現在状態を入れるパケッ
							トへのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊固定長メモリプールの現在状態（パケットの内容）
	ID			wtskid		固定長メモリプールの待ち行列の先頭のタスク
							のID番号
	uint_t		fblkcnt		固定長メモリプール領域の空きメモリ領域に割
							り付けることができる固定長メモリブロックの
							数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2324】
				・CPUロック状態からの呼出し【NGKI2325】
	E_ID		不正ID番号
				・mpfidが有効範囲外【NGKI2326】
	E_NOEXS		オブジェクト未登録
				・対象固定長メモリプールが未登録〔D〕【NGKI2327】
	E_OACV		オブジェクトアクセス違反
				・対象固定長メモリプールに対する参照操作が許可されてい
				　ない〔P〕【NGKI2328】
	E_MACV		メモリアクセス違反
				・pk_rmpfが指すメモリ領域への書込みアクセスが許可されて
				　いない）〔P〕【NGKI2329】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>mpfidで指定した固定長メモリプール（対象固定長メモリプール）の現在状態を
参照する．参照した現在状態は，pk_rmpfで指定したパケットに返される
【NGKI2330】．</p>
</div>
<div class="paragraph">
<p>対象固定長メモリプールの待ち行列にタスクが存在しない場合，wtskidには
TSK_NONE（＝0）が返る【NGKI2331】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_mpfはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_mpfを呼び出し，対象固定長メモリプールの現在状態を参照
した直後に割込みが発生した場合，ref_mpfから戻ってきた時には対象固定長メ
モリプールの状態が変化している可能性があるためである．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_時間管理機能">4.6. 時間管理機能</h3>
<div class="sect3">
<h4 id="_システム時刻管理">4.6.1. システム時刻管理</h4>
<div class="paragraph">
<p>システム時刻は，カーネルによって管理され，タイムアウト処理，タスクの遅
延，周期ハンドラの起動，アラームハンドラの起動に使用される時刻を管理す
るカーネルオブジェクトである【NGKI3603】．システム時刻は，符号無しの整
数型であるSYSTIM型で表され，単位はミリ秒である【NGKI2332】．</p>
</div>
<div class="paragraph">
<p>システム時刻は，カーネルの初期化時に0に初期化される【NGKI2333】．タイム
ティックを通知するためのタイマ割込みが発生する毎にカーネルによって更新
され，SYSTIM型で表せる最大値（ULONG_MAX）を超えると0に戻される
【NGKI2334】．タイムティックの周期は，ターゲット定義である【NGKI2335】．
また，システム時刻の精度はターゲットに依存する【NGKI2336】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応でないカーネルと，マルチプロセッサ対応カーネルでグ
ローバルタイマ方式を用いている場合には，システム時刻は，システムに1つの
み存在する【NGKI2337】．マルチプロセッサ対応カーネルでローカルタイマ方
式を用いている場合には，システム時刻は，プロセッサ毎に存在する
【NGKI2338】．ローカルタイマ方式とグローバルタイマ方式については，
「2.3.4 マルチプロセッサ対応」の節を参照すること．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでローカルタイマ方式を用いている場合には，
タイムアウト処理とタスクの遅延処理には，待ち解除されるタスクが割り付け
られているプロセッサのシステム時刻が用いられる【NGKI2339】．また，周期
ハンドラとアラームハンドラの起動には，それが割り付けられているプロセッ
サのシステム時刻が用いられる【NGKI2340】．これらの処理単位がマイグレー
ションする場合には，用いられるシステム時刻も変更される【NGKI2341】．こ
の場合にも，イベントの処理が行われるのは，基準時刻から相対時間によって
指定した以上の時間が経過した後となるという規則は維持される【NGKI2342】．</p>
</div>
<div class="paragraph">
<p>1回のタイムティックの発生により，複数のイベントの処理を行うべき状況になっ
た場合，それらの処理の間の処理順序は規定されない【NGKI2343】．</p>
</div>
<div class="paragraph">
<p>性能評価用システム時刻は，性能評価に使用することを目的とした，システム
時刻よりも精度の高い時刻である．性能評価用システム時刻は，符号無しの整
数型であるSYSUTM型で表され，単位はマイクロ秒である【NGKI2344】．ただし，
実際の精度はターゲットに依存する【NGKI2345】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおける性能評価用システム時刻の扱いは，ター
ゲット定義とする【NGKI2346】．</p>
</div>
<div class="paragraph">
<p>システム時刻管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TIC_NUME	タイムティックの周期（単位はミリ秒）の分子	【NGKI2347】
TIC_DENO	タイムティックの周期（単位はミリ秒）の分母</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_GET_UTM		get_utmがサポートされている【NGKI2348】</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，時間管理機能をサポートしない【SSPS0129】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>タイムティックを通知するためのタイマ割込みが長時間マスクされた場合（タ
イマ割込みより優先して実行される割込み処理が長時間続けて実行された場合
を含む）や，シミュレーション環境においてシミュレータのプロセスが長時間
スケジュールされなかった場合には，システム時刻が正しく更新されない可能
性があるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>システム時刻を設定するサービスコール（set_tim）を廃止した．また，タイム
ティックを供給する機能は，カーネル内に実現することとし，そのためのサー
ビスコール（isig_tim）は廃止した．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>システム時刻のアクセス許可ベクタは廃止し，システム状態のアクセス許可ベ
クタで代替することとした．そのため，システム時刻のアクセス許可ベクタを
設定する静的API（SAC_TIM）とサービスコール（sac_tim）は廃止した．</p>
</div>
<div id="API_get_tim" class="listingblock">
<div class="content">
<pre>get_tim		システム時刻の参照〔T〕【NGKI2349】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_tim(SYSTIM *p_systim)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SYSTIM *	p_systim	システム時刻を入れるメモリ領域へのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	SYSTIM		systim		システム時刻の現在値</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2350】
				・CPUロック状態からの呼出し【NGKI2351】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する参照操作が許可されていない〔P〕
				　【NGKI2352】
	E_MACV		メモリアクセス違反
				・p_systimが指すメモリ領域への書込みアクセスが許可され
				　ていない）〔P〕【NGKI2353】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>システム時刻の現在値を参照する．参照したシステム時刻は，p_systimが指す
メモリ領域に返される【NGKI2354】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでローカルタイマ方式を用いている場合には，
自タスクが割り付けられているプロセッサのシステム時刻の現在値を参照する
【NGKI2355】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでローカルタイマ方式を用いている場合に，他
のプロセッサのシステム時刻の現在値を参照する機能は用意していない．</p>
</div>
<div id="API_get_utm" class="listingblock">
<div class="content">
<pre>get_utm		性能評価用システム時刻の参照〔TI〕【NGKI2356】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_utm(SYSUTM *p_sysutm)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SYSUTM *	p_sysutm	性能評価用システム時刻を入れるメモリ領域へ
							のポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	SYSUTM		sysutm		性能評価用システム時刻の現在値</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_MACV		メモリアクセス違反
				・p_sysutmが指すメモリ領域へ書込みアクセスが許可されて
				　いない）〔P〕【NGKI2357】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>性能評価用システム時刻の現在値を参照する．参照した性能評価用システム時
刻は，p_sysutmが指すメモリ領域に返される【NGKI2358】．</p>
</div>
<div class="paragraph">
<p>get_utmは，任意の状態から呼び出すことができる【NGKI2359】．タスクコンテ
キストからも非タスクコンテキストからも呼び出すことができるし，CPUロック
状態であっても呼び出すことができる．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，get_utmがサポートされていない場合がある【NGKI2360】．
get_utmがサポートされている場合には，TOPPERS_SUPPORT_GET_UTMがマクロ定
義される【NGKI2361】．サポートされていない場合にget_utmを呼び出すと，
E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI2362】．</p>
</div>
<div class="paragraph">
<p>【使用方法】</p>
</div>
<div class="paragraph">
<p>get_utmを使用してプログラムの処理時間を計測する場合には，次の手順を取る．
処理時間を計測したいプログラムの実行直前と実行直後に，get_utmを用いて性
能評価用システム時刻を読み出す．その差を求めることで，対象プログラムの
処理時間に，get_utm自身の処理時間を加えたものが得られる．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，異なるプロセッサで読み出した性
能評価用システム時刻の差を求めることで，処理時間が正しく計測できるとは
限らない．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>get_utmは性能評価のための機能であり，その他の目的に使用することは推奨し
ない．</p>
</div>
<div class="paragraph">
<p>get_utmは，任意の状態から呼び出すことができるように，全割込みロック状態
を用いて実装されている．そのため，get_utmを用いると，カーネル管理外の割
込みの応答性が低下する．</p>
</div>
<div class="paragraph">
<p>システム時刻が正しく更新されない状況では，get_utmは誤った性能評価用シス
テム時刻を返す可能性がある．システム時刻の更新が確実に行われることを保
証できない場合には，get_utmが誤った性能評価用システム時刻を返す可能性を
考慮に入れて使用しなければならない．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
</div>
<div class="sect3">
<h4 id="_周期ハンドラ">4.6.2. 周期ハンドラ</h4>
<div class="paragraph">
<p>周期ハンドラは，指定した周期で起動されるタイムイベントハンドラである．
周期ハンドラは，周期ハンドラIDと呼ぶID番号によって識別する【NGKI2363】．</p>
</div>
<div class="paragraph">
<p>各周期ハンドラが持つ情報は次の通り【NGKI2364】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>周期ハンドラ属性</p>
</li>
<li>
<p>周期ハンドラの動作状態</p>
</li>
<li>
<p>次に周期ハンドラを起動する時刻</p>
</li>
<li>
<p>拡張情報</p>
</li>
<li>
<p>周期ハンドラの先頭番地</p>
</li>
<li>
<p>起動周期</p>
</li>
<li>
<p>起動位相</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>周期ハンドラの起動時刻は，後述する基準時刻から，以下の式で求められる相
対時間後である【NGKI2365】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>起動位相＋起動周期×(n−1)		n＝1,2,…</pre>
</div>
</div>
<div class="paragraph">
<p>周期ハンドラの動作状態は，動作している状態と動作していない状態のいずれ
かをとる【NGKI2366】．周期ハンドラを動作している状態にすることを動作開
始，動作していない状態にすることを動作停止という．</p>
</div>
<div class="paragraph">
<p>周期ハンドラが動作している状態の場合には，周期ハンドラを起動する時刻に
なると，周期ハンドラの起動処理が行われる【NGKI2367】．具体的には，拡張
情報をパラメータとして，周期ハンドラが呼び出される【NGKI2368】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，周期ハンドラが属することのできる保護ドメ
インは，カーネルドメインに限られる【NGKI2369】．</p>
</div>
<div class="paragraph">
<p>周期ハンドラ属性には，次の属性を指定することができる【NGKI2370】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_STA		0x02U	周期ハンドラの生成時に周期ハンドラを動作開始する
TA_PHS		0x04U	周期ハンドラを生成した時刻を基準時刻とする</pre>
</div>
</div>
<div class="paragraph">
<p>TA_STAを指定しない場合，周期ハンドラの生成直後には，周期ハンドラは動作
していない状態となる【NGKI2371】．</p>
</div>
<div class="paragraph">
<p>TA_PHSを指定しない場合には，周期ハンドラを動作開始した時刻が，周期ハン
ドラを起動する時刻の基準時刻となる【NGKI2372】．TA_PHSを指定した場合に
は，周期ハンドラを生成した時刻（静的APIで生成した場合にはカーネルの起動
時刻）が，基準時刻となる【NGKI2373】．</p>
</div>
<div class="paragraph">
<p>次に周期ハンドラを起動する時刻は，周期ハンドラが動作している状態でのみ
有効で，必要に応じて，カーネルの起動時，周期ハンドラの動作開始時，周期
ハンドラの起動処理時に設定される【NGKI2374】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでグローバルタイマ方式を用いている場合には，
周期ハンドラは，システム時刻管理プロセッサのみが割付け可能プロセッサで
あるクラスにのみ属することができる【NGKI2375】．すなわち，周期ハンドラ
は，システム時刻管理プロセッサによって実行される．</p>
</div>
<div class="paragraph">
<p>C言語による周期ハンドラの記述形式は次の通り【NGKI2376】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void cyclic_handler(intptr_t exinf)
	{
		周期ハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，周期ハンドラの拡張情報が渡される【NGKI2377】．</p>
</div>
<div class="paragraph">
<p>周期ハンドラ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_CYCID		登録できる周期ハンドラの数（動的生成対応でないカー
				ネルでは，静的APIによって登録された周期ハンドラの数
				に一致）【NGKI2378】</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，TA_PHS属性の周期ハンドラをサポートしない【ASPS0172】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，TA_PHS属性の周期ハンドラをサポートしない【FMPS0147】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，TA_PHS属性の周期ハンドラをサポートしない【HRPS0141】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TNUM_CYCIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_CYC" class="listingblock">
<div class="content">
<pre>CRE_CYC		周期ハンドラの生成〔S〕【NGKI2379】
acre_cyc	周期ハンドラの生成〔TD〕【NGKI2380】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_CYC(ID cycid, { ATR cycatr, intptr_t exinf, CYCHDR cychdr,
										RELTIM cyctim, RELTIM cycphs })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID cycid = acre_cyc(const T_CCYC *pk_ccyc)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			cycid		生成する周期ハンドラのID番号（CRE_CYCの場合）
	T_CCYC *	pk_ccyc		周期ハンドラの生成情報を入れたパケットへの
							ポインタ（静的APIを除く）

　＊周期ハンドラの生成情報（パケットの内容）
	ATR			cycatr		周期ハンドラ属性
	intptr_t	exinf		周期ハンドラの拡張情報
	CYCHDR		cychdr		周期ハンドラの先頭番地
	RELTIM		cyctim		周期ハンドラの起動周期
	RELTIM		cycphs		周期ハンドラの起動位相</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		cycid		生成された周期ハンドラのID番号（正の値）また
							はエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2381】
				・CPUロック状態からの呼出し〔s〕【NGKI2382】
	E_RSATR		予約属性
				・cycatrが無効【NGKI2383】
				・属する保護ドメインの指定が有効範囲外またはカーネルド
				　メイン以外〔sP〕【NGKI2384】
				・カーネルドメインの囲みの中に記述されていない〔SP〕
				　【NGKI2385】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI2386】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI2387】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・cychdrがプログラムの先頭番地として正しくない【NGKI2388】
				・cyctimが有効範囲（0より大きくTMAX_RELTIM以下）外【NGKI2397】
				・cycphsが有効範囲（0以上TMAX_RELTIM以下）外【NGKI2399】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2389】
	E_MACV		メモリアクセス違反
				・pk_ccycが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2390】
	E_NOID		ID番号不足
				・割り付けられる周期ハンドラIDがない〔sD〕【NGKI2391】
	E_OBJ		オブジェクト状態エラー
				・cycidで指定した周期ハンドラが登録済み（CRE_CYCの場合）
				　【NGKI2392】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した周期ハンドラ生成情報に従って，周期ハンドラを生成
する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>cycatrにTA_STAを指定した場合，対象周期ハンドラは動作している状態となる
【NGKI2393】．次に周期ハンドラを起動する時刻は，サービスコールを呼び出
した時刻（静的APIの場合はカーネルの起動時刻）から，cycphsで指定した相対
時間後に設定される【NGKI2394】．cycphsにcyctimより大きい値を指定しても
よい【NGKI2400】．</p>
</div>
<div class="paragraph">
<p>cycatrにTA_STAを指定しない場合，対象周期ハンドラは動作していない状態に
初期化される【NGKI2395】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，cycidはオブジェクト識別名，cycatr，cyctim，cycphsは
整数定数式パラメータ，exinfとcychdrは一般定数式パラメータである
【NGKI2396】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでグローバルタイマ方式を用いている場合で，
生成する周期ハンドラの属するクラスの割付け可能プロセッサが，システム時
刻管理プロセッサのみでない場合には，E_RSATRエラーとなる【NGKI2401】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>静的APIにおいて，cycatrにTA_STAを，cycphsに0を指定した場合，周期ハンド
ラが最初に呼び出されるのは，カーネル起動後最初のタイムティックになる．
cycphsに1を指定した場合も同じ振舞いとなるため，静的APIでcycatrにTA_STA
が指定されている場合には，cycphsに0を指定することは推奨されず，コンフィ
ギュレータが警告メッセージを出力する．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_CYCのみをサポートする【ASPS0173】．ただし，TA_PHS
属性の周期ハンドラはサポートしない【ASPS0174】．動的生成機能拡張パッケー
ジでは，acre_cycもサポートする【ASPS0175】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_CYCのみをサポートする【FMPS0148】．ただし，TA_PHS
属性の周期ハンドラはサポートしない【FMPS0149】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_CYCのみをサポートする【HRPS0142】．ただし，
TA_PHS属性の周期ハンドラはサポートしない【HRPS0143】．動的生成機能拡張
パッケージでは，acre_cycもサポートする【HRPS0202】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>cychdrのデータ型をCYCHDRに変更した．また，cycphsにcyctimより大きい値を
指定した場合の振舞いと，静的APIでcycphsに0を指定した場合の振舞いを規定
した．</p>
</div>
<div id="API_AID_CYC" class="listingblock">
<div class="content">
<pre>AID_CYC		割付け可能な周期ハンドラIDの数の指定〔SD〕【NGKI2402】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_CYC(uint_t nocyc)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		nocyc		割付け可能な周期ハンドラIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3437】
				・クラスの囲みの中に記述されていない〔M〕【NGKI2404】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・nocycが負の値【NGKI3285】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>nocycで指定した数の周期ハンドラIDを，周期ハンドラを生成するサービスコー
ルによって割付け可能な周期ハンドラIDとして確保する【NGKI2405】．</p>
</div>
<div class="paragraph">
<p>nocycは整数定数式パラメータである【NGKI2406】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでグローバルタイマ方式を用いている場合で，
AID_CYCが属するクラスの割付け可能プロセッサが，システム時刻管理プロセッ
サのみでない場合には，E_RSATRエラーとなる【NGKI2407】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_CYCをサポートする
【ASPS0217】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_CYCをサポートする
【HRPS0218】．</p>
</div>
<div id="API_SAC_CYC" class="listingblock">
<div class="content">
<pre>SAC_CYC		周期ハンドラのアクセス許可ベクタの設定〔SP〕【NGKI2408】
sac_cyc		周期ハンドラのアクセス許可ベクタの設定〔TPD〕【NGKI2409】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_CYC(ID cycid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_cyc(ID cycid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			cycid		対象周期ハンドラのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2410】
				・CPUロック状態からの呼出し〔s〕【NGKI2411】
	E_ID		不正ID番号
				・cycidが有効範囲外〔s〕【NGKI2412】
	E_RSATR		予約属性
				・カーネルドメインの囲みの中に記述されていない〔S〕【NGKI2413】
				・対象周期ハンドラが属するクラスの囲みの中に記述されて
				　いない〔SM〕【NGKI2414】
	E_NOEXS		オブジェクト未登録
				・対象周期ハンドラが未登録【NGKI2415】
	E_OACV		オブジェクトアクセス違反
				・対象周期ハンドラに対する管理操作が許可されていない〔s〕
				　【NGKI2416】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI2417】
	E_OBJ		オブジェクト状態エラー
				・対象周期ハンドラは静的APIで生成された〔s〕【NGKI2418】
				・対象周期ハンドラに対してアクセス許可ベクタが設定済み
				　〔S〕【NGKI2419】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>cycidで指定した周期ハンドラ（対象周期ハンドラ）のアクセス許可ベクタ（4
つのアクセス許可パターンの組）を，各パラメータで指定した値に設定する
【NGKI2420】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，cycidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI2421】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_CYCのみをサポートする【HRPS0144】．ただし，動的生
成機能拡張パッケージでは，sac_cycもサポートする【HRPS0203】．</p>
</div>
<div id="API_del_cyc" class="listingblock">
<div class="content">
<pre>del_cyc		周期ハンドラの削除〔TD〕【NGKI2422】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_cyc(ID cycid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			cycid		対象周期ハンドラのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2423】
				・CPUロック状態からの呼出し【NGKI2424】
	E_ID		不正ID番号
				・cycidが有効範囲外【NGKI2425】
	E_NOEXS		オブジェクト未登録
				・対象周期ハンドラが未登録【NGKI2426】
	E_OACV		オブジェクトアクセス違反
				・対象周期ハンドラに対する管理操作が許可されていない〔P〕
				　【NGKI2427】
	E_OBJ		オブジェクト状態エラー
				・対象周期ハンドラは静的APIで生成された【NGKI2428】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>cycidで指定した周期ハンドラ（対象周期ハンドラ）を削除する．具体的な振舞
いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラの登録が解除され，その周期ハンドラIDが未使用の状態に戻
される【NGKI2429】．対象周期ハンドラが動作している状態であった場合には，
動作していない状態にされた後に，登録が解除される【NGKI2430】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_cycをサポートしない【ASPS0177】．ただし，動的生成
機能拡張パッケージでは，del_cycをサポートする【ASPS0178】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_cycをサポートしない【FMPS0151】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_cycをサポートしない【HRPS0145】．ただし，動的生成
機能拡張パッケージでは，del_cycをサポートする【HRPS0204】．</p>
</div>
<div id="API_sta_cyc" class="listingblock">
<div class="content">
<pre>sta_cyc		周期ハンドラの動作開始〔T〕【NGKI2431】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sta_cyc(ID cycid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			cycid		対象周期ハンドラのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2432】
				・CPUロック状態からの呼出し【NGKI2433】
	E_ID		不正ID番号
				・cycidが有効範囲外【NGKI2434】
	E_NOEXS		オブジェクト未登録
				・対象周期ハンドラが未登録〔D〕【NGKI2435】
	E_OACV		オブジェクトアクセス違反
				・対象周期ハンドラに対する通常操作1が許可されていない〔P〕
				　【NGKI2436】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>cycidで指定した周期ハンドラ（対象周期ハンドラ）を動作開始する．具体的な
振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラが動作していない状態であれば，対象周期ハンドラは動作し
ている状態となる【NGKI2437】．次に周期ハンドラを起動する時刻は，
sta_cycを呼び出して以降の最初の起動時刻に設定される【NGKI2438】．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラが動作している状態であれば，次に周期ハンドラを起動する
時刻の再設定のみが行われる【NGKI2439】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>TA_PHS属性でない周期ハンドラの場合，次に周期ハンドラを起動する時刻は，
sta_cycを呼び出してから，対象周期ハンドラの起動位相で指定した相対時間後
に設定される．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラがTA_PHS属性で，動作している状態であれば，次に周期ハン
ドラを起動する時刻は変化しない．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TA_PHS属性でない周期ハンドラにおいて，sta_cycを呼び出した後，最初に周期
ハンドラが起動される時刻を変更した．μITRON4.0仕様では，sta_cycを呼び出
してから周期ハンドラの起動周期で指定した相対時間後となっているが，この
仕様では，起動位相で指定した相対時間後とした．</p>
</div>
<div id="API_msta_cyc" class="listingblock">
<div class="content">
<pre>msta_cyc	割付けプロセッサ指定での周期ハンドラの動作開始〔TM〕【NGKI2440】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = msta_cyc(ID cycid, ID prcid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			cycid		対象周期ハンドラのID番号
	ID			prcid		周期ハンドラの割付け対象のプロセッサのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2441】
				・CPUロック状態からの呼出し【NGKI2442】
	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_ID		不正ID番号
				・cycidが有効範囲外【NGKI2443】
				・prcidが有効範囲外【NGKI2444】
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_NOEXS		オブジェクト未登録
				・対象周期ハンドラが未登録〔D〕【NGKI2445】
	E_OACV		オブジェクトアクセス違反
				・対象周期ハンドラに対する通常操作1が許可されていない〔P〕
				　【NGKI2446】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>prcidで指定したプロセッサを割付けプロセッサとして，cycidで指定した周期
ハンドラ（対象周期ハンドラ）を動作開始する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラが動作していない状態であれば，対象周期ハンドラの割付け
プロセッサがprcidで指定したプロセッサに変更された後，対象周期ハンドラは
動作している状態となる【NGKI2447】．次に周期ハンドラを起動する時刻は，
msta_cycを呼び出して以降の最初の起動時刻に設定される【NGKI2448】．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラが動作している状態であれば，対象周期ハンドラの割付けプ
ロセッサがprcidで指定したプロセッサに変更された後，次に周期ハンドラを起
動する時刻の再設定が行われる【NGKI2449】．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラが実行中である場合には，割付けプロセッサを変更しても，
実行中の周期ハンドラを実行するプロセッサは変更されない【NGKI2450】．対
象周期ハンドラが変更後の割付けプロセッサで実行されるのは，次に起動され
る時からである【NGKI2451】．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラの属するクラスの割付け可能プロセッサが，prcidで指定した
プロセッサを含んでいない場合には，E_PARエラーとなる【NGKI2452】．</p>
</div>
<div class="paragraph">
<p>prcidにTPRC_INI（＝0）を指定すると，対象周期ハンドラの割付けプロセッサ
を，それが属するクラスの初期割付けプロセッサとする【NGKI2453】．</p>
</div>
<div class="paragraph">
<p>グローバルタイマ方式を用いている場合，msta_cycはE_NOSPTを返す
【NGKI2454】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>TA_PHS属性でない周期ハンドラの場合，次に周期ハンドラを起動する時刻は，
msta_cycを呼び出してから，対象周期ハンドラの起動位相で指定した相対時間
後に設定される．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>msta_cycで実行中の周期ハンドラの割付けプロセッサを変更した場合，同じ周
期ハンドラが異なるプロセッサで同時に実行される可能性がある．特に，対象
周期ハンドラの起動位相が0の場合に，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_stp_cyc" class="listingblock">
<div class="content">
<pre>stp_cyc		周期ハンドラの動作停止〔T〕【NGKI2455】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = stp_cyc(ID cycid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			cycid		対象周期ハンドラのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2456】
				・CPUロック状態からの呼出し【NGKI2457】
	E_ID		不正ID番号
				・cycidが有効範囲外【NGKI2458】
	E_NOEXS		オブジェクト未登録
				・対象周期ハンドラが未登録〔D〕【NGKI2459】
	E_OACV		オブジェクトアクセス違反
				・対象周期ハンドラに対する通常操作2が許可されていない〔P〕
				　【NGKI2460】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>cycidで指定した周期ハンドラ（対象周期ハンドラ）を動作停止する．具体的な
振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象周期ハンドラが動作している状態であれば，動作していない状態になる
【NGKI2461】．対象周期ハンドラが動作していない状態であれば，何も行われ
ずに正常終了する【NGKI2462】．</p>
</div>
<div id="API_ref_cyc" class="listingblock">
<div class="content">
<pre>ref_cyc		周期ハンドラの状態参照〔T〕【NGKI2463】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_cyc(ID cycid, T_RCYC *pk_rcyc)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			cycid		対象周期ハンドラのID番号
	T_RCYC *	pk_rcyc		周期ハンドラの現在状態を入れるパケットへの
							ポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊周期ハンドラの現在状態（パケットの内容）
	STAT		cycstat		周期ハンドラの動作状態
	RELTIM		lefttim		次に周期ハンドラを起動する時刻までの相対時間
	ID			prcid		周期ハンドラの割付けプロセッサのID（マルチプ
							ロセッサ対応カーネルの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2464】
				・CPUロック状態からの呼出し【NGKI2465】
	E_ID		不正ID番号
				・cycidが有効範囲外【NGKI2466】
	E_NOEXS		オブジェクト未登録
				・対象周期ハンドラが未登録〔D〕【NGKI2467】
	E_OACV		オブジェクトアクセス違反
				・対象周期ハンドラに対する参照操作が許可されていない〔P〕
				　【NGKI2468】
	E_MACV		メモリアクセス違反
				・pk_rcycが指すメモリ領域への書込みアクセスが許可されて
				　いない）〔P〕【NGKI2469】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>cycidで指定した周期ハンドラ（対象周期ハンドラ）の現在状態を参照する．参
照した現在状態は，pk_rcycで指定したパケットに返される【NGKI2470】．</p>
</div>
<div class="paragraph">
<p>cycstatには，対象周期ハンドラの現在の動作状態を表す次のいずれかの値が返
される【NGKI2471】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TCYC_STP	0x01U		周期ハンドラが動作していない状態
TCYC_STA	0x02U		周期ハンドラが動作している状態</pre>
</div>
</div>
<div class="paragraph">
<p>対象周期ハンドラが動作している状態である場合には，lefttimに，次に周期ハ
ンドラ起動する時刻までの相対時間が返される【NGKI2472】．対象周期ハンド
ラが動作していない状態である場合には，lefttimの値は保証されない
【NGKI2473】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，prcidに，対象周期ハンドラの割付けプロ
セッサのID番号が返される【NGKI2474】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_cycはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_cycを呼び出し，対象周期ハンドラの現在状態を参照した直
後に割込みが発生した場合，ref_cycから戻ってきた時には対象周期ハンドラの
状態が変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TCYC_STPとTCYC_STAを値を変更した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_アラームハンドラ">4.6.3. アラームハンドラ</h4>
<div class="paragraph">
<p>アラームハンドラは，指定した相対時間後に起動されるタイムイベントハンド
ラである．アラームハンドラは，アラームハンドラIDと呼ぶID番号によって識
別する【NGKI2475】．</p>
</div>
<div class="paragraph">
<p>各アラームハンドラが持つ情報は次の通り【NGKI2476】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>アラームハンドラ属性</p>
</li>
<li>
<p>アラームハンドラの動作状態</p>
</li>
<li>
<p>アラームハンドラを起動する時刻</p>
</li>
<li>
<p>拡張情報</p>
</li>
<li>
<p>アラームハンドラの先頭番地</p>
</li>
<li>
<p>アクセス許可ベクタ（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属する保護ドメイン（保護機能対応カーネルの場合）</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>アラームハンドラの動作状態は，動作している状態と動作していない状態のい
ずれかをとる【NGKI2477】．アラームハンドラを動作している状態にすること
を動作開始，動作していない状態にすることを動作停止という．</p>
</div>
<div class="paragraph">
<p>アラームハンドラを起動する時刻は，アラームハンドラを動作開始する時に設
定される【NGKI2478】．</p>
</div>
<div class="paragraph">
<p>アラームハンドラが動作している状態の場合には，アラームハンドラを起動す
る時刻になると，アラームハンドラの起動処理が行われる【NGKI2479】．具体
的には，まず，アラームハンドラが動作していない状態にされる【NGKI2480】．
その後に，拡張情報をパラメータとして，アラームハンドラが呼び出される
【NGKI2481】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，アラームハンドラが属することのできる保護
ドメインは，カーネルドメインに限られる【NGKI2482】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでグローバルタイマ方式を用いている場合には，
アラームハンドラは，割付け可能プロセッサがシステム時刻管理プロセッサの
みであるクラスにのみ属することができる【NGKI2483】．すなわち，アラーム
ハンドラは，システム時刻管理プロセッサによって実行される．</p>
</div>
<div class="paragraph">
<p>アラームハンドラ属性に指定できる属性はない【NGKI3423】．そのためアラー
ムハンドラ属性には，TA_NULLを指定しなければならない【NGKI3424】．</p>
</div>
<div class="paragraph">
<p>C言語によるアラームハンドラの記述形式は次の通り【NGKI2484】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void alarm_handler(intptr_t exinf)
	{
		アラームハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，アラームハンドラの拡張情報が渡される【NGKI2485】．</p>
</div>
<div class="paragraph">
<p>アラームハンドラ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_ALMID		登録できるアラームハンドラの数（動的生成対応でない
				カーネルでは，静的APIによって登録されたアラームハン
				ドラの数に一致）【NGKI2486】</pre>
</div>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TNUM_ALMIDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_CRE_ALM" class="listingblock">
<div class="content">
<pre>CRE_ALM		アラームハンドラの生成〔S〕【NGKI2487】
acre_alm	アラームハンドラの生成〔TD〕【NGKI2488】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_ALM(ID almid, { ATR almatr, intptr_t exinf, ALMHDR almhdr })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID almid = acre_alm(const T_CALM *pk_calm)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			almid		生成するアラームハンドラのID番号（CRE_ALM
							の場合）
	T_CALM *	pk_calm		アラームハンドラの生成情報を入れたパケット
							へのポインタ（静的APIを除く）

　＊アラームハンドラの生成情報（パケットの内容）
	ATR			almatr		アラームハンドラ属性
	intptr_t	exinf		アラームハンドラの拡張情報
	ALMHDR		almhdr		アラームハンドラの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		almid		生成されたアラームハンドラのID番号（正の値）
							またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2489】
				・CPUロック状態からの呼出し〔s〕【NGKI2490】
	E_RSATR		予約属性
				・almatrが無効【NGKI2491】
				・属する保護ドメインの指定が有効範囲外またはカーネルド
				　メイン以外〔sP〕【NGKI2492】
				・カーネルドメインの囲みの中に記述されていない〔SP〕
				　【NGKI2493】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI2494】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI2495】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・almhdrがプログラムの先頭番地として正しくない【NGKI2496】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2497】
	E_MACV		メモリアクセス違反
				・pk_calmが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2498】
	E_NOID		ID番号不足
				・割り付けられるアラームハンドラIDがない〔sD〕【NGKI2499】
	E_OBJ		オブジェクト状態エラー
				・almidで指定したアラームハンドラが登録済み（CRE_ALMの
				　場合）【NGKI2500】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したアラームハンドラ生成情報に従って，アラームハンド
ラを生成する．対象アラームハンドラは，動作していない状態に初期化される
【NGKI2501】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，almidはオブジェクト識別名，almatrは整数定数式パラメー
タ，exinfとalmhdrは一般定数式パラメータである【NGKI2502】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでグローバルタイマ方式を用いている場合で，
生成するアラームハンドラの属するクラスの割付け可能プロセッサが，システ
ム時刻管理プロセッサのみでない場合には，E_RSATRエラーとなる【NGKI2503】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CRE_ALMのみをサポートする【ASPS0179】．ただし，動的生
成機能拡張パッケージでは，acre_almもサポートする【ASPS0180】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CRE_ALMのみをサポートする【FMPS0152】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CRE_ALMのみをサポートする【HRPS0146】．ただし，動的生
成機能拡張パッケージでは，acre_almもサポートする【HRPS0205】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>almhdrのデータ型をALMHDRに変更した．</p>
</div>
<div id="API_AID_ALM" class="listingblock">
<div class="content">
<pre>AID_ALM		割付け可能なアラームハンドラIDの数の指定〔SD〕【NGKI2504】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_ALM(uint_t noalm)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		noalm		割付け可能なアラームハンドラIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3438】
				・クラスの囲みの中に記述されていない〔M〕【NGKI2506】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・noalmが負の値【NGKI3286】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>noalmで指定した数のアラームハンドラIDを，アラームハンドラを生成するサー
ビスコールによって割付け可能なアラームハンドラIDとして確保する
【NGKI2507】．</p>
</div>
<div class="paragraph">
<p>noalmは整数定数式パラメータである【NGKI2508】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでグローバルタイマ方式を用いている場合で，
AID_ALMが属するクラスの割付け可能プロセッサが，システム時刻管理プロセッ
サのみでない場合には，E_RSATRエラーとなる【NGKI2509】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_ALMをサポートする
【ASPS0218】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_ALMをサポートする
【HRPS0219】．</p>
</div>
<div id="API_SAC_ALM" class="listingblock">
<div class="content">
<pre>SAC_ALM		アラームハンドラのアクセス許可ベクタの設定〔SP〕【NGKI2510】
sac_alm		アラームハンドラのアクセス許可ベクタの設定〔TPD〕【NGKI2511】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_ALM(ID almid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_alm(ID almid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			almid		対象アラームハンドラのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2512】
				・CPUロック状態からの呼出し〔s〕【NGKI2513】
	E_ID		不正ID番号
				・almidが有効範囲外〔s〕【NGKI2514】
	E_RSATR		予約属性
				・カーネルドメインの囲みの中に記述されていない〔S〕【NGKI2515】
				・対象アラームハンドラが属するクラスの囲みの中に記述さ
				　れていない〔SM〕【NGKI2516】
	E_NOEXS		オブジェクト未登録
				・対象アラームハンドラが未登録【NGKI2517】
	E_OACV		オブジェクトアクセス違反
				・対象アラームハンドラに対する管理操作が許可されていな
				　い〔s〕【NGKI2518】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI2519】
	E_OBJ		オブジェクト状態エラー
				・対象アラームハンドラは静的APIで生成された〔s〕【NGKI2520】
				・対象アラームハンドラに対してアクセス許可ベクタが設定
				　済み〔S〕【NGKI2521】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>almidで指定したアラームハンドラ（対象アラームハンドラ）のアクセス許可ベ
クタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に設定
する【NGKI2522】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，almidはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI2523】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_ALMのみをサポートする【HRPS0147】．ただし，動的生
成機能拡張パッケージでは，sac_almもサポートする【HRPS0206】．</p>
</div>
<div id="API_del_alm" class="listingblock">
<div class="content">
<pre>del_alm		アラームハンドラの削除〔TD〕【NGKI2524】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_alm(ID almid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			almid		対象アラームハンドラのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2525】
				・CPUロック状態からの呼出し【NGKI2526】
	E_ID		不正ID番号
				・almidが有効範囲外【NGKI2527】
	E_NOEXS		オブジェクト未登録
				・対象アラームハンドラが未登録【NGKI2528】
	E_OACV		オブジェクトアクセス違反
				・対象アラームハンドラに対する管理操作が許可されていな
				　い〔P〕【NGKI2529】
	E_OBJ		オブジェクト状態エラー
				・対象アラームハンドラは静的APIで生成された【NGKI2530】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>almidで指定したアラームハンドラ（対象アラームハンドラ）を削除する．具体
的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象アラームハンドラの登録が解除され，そのアラームハンドラIDが未使用の
状態に戻される【NGKI2531】．対象アラームハンドラが動作している状態であっ
た場合には，登録解除の前に，アラームハンドラが動作していない状態となる
【NGKI2532】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_almをサポートしない【ASPS0182】．ただし，動的生成
機能拡張パッケージでは，del_almをサポートする【ASPS0183】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_almをサポートしない【FMPS0154】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_almをサポートしない【HRPS0148】．ただし，動的生成
機能拡張パッケージでは，del_almをサポートする【HRPS0207】．</p>
</div>
<div id="API_sta_alm" class="listingblock">
<div class="content">
<pre>sta_alm		アラームハンドラの動作開始〔T〕【NGKI2533】
ista_alm	アラームハンドラの動作開始〔I〕【NGKI2534】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sta_alm(ID almid, RELTIM almtim)
	ER ercd = ista_alm(ID almid, RELTIM almtim)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			almid		対象アラームハンドラのID番号
	RELTIM		almtim		アラームハンドラの起動時刻（相対時間）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（sta_almの場合）【NGKI2535】
				・タスクコンテキストからの呼出し（ista_almの場合）【NGKI2536】
				・CPUロック状態からの呼出し
	E_ID		不正ID番号
				・almidが有効範囲外【NGKI2537】
	E_PAR		パラメータエラー
				・almtimがTMAX_RELTIMより大きい【NGKI2538】
	E_NOEXS		オブジェクト未登録
				・対象アラームハンドラが未登録〔D〕【NGKI2539】
	E_OACV		オブジェクトアクセス違反
				・対象アラームハンドラに対する通常操作1が許可されていな
				　い（sta_almの場合）〔P〕【NGKI2540】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>almidで指定したアラームハンドラ（対象アラームハンドラ）を動作開始する．
具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象アラームハンドラが動作していない状態であれば，対象アラームハンドラ
は動作している状態となる【NGKI2541】．アラームハンドラを起動する時刻は，
sta_almを呼び出してから，almtimで指定した相対時間後に設定される
【NGKI2542】．</p>
</div>
<div class="paragraph">
<p>対象アラームハンドラが動作している状態であれば，アラームハンドラを起動
する時刻の再設定のみが行われる【NGKI2543】．</p>
</div>
<div id="API_msta_alm" class="listingblock">
<div class="content">
<pre>msta_alm	割付けプロセッサ指定でのアラームハンドラの動作開始〔TM〕【NGKI2544】
imsta_alm	割付けプロセッサ指定でのアラームハンドラの動作開始〔IM〕【NGKI2545】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = msta_alm(ID almid, RELTIM almtim, ID prcid)
	ER ercd = imsta_alm(ID almid, RELTIM almtim, ID prcid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			almid		対象アラームハンドラのID番号
	RELTIM		almtim		アラームハンドラの起動時刻（相対時間）
	ID			prcid		アラームハンドラの割付け対象のプロセッサの
							ID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（msta_almの場合）
				　【NGKI2546】
				・タスクコンテキストからの呼出し（imsta_almの場合）【NGKI2547】
				・CPUロック状態からの呼出し【NGKI2548】
	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_ID		不正ID番号
				・almidが有効範囲外【NGKI2549】
				・prcidが有効範囲外【NGKI2550】
	E_PAR		パラメータエラー
				・almtimがTMAX_RELTIMより大きい【NGKI2551】
				・その他の条件については機能の項を参照
	E_NOEXS		オブジェクト未登録
				・対象アラームハンドラが未登録〔D〕【NGKI2552】
	E_OACV		オブジェクトアクセス違反
				・対象アラームハンドラに対する通常操作1が許可されていな
				　い（msta_almの場合）〔P〕【NGKI2553】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>prcidで指定したプロセッサを割付けプロセッサとして，almidで指定したアラー
ムハンドラ（対象アラームハンドラ）を動作開始する．具体的な振舞いは以下
の通り．</p>
</div>
<div class="paragraph">
<p>対象アラームハンドラが動作していない状態であれば，対象アラームハンドラ
の割付けプロセッサがprcidで指定したプロセッサに変更された後，対象アラー
ムハンドラは動作している状態となる【NGKI2554】．アラームハンドラを起動
する時刻は，msta_almを呼び出してから，almtimで指定した相対時間後に設定
される【NGKI2555】．</p>
</div>
<div class="paragraph">
<p>対象アラームハンドラが動作している状態であれば，対象アラームハンドラの
割付けプロセッサがprcidで指定したプロセッサに変更された後，アラームハン
ドラを起動する時刻の再設定が行われる【NGKI2556】．</p>
</div>
<div class="paragraph">
<p>対象アラームハンドラが実行中である場合には，割付けプロセッサを変更して
も，実行中のアラームハンドラを実行するプロセッサは変更されない
【NGKI2557】．対象アラームハンドラが変更後の割付けプロセッサで実行され
るのは，次に起動される時からである【NGKI2558】．</p>
</div>
<div class="paragraph">
<p>対象アラームハンドラの属するクラスの割付け可能プロセッサが，prcidで指定
したプロセッサを含んでいない場合には，E_PARエラーとなる【NGKI2559】．</p>
</div>
<div class="paragraph">
<p>prcidにTPRC_INI（＝0）を指定すると，対象アラームハンドラの割付けプロセッ
サを，それが属するクラスの初期割付けプロセッサとする【NGKI2560】．</p>
</div>
<div class="paragraph">
<p>グローバルタイマ方式を用いている場合，msta_alm／imsta_almはE_NOSPTを返
す【NGKI2561】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>msta_alm／imsta_almで実行中のアラームハンドラの割付けプロセッサを変更し
た場合，同じアラームハンドラが異なるプロセッサで同時に実行される可能性
がある．特に，almtimに0を指定する場合に，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_stp_alm" class="listingblock">
<div class="content">
<pre>stp_alm		アラームハンドラの動作停止〔T〕【NGKI2562】
istp_alm	アラームハンドラの動作停止〔I〕【NGKI2563】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = stp_alm(ID almid)
	ER ercd = istp_alm(ID almid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			almid		対象アラームハンドラのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（stp_almの場合）【NGKI2564】
				・タスクコンテキストからの呼出し（istp_almの場合）【NGKI2565】
				・CPUロック状態からの呼出し【NGKI2566】
	E_ID		不正ID番号
				・almidが有効範囲外【NGKI2567】
	E_NOEXS		オブジェクト未登録
				・対象アラームハンドラが未登録〔D〕【NGKI2568】
	E_OACV		オブジェクトアクセス違反
				・対象アラームハンドラに対する通常操作2が許可されていな
				　い（stp_almの場合）〔P〕【NGKI2569】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>almidで指定したアラームハンドラ（対象アラームハンドラ）を動作停止する．
具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象アラームハンドラが動作している状態であれば，動作していない状態とな
る【NGKI2570】．対象アラームハンドラが動作していない状態であれば，何も
行われずに正常終了する【NGKI2571】．</p>
</div>
<div id="API_ref_alm" class="listingblock">
<div class="content">
<pre>ref_alm		アラームハンドラの状態参照〔T〕【NGKI2572】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_alm(ID almid, T_RALM *pk_ralm)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			almid		対象アラームハンドラのID番号
	T_RALM *	pk_ralm		アラームハンドラの現在状態を入れるパケット
							へのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊アラームハンドラの現在状態（パケットの内容）
	STAT		almstat		アラームハンドラの動作状態
	RELTIM		lefttim		アラームハンドラを起動する時刻までの相対時間
	ID			prcid		アラームハンドラの割付けプロセッサのID（マル
							チプロセッサ対応カーネルの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2573】
				・CPUロック状態からの呼出し【NGKI2574】
	E_ID		不正ID番号
				・almidが有効範囲外【NGKI2575】
	E_NOEXS		オブジェクト未登録
				・対象アラームハンドラが未登録〔D〕【NGKI2576】
	E_OACV		オブジェクトアクセス違反
				・対象アラームハンドラに対する参照操作が許可されていな
				　い〔P〕【NGKI2577】
	E_MACV		メモリアクセス違反
				・pk_ralmが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI2578】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>almidで指定したアラームハンドラ（対象アラームハンドラ）の現在状態を参照
する．参照した現在状態は，pk_ralmで指定したパケットに返される【NGKI2579】．</p>
</div>
<div class="paragraph">
<p>almstatには，対象アラームハンドラの現在の動作状態を表す次のいずれかの値
が返される【NGKI2580】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TALM_STP	0x01U		アラームハンドラが動作していない状態
TALM_STA	0x02U		アラームハンドラが動作している状態</pre>
</div>
</div>
<div class="paragraph">
<p>対象アラームハンドラが動作している状態である場合には，lefttimに，アラー
ムハンドラ起動する時刻までの相対時間が返される【NGKI2581】．対象アラー
ムハンドラが動作していない状態である場合には，lefttimの値は保証されない
【NGKI2582】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，prcidに，対象アラームハンドラの割付け
プロセッサのID番号が返される【NGKI2583】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_almはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_almを呼び出し，対象アラームハンドラの現在状態を参照し
た直後に割込みが発生した場合，ref_almから戻ってきた時には対象アラームハ
ンドラの状態が変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TALM_STPとTALM_STAを値を変更した．</p>
</div>
</div>
<div class="sect3">
<h4 id="_オーバランハンドラ">4.6.4. オーバランハンドラ</h4>
<div class="paragraph">
<p>オーバランハンドラは，タスクが使用したプロセッサ時間が，指定した時間を
超えた場合に起動されるタイムイベントハンドラである．オーバランハンドラ
は，システムで1つのみ登録することができる【NGKI2584】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラ機能に関連して，各タスクが持つ情報は次の通り
【NGKI2585】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>オーバランハンドラの動作状態</p>
</li>
<li>
<p>残りプロセッサ時間</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>オーバランハンドラの動作状態は，タスク毎に，動作している状態と動作して
いない状態のいずれかをとる【NGKI2586】．残りプロセッサ時間は，オーバラ
ンハンドラが動作している状態の時に，タスクが使用できる残りのプロセッサ
時間を表す．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラの動作状態は，タスクの登録時と，タスクが休止状態に遷
移する時に，動作していない状態に初期化される【NGKI2587】．</p>
</div>
<div class="paragraph">
<p>残りプロセッサ時間は，オーバランハンドラが動作している状態でタスクが実
行している間，タスクが使用したプロセッサ時間の分だけ減少する【NGKI2588】．
残りプロセッサ時間が0になると（これをオーバランと呼ぶ），オーバランハン
ドラが起動される【NGKI2589】．</p>
</div>
<div class="paragraph">
<p>タスクが使用したプロセッサ時間には，そのタスク自身とタスク例外処理ルー
チン，それらから呼び出したサービルコール（拡張サービスコールを含む）の
実行時間を含む【NGKI2590】．一方，タスクの実行中に起動されたカーネル管
理の割込みハンドラ（割込みサービスルーチン，周期ハンドラ，アラームハン
ドラ，オーバランハンドラの実行時間を含む）とカーネル管理のCPU例外ハンド
ラの実行時間は含まないが，割込みハンドラおよびCPU例外ハンドラの呼出し／
復帰にかかる時間と，それらの入口処理と出口処理の一部の実行時間は含んで
しまう【NGKI2591】．また，タスクの実行中に起動されたカーネル管理外の割
込みハンドラとカーネル管理外のCPU例外ハンドラの実行時間も含む
【NGKI2592】．</p>
</div>
<div class="paragraph">
<p>プロセッサ時間は，符号無しの整数型であるOVRTIM型で表し，単位はマイクロ
秒とする【NGKI2593】．ただし，プロセッサ時間には，OVRTIM型に格納できる
任意の値を指定できるとは限らず，指定できる値にターゲット定義の上限があ
る場合がある【NGKI2594】．プロセッサ時間に指定できる最大値は，構成マク
ロTMAX_OVRTIMに定義されている【NGKI2595】．また，タスクが使用したプロセッ
サ時間の計測精度はターゲットに依存する【NGKI2596】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，オーバランハンドラは，カーネルドメインに
属する【NGKI2597】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，オーバランハンドラ機能がサポートされていない場合があ
る【NGKI2598】．オーバランハンドラ機能がサポートされている場合には，
TOPPERS_SUPPORT_OVRHDRがマクロ定義される【NGKI2599】．サポートされてい
ない場合にオーバランハンドラ機能のサービスコールを呼び出すと，E_NOSPTエ
ラーが返るか，リンク時にエラーとなる【NGKI2600】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラ機能に用いるデータ型は次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>OVRTIM		プロセッサ時間（符号無し整数，単位はマイクロ秒，ulong_t
			に定義）【NGKI2601】</pre>
</div>
</div>
<div class="paragraph">
<p>オーバランハンドラ属性に指定できる属性はない【NGKI2602】．そのためオー
バランハンドラ属性には，TA_NULLを指定しなければならない【NGKI2603】．</p>
</div>
<div class="paragraph">
<p>C言語によるオーバランハンドラの記述形式は次の通り【NGKI2604】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void overrun_handler(ID tskid, intptr_t exinf)
	{
		オーバランハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>tskidにはオーバランを起こしたタスクのID番号が，exinfにはそのタスクの拡
張情報が，それぞれ渡される【NGKI2605】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラ機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_OVRTIM		プロセッサ時間に指定できる最大値【NGKI2606】</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_OVRHDR		オーバランハンドラ機能がサポートされて
							いる【NGKI2607】</pre>
</div>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，オーバランハンドラが異なるプロセッサ
で同時に実行される可能性があるので，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，オーバランハンドラをサポートしない【ASPS0184】．ただし，
オーバランハンドラ機能拡張パッケージを用いると，オーバランハンドラ機能
を追加することができる【ASPS0185】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，オーバランハンドラをサポートしない【FMPS0155】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，オーバランハンドラをサポートする【HRPS0149】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>OVRTIMの時間単位は，μITRON4.0仕様では実装定義としていたが，この仕様で
はマイクロ秒と規定した．</p>
</div>
<div class="paragraph">
<p>TMAX_OVRTIMは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_DEF_OVR" class="listingblock">
<div class="content">
<pre>DEF_OVR		オーバランハンドラの定義〔S〕【NGKI2608】
def_ovr		オーバランハンドラの定義〔TD〕【NGKI2609】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_OVR({ ATR ovratr, OVRHDR ovrhdr })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = def_ovr(const T_DOVR *pk_dovr)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	T_DOVR *	pk_dovr		オーバランハンドラの定義情報を入れたパケッ
							トへのポインタ（静的APIを除く）

　＊オーバランハンドラの定義情報（パケットの内容）
	ATR			ovratr		オーバランハンドラ属性
	OVRHDR		ovrhdr		オーバランハンドラの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2610】
				・CPUロック状態からの呼出し〔s〕【NGKI2611】
	E_RSATR		予約属性
				・ovratrが無効【NGKI2612】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・ovrhdrがプログラムの先頭番地として正しくない【NGKI2613】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2614】
	E_MACV		メモリアクセス違反
				・pk_dovrが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2615】
	E_OBJ		オブジェクト状態エラー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したオーバランハンドラ定義情報に従って，オーバランハ
ンドラを定義する【NGKI2616】．ただし，def_ovrにおいてpk_dovrをNULLにし
た場合には，オーバランハンドラの定義を解除する【NGKI2617】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，ovratrは整数定数式パラメータ，ovrhdrは一般定数式パラ
メータである【NGKI2618】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラを定義する場合（DEF_OVRの場合およびdef_ovrにおいて
pk_dovrをNULL以外にした場合）で，すでにオーバランハンドラが定義されてい
る場合には，E_OBJエラーとなる【NGKI2619】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，DEF_OVRは，カーネルドメインの囲みの中に記
述しなければならない．そうでない場合には，E_RSATRエラーとなる
【NGKI2621】．また，def_ovrでオーバランハンドラを定義する場合には，オー
バランハンドラの属する保護ドメインを設定する必要はなく，オーバランハン
ドラ属性にTA_DOM(domid)を指定した場合にはE_RSATRエラーとなる【NGKI2622】．
ただし，TA_DOM(TDOM_SELF)を指定した場合には，指定が無視され，E_RSATRエ
ラーは検出されない【NGKI2623】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，DEF_OVRは，クラスの囲みの外に記述しな
ければならない．そうでない場合には，E_RSATRエラーとなる【NGKI2625】．ま
た，def_ovrオーバランハンドラを定義する場合には，オーバランハンドラの属
するクラスを設定する必要はなく，オーバランハンドラ属性にTA_CLS(clsid)を
指定した場合にはE_RSATRエラーとなる【NGKI2626】．ただし，
TA_CLS(TCLS_SELF)を指定した場合には，指定が無視され，E_RSATRエラーは検
出されない【NGKI2627】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラの定義を解除する場合（def_ovrにおいてpk_dovrをNULLに
した場合）で，オーバランハンドラが定義されていない場合には，E_OBJエラー
となる【NGKI2628】．</p>
</div>
<div class="paragraph">
<p>オーバランハンドラの定義を解除すると，オーバランハンドラの動作状態は，
すべてのタスクに対して動作していない状態となる【NGKI2629】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>def_ovrによりオーバランハンドラの定義を解除する場合，サービスコールの処
理時間およびカーネル内での割込み禁止時間が，タスクの総数に比例して長く
なる．特に，タスクの総数が多い場合，カーネル内での割込み禁止時間が長く
なるため，注意が必要である．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルのオーバランハンドラ機能拡張パッケージでは，DEF_OVRのみをサ
ポートする【ASPS0186】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，DEF_OVRのみをサポートする【HRPS0150】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>ovrhdrのデータ型をOVRHDRに変更した．</p>
</div>
<div class="paragraph">
<p>def_ovrによって定義済みのオーバランハンドラを再定義しようとした場合に，
E_OBJエラーとすることにした．オーバランハンドラの定義を変更するには，一
度定義を解除してから，再度定義する必要がある．</p>
</div>
<div id="API_sta_ovr" class="listingblock">
<div class="content">
<pre>sta_ovr		オーバランハンドラの動作開始〔T〕【NGKI2630】
ista_ovr	オーバランハンドラの動作開始〔I〕【NGKI2631】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sta_ovr(ID tskid, OVRTIM ovrtim)
	ER ercd = ista_ovr(ID tskid, OVRTIM ovrtim)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	OVRTIM		ovrtim		対象タスクの残りプロセッサ時間</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（sta_ovrの場合）【NGKI2632】
				・タスクコンテキストからの呼出し（ista_ovrの場合）【NGKI2633】
				・CPUロック状態からの呼出し【NGKI2634】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI2635】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI2636】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない（sta_ovr
				　の場合）〔P〕【NGKI2637】
	E_PAR		パラメータエラー
				・ovrtimが0，またはTMAX_OVRTIMより大きい【NGKI2643】
	E_OBJ		オブジェクト状態エラー
				・オーバランハンドラが定義されていない【NGKI2638】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）に対して，オーバランハンドラの動作を
開始する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクに対するオーバランハンドラの動作状態は，動作している状態とな
り，残りプロセッサ時間は，ovrtimに指定した時間に設定される【NGKI2639】．
対象タスクに対してオーバランハンドラが動作している状態であれば，残りプ
ロセッサ時間の設定のみが行われる【NGKI2640】．</p>
</div>
<div class="paragraph">
<p>sta_ovrにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI2641】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>ista_ovrは，μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_stp_ovr" class="listingblock">
<div class="content">
<pre>stp_ovr		オーバランハンドラの動作停止〔T〕【NGKI2644】
istp_ovr	オーバランハンドラの動作停止〔I〕【NGKI2645】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = stp_ovr(ID tskid)
	ER ercd = istp_ovr(ID tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（stp_ovrの場合）【NGKI2646】
				・タスクコンテキストからの呼出し（istp_ovrの場合）【NGKI2647】
				・CPUロック状態からの呼出し【NGKI2648】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI2649】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI2650】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する通常操作2が許可されていない（stp_ovr
				　の場合）〔P〕【NGKI2651】
	E_OBJ		オブジェクト状態エラー
				・オーバランハンドラが定義されていない【NGKI2652】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）に対して，オーバランハンドラの動作を
停止する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象タスクに対するオーバランハンドラの動作状態は，動作していない状態と
なる【NGKI2653】．対象タスクに対してオーバランハンドラが動作していない
状態であれば，何も行われずに正常終了する【NGKI2654】．</p>
</div>
<div class="paragraph">
<p>stp_ovrにおいてtskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスク
となる【NGKI2655】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>istp_ovrは，μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_ovr" class="listingblock">
<div class="content">
<pre>ref_ovr		オーバランハンドラの状態参照〔T〕【NGKI2656】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_ovr(ID tskid, T_ROVR *pk_rovr)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			tskid		対象タスクのID番号
	T_ROVR *	pk_rovr		オーバランハンドラの現在状態を入れるパケッ
							トへのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード

　＊タスクの現在状態（パケットの内容）
	STAT		ovrstat		オーバランハンドラの動作状態
	OVRTIM		leftotm		残りプロセッサ時間</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2657】
				・CPUロック状態からの呼出し【NGKI2658】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI2659】
	E_NOEXS		オブジェクト未登録
				・対象タスクが未登録〔D〕【NGKI2660】
	E_OACV		オブジェクトアクセス違反
				・対象タスクに対する参照操作が許可されていない〔P〕【NGKI2661】
	E_MACV		メモリアクセス違反
				・pk_rovrが指すメモリ領域への書込みアクセスが許可されて
				　いない〔P〕【NGKI2662】
	E_OBJ		オブジェクト状態エラー
				・オーバランハンドラが定義されていない【NGKI2663】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスク（対象タスク）に対するオーバランハンドラの現在状態
を参照する．参照した現在状態は，pk_rovrで指定したメモリ領域に返される
【NGKI2664】．</p>
</div>
<div class="paragraph">
<p>ovrstatには，対象タスクに対するオーバランハンドラの動作状態を表す次のい
ずれかの値が返される【NGKI2665】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOVR_STP	0x01U		オーバランハンドラが動作していない状態
TOVR_STA	0x02U		オーバランハンドラが動作している状態</pre>
</div>
</div>
<div class="paragraph">
<p>対象タスクに対してオーバランハンドラが動作している状態の場合には，
leftotmに，オーバランハンドラが起動されるまでの残りプロセッサ時間が返さ
れる【NGKI2666】．オーバランハンドラが起動される直前には，leftotmに0が
返される可能性がある【NGKI2667】．オーバランハンドラが動作していない状
態の場合には，leftotmの値は保証されない【NGKI2668】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクが対象タスクとなる
【NGKI2669】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ref_ovrはデバッグ時向けの機能であり，その他の目的に使用することは推奨し
ない．これは，ref_ovrを呼び出し，対象オーバランハンドラの現在状態を参照
した直後に割込みが発生した場合，ref_ovrから戻ってきた時には対象オーバラ
ンハンドラの状態が変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，対象タスクが，自タスクが割付けら
れたプロセッサと異なるプロセッサに割り付けられている場合に，leftotmを参
照できるとするかどうかは，今後の課題である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>TOVR_STPとTOVR_STAを値を変更した．</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_システム状態管理機能">4.7. システム状態管理機能</h3>
<div class="paragraph">
<p>システム状態管理機能は，特定のオブジェクトに関連しないシステムの状態を
変更／参照するための機能である．</p>
</div>
<div id="API_SAC_SYS" class="listingblock">
<div class="content">
<pre>SAC_SYS		システム状態のアクセス許可ベクタの設定〔SP〕【NGKI2670】
sac_sys		システム状態のアクセス許可ベクタの設定〔TPD〕【NGKI2671】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_SYS({ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_sys(const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2672】
				・CPUロック状態からの呼出し〔s〕【NGKI2673】
	E_RSATR		予約属性
				・カーネルドメインの囲みの中に記述されていない〔S〕【NGKI2674】
				・クラスの囲みの中に記述されている〔SM〕【NGKI2675】
	E_OACV		オブジェクトアクセス違反
				・カーネルドメイン以外からの呼出し〔s〕【NGKI2676】
	E_OBJ		オブジェクト状態エラー
				・システム状態のアクセス許可ベクタが設定済み〔S〕【NGKI2677】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>システム状態のアクセス許可ベクタ（4つのアクセス許可パターンの組）を，各
パラメータで指定した値に設定する【NGKI2678】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，acptn1〜acptn4は整数定数式パラメータである【NGKI2679】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_SYSのみをサポートする【HRPS0151】．</p>
</div>
<div id="API_rot_rdq" class="listingblock">
<div class="content">
<pre>rot_rdq		タスクの優先順位の回転〔T〕【NGKI2680】
irot_rdq	タスクの優先順位の回転〔I〕【NGKI2681】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = rot_rdq(PRI tskpri)
	ER ercd = irot_rdq(PRI tskpri)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	PRI	　		tskpri		回転対象の優先度（対象優先度）</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（rot_rdqの場合）【NGKI2682】
				・タスクコンテキストからの呼出し（irot_rdqの場合）【NGKI2683】
				・CPUロック状態からの呼出し【NGKI2684】
	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_PAR		パラメータエラー
				・tskpriが有効範囲外【NGKI2685】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作1が許可されていない（rot_rdq
				　の場合）〔P〕【NGKI2686】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskpriで指定した優先度（対象優先度）を持つ実行できる状態のタスクの中で，
最も優先順位が高いタスクを，同じ優先度のタスクの中で最も優先順位が低い
状態にする【NGKI2687】．対象優先度を持つ実行できる状態のタスクが無いか
1つのみの場合には，何も行われずに正常終了する【NGKI2688】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，自タスクと同じプロセッサに割り
付けられているタスクのみを操作対象とする【NGKI3622】．</p>
</div>
<div class="paragraph">
<p>rot_rdqにおいて，tskpriにTPRI_SELF（＝0）を指定すると，自タスクのベース
優先度が対象優先度となる【NGKI2689】．</p>
</div>
<div class="paragraph">
<p>対象優先度を持つ実行できる状態のタスクの中で，最も優先順位が高いタスク
が制約タスクの場合には，E_NOSPTエラーとなる【NGKI2690】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，rot_rdq，irot_rdqをサポートしない【SSPS0131】．</p>
</div>
<div id="API_mrot_rdq" class="listingblock">
<div class="content">
<pre>mrot_rdq	プロセッサ指定でのタスクの優先順位の回転〔TM〕【NGKI2691】
imrot_rdq	プロセッサ指定でのタスクの優先順位の回転〔IM〕【NGKI2692】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = mrot_rdq(PRI tskpri, ID prcid)
	ER ercd = imrot_rdq(PRI tskpri, ID prcid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	PRI			tskpri		回転対象の優先度（対象優先度）
	ID			prcid		優先順位の回転対象とするプロセッサのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（mrot_rdqの場合）
				　【NGKI2693】
				・タスクコンテキストからの呼出し（imrot_rdqの場合）【NGKI2694】
				・CPUロック状態からの呼出し【NGKI2695】
	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_ID		不正ID番号
				・prcidが有効範囲外【NGKI2696】
	E_PAR		パラメータエラー
				・tskpriが有効範囲外【NGKI2697】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作1が許可されていない（mrot_rdq
				　の場合）〔P〕【NGKI2698】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>prcidで指定したプロセッサに割り付けられており，tskpriで指定した優先度
（対象優先度）を持つ実行できる状態のタスクの中で，最も優先順位が高いタ
スクを，同じ優先度のタスクの中で最も優先順位が低い状態にする【NGKI2699】．
対象優先度を持つ実行できる状態のタスクが無いか1つのみの場合には，何も行
われずに正常終了する【NGKI2700】．</p>
</div>
<div class="paragraph">
<p>mrot_rdqにおいて，tskpriにTPRI_SELF（＝0）を指定すると，自タスクのベー
ス優先度が対象優先度となる【NGKI2701】．</p>
</div>
<div class="paragraph">
<p>prcidで指定したプロセッサに割り付けられており，対象優先度を持つ実行でき
る状態のタスクの中で，最も優先順位が高いタスクが制約タスクの場合には，
E_NOSPTエラーとなる【NGKI2702】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，mrot_rdq，imrot_rdqをサポートしない【ASPS0188】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，mrot_rdq，imrot_rdqをサポートしない【HRPS0152】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，mrot_rdq，imrot_rdqをサポートしない【SSPS0132】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_get_tid" class="listingblock">
<div class="content">
<pre>get_tid		実行状態のタスクIDの参照〔T〕【NGKI2703】
iget_tid	実行状態のタスクIDの参照〔I〕【NGKI2704】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_tid(ID *p_tskid)
	ER ercd = iget_tid(ID *p_tskid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID *		p_tskid		タスクIDを入れるメモリ領域へのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	ID			tskid		タスクID</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（get_tidの場合）【NGKI2705】
				・タスクコンテキストからの呼出し（iget_tidの場合）【NGKI2706】
				・CPUロック状態からの呼出し【NGKI2707】
	E_MACV		メモリアクセス違反
				・p_tskidが指すメモリ領域への書込みアクセスが許可されて
				　いない（get_tidの場合）〔P〕【NGKI2708】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>実行状態のタスク（get_tidの場合には自タスク）のID番号を参照する．参照し
たタスクIDは，p_tskidが指すメモリ領域に返される【NGKI2709】．</p>
</div>
<div class="paragraph">
<p>iget_tidにおいて，実行状態のタスクがない場合には，TSK_NONE（＝0）が返さ
れる【NGKI2710】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，サービスコールを呼び出した処理
単位を実行しているプロセッサにおいて実行状態のタスクのID番号を参照する
【NGKI2711】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，get_tidをサポートしない【SSPS0133】．</p>
</div>
<div id="API_get_did" class="listingblock">
<div class="content">
<pre>get_did		実行状態のタスクが属する保護ドメインIDの参照〔TP〕【NGKI2712】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_did(ID *p_domid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID *		p_domid		保護ドメインIDを入れるメモリ領域へのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	ID			domid		保護ドメインID</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2713】
				・CPUロック状態からの呼出し【NGKI2714】
	E_MACV		メモリアクセス違反
				・p_domidが指すメモリ領域への書込みアクセスが許可されて
				　いない【NGKI2715】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>実行状態のタスク（自タスク）が属する保護ドメインのID番号を参照する．参
照した保護ドメインIDは，p_domidが指すメモリ領域に返される【NGKI2716】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいては，サービスコールを呼び出した処理
単位を実行しているプロセッサにおいて実行状態のタスクが属する保護ドメイ
ンのID番号を参照する【NGKI2717】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，get_didをサポートしない【ASPS0189】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，get_didをサポートしない【FMPS0157】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，get_didをサポートしない【SSPS0134】．</p>
</div>
<div id="API_get_pid" class="listingblock">
<div class="content">
<pre>get_pid		割付けプロセッサのID番号の参照〔TM〕【NGKI2718】
iget_pid	割付けプロセッサのID番号の参照〔IM〕【NGKI2719】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_pid(ID *p_prcid)
	ER ercd = iget_pid(ID *p_prcid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID *		p_prcid		プロセッサIDを入れるメモリ領域へのポインタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード
	ID			prcid		プロセッサID</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（get_pidの場合）【NGKI2720】
				・タスクコンテキストからの呼出し（iget_pidの場合）【NGKI2721】
				・CPUロック状態からの呼出し【NGKI2722】
	E_MACV		メモリアクセス違反
				・p_prcidが指すメモリ領域への書込みアクセスが許可されて
				　いない（get_pidの場合）〔P〕【NGKI2723】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>サービスコールを呼び出した処理単位の割付けプロセッサのID番号を参照する．
参照したプロセッサIDは，p_prcidが指すメモリ領域に返される
【NGKI2724】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>タスクは，get_pidを用いて，自タスクの割付けプロセッサを正しく参照できる
とは限らない．これは，get_pidを呼び出し，自タスクの割付けプロセッサの
ID番号を参照した直後に割込みが発生した場合，get_pidから戻ってきた時には
割付けプロセッサが変化している可能性があるためである．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，get_pid，iget_pidをサポートしない【ASPS0190】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，get_pid，iget_pidをサポートしない【HRPS0153】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，get_pid，iget_pidをサポートしない【SSPS0135】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_loc_cpu" class="listingblock">
<div class="content">
<pre>loc_cpu		CPUロック状態への遷移〔T〕【NGKI2725】
iloc_cpu	CPUロック状態への遷移〔I〕【NGKI2726】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = loc_cpu()
	ER ercd = iloc_cpu()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（loc_cpuの場合）【NGKI2727】
				・タスクコンテキストからの呼出し（iloc_cpuの場合）【NGKI2728】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作2が許可されていない
				　（loc_cpuの場合）〔P〕【NGKI2729】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>CPUロックフラグをセットし，CPUロック状態へ遷移する【NGKI2730】．CPUロッ
ク状態で呼び出した場合には，何も行われずに正常終了する【NGKI2731】．</p>
</div>
<div id="API_unl_cpu" class="listingblock">
<div class="content">
<pre>unl_cpu		CPUロック状態の解除〔T〕【NGKI2732】
iunl_cpu	CPUロック状態の解除〔I〕【NGKI2733】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = unl_cpu()
	ER ercd = iunl_cpu()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し（unl_cpuの場合）【NGKI2734】
				・タスクコンテキストからの呼出し（iunl_cpuの場合）【NGKI2735】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作2が許可されていない
				　（unl_cpuの場合）〔P〕【NGKI2736】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>CPUロックフラグをクリアし，CPUロック解除状態へ遷移する【NGKI2737】．
CPUロック解除状態で呼び出した場合には，何も行われずに正常終了する
【NGKI2738】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，unl_cpu／iunl_cpuを呼び出したプロ
セッサによって取得されている状態となっているスピンロックがある場合には，
unl_cpu／iunl_cpuによってCPUロック解除状態に遷移しない（何も行われずに
正常終了する）【NGKI2739】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，CPUロック解除状態へ遷移した結果，ディ
スパッチ保留状態が解除され，ディスパッチが起こる可能性がある．また，保
護機能対応カーネルとマルチプロセッサ対応カーネルでは，タスク例外処理ルー
チンの実行が開始される可能性がある．</p>
</div>
<div id="API_dis_dsp" class="listingblock">
<div class="content">
<pre>dis_dsp		ディスパッチの禁止〔T〕【NGKI2740】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = dis_dsp()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2741】
				・CPUロック状態からの呼出し【NGKI2742】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作1が許可されていない〔P〕
				　【NGKI2743】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>ディスパッチ禁止フラグをセットし，ディスパッチ禁止状態へ遷移する
【NGKI2744】．ディスパッチ禁止状態で呼び出した場合には，何も行われずに
正常終了する【NGKI2745】．</p>
</div>
<div id="API_ena_dsp" class="listingblock">
<div class="content">
<pre>ena_dsp		ディスパッチの許可〔T〕【NGKI2746】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ena_dsp()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2747】
				・CPUロック状態からの呼出し【NGKI2748】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作1が許可されていない〔P〕
				　【NGKI2749】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>ディスパッチ禁止フラグをクリアし，ディスパッチ許可状態へ遷移する
【NGKI2750】．ディスパッチ許可状態で呼び出した場合には，何も行われずに
正常終了する【NGKI2751】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>ディスパッチ許可状態へ遷移した結果，ディスパッチ保留状態が解除され，ディ
スパッチが起こる可能性がある．</p>
</div>
<div id="API_sns_ctx" class="listingblock">
<div class="content">
<pre>sns_ctx		コンテキストの参照〔TI〕【NGKI2752】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t state = sns_ctx()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t	state		コンテキスト</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>実行中のコンテキストを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_ctxを非タスクコンテキストから呼び出した場合にはtrue，タスクコンテキ
ストから呼び出した場合にはfalseが返る【NGKI2753】．</p>
</div>
<div id="API_sns_loc" class="listingblock">
<div class="content">
<pre>sns_loc		CPUロック状態の参照〔TI〕【NGKI2754】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t state = sns_loc()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t	state		CPUロックフラグ</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>CPUロックフラグを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_locをCPUロック状態で呼び出した場合にはtrue，CPUロック解除状態で呼び
出した場合にはfalseが返る【NGKI2755】．</p>
</div>
<div id="API_sns_dsp" class="listingblock">
<div class="content">
<pre>sns_dsp		ディスパッチ禁止状態の参照〔TI〕【NGKI2756】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t state = sns_dsp()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t	state		ディスパッチ禁止フラグ</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>ディスパッチ禁止フラグを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_dspをディスパッチ禁止状態で呼び出した場合にはtrue，ディスパッチ許可
状態で呼び出した場合にはfalseが返る【NGKI2757】．</p>
</div>
<div id="API_sns_dpn" class="listingblock">
<div class="content">
<pre>sns_dpn		ディスパッチ保留状態の参照〔TI〕【NGKI2758】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t state = sns_dpn()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t	state		ディスパッチ保留状態</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>ディスパッチ保留状態であるか否かを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_dpnをディスパッチ保留状態で呼び出した場合にはtrue，ディスパッチ保留
状態でない状態で呼び出した場合にはfalseが返る【NGKI2759】．</p>
</div>
<div id="API_sns_ker" class="listingblock">
<div class="content">
<pre>sns_ker		カーネル非動作状態の参照〔TI〕【NGKI2760】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t state = sns_ker()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t		state		カーネル非動作状態</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>カーネルが動作中であるか否かを参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>sns_kerをカーネルの初期化完了前（初期化ルーチン実行中を含む）または終了
処理開始後（終了処理ルーチン実行中を含む）に呼び出した場合にはtrue，カー
ネルの動作中に呼び出した場合にはfalseが返る【NGKI2761】．</p>
</div>
<div class="paragraph">
<p>【使用方法】</p>
</div>
<div class="paragraph">
<p>sns_kerは，カーネルが動作している時とそうでない時で，処理内容を変えたい
場合に使用する．sns_kerがtrueを返した場合，他のサービスコールを呼び出す
ことはできない．sns_kerがtrueを返す時に他のサービスコールを呼び出した場
合の動作は保証されない．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>どちらの条件でtrueが返るか間違いやすいので注意すること．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ext_ker" class="listingblock">
<div class="content">
<pre>ext_ker		カーネルの終了〔TI〕【NGKI2762】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ext_ker()</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	なし</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		エラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_SYS		システムエラー
				・カーネルの誤動作【NGKI2763】
	E_OACV		オブジェクトアクセス違反
				・カーネルドメイン以外からの呼出し〔P〕【NGKI2764】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>カーネルを終了する．具体的な振舞いについては，「2.9.2 システム終了手順」
の節を参照すること．</p>
</div>
<div class="paragraph">
<p>ext_kerが正常に処理された場合，ext_kerからはリターンしない【NGKI2765】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_ref_sys" class="listingblock">
<div class="content">
<pre>ref_sys		システムの状態参照〔T〕</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_sys(T_RSYS *pk_rsys)</pre>
</div>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ref_sysをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ref_sysをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ref_sysをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ref_sysをサポートしない．</p>
</div>
</div>
<div class="sect2">
<h3 id="_メモリオブジェクト管理機能">4.8. メモリオブジェクト管理機能</h3>
<div class="paragraph">
<p>メモリオブジェクト管理機能は，保護機能対応カーネルでのみサポートされる
機能である．保護機能対応でないカーネルでは，メモリオブジェクト管理機能
をサポートしない．</p>
</div>
<div class="paragraph">
<p>〔メモリリージョン〕</p>
</div>
<div class="paragraph">
<p>メモリリージョンは，オブジェクトモジュールに含まれるセクションの配置対
象となる同じ性質を持った連続したメモリ領域である．メモリリージョンは，
メモリリージョン名によって識別する【NGKI2766】．</p>
</div>
<div class="paragraph">
<p>各メモリリージョンが持つ情報は次の通り【NGKI2767】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>先頭番地</p>
</li>
<li>
<p>サイズ</p>
</li>
<li>
<p>メモリリージョン属性</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メモリリージョンの先頭番地とサイズには，ターゲット定義の制約が課せられ
る場合がある【NGKI2768】．</p>
</div>
<div class="paragraph">
<p>メモリリージョン属性には，次の属性を指定することができる【NGKI3256】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_NOWRITE	0x01U	書込みアクセス禁止</pre>
</div>
</div>
<div class="paragraph">
<p>ターゲットによっては，ターゲット定義のメモリリージョン属性を指定できる
場合がある【NGKI2771】．</p>
</div>
<div class="paragraph">
<p>標準メモリリージョンとは，ATT_MOD／ATA_MODによって，オブジェクトモジュー
ルに含まれる標準のセクションが配置されるメモリリージョンである．標準メ
モリリージョンには，標準のセクションの中で，書込みアクセスを行わないも
のが配置される標準ROMリージョンと，書込みアクセスを行うものが配置される
標準RAMリージョンが含まれる．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，ATT_MOD／ATA_MODがクラスの囲みの外に
記述された場合に適用される共通の標準メモリリージョンに加えて，クラス毎
の標準メモリリージョンを定義することができる【NGKI3257】．</p>
</div>
<div class="paragraph">
<p>標準メモリリージョン（マルチプロセッサ対応カーネルでは，共通の標準メモ
リリージョン）は，必ず定義しなければならない．定義しない場合には，コン
フィギュレータがエラーを報告する【NGKI3259】．</p>
</div>
<div class="paragraph">
<p>〔メモリオブジェクト〕</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトは，保護機能対応カーネルにおいてアクセス保護の対象と
する連続したメモリ領域である．メモリオブジェクトは，その先頭番地によっ
て識別する【NGKI2772】．</p>
</div>
<div class="paragraph">
<p>各メモリオブジェクトが持つ情報は次の通り【NGKI2773】．</p>
</div>
<div class="ulist">
<ul>
<li>
<p>先頭番地</p>
</li>
<li>
<p>サイズ</p>
</li>
<li>
<p>メモリオブジェクト属性</p>
</li>
<li>
<p>アクセス許可ベクタ</p>
</li>
<li>
<p>属する保護ドメイン</p>
</li>
<li>
<p>属するクラス（マルチプロセッサ対応カーネルの場合）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>メモリオブジェクトの先頭番地とサイズには，ターゲット定義の制約が課せら
れる【NGKI2774】．</p>
</div>
<div class="paragraph">
<p>メモリオブジェクト属性には，次の属性を指定することができる【NGKI2775】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_NOWRITE	0x01U	書込みアクセス禁止
TA_NOREAD	0x02U	読出しアクセス禁止
TA_EXEC		0x04U	実行アクセス許可
TA_MEMINI	0x08U	メモリの初期化を行う
TA_MEMPRSV	0x10U	メモリの初期化を行わない
TA_SDATA	0x20U	ショートデータ領域に配置
TA_UNCACHE	0x40U	キャッシュ禁止
TA_IODEV	0x80U	周辺デバイスの領域</pre>
</div>
</div>
<div class="paragraph">
<p>メモリオブジェクトに対して書込みアクセスできるのは，メモリオブジェクト
属性に書込みアクセス禁止（TA_NOWRITE属性）が指定されておらず，アクセス
許可ベクタにより書込みアクセスが許可されている場合である【NGKI2776】．
また，読出しアクセスできるのは，メモリオブジェクト属性に読出しアクセス
禁止（TA_NOREAD属性）が指定されておらず，アクセス許可ベクタにより読出し・
実行アクセスが許可されている場合である【NGKI2777】．実行アクセスできる
のは，メモリオブジェクト属性に実行アクセス許可（TA_EXEC属性）が指定され
ており，アクセス許可ベクタにより読出し・実行アクセスが許可されている場
合である【NGKI2778】．</p>
</div>
<div class="paragraph">
<p>ただし，ターゲットハードウェアの制約によってこれらの属性を実現できない
場合には，次のように扱われる．書込みアクセス禁止が実現できない場合には，
TA_NOWRITEを指定しても無視される【NGKI2779】．また，読出しアクセス禁止
が実現できない場合には，TA_NOREADを指定しても無視される【NGKI2780】．実
行アクセス禁止が実現できない場合には，TA_EXECを指定しなくても実行アクセ
ス許可となり，TA_EXECは無視される【NGKI2781】．どのような場合にどの属性
の指定が無視されるかは，ターゲット定義である【NGKI2782】．</p>
</div>
<div class="paragraph">
<p>TA_MEMINI属性は，システム初期化時に初期化するメモリオブジェクトであるこ
とを，TA_MEMPRSV属性は，システム初期化時に初期化を行わないメモリオブジェ
クトであることを示す【NGKI2783】．いずれの属性も指定しない場合，そのメ
モリオブジェクトは，システム初期化時にクリア（言い換えると，0に初期化）
される【NGKI2784】．</p>
</div>
<div class="paragraph">
<p>TA_MEMINI属性を設定したメモリオブジェクトを初期化に用いる初期化データは，
標準ROMリージョン（マルチプロセッサ対応カーネルでは，共通の標準ROMリー
ジョン）に配置され，メモリオブジェクトとしては登録されない【NGKI2787】．</p>
</div>
<div class="paragraph">
<p>TA_SDATA属性は，メモリオブジェクトをショートデータ領域に配置することを
示す【NGKI2788】．具体的な扱いはターゲット定義であるが，ショートデータ
領域がサポートされていないターゲットでは，この属性は無視される
【NGKI2789】．また，ターゲットによっては，TA_NOWRITEを指定した場合に，
TA_SDATAが無視される場合がある【NGKI2790】．</p>
</div>
<div class="paragraph">
<p>TA_UNCACHE属性は，メモリオブジェクトをキャッシュ禁止に設定することを，
TA_IODEV属性は，メモリオブジェクトを周辺デバイスの領域として扱うことを
示す【NGKI2791】．具体的な扱いはターゲット定義であるが，これらの属性を
指定しても意味がないターゲット（例えば，キャッシュを持たないターゲット
プロセッサでのTA_UNCACHE）では，これらの属性は無視される【NGKI2792】．
逆に，キャッシュ禁止にできないメモリオブジェクトに対してTA_UNCACHEを指
定した場合や，周辺デバイスの領域として扱うことができないメモリオブジェ
クトに対してTA_IODEVを指定した場合には，E_RSATRエラーとなる【NGKI2793】．</p>
</div>
<div class="paragraph">
<p>ターゲットによっては，ターゲット定義のメモリオブジェクト属性を指定でき
る場合がある【NGKI2794】．ターゲット定義のメモリオブジェクト属性として，
次の属性を予約している【NGKI2795】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_WTHROUGH			ライトスルーキャッシュを用いる</pre>
</div>
</div>
<div class="paragraph">
<p>〔カーネル構成マクロ〕</p>
</div>
<div class="paragraph">
<p>メモリオブジェクト管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_ATT_MOD		ATT_MOD／ATA_MODがサポートされている
							【NGKI2796】
TOPPERS_SUPPORT_ATT_PMA		ATT_PMA／ATA_PMA／att_pmaがサポートさ
							れている【NGKI2797】</pre>
</div>
</div>
<div class="paragraph">
<p>ただし，att_pmaは，動的生成対応カーネルのみでサポートされるAPIであるた
め，サポートされているかを判定するには，TOPPERS_SUPPORT_DYNAMIC_CREと
TOPPERS_SUPPORT_ATT_PMAの両方が定義されていることをチェックする必要があ
る【NGKI2798】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトが属するクラスは，ATT_MOD／ATA_MODにおいて，標準のセ
クションが配置されるメモリリージョンを決定するためのみに使用される．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，メモリオブジェクト管理機能をサポートしない【ASPS0191】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，メモリオブジェクト管理機能をサポートしない【FMPS0158】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，メモリオブジェクト管理機能をサポートする【HRPS0154】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，メモリオブジェクト管理機能をサポートしない【SSPS0136】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>値が0のメモリオブジェクト属性（TA_RW，TA_CACHE）は，デフォルトの扱いに
して廃止した．TA_ROはTA_NOWRITEに改名し，TA_NOREAD，TA_EXEC，TA_MEMINI，
TA_MEMPRSV，TA_IODEVを追加した．また，TA_UNCACHEの値を変更し，ターゲッ
ト定義のメモリオブジェクト属性としてTA_WTHROUGHを予約した．</p>
</div>
<div class="paragraph">
<p>メモリリージョンは，μITRON4.0/PX仕様にはない概念である．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>TA_IODEV属性を導入したのは，ターゲットプロセッサによっては，周辺デバイ
スの領域として扱うためには，キャッシュ禁止に加えて，メモリのアクセス順
序を変更しないことを指定しなければならないためである．メモリのアクセス
順序を変更しないことを指定するメモリオブジェクト属性を，ターゲット定義
で用意してもよいが，それを使うとアプリケーションのポータビリティが下が
るため，TA_IODEV属性を用意することにした．</p>
</div>
<div id="API_ATT_REG" class="listingblock">
<div class="content">
<pre>ATT_REG		メモリリージョンの登録〔SP〕【NGKI2799】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ATT_REG("メモリリージョン名", { ATR regatr, void *base, SIZE size })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	"メモリリージョン名"	登録するメモリリージョンを指定する文字列
	ATR			regatr		メモリリージョン属性
	void *		base		登録するメモリリージョンの先頭番地
	SIZE		size		登録するメモリリージョンのサイズ（バイト数）</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・regatrが無効【NGKI2800】
				・保護ドメインの囲みの中に記述されている【NGKI2814】
				・クラスの囲みの中に記述されている〔M〕【NGKI3260】
	E_PAR		パラメータエラー
				・sizeが0以下【NGKI2816】
				・その他の条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・登録済みのメモリリージョンの再登録【NGKI2801】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したメモリリージョン登録情報に従って，指定したメモリ
リージョンを登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>baseとsizeで指定したメモリ領域が，メモリリージョンとして登録される
【NGKI2802】．登録されるメモリリージョンには，regatrで指定したメモリリー
ジョン属性が設定される【NGKI2803】．</p>
</div>
<div class="paragraph">
<p>メモリリージョン名は文字列パラメータ，regatr，base，sizeは整数定数式パ
ラメータである【NGKI2804】．</p>
</div>
<div class="paragraph">
<p>baseやsizeに，ターゲット定義の制約に合致しない先頭番地やサイズを指定し
た時には，E_PARエラーとなる【NGKI2815】．登録しようとしたメモリリージョ
ンが，登録済みのメモリリージョンとメモリ領域が重なる場合には，E_OBJエラー
となる【NGKI2817】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様に定義されていない静的APIである．</p>
</div>
<div id="API_DEF_SRG" class="listingblock">
<div class="content">
<pre>DEF_SRG		標準メモリリージョンの定義〔SP〕【NGKI3261】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_SRG("標準ROMリージョン名", "標準RAMリージョン名")</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	"標準ROMリージョン名"	標準ROMリージョンとするメモリリージョンを
							指定する文字列
	"標準RAMリージョン名"	標準RAMリージョンとするメモリリージョンを
							指定する文字列</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている【NGKI3262】
	E_OBJ		オブジェクト状態エラー
				・標準メモリリージョンが定義済み【NGKI3263】
				・標準ROMリージョンに指定したメモリリージョンが未登録
				　【NGKI3264】
				・標準RAMリージョンに指定したメモリリージョンが未登録
				　【NGKI3272】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータに従って，標準ROMリージョンと標準RAMリージョンを定義する
【NGKI3265】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，DEF_SRGをクラスの囲みの外に記述すると，
共通の標準ROMリージョンと標準RAMリージョンを定義し，クラスの囲みの中に
記述すると，そのクラスの標準ROMリージョンと標準RAMリージョンを定義する
【NGKI3266】．</p>
</div>
<div class="paragraph">
<p>標準ROMリージョンは，TA_NOWRITE属性のメモリリージョンでなければならない．
標準ROMリージョンとして指定したメモリリージョンが，TA_NOWRITE属性でない
場合には，E_OBJエラーとなる【NGKI3268】．また，標準RAMリージョンは，
TA_NOWRITE属性でないメモリリージョンでなければならない．標準RAMリージョ
ンとして指定したメモリリージョンが，TA_NOWRITE属性である場合には，
E_OBJエラーとなる【NGKI3270】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様に定義されていない静的APIである．</p>
</div>
<div id="API_ATT_SEC" class="listingblock">
<div class="content">
<pre>ATT_SEC		セクションの登録〔SP〕【NGKI2818】
ATA_SEC		セクションの登録（アクセス許可ベクタ付き）〔SP〕【NGKI2819】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ATT_SEC("セクション名", { ATR mematr, "メモリリージョン名" })
	ATA_SEC("セクション名", { ATR mematr, "メモリリージョン名" },
				{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	"セクション名"			登録するセクションを指定する文字列
	ATR			mematr		メモリオブジェクト属性
	"メモリリージョン名"	セクションを配置するメモリリージョンを指定
							する文字列

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・mematrが無効【NGKI2820】
				・その他の条件については機能の項を参照
 	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・登録済みのセクションの再登録【NGKI2821】
				・指定したメモリリージョンが未登録【NGKI2822】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した情報に従って，指定したセクションをカーネルに登録
する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>各オブジェクトモジュールに含まれるセクション名で指定したセクションが，
メモリリージョン名で指定したメモリリージョンに配置され，メモリオブジェ
クトとして登録される【NGKI2823】．登録されるメモリオブジェクトには，
mematrで指定したメモリオブジェクト属性が設定される【NGKI2824】．
ATA_SECの場合には，登録されるメモリオブジェクトのアクセス許可ベクタ（4
つのアクセス許可パターンの組）が，acptn1〜acptn4で指定した値に設定され
る【NGKI2825】．</p>
</div>
<div class="paragraph">
<p>指定したメモリリージョンがTA_NOWRITE属性である場合には，メモリオブジェ
クト属性にTA_NOWRITE属性を指定したことになる（TA_NOWRITE属性を指定して
も指定しなくても，同じ振舞いとなる）【NGKI2826】．また，メモリオブジェ
クト属性のTA_MEMINIとTA_MEMPRSVは無視される（指定しても指定しなくても，
同じ振舞いとなる）【NGKI2786】．</p>
</div>
<div class="paragraph">
<p>mematrに，TA_MEMINIとTA_MEMPRSVを同時に指定することはできない．指定した
場合には，E_RSATRエラーとなる【NGKI2828】．</p>
</div>
<div class="paragraph">
<p>登録されるメモリオブジェクトと同じ保護ドメインに属し，メモリオブジェク
ト属性とアクセス許可ベクタがすべて一致するメモリオブジェクトがある場合
には，1つのメモリオブジェクトにまとめて登録される場合がある【NGKI2829】．</p>
</div>
<div class="paragraph">
<p>セクション名とメモリリージョン名は文字列パラメータ，mematr，acptn1〜
acptn4は整数定数式パラメータである【NGKI2830】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATA_SECにより登録できるセクションが属する保護ドメイン
や登録できる数に制限がある場合がある【NGKI2831】．この制限に違反した場
合には，E_NOSPTエラーとなる【NGKI2832】．</p>
</div>
<div class="paragraph">
<p>ATT_MOD／ATA_MODがサポートされているターゲットでは，セクション名として，
標準のセクションを指定することはできない．指定した場合には，E_PARエラー
となる【NGKI2834】．</p>
</div>
<div class="paragraph">
<p>保護ドメイン毎の標準セクションは，コンフィギュレータによってカーネルに
登録されるため，ATT_SEC／ATA_SECで登録することはできない．セクション名
として指定した場合には，E_PARエラーとなる【NGKI2836】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，指定したメモリリージョンがあるク
ラス専用のメモリリージョンの場合で，ATT_SEC／ATA_SECをクラスの囲みの外
に記述するか，他のクラスの囲みの中に記述した場合には，E_RSATRエラーとな
る【NGKI2837】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様に定義されていない静的APIである．</p>
</div>
<div id="API_LNK_SEC" class="listingblock">
<div class="content">
<pre>LNK_SEC		セクションの配置〔SP〕【NGKI2838】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	LNK_SEC("セクション名", { "メモリリージョン名" })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	"セクション名"			配置するセクションを指定する文字列
	"メモリリージョン名"	セクションを配置するメモリリージョンを指定
							する文字列</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている【NGKI3685】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・登録済みのセクションの再登録【NGKI2839】
				・指定したメモリリージョンが未登録【NGKI2840】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各オブジェクトモジュールに含まれるセクション名で指定したセクションを，
メモリリージョン名で指定したメモリリージョンに配置する【NGKI2841】．</p>
</div>
<div class="paragraph">
<p>セクション名として，標準のセクションや保護ドメイン毎の標準セクションを
指定することはできない．指定した場合には，E_PARエラーとなる【NGKI2843】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルにおいて，指定したメモリリージョンがあるク
ラス専用のメモリリージョンの場合で，LNK_SECをクラスの囲みの外に記述する
か，他のクラスの囲みの中に記述した場合には，E_RSATRエラーとなる
【NGKI2844】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>LNK_SECにより配置されたセクションは，メモリオブジェクトとしてカーネルに
登録されず，メモリ保護が実現できる先頭番地とサイズになるとは限らない．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様に定義されていない静的APIである．</p>
</div>
<div id="API_ATT_MOD" class="listingblock">
<div class="content">
<pre>ATT_MOD		オブジェクトモジュールの登録〔SP〕【NGKI2845】
ATA_MOD		オブジェクトモジュールの登録（アクセス許可ベクタ付き）〔SP〕
			【NGKI2846】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ATT_MOD("オブジェクトモジュール名")
	ATA_MOD("オブジェクトモジュール名",
				{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	"オブジェクトモジュール名"		登録するオブジェクトモジュールを指
									定する文字列

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・mematrが無効【NGKI2847】
 	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・登録済みのオブジェクトモジュールの再登録【NGKI2848】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した情報に従って，指定したオブジェクトモジュールをカー
ネルに登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>オブジェクトモジュール名で指定したオブジェクトモジュールに含まれる標準
のセクションの内，書込みアクセスを行わないセクションは標準ROMリージョン
に，書込みアクセスを行うセクションは標準RAMリージョンに配置され，メモリ
オブジェクトとして登録される【NGKI2849】．登録されるメモリオブジェクト
には，ターゲット定義でセクション毎に定まるメモリオブジェクト属性が設定
される【NGKI2850】．ATA_MODの場合には，登録されるメモリオブジェクトのア
クセス許可ベクタ（4つのアクセス許可パターンの組）が，acptn1〜acptn4で指
定した値に設定される【NGKI2851】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，ATT_MOD／ATA_MODを，クラスの囲みの外
に記述することも，クラスの囲みの中に記述することもできる【NGKI2852】．
ATT_MOD／ATA_MODをクラスの囲みの外に記述した場合，標準のセクションは，
共通の標準メモリリージョンに配置される【NGKI2853】．クラスの囲みの中に
記述した場合，そのクラスの標準メモリリージョンが定義されていればそれら
のメモリリージョン，定義されていなければ共通の標準メモリリージョンに配
置される【NGKI2854】．ただし，セクションによっては，ターゲット定義で，
クラスの標準メモリリージョンが定義されている場合でも，共通の標準メモリ
リージョンに配置される場合がある【NGKI3271】．</p>
</div>
<div class="paragraph">
<p>登録されるメモリオブジェクトと同じ保護ドメインに属し，メモリオブジェク
ト属性とアクセス許可ベクタがすべて一致するメモリオブジェクトがある場合
には，1つのメモリオブジェクトにまとめて登録される場合がある【NGKI2855】．</p>
</div>
<div class="paragraph">
<p>オブジェクトモジュール名は文字列パラメータ，acptn1〜acptn4は整数定数式
パラメータである【NGKI2856】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATA_MODにより登録できるオブジェクトモジュールが属する
保護ドメインや登録できる数に制限がある場合がある【NGKI2857】．この制限
に違反した場合には，E_NOSPTエラーとなる【NGKI2858】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATT_MOD／ATA_MODがサポートされていない場合がある
【NGKI2859】．ATT_MOD／ATA_MODがサポートされている場合には，
TOPPERS_SUPPORT_ATT_MODがマクロ定義される【NGKI2860】．サポートされてい
ない場合にATT_MOD／ATA_MODを使用すると，コンフィギュレータがE_NOSPTエラー
を報告する【NGKI2861】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>ATT_MOD／ATA_MODでは，標準のセクション以外は配置・登録されない．標準の
セクション以外のセクションを配置・登録するためには，ATT_SEC/ATA_SECを用
いる必要がある．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>オブジェクトモジュールに含まれるセクションの配置場所が，標準ROMリージョ
ンと標準RAMリージョンであることを明確化した．</p>
</div>
<div id="API_ATT_MEM" class="listingblock">
<div class="content">
<pre>ATT_MEM		メモリオブジェクトの登録〔SP〕【NGKI2862】
ATA_MEM		メモリオブジェクトの登録（アクセス許可ベクタ付き）〔SP〕【NGKI2863】
att_mem		メモリオブジェクトの登録〔TPD〕【NGKI2864】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ATT_MEM({ ATR mematr, void *base, SIZE size })
	ATA_MEM({ ATR mematr, void *base, SIZE size },
				{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = att_mem(const T_AMEM *pk_amem)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	T_AMEM *	pk_amem		メモリオブジェクトの登録情報を入れたパケッ
							トへのポインタ（静的APIを除く）

　＊メモリオブジェクトの登録情報（パケットの内容）
	ATR			mematr		メモリオブジェクト属性
	void *		base		登録するメモリ領域の先頭番地
	SIZE		size		登録するメモリ領域のサイズ（バイト数）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2865】
				・CPUロック状態からの呼出し〔s〕【NGKI2866】
	E_RSATR		予約属性
				・mematrが無効【NGKI2867】
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI2868】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI2869】
				・その他の条件については機能の項を参照
 	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_PAR		パラメータエラー
				・sizeが0以下【NGKI2881】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2870】
	E_MACV		メモリアクセス違反
				・pk_amemが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2871】
	E_OBJ		オブジェクト状態エラー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定したメモリオブジェクト登録情報に従って，メモリオブジェ
クトを登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>baseとsizeで指定したメモリ領域が，メモリオブジェクトとして登録される
【NGKI2872】．登録されるメモリオブジェクトには，mematrで指定したメモリ
オブジェクト属性が設定される【NGKI2873】．ATA_MEMの場合には，登録される
メモリオブジェクトのアクセス許可ベクタ（4つのアクセス許可パターンの組）
が，acptn1〜acptn4で指定した値に設定される【NGKI2874】．</p>
</div>
<div class="paragraph">
<p>mematrには，TA_MEMPRSVを指定しなければならず，TA_MEMINIを指定することは
できない．TA_MEMPRSVを指定しない場合や，TA_MEMINIを指定した場合には，
E_RSATRエラーとなる【NGKI2876】．また，mematrにTA_SDATAを指定することは
できない．TA_SDATAを指定した場合には，E_RSATRエラーとなる【NGKI3274】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mematr，size，acptn1〜acptn4は整数定数式パラメータ，
baseは一般定数式パラメータである【NGKI2877】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATT_MEM／ATA_MEMにより登録できるメモリオブジェクトが
属する保護ドメインや登録できる数に制限がある場合がある【NGKI2878】．こ
の制限に違反した場合には，E_NOSPTエラーとなる【NGKI2879】．</p>
</div>
<div class="paragraph">
<p>baseやsizeに，ターゲット定義の制約に合致しない先頭番地やサイズを指定し
た時には，E_PARエラーとなる【NGKI2880】．登録しようとしたメモリオブジェ
クトが，登録済みのメモリオブジェクトとメモリ領域が重なる場合には，
E_OBJエラーとなる【NGKI2882】．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>ATT_MEM／ATA_MEMは，メモリ空間にマッピングされたI/O領域にアクセスできる
ようにするために使用することを想定した静的APIである．メモリ領域に対して
は，ATT_SEC／ATA_SECかATT_MOD／ATA_MODを使用することを推奨する．</p>
</div>
<div class="paragraph">
<p>ATT_MEM／ATA_MEMで登録したメモリオブジェクトのメモリ領域が，ATT_REGで登
録したメモリリージョンと重なっても，直ちにエラーとはならない．ただし，
メモリリージョン内に配置されたメモリオブジェクトと，ATT_MEM／ATA_MEMで
登録したメモリオブジェクトのメモリ領域が重なった場合には，E_OBJエラーと
なる．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ATT_MEMとATA_MEMのみをサポートする【HRPS0155】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>アクセス許可ベクタを指定してメモリオブジェクトを登録するサービスコール
（ata_mem）は廃止した．</p>
</div>
<div class="paragraph">
<p>baseやsizeがターゲット定義の制約に合致しない場合，μITRON4.0/PX仕様では
ターゲット定義の制約に合致するようにメモり領域を広げることとしていたが，
この仕様ではE_PARエラーとなることとした．</p>
</div>
<div id="API_ATT_PMA" class="listingblock">
<div class="content">
<pre>ATT_PMA		物理メモリ領域の登録〔SP〕【NGKI2883】
ATA_PMA		物理メモリ領域の登録（アクセス許可ベクタ付き）〔SP〕【NGKI2884】
att_pma		物理メモリ領域の登録〔TPD〕【NGKI2885】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ATT_PMA({ ATR mematr, void *base, SIZE size, void *paddr })
	ATA_PMA({ ATR mematr, void *base, SIZE size, void *paddr  },
				{ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = att_pma(const T_APMA *pk_apma)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	T_APMA *	pk_apma		物理メモリ領域の登録情報を入れたパケットへ
							のポインタ（静的APIを除く）

　＊物理メモリ領域の登録情報（パケットの内容）
	ATR			mematr		メモリオブジェクト属性
	void *		base		登録するメモリ領域の先頭番地
	SIZE		size		登録するメモリ領域のサイズ（バイト数）
	void *		paddr		登録するメモリ領域の物理アドレス空間における
							先頭番地

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2886】
				・CPUロック状態からの呼出し〔s〕【NGKI2887】
	E_RSATR		予約属性
				・mematrが無効
				・属する保護ドメインの指定が有効範囲外〔sP〕【NGKI2888】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI2889】
				・その他の条件については機能の項を参照
 	E_NOSPT		未サポート機能
				・条件については機能の項を参照
	E_PAR		パラメータエラー
				・sizeが0以下【NGKI2901】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2890】
	E_MACV		メモリアクセス違反
				・pk_apmaが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2891】
	E_OBJ		オブジェクト状態エラー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した物理メモリ領域の登録情報に従って，メモリオブジェ
クトを登録する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>物理アドレス空間において先頭番地がpaddr，サイズがsizeのメモリ領域が，論
理アドレス空間においてbaseで指定した番地からアクセスできるように，メモ
リオブジェクトとして登録される【NGKI2892】．登録されるメモリオブジェク
トには，mematrで指定したメモリオブジェクト属性が設定される【NGKI2893】．
ATA_PMAの場合には，登録されるメモリオブジェクトのアクセス許可ベクタ（4
つのアクセス許可パターンの組）が，acptn1〜acptn4で指定した値に設定され
る【NGKI2894】．</p>
</div>
<div class="paragraph">
<p>mematrには，TA_MEMPRSVを指定しなければならず，TA_MEMINIを指定することは
できない．TA_MEMPRSVを指定しない場合や，TA_MEMINIを指定した場合には，
E_RSATRエラーとなる【NGKI2896】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，mematr，size，paddr，acptn1〜acptn4は整数定数式パラ
メータ，baseは一般定数式パラメータである【NGKI2897】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ATT_PMA／ATA_PMAにより登録できるメモリオブジェクトが
属する保護ドメインや登録できる数に制限がある場合がある【NGKI2898】．こ
の制限に違反した場合には，E_NOSPTエラーとなる【NGKI2899】．</p>
</div>
<div class="paragraph">
<p>base，size，paddrに，ターゲット定義の制約に合致しない先頭番地やサイズを
指定した時には，E_PARエラーとなる【NGKI2900】．登録しようとしたメモリオ
ブジェクトが，登録済みのメモリオブジェクトと論理アドレス空間においてメ
モリ領域が重なる場合には，E_OBJエラーとなる【NGKI2902】．</p>
</div>
<div class="paragraph">
<p>ATT_PMA／ATA_PMA／att_pmaは，MMU（Memory Management Unit）を持つターゲッ
トシステムにおいて，ターゲット定義でサポートされる機能である【NGKI2903】．
ATT_PMA／ATA_PMA／att_pmaがサポートされている場合には，
TOPPERS_SUPPORT_ATT_PMAがマクロ定義される【NGKI2904】．ATT_PMA／ATA_PMA
がサポートされていない場合にこれらの静的APIを使用すると，コンフィギュレー
タがE_NOSPTエラーを報告する【NGKI2905】．また，att_pmaがサポートされて
いない場合にatt_pmaを呼び出すと，E_NOSPTエラーが返るか，リンク時にエラー
となる【NGKI2906】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ターゲット定義で，ATT_PMAとATA_PMAのみをサポートする
【HRPS0156】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様に定義されていない静的APIおよびサービスコールである．</p>
</div>
<div id="API_sac_mem" class="listingblock">
<div class="content">
<pre>sac_mem		メモリオブジェクトのアクセス許可ベクタの設定〔TPD〕【NGKI2907】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_mem(const void *base, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	void *		base		メモリオブジェクトの先頭番地
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2908】
				・CPUロック状態からの呼出し【NGKI2909】
	E_PAR		パラメータエラー
				・baseがメモリオブジェクトの先頭番地でない【NGKI2910】
	E_NOEXS		オブジェクト未登録
				・baseで指定した番地を含むメモリオブジェクトが登録され
				　ていない【NGKI2911】
	E_OACV		オブジェクトアクセス違反
				・対象メモリオブジェクトに対する管理操作が許可されてい
				　ない【NGKI2912】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない【NGKI2913】
	E_OBJ		オブジェクト状態エラー
				・対象メモリオブジェクトは静的APIで登録された【NGKI2914】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>baseで指定したメモリオブジェクト（対象メモリオブジェクト）のアクセス許
可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定した値に
設定する【NGKI2915】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，sac_memをサポートしない【HRPS0157】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>静的APIによって登録したメモリオブジェクトは，アクセス許可ベクタを設定す
ることができないこととした．</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様では，baseはメモリオブジェクトに含まれる番地を指定する
ものとしていたが，この仕様では，メモリオブジェクトの先頭番地でなければ
ならないものとした．</p>
</div>
<div id="API_det_mem" class="listingblock">
<div class="content">
<pre>det_mem		メモリオブジェクトの登録解除〔TPD〕【NGKI2916】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = det_mem(const void *base)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	void *		base		メモリオブジェクトの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2917】
				・CPUロック状態からの呼出し【NGKI2918】
	E_PAR		パラメータエラー
				・baseがメモリオブジェクトの先頭番地でない【NGKI2919】
	E_NOEXS		オブジェクト未登録
				・baseで指定した番地を含むメモリオブジェクトが登録され
				　ていない【NGKI2920】
	E_OACV		オブジェクトアクセス違反
				・対象メモリオブジェクトに対する管理操作が許可されてい
				　ない【NGKI2921】
	E_OBJ		オブジェクト状態エラー
				・対象メモリオブジェクトは静的APIで登録された【NGKI2922】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>baseで指定したメモリオブジェクト（対象メモリオブジェクト）を登録解除す
る【NGKI2923】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，det_memをサポートしない【HRPS0158】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>静的APIによって登録したメモリオブジェクトは，登録を解除することができな
いこととした．</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様では，baseはメモリオブジェクトに含まれる番地を指定する
ものとしていたが，この仕様では，メモリオブジェクトの先頭番地でなければ
ならないものとした．</p>
</div>
<div id="API_prb_mem" class="listingblock">
<div class="content">
<pre>prb_mem		メモリ領域に対するアクセス権のチェック〔TP〕【NGKI2924】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = prb_mem(const void *base, SIZE size, ID tskid, MODE pmmode)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	void *		base		メモリ領域の先頭番地
	SIZE		size		メモリ領域のサイズ（バイト数）
	ID			tskid		アクセス元のタスクのID番号
	MODE		pmmode		アクセスモード</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI2925】
	E_ID		不正ID番号
				・tskidが有効範囲外【NGKI2927】
	E_PAR		パラメータエラー
				・sizeが0【NGKI2929】
				・その他の条件については機能の項を参照
	E_NOEXS		オブジェクト未登録
				・baseで指定した番地を含むメモリオブジェクトが登録され
				　ていない【NGKI2930】
				・tskidで指定したタスクが未登録〔D〕【NGKI3425】
	E_OACV		オブジェクトアクセス違反
				・対象メモリ領域を含むメモリオブジェクトに対する参照操
				　作が許可されていない【NGKI2931】
				・tskidで指定したタスクに対する参照操作が許可されていな
				　い【NGKI3426】
	E_MACV		メモリアクセス違反
				・条件については機能の項を参照
	E_OBJ		オブジェクト状態エラー
				・対象メモリ領域がメモリオブジェクトの境界を越えている
				　【NGKI2932】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>tskidで指定したタスクから，baseとsizeで指定したメモリ領域（対象メモリ領
域）に対して，pmmodeで指定した種別のアクセスが許可されているかをチェッ
クする．アクセスが許可されている場合にE_OK，そうでない場合にE_MACVが返
る【NGKI2933】．tskidで指定したタスクがカーネルドメインに属する場合，
E_MACVが返ることはない【NGKI2934】．</p>
</div>
<div class="paragraph">
<p>pmmodeには，TPM_WRITE（＝0x01U），TPM_READ（＝0x02U），TPM_EXEC（＝
0x04U）のいずれか，またはそれらの内のいくつかのビット毎論理和（C言語の
"|"）を指定することができる【NGKI2935】．TPM_WRITE，TPM_READ，TPM_EXEC
を指定した場合には，それぞれ，読出しアクセス，書込みアクセス，実行アク
セスが許可されているかをチェックする【NGKI2936】．また，いくつかのビッ
ト毎論理和を指定した場合には，それらに対応した種別のアクセスがすべて許
可されているかをチェックする【NGKI2937】．pmmodeにそれ以外の値を指定し
た場合には，E_PARエラーとなる【NGKI2938】．</p>
</div>
<div class="paragraph">
<p>tskidにTSK_SELF（＝0）を指定すると，自タスクから対象メモリ領域に対して
アクセスが許可されているかをチェックする【NGKI2939】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>アクセスする主体の指定方法を，保護ドメインによる指定（domid）から，タス
クによる指定（tskid）に変更した．また，pmmodeに指定できるアクセス種別に
TPM_EXECを追加し，TPM_WRITEとTPM_READの値を入れ換えた．CPUロック状態か
らも呼び出せるものとした．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>prb_memを，CPUロック状態からも呼び出せるものとしたのは，次の理由による．
prb_memは，拡張サービスコールの中で，タスクから渡されたポインタが，その
タスクからアクセスできる領域であるかを調べるために用いることを想定して
いる．拡張サービスコールの中には，CPUロック状態でも呼び出せるものがあり，
そのような拡張サービスコールを実現するには，prb_memがCPUロック状態から
呼び出せることが必要である．</p>
</div>
<div class="paragraph">
<p>なお，prb_memを非タスクコンテキストから呼び出すことはできないが，非タス
クコンテキストで実行される処理単位は必ずカーネルドメインに属するために，
prb_memを使ってアクセス権を調べる必要がないことから，支障がない．</p>
</div>
<div id="API_ref_mem" class="listingblock">
<div class="content">
<pre>ref_mem		メモリオブジェクトの状態参照〔TP〕</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_mem(const void *base, T_RMEM *pk_rmem)</pre>
</div>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ref_memをサポートしない．</p>
</div>
</div>
<div class="sect2">
<h3 id="_割込み管理機能">4.9. 割込み管理機能</h3>
<div class="paragraph">
<p>割込み処理のプログラムは，割込みサービスルーチン（ISR）として実現するこ
とを推奨する．割込みサービスルーチンをカーネルに登録する場合には，まず，
割込みサービスルーチンの登録対象となる割込み要求ラインの属性を設定して
おく必要がある【NGKI2940】．割込みサービスルーチンは，カーネル内の割込
みハンドラを経由して呼び出される【NGKI2941】．</p>
</div>
<div class="paragraph">
<p>ただし，カーネルが用意する割込みハンドラで対応できないケースに対応する
ために，アプリケーションで割込みハンドラを用意することも可能である
【NGKI2942】．この場合にも，割込みハンドラをカーネルに登録する前に，割
込みハンドラの登録対象となる割込みハンドラ番号に対応する割込み要求ライ
ンの属性を設定しておく必要がある【NGKI2943】．</p>
</div>
<div class="paragraph">
<p>割込み要求ラインの属性を設定する際に指定する割込み要求ライン属性には，
次の属性を指定することができる【NGKI2944】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_ENAINT	0x01U	割込み要求禁止フラグをクリア
TA_EDGE		0x02U	エッジトリガ</pre>
</div>
</div>
<div class="paragraph">
<p>ターゲットによっては，ターゲット定義の割込み要求ライン属性を指定できる
場合がある【NGKI2945】．ターゲット定義の割込み要求ライン属性として，次
の属性を予約している【NGKI2946】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_POSEDGE			ポジティブエッジトリガ
TA_NEGEDGE			ネガティブエッジトリガ
TA_BOTHEDGE			両エッジトリガ
TA_LOWLEVEL			ローレベルトリガ
TA_HIGHLEVEL		ハイレベルトリガ
TA_BROADCAST		すべてのプロセッサで割込みを処理（マルチプロセッ
					サ対応カーネルの場合）</pre>
</div>
</div>
<div class="paragraph">
<p>割込みサービスルーチンは，カーネルが実行を制御する処理単位である．割込
みサービスルーチンは，割込みサービスルーチンIDと呼ぶID番号によって識別
する【NGKI2947】．</p>
</div>
<div class="paragraph">
<p>1つの割込み要求ラインに対して複数の割込みサービスルーチンを登録した場合，
それらの割込みサービスルーチンは，割込みサービスルーチン優先度の高い順
にすべて呼び出される【NGKI2948】．割込みサービスルーチン優先度が同じ場
合には，登録した順（静的APIにより登録した場合には，割込みサービスルーチ
ンを生成するAPIをコンフィギュレーションファイル中に記述した順）で呼び出
される【NGKI2949】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，割込みサービスルーチンが属することのでき
る保護ドメインは，カーネルドメインに限られる【NGKI2950】．</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチン属性に指定できる属性はない【NGKI2951】．そのため
割込みサービスルーチン属性には，TA_NULLを指定しなければならない
【NGKI2952】．</p>
</div>
<div class="paragraph">
<p>C言語による割込みサービスルーチンの記述形式は次の通り【NGKI2953】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void interrupt_service_routine(intptr_t exinf)
	{
		割込みサービスルーチン本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，割込みサービスルーチンの拡張情報が渡される【NGKI2954】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラは，カーネルが実行を制御する処理単位である．割込みハンド
ラは，割込みハンドラ番号と呼ぶオブジェクト番号によって識別する
【NGKI2955】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，割込みハンドラは，カーネルドメインに属す
る【NGKI2956】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラを登録する際に指定する割込みハンドラ属性には，ターゲット
定義で，次の属性を指定することができる【NGKI2957】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_NONKERNEL	0x02U	カーネル管理外の割込み</pre>
</div>
</div>
<div class="paragraph">
<p>TA_NONKERNELを指定しない場合，カーネル管理の割込みとなる【NGKI2958】．
また，ターゲットによっては，その他のターゲット定義の割込みハンドラ属性
を指定できる場合がある【NGKI2959】．</p>
</div>
<div class="paragraph">
<p>C言語による割込みハンドラの記述形式は次の通り【NGKI2960】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void interrupt_handler(void)
	{
		割込みハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>割込み管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_INTPRI		割込み優先度の最小値（最高値）	【NGKI2961】
TMAX_INTPRI		割込み優先度の最大値（最低値，＝-1）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_ISRPRI		割込みサービスルーチン優先度の最小値（＝1）【NGKI2962】
TMAX_ISRPRI		割込みサービスルーチン優先度の最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_DIS_INT		dis_intがサポートされている【NGKI2963】
TOPPERS_SUPPORT_ENA_INT		ena_intがサポートされている【NGKI2964】</pre>
</div>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>1つの割込み要求ラインに複数のデバイスからの割込み要求が接続されている場
合に対応するために，割込みサービスルーチンは，それが処理する割込み要求
が発生しているかをチェックし，割込み要求が発生していない場合には何もせ
ずにリターンするように実装すべきである．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）
は16に固定されている【ASPS0192】．ただし，タスク優先度拡張パッケージで
は，TMAX_ISRPRIを256に拡張する【ASPS0193】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）
は16に固定されている【FMPS0159】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）
は16に固定されている【HRPS0159】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，割込みサービスルーチン優先度の最大値（＝TMAX_ISRPRI）
は16に固定されている【SSPS0137】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>割込み要求ラインの属性，割込み優先度，割込みサービスルーチン優先度は，
μITRON4.0仕様にない概念であり，TMIN_INTPRI，TMAX_INTPRI，TMIN_ISRPRI，
TMAX_ISRPRIは，μITRON4.0仕様に定義のないカーネル構成マクロである．また，
TA_NONKERNELは，μITRON4.0仕様に定義のない割込みハンドラ属性である．</p>
</div>
<div id="API_CFG_INT" class="listingblock">
<div class="content">
<pre>CFG_INT		割込み要求ラインの属性の設定〔S〕【NGKI2965】
cfg_int		割込み要求ラインの属性の設定〔TD〕【NGKI2966】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CFG_INT(INTNO intno, { ATR intatr, PRI intpri })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = cfg_int(INTNO intno, const T_CINT *pk_cint)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	INTNO		intno		割込み番号
	T_CINT *	pk_cint		割込み要求ラインの属性の設定情報を入れたパ
							ケットへのポインタ（静的APIを除く）

　＊割込み要求ラインの属性の設定情報（パケットの内容）
	ATR			intatr		割込み要求ライン属性
	PRI			intpri		割込み優先度</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2967】
				・CPUロック状態からの呼出し〔s〕【NGKI2968】
	E_RSATR		予約属性
				・intatrが無効【NGKI2969】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI2970】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI2971】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・intnoが有効範囲外【NGKI2972】
				・intpriが有効範囲外【NGKI2973】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI2974】
	E_MACV		メモリアクセス違反
				・pk_cintが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI2975】
	E_OBJ		オブジェクト状態エラー
				・対象割込み要求ラインに対して属性が設定済み〔S〕【NGKI2976】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）に対して，各パラ
メータで指定した属性を設定する【NGKI2977】．</p>
</div>
<div class="paragraph">
<p>対象割込み要求ラインの割込み要求禁止フラグは，intatrにTA_ENAINTを指定し
た場合にクリアされ，指定しない場合にセットされる【NGKI2978】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，intno，intatr，intpriは整数定数式パラメータである
【NGKI2979】．</p>
</div>
<div class="paragraph">
<p>cfg_intにおいて，ターゲット定義で，複数の割込み要求ラインの割込み優先度
が連動して設定される場合がある【NGKI2980】．</p>
</div>
<div class="paragraph">
<p>intpriに指定できる値は，基本的には，TMIN_INTPRI以上，TMAX_INTPRI以下の
値である【NGKI2981】．ターゲット定義の拡張で，カーネル管理外の割込み要
求ラインに対しても属性を設定できる場合には，TMIN_INTPRIよりも小さい値を
指定することができる【NGKI2982】．このように拡張されている場合，カーネ
ル管理外の割込み要求ラインを対象として，intpriにTMIN_INTPRI以上の値を指
定した場合には，E_OBJエラーとなる【NGKI2983】．逆に，カーネル管理の割込
み要求ラインを対象として，intpriがTMIN_INTPRIよりも小さい値である場合に
も，E_OBJエラーとなる【NGKI2984】．</p>
</div>
<div class="paragraph">
<p>対象割込み要求ラインに対して，設定できない割込み要求ライン属性をintatr
に指定した場合にはE_RSATRエラー，設定できない割込み優先度をintpriに指定
した場合にはE_PARエラーとなる【NGKI2985】．ここで，設定できない割込み要
求ライン属性／割込み優先度には，ターゲット定義の制限によって設定できな
い値も含む【NGKI2986】．また，マルチプロセッサ対応カーネルにおいて，
cfg_intを呼び出したタスクが割り付けられているプロセッサから，対象割込み
要求ラインの属性を設定できない場合も，これに該当する【NGKI2987】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，CFG_INTは，カーネルドメインの囲みの中に記
述しなければならない．そうでない場合には，E_RSATRエラーとなる
【NGKI2989】．また，cfg_intはカーネルオブジェクトを登録するサービスコー
ルではないため，割込み要求ライン属性にTA_DOM(domid)を指定した場合には
E_RSATRエラーとなる【NGKI2990】．ただし，TA_DOM(TDOM_SELF)を指定した場
合には，指定が無視され，E_RSATRエラーは検出されない【NGKI2991】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，CFG_INTの記述が，対象割込み要求ラインに
対して登録された割込みサービスルーチン（または対象割込み番号に対応する
割込みハンドラ番号に対して登録された割込みハンドラ）と異なるクラスの囲
み中にある場合には，E_RSATRエラーとなる【NGKI2992】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>ターゲット定義の制限によって設定できない割込み要求ライン属性／割込み優
先度は，主にターゲットハードウェアの制限から来るものである．例えば，対
象割込み要求ラインに対して，トリガモードや割込み優先度が固定されていて，
変更できないケースが考えられる．</p>
</div>
<div class="paragraph">
<p>cfg_intにおいて，ターゲット定義で，複数の割込み要求ラインの割込み優先度
が連動して設定されるのは，ターゲットハードウェアの制限により，異なる割
込み要求ラインに対して，同一の割込み優先度しか設定できないケースに対応
するための仕様である．この場合，CFG_INTにおいては，同一の割込み優先度し
か設定できない割込み要求ラインに対して異なる割込み優先度を設定した場合
には，E_PARエラーとなる．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，CFG_INTのみをサポートする【ASPS0194】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，CFG_INTのみをサポートする【FMPS0160】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，CFG_INTのみをサポートする【HRPS0160】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，CFG_INTのみをサポートする【SSPS0138】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていない静的APIおよびサービスコールである．</p>
</div>
<div id="API_CRE_ISR" class="listingblock">
<div class="content">
<pre>CRE_ISR		割込みサービスルーチンの生成〔S〕【NGKI2993】
ATT_ISR		割込みサービスルーチンの追加〔S〕【NGKI2994】
acre_isr	割込みサービスルーチンの生成〔TD〕【NGKI2995】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	CRE_ISR(ID isrid, { ATR isratr, intptr_t exinf,
										INTNO intno, ISR isr, PRI isrpri })
	ATT_ISR({ ATR isratr, intptr_t exinf, INTNO intno, ISR isr, PRI isrpri })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID isrid = acre_isr(const T_CISR *pk_cisr)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			isrid		対象割込みサービスルーチンのID番号（CRE_ISR
							の場合）
	T_CISR *	pk_cisr		割込みサービスルーチンの生成情報を入れたパ
							ケットへのポインタ（静的APIを除く）

　＊割込みサービスルーチンの生成情報（パケットの内容）
	ATR			isratr		割込みサービスルーチン属性
	intptr_t	exinf		割込みサービスルーチンの拡張情報
	INTNO		intno		割込みサービスルーチンを登録する割込み番号
	ISR			isr			割込みサービスルーチンの先頭番地
	PRI			isrpri		割込みサービスルーチン優先度</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_ID		isrid		生成された割込みサービスルーチンのID番号（正
							の値）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI2996】
				・CPUロック状態からの呼出し〔s〕【NGKI2997】
	E_RSATR		予約属性
				・isratrが無効【NGKI2998】
				・属する保護ドメインの指定が有効範囲外またはカーネルド
				　メイン以外〔sP〕【NGKI2999】
				・カーネルドメインの囲みの中に記述されていない〔SP〕
				　【NGKI3000】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI3001】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI3002】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・intnoが有効範囲外【NGKI3003】
				・isrがプログラムの先頭番地として正しくない【NGKI3004】
				・isrpriが有効範囲外【NGKI3005】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI3006】
	E_MACV		メモリアクセス違反
				・pk_cisrが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI3007】
	E_NOID		ID番号不足
				・割り付けられる割込みサービスルーチンIDがない〔sD〕
				　【NGKI3008】
	E_OBJ		オブジェクト状態エラー
				・isridで指定した割込みサービスルーチンが登録済み
				　（CRE_ISRの場合）【NGKI3009】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した割込みサービスルーチン生成情報に従って，割込みサー
ビスルーチンを生成する【NGKI3010】．</p>
</div>
<div class="paragraph">
<p>ATT_ISRによって生成された割込みサービスルーチンは，ID番号を持たない
【NGKI3011】．</p>
</div>
<div class="paragraph">
<p>intnoで指定した割込み要求ラインの属性が設定されていない場合には，E_OBJ
エラーとなる【NGKI3012】．また，intnoで指定した割込み番号に対応する割込
みハンドラ番号に対して，割込みハンドラを定義する機能（DEF_INH，def_inh）
によって割込みハンドラが定義されている場合にも，E_OBJエラーとなる
【NGKI3013】．さらに，intno でカーネル管理外の割込みを指定した場合にも，
E_OBJエラーとなる【NGKI3014】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，isridはオブジェクト識別名，isratr，intno，isrpriは整
数定数式パラメータ，exinfとisrは一般定数式パラメータである【NGKI3015】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，生成する割込みサービスルーチンの属する
クラスの割付け可能プロセッサが，intnoで指定した割込み要求ラインが接続さ
れたプロセッサの集合に含まれていない場合には，E_RSATRエラーとなる
【NGKI3016】．また，intnoで指定した割込み要求ラインに対して登録済みの割
込みサービスルーチンがある場合に，生成する割込みサービスルーチンがそれ
と異なるクラスに属する場合にも，E_RSATRエラーとなる【NGKI3017】．さらに，
ターゲット定義で，割込みサービスルーチンが属することができるクラスに制
限がある場合がある【NGKI3018】．生成する割込みサービスルーチンの属する
クラスが，ターゲット定義の制限に合致しない場合にも，E_RSATRエラーとなる
【NGKI3019】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいて，isrが不正である場合にE_PARエラーが検出されるか否かは，
ターゲット定義である【NGKI3020】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ATT_ISRのみをサポートする【ASPS0209】．ただし，動的生
成機能拡張パッケージでは，acre_isrもサポートする【ASPS0195】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ATT_ISRのみをサポートする【FMPS0161】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ATT_ISRのみをサポートする【HRPS0161】．ただし，動的生
成機能拡張パッケージでは，acre_isrもサポートする【HRPS0208】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ATT_ISRのみをサポートする【SSPS0139】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチンの生成情報に，isrpri（割込みサービスルーチンの割
込み優先度）を追加した．CRE_ISRは，μITRON4.0仕様に定義されていない静的
APIである．</p>
</div>
<div id="API_AID_ISR" class="listingblock">
<div class="content">
<pre>AID_ISR		割付け可能な割込みサービスルーチンIDの数の指定〔SD〕【NGKI3021】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	AID_ISR(uint_t noisr)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	uint_t		noisr		割付け可能な割込みサービスルーチンIDの数</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・保護ドメインの囲みの中に記述されている〔P〕【NGKI3439】
				・クラスの囲みの中に記述されていない〔M〕【NGKI3022】
	E_PAR		パラメータエラー
				・noisrが負の値【NGKI3287】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>noisrで指定した数の割込みサービスルーチンIDを，割込みサービスルーチンを
生成するサービスコールによって割付け可能な割込みサービスルーチンIDとし
て確保する【NGKI3024】．</p>
</div>
<div class="paragraph">
<p>noisrは整数定数式パラメータである【NGKI3025】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルの動的生成機能拡張パッケージでは，AID_ISRをサポートする
【ASPS0219】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルの動的生成機能拡張パッケージでは，AID_ISRをサポートする
【HRPS0220】．</p>
</div>
<div id="API_SAC_ISR" class="listingblock">
<div class="content">
<pre>SAC_ISR		割込みサービスルーチンのアクセス許可ベクタの設定〔SP〕【NGKI3026】
sac_isr		割込みサービスルーチンのアクセス許可ベクタの設定〔TPD〕【NGKI3027】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	SAC_ISR(ID isrid, { ACPTN acptn1, ACPTN acptn2,
										ACPTN acptn3, ACPTN acptn4 })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = sac_isr(ID isrid, const ACVCT *p_acvct)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			isrid		対象割込みサービスルーチンのID番号
	ACVCT *		p_acvct		アクセス許可ベクタを入れたパケットへのポ
							インタ（静的APIを除く）

　＊アクセス許可ベクタ（パケットの内容）
	ACPTN		acptn1		通常操作1のアクセス許可パターン
	ACPTN		acptn2		通常操作2のアクセス許可パターン
	ACPTN		acptn3		管理操作のアクセス許可パターン
	ACPTN		acptn4		参照操作のアクセス許可パターン</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI3028】
				・CPUロック状態からの呼出し〔s〕【NGKI3029】
	E_ID		不正ID番号
				・isridが有効範囲外〔s〕【NGKI3030】
	E_RSATR		予約属性
				・カーネルドメインの囲みの中に記述されていない〔S〕【NGKI3031】
				・対象割込みサービスルーチンが属するクラスの囲みの中に
				　記述されていない〔SM〕【NGKI3032】
	E_NOEXS		オブジェクト未登録
				・対象割込みサービスルーチンが未登録【NGKI3033】
	E_OACV		オブジェクトアクセス違反
				・対象割込みサービスルーチンに対する管理操作が許可され
				　ていない）〔s〕【NGKI3034】
	E_MACV		メモリアクセス違反
				・p_acvctが指すメモリ領域への読出しアクセスが許可されて
				　いない）〔s〕【NGKI3035】
	E_OBJ		オブジェクト状態エラー
				・対象割込みサービスルーチンは静的APIで生成された〔s〕
				　【NGKI3036】
				・対象割込みサービスルーチンに対してアクセス許可ベクタ
				　が設定済み〔S〕【NGKI3037】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>isridで指定した割込みサービスルーチン（対象割込みサービスルーチン）のア
クセス許可ベクタ（4つのアクセス許可パターンの組）を，各パラメータで指定
した値に設定する【NGKI3038】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，isridはオブジェクト識別名，acptn1〜acptn4は整数定数
式パラメータである【NGKI3039】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，SAC_ISR，sac_isrをサポートしない【HRPS0162】．ただし，
動的生成機能拡張パッケージでは，sac_isrをサポートする【HRPS0209】．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>割込みサービスルーチンのアクセス許可ベクタを設けず，システム状態のアク
セス許可ベクタでアクセス保護する方法も考えられる．</p>
</div>
<div id="API_del_isr" class="listingblock">
<div class="content">
<pre>del_isr		割込みサービスルーチンの削除〔TD〕【NGKI3040】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = del_isr(ID isrid)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ID			isrid		対象割込みサービスルーチンのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3041】
				・CPUロック状態からの呼出し【NGKI3042】
	E_ID		不正ID番号
				・isridが有効範囲外【NGKI3043】
	E_NOEXS		オブジェクト未登録
				・対象割込みサービスルーチンが未登録【NGKI3044】
	E_OACV		オブジェクトアクセス違反
				・対象割込みサービスルーチンに対する管理操作が許可され
				　ていない〔P〕【NGKI3045】
	E_OBJ		オブジェクト状態エラー
				・対象割込みサービスルーチンは静的APIで生成された【NGKI3046】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>isridで指定した割込みサービスルーチン（対象割込みサービスルーチン）を削
除する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>対象割込みサービスルーチンの登録が解除され，その割込みサービスルーチン
IDが未使用の状態に戻される【NGKI3047】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，del_isrをサポートしない【ASPS0197】．ただし，動的生成
機能拡張パッケージでは，del_isrをサポートする【ASPS0198】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，del_isrをサポートしない【FMPS0163】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，del_isrをサポートしない【HRPS0163】．ただし，動的生成
機能拡張パッケージでは，del_isrをサポートする【HRPS0210】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，del_isrをサポートしない【SSPS0141】．</p>
</div>
<div id="API_ref_isr" class="listingblock">
<div class="content">
<pre>ref_isr		割込みサービスルーチンの状態参照〔T〕</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_isr(ID isrid, T_RISR *pk_risr)</pre>
</div>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ref_isrをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ref_isrをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ref_isrをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ref_isrをサポートしない．</p>
</div>
<div id="API_DEF_INH" class="listingblock">
<div class="content">
<pre>DEF_INH		割込みハンドラの定義〔S〕【NGKI3048】
def_inh		割込みハンドラの定義〔TD〕【NGKI3049】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_INH(INHNO inhno, { ATR inhatr, INTHDR inthdr })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = def_inh(INHNO inhno, const T_DINH *pk_dinh)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	INHNO		inhno		割込みハンドラ番号
	T_DINH *	pk_dinh		割込みハンドラの定義情報を入れたパケットへ
							のポインタ（静的APIを除く）

　＊割込みハンドラの定義情報（パケットの内容）
	ATR			inhatr		割込みハンドラ属性
	INTHDR		inthdr		割込みハンドラの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI3050】
				・CPUロック状態からの呼出し〔s〕【NGKI3051】
	E_RSATR		予約属性
				・inhatrが無効【NGKI3052】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI3053】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI3054】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・inhnoが有効範囲外【NGKI3055】
				・inthdrがプログラムの先頭番地として正しくない【NGKI3056】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI3057】
	E_MACV		メモリアクセス違反
				・pk_dinhが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI3058】
	E_OBJ		オブジェクト状態エラー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>inhnoで指定した割込みハンドラ番号（対象割込みハンドラ番号）に対して，各
パラメータで指定した割込みハンドラ定義情報に従って，割込みハンドラを定
義する【NGKI3059】．ただし，def_inhにおいてpk_dinhをNULLにした場合には，
対象割込みハンドラ番号に対する割込みハンドラの定義を解除する【NGKI3060】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，inhnoとinhatrは整数定数式パラメータ，inthdrは一般定
数式パラメータである【NGKI3061】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラを定義する場合（DEF_INHの場合およびdef_inhにおいて
pk_dinhをNULL以外にした場合）には，次のエラーが検出される．</p>
</div>
<div class="paragraph">
<p>対象割込みハンドラ番号に対応する割込み要求ラインの属性が設定されていな
い場合には，E_OBJエラーとなる【NGKI3062】．また，対象割込みハンドラ番号
に対してすでに割込みハンドラが定義されている場合と，対象割込みハンドラ
番号に対応する割込み番号を対象に割込みサービスルーチンが登録されている
場合にも，E_OBJエラーとなる【NGKI3063】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義の拡張で，カーネル管理外の割込みに対しても割込みハンドラ
を定義できる場合には，次のエラーが検出される【NGKI3064】．カーネル管理
外の割込みハンドラを対象として，inhatrにTA_NONKERNELを指定しない場合に
は，E_OBJエラーとなる【NGKI3065】．逆に，カーネル管理の割込みハンドラを
対象として，inhatrにTA_NONKERNELを指定した場合にも，E_OBJエラーとなる
【NGKI3066】．また，ターゲット定義でカーネル管理外に固定されている割込
みハンドラがある場合には，それを対象割込みハンドラに指定して，inhatrに
TA_NONKERNELを指定しない場合には，E_RSATRエラーとなる【NGKI3067】．逆に，
ターゲット定義でカーネル管理に固定されている割込みハンドラがある場合に
は，それを対象割込みハンドラに指定して，inhatrにTA_NONKERNELを指定した
場合には，E_RSATRエラーとなる【NGKI3068】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，DEF_INHは，カーネルドメインの囲みの中に記
述しなければならない．そうでない場合には，E_RSATRエラーとなる
【NGKI3070】．また，def_inhで割込みハンドラを定義する場合には，割込みハ
ンドラの属する保護ドメインを設定する必要はなく，割込みハンドラ属性に
TA_DOM(domid)を指定した場合にはE_RSATRエラーとなる【NGKI3071】．ただし，
TA_DOM(TDOM_SELF)を指定した場合には，指定が無視され，E_RSATRエラーは検
出されない【NGKI3072】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，登録する割込みハンドラの属するクラスの
初期割付けプロセッサが，その割込みが要求されるプロセッサでない場合には，
E_RSATRエラーとなる【NGKI3073】．また，ターゲット定義で，割込みハンドラ
が属することができるクラスに制限がある場合がある【NGKI3074】．登録する
割込みハンドラの属するクラスが，ターゲット定義の制限に合致しない場合に
も，E_RSATRエラーとなる【NGKI3075】．</p>
</div>
<div class="paragraph">
<p>割込みハンドラの定義を解除する場合（def_inhにおいてpk_dinhをNULLにした
場合）で，対象割込みハンドラ番号に対して割込みハンドラが定義されていな
い場合には，E_OBJエラーとなる【NGKI3076】．また，対象割込みハンドラ番号
に対して定義された割込みハンドラが，静的APIで定義されたものである場合に
は，ターゲット定義でE_OBJエラーとなる場合がある【NGKI3077】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込みハンドラを定義（または定義解除）できない場
合には，E_PARエラーとなる【NGKI3078】．具体的には，マルチプロセッサ対応
カーネルにおいて，def_inhを呼び出したタスクが割り付けられているプロセッ
サから，対象割込みハンドラを定義（または定義解除）できない場合が，これ
に該当する【NGKI3079】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいて，inthdrが不正である場合にE_PARエラーが検出されるか否か
は，ターゲット定義である【NGKI3080】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，DEF_INHのみをサポートする【ASPS0199】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，DEF_INHのみをサポートする【FMPS0164】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，DEF_INHのみをサポートする【HRPS0164】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，DEF_INHのみをサポートする【SSPS0142】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>inthdrのデータ型をINTHDRに変更した．</p>
</div>
<div class="paragraph">
<p>def_inhによって定義済みの割込みハンドラを再定義しようとした場合に，
E_OBJエラーとすることにした．割込みハンドラの定義を変更するには，一度定
義を解除してから，再度定義する必要がある．</p>
</div>
<div id="API_dis_int" class="listingblock">
<div class="content">
<pre>dis_int		割込みの禁止〔T〕【NGKI3081】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = dis_int(INTNO intno)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	INTNO		intno		割込み番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3082】
	E_NOSPT		未サポートエラー
				・条件については機能の項を参照
	E_PAR		パラメータエラー
				・intnoが有効範囲外【NGKI3083】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作2が許可されていない〔P〕
				　【NGKI3084】
	E_OBJ		オブジェクト状態エラー
				・対象割込み要求ラインに対して割込み要求ライン属性が設
				　定されていない【NGKI3085】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）の割込み要求禁止
フラグをセットする【NGKI3086】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込み要求ラインの割込み要求禁止フラグをセットで
きない場合には，E_PARエラーとなる【NGKI3087】．具体的には，対象割込み要
求ラインに対して割込み要求禁止フラグがサポートされていない場合や，マル
チプロセッサ対応カーネルにおいて，dis_intを呼び出したタスクが割り付けら
れているプロセッサから，対象割込み要求ラインの割込み要求禁止フラグが操
作できない場合が，これに該当する．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，割込み要求禁止フラグの振舞いが，この仕様の規定と異な
る場合がある【NGKI3089】．特にマルチプロセッサ対応カーネルでは，あるプ
ロセッサからdis_intを呼び出して割込み要求禁止フラグをセットしても，他の
プロセッサに対しては割込みがマスクされない場合がある．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，dis_intがサポートされていない場合がある【NGKI3091】．
dis_intがサポートされている場合には，TOPPERS_SUPPORT_DIS_INTがマクロ定
義される【NGKI3092】．サポートされていない場合にdis_intを呼び出すと，
E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI3093】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様で実装定義としていたintnoの意味を標準化した．</p>
</div>
<div class="paragraph">
<p>CPUロック状態でも呼び出せるものとした．</p>
</div>
<div id="API_ena_int" class="listingblock">
<div class="content">
<pre>ena_int		割込みの許可〔T〕【NGKI3094】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ena_int(INTNO intno)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	INTNO		intno		割込み番号</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3095】
	E_NOSPT		未サポートエラー
				・条件については機能の項を参照
	E_PAR		パラメータエラー
				・intnoが有効範囲外【NGKI3096】
				・その他の条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作2が許可されていない〔P〕
				　【NGKI3097】
	E_OBJ		オブジェクト状態エラー
				・対象割込み要求ラインに対して割込み要求ライン属性が設
				　定されていない【NGKI3098】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>intnoで指定した割込み要求ライン（対象割込み要求ライン）の割込み要求禁止
フラグをクリアする【NGKI3099】．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，対象割込み要求ラインの割込み要求禁止フラグをクリアで
きない場合には，E_PARエラーとなる【NGKI3100】．具体的には，対象割込み要
求ラインに対して割込み要求禁止フラグがサポートされていない場合や，マル
チプロセッサ対応カーネルにおいて，ena_intを呼び出したタスクが割り付けら
れているプロセッサから，対象割込み要求ラインの割込み要求禁止フラグが操
作できない場合が，これに該当する．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，割込み要求禁止フラグの振舞いが，この仕様の規定と異な
る場合がある【NGKI3102】．特にマルチプロセッサ対応カーネルでは，あるプ
ロセッサからena_intを呼び出して割込み要求禁止フラグをクリアしても，他の
プロセッサに対しては割込みがマスク解除されない場合がある．</p>
</div>
<div class="paragraph">
<p>ターゲット定義で，ena_intがサポートされていない場合がある【NGKI3104】．
ena_intがサポートされている場合には，TOPPERS_SUPPORT_ENA_INTがマクロ定
義される【NGKI3105】．サポートされていない場合にena_intを呼び出すと，
E_NOSPTエラーが返るか，リンク時にエラーとなる【NGKI3106】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様で実装定義としていたintnoの意味を標準化した．</p>
</div>
<div class="paragraph">
<p>CPUロック状態でも呼び出せるものとした．</p>
</div>
<div id="API_ref_int" class="listingblock">
<div class="content">
<pre>ref_int		割込み要求ラインの参照〔T〕</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_int(INTNO intno, T_RINT *pk_rint)</pre>
</div>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ref_intをサポートしない．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div id="API_chg_ipm" class="listingblock">
<div class="content">
<pre>chg_ipm		割込み優先度マスクの変更〔T〕【NGKI3107】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = chg_ipm(PRI intpri)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	PRI			intpri		割込み優先度マスク</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3108】
				・CPUロック状態からの呼出し【NGKI3109】
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する通常操作2が許可されていない〔P〕
				　【NGKI3110】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>割込み優先度マスクを，intpriで指定した値に変更する【NGKI3111】．</p>
</div>
<div class="paragraph">
<p>intpriは，TMIN_INTPRI以上，TIPM_ENAALL以下でなければならない．そうでな
い場合には，E_PARエラーとなる【NGKI3113】．ただし，ターゲット定義の拡張
として，TMIN_INTPRIよりも小さい値を指定できる場合がある【NGKI3114】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>割込み優先度マスクをTIPM_ENAALLに変更した場合，ディスパッチ保留状態が解
除され，ディスパッチが起こる可能性がある．また，タスク例外処理ルーチン
の実行が開始される可能性がある．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，chg_ipmをサポートしない【SSPS0143】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，サービスコールの名称およびパラメータの名称が実装定
義となっているサービスコールである．</p>
</div>
<div id="API_get_ipm" class="listingblock">
<div class="content">
<pre>get_ipm		割込み優先度マスクの参照〔T〕【NGKI3115】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = get_ipm(PRI *p_intpri)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	PRI *		p_intpri	割込み優先度マスクを入れるメモリ領域へのポ
							インタ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		エラーコード
	PRI			intpri		割込み優先度マスク</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し【NGKI3116】
				・CPUロック状態からの呼出し【NGKI3117】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する参照操作が許可されていない〔P〕
				　【NGKI3118】
	E_MACV		メモリアクセス違反
				・p_intpriが指すメモリ領域への書込みアクセスが許可され
				　ていない〔P〕【NGKI3119】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>割込み優先度マスクの現在値を参照する．参照した割込み優先度マスクは，
p_intpriが指すメモリ領域に返される【NGKI3120】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，get_ipmをサポートしない【SSPS0144】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，サービスコールの名称およびパラメータの名称が実装定
義となっているサービスコールである．</p>
</div>
</div>
<div class="sect2">
<h3 id="_cpu例外管理機能">4.10. CPU例外管理機能</h3>
<div class="paragraph">
<p>CPU例外ハンドラは，カーネルが実行を制御する処理単位である．CPU例外ハン
ドラは，CPU例外ハンドラ番号と呼ぶオブジェクト番号によって識別する
【NGKI3121】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，CPU例外ハンドラは，カーネルドメインに属す
る【NGKI3122】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラ属性に標準で指定できる属性はないが，ターゲットによっては，
ターゲット定義のCPU例外ハンドラ属性を指定できる場合がある【NGKI3123】．
ターゲット定義のCPU例外ハンドラ属性として，次の属性を予約している
【NGKI3124】．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_DIRECT			CPU例外ハンドラを直接呼び出す</pre>
</div>
</div>
<div class="paragraph">
<p>C言語によるCPU例外ハンドラの記述形式は次の通り【NGKI3125】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void cpu_exception_handler(void *p_excinf)
	{
		CPU例外ハンドラ本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>p_excinfには，CPU例外の情報を記憶しているメモリ領域の先頭番地が渡される
【NGKI3126】．これは，CPU例外ハンドラ内で，CPU例外発生時の状態を参照す
る際に必要となる．</p>
</div>
<div id="API_DEF_EXC" class="listingblock">
<div class="content">
<pre>DEF_EXC		CPU例外ハンドラの定義〔S〕【NGKI3127】
def_exc		CPU例外ハンドラの定義〔TD〕【NGKI3128】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_EXC(EXCNO excno, { ATR excatr, EXCHDR exchdr })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = def_exc(EXCNO excno, const T_DEXC *pk_dexc)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	EXCNO		excno		CPU例外ハンドラ番号
	T_DEXC *	pk_dexc		CPU例外ハンドラの定義情報を入れたパケットへ
							のポインタ（静的APIを除く）

　＊CPU例外ハンドラの定義情報（パケットの内容）
	ATR			excatr		CPU例外ハンドラ属性
	EXCHDR		exchdr		CPU例外ハンドラの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI3129】
				・CPUロック状態からの呼出し〔s〕【NGKI3130】
	E_RSATR		予約属性
				・excatrが無効【NGKI3131】
				・属するクラスの指定が有効範囲外〔sM〕【NGKI3132】
				・クラスの囲みの中に記述されていない〔SM〕【NGKI3133】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・excnoが有効範囲外【NGKI3134】
				・exchdrがプログラムの先頭番地として正しくない【NGKI3135】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔sP〕
				　【NGKI3136】
	E_MACV		メモリアクセス違反
				・pk_dexcが指すメモリ領域への読出しアクセスが許可されて
				　いない〔sP〕【NGKI3137】
	E_OBJ		オブジェクト状態エラー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>excnoで指定したCPU例外ハンドラ番号（対象CPU例外ハンドラ番号）に対して，
各パラメータで指定したCPU例外ハンドラ定義情報に従って，CPU例外ハンドラ
を定義する【NGKI3138】．ただし，def_excにおいてpk_dexcをNULLにした場合
には，対象CPU例外ハンドラ番号に対するCPU例外ハンドラの定義を解除する
【NGKI3139】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，excnoとexcatrは整数定数式パラメータ，exchdrは一般定
数式パラメータである【NGKI3140】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラを定義する場合（DEF_EXCの場合およびdef_excにおいて
pk_dexcをNULL以外にした場合）で，対象CPU例外ハンドラ番号に対してすでに
CPU例外ハンドラが定義されている場合には，E_OBJエラーとなる【NGKI3141】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，DEF_EXCは，カーネルドメインの囲みの中に記
述しなければならない．そうでない場合には，E_RSATRエラーとなる
【NGKI3143】．また，def_excでCPU例外ハンドラを定義する場合には，CPU例外
ハンドラの属する保護ドメインを設定する必要はなく，CPU例外ハンドラ属性に
TA_DOM(domid)を指定した場合にはE_RSATRエラーとなる【NGKI3144】．ただし，
TA_DOM(TDOM_SELF)を指定した場合には，指定が無視され，E_RSATRエラーは検
出されない【NGKI3145】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルで，登録するCPU例外ハンドラの属するクラスの
初期割付けプロセッサが，そのCPU例外が発生するプロセッサでない場合には，
E_RSATRエラーとなる【NGKI3146】．</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラの定義を解除する場合（def_excにおいてpk_dexcをNULLにした
場合）で，対象CPU例外ハンドラ番号に対してCPU例外ハンドラが定義されてい
ない場合には，E_OBJエラーとなる【NGKI3147】．また，対象CPU例外ハンドラ
番号に対して定義されたCPU例外ハンドラが，静的APIで定義されたものである
場合には，ターゲット定義でE_OBJエラーとなる場合がある【NGKI3148】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいて，exchdrが不正である場合にE_PARエラーが検出されるか否か
は，ターゲット定義である【NGKI3149】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，DEF_EXCのみをサポートする【ASPS0200】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，DEF_EXCのみをサポートする【FMPS0165】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，DEF_EXCのみをサポートする【HRPS0165】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，DEF_EXCのみをサポートする【SSPS0145】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>def_excによって，定義済みのCPU例外ハンドラを再定義しようとした場合に，
E_OBJエラーとすることにした．</p>
</div>
<div id="API_xsns_dpn" class="listingblock">
<div class="content">
<pre>xsns_dpn	CPU例外発生時のディスパッチ保留状態の参照〔TI〕【NGKI3150】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t stat = xsns_dpn(void *p_excinf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	void *		p_excinf	CPU例外の情報を記憶しているメモリ領域の先頭
							番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t		state		ディスパッチ保留状態</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>CPU例外発生時のディスパッチ保留状態を参照する．具体的な振舞いは以下の通
り．</p>
</div>
<div class="paragraph">
<p>実行中のCPU例外ハンドラの起動原因となったCPU例外が，カーネル管理外の
CPU例外でなく，タスクコンテキストで発生し，そのタスクがディスパッチ保留
状態でなかった場合にfalse，そうでない場合にtrueが返る【NGKI3151】．</p>
</div>
<div class="paragraph">
<p>保護機能対応のカーネルにおいて，xsns_dpnをタスクコンテキストから呼び出
した場合には，trueが返る【NGKI3152】．</p>
</div>
<div class="paragraph">
<p>p_excinfには，CPU例外ハンドラに渡されるp_excinfパラメータをそのまま渡す
【NGKI3153】．それ以外の値を渡した場合の動作は保証されない【NGKI3552】．</p>
</div>
<div class="paragraph">
<p>【使用方法】</p>
</div>
<div class="paragraph">
<p>xsns_dpnは，CPU例外ハンドラの中で，どのようなリカバリ処理が可能かを判別
したい場合に使用する．xsns_dpnがfalseを返した場合（trueを返した場合では
ないので注意すること），非タスクコンテキスト用のサービスコールを用いて
CPU例外を起こしたタスクよりも優先度の高いタスクを起動または待ち解除し，
そのタスクでリカバリ処理を行うことができる．ただし，CPU例外を起こしたタ
スクが最高優先度の場合には，この方法でリカバリ処理を行うことはできない．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>xsns_dpnは，E_CTXエラーを返すことがないために〔TI〕となっているが，CPU
例外ハンドラから呼び出すためのものである．CPU例外ハンドラ以外から呼び出
した場合や，p_excinfに正しい値を渡さなかった場合，xsns_dpnが返す値は意
味を持たない．</p>
</div>
<div class="paragraph">
<p>どちらの条件でtrueが返るか間違いやすいので注意すること．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，xsns_dpnをサポートしない【SSPS0146】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>保護機能対応のカーネルにおいては，xsns_dpnをユーザドメインから呼び出す
ことは禁止すべきである．ユーザドメインの実行中は，必ずタスクコンテキス
トであるため，xsns_dpnをタスクコンテキストから呼び出した場合に必ずtrue
を返す仕様とすることで，xsns_dpnをユーザドメインから呼び出すことを実質
的に禁止している．</p>
</div>
<div id="APIxsns_xpn" class="listingblock">
<div class="content">
<pre>xsns_xpn	CPU例外発生時のタスク例外処理保留状態の参照〔TI〕【NGKI3154】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t stat = xsns_xpn(void *p_excinf)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	void *		p_excinf	CPU例外の情報を記憶しているメモリ領域の先頭
							番地</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	bool_t		state		タスク例外処理保留状態</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>CPU例外発生時にタスク例外処理ルーチンを実行開始できない状態であったかを
参照する．具体的な振舞いは以下の通り．</p>
</div>
<div class="paragraph">
<p>実行中のCPU例外ハンドラの起動原因となったCPU例外が，カーネル管理外の
CPU例外でなく，タスクコンテキストで発生し，そのタスクがタスク例外処理ルー
チンを実行開始できる状態であった場合にfalse，そうでない場合にtrueが返る
【NGKI3155】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，CPU例外が発生したタスクがユーザタスクの場
合には，ユーザスタック領域の残りが少なく，タスク例外処理ルーチンを実行
開始できない（タスク例外処理ルーチンを実行開始しようとすると，タスク例
外実行開始時スタック不正例外が発生する）場合にも，trueを返す【NGKI3156】．</p>
</div>
<div class="paragraph">
<p>保護機能対応のカーネルにおいて，xsns_xpnをタスクコンテキストから呼び出
した場合には，trueが返る【NGKI3157】．</p>
</div>
<div class="paragraph">
<p>p_excinfには，CPU例外ハンドラに渡されるp_excinfパラメータをそのまま渡す
【NGKI3158】．</p>
</div>
<div class="paragraph">
<p>【使用方法】</p>
</div>
<div class="paragraph">
<p>xsns_xpnは，CPU例外ハンドラの中で，どのようなリカバリ処理が可能かを判別
したい場合に使用する．xsns_xpnがfalseを返した場合（trueを返した場合では
ないので注意すること），非タスクコンテキスト用のサービスコールを用いて
CPU例外を起こしたタスクにタスク例外を要求し，タスク例外処理ルーチンでリ
カバリ処理を行うことができる．</p>
</div>
<div class="paragraph">
<p>【使用上の注意】</p>
</div>
<div class="paragraph">
<p>xsns_xpnは，E_CTXエラーを返すことがないために〔TI〕となっているが，CPU
例外ハンドラから呼び出すためのものである．CPU例外ハンドラ以外から呼び出
した場合や，p_excinfに正しい値を渡さなかった場合，xsns_xpnが返す値は意
味を持たない．</p>
</div>
<div class="paragraph">
<p>どちらの条件でtrueが返るか間違いやすいので注意すること．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，xsns_xpnをサポートしない【SSPS0147】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていないサービスコールである．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>保護機能対応のカーネルにおいては，xsns_xpnをユーザドメインから呼び出す
ことは禁止すべきである．ユーザドメインの実行中は，必ずタスクコンテキス
トであるため，xsns_xpnをタスクコンテキストから呼び出した場合に必ずtrue
を返す仕様とすることで，xsns_xpnをユーザドメインから呼び出すことを実質
的に禁止している．</p>
</div>
</div>
<div class="sect2">
<h3 id="_拡張サービスコール管理機能">4.11. 拡張サービスコール管理機能</h3>
<div class="paragraph">
<p>拡張サービスコールは，非特権モードで実行される処理単位から，特権モード
で実行すべきルーチンを呼び出すための機能である【NGKI3159】．特権モード
で実行するルーチンを，拡張サービスコールと呼ぶ．拡張サービスコールは，
特権モードで実行される処理単位からも呼び出すことができる【NGKI3160】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，拡張サービスコールは，カーネルドメインに
属する【NGKI3161】．拡張サービスコールは，それを呼び出す処理単位とは別
の処理単位であり，拡張サービスコールからカーネルオブジェクトをアクセス
する場合には，拡張サービスコールがアクセスの主体となる【NGKI3162】．そ
のため，拡張サービスコールからは，すべてのカーネルオブジェクトに対して，
すべての種別のアクセスを行うことが許可される．</p>
</div>
<div class="paragraph">
<p>保護機能対応でないカーネルでは，非特権モードと特権モードの区別がないた
め，拡張サービスコール管理機能をサポートしない【NGKI3163】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコール属性に指定できる属性はない【NGKI3686】．そのため拡張
サービスコール属性には，TA_NULLを指定しなければならない【NGKI3687】．</p>
</div>
<div class="paragraph">
<p>C言語による拡張サービスコールの記述形式は次の通り【NGKI3164】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	ER_UINT extended_svc(intptr_t par1, intptr_t par2, intptr_t par3,
								intptr_t par4, intptr_t par5, ID cdmid)
	{
		拡張サービスコール本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>cdmidには，拡張サービスコールを呼び出した処理単位が属する保護ドメインの
ID番号が渡される【NGKI3165】．すなわち，拡張サービスコールから呼び出し
た場合にはTDOM_KERNEL（＝-1）が，タスク本体（拡張サービスコールを除く）
から呼び出した場合にはそのタスク（自タスク）の属する保護ドメインIDが渡
される．</p>
</div>
<div class="paragraph">
<p>par1〜par5には，拡張サービスコールに対するパラメータが渡される
【NGKI3166】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコール管理機能に関連するカーネル構成マクロは次の通り．</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_FNCD		拡張サービスコールの機能番号の最大値（動的生成対応
				カーネルでは，登録できる拡張サービスコールの数に一
				致）【NGKI3167】</pre>
</div>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，拡張サービスコール管理機能をサポートしない【ASPS0201】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，拡張サービスコール管理機能をサポートしない【FMPS0166】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，拡張サービスコール管理機能をサポートする【HRPS0166】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，拡張サービスコール管理機能をサポートしない【SSPS0148】．</p>
</div>
<div class="paragraph">
<p>【未決定事項】</p>
</div>
<div class="paragraph">
<p>動的生成対応カーネルにおいてTMAX_FNCDを設定する方法については，現時点で
は未決定である．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>この仕様では，拡張サービスコールに対するパラメータを，intptr_t型のパラ
メータ5個に固定した．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールに，それを呼び出した処理単位が属する保護ドメインのID
番号を渡す機能を追加した．</p>
</div>
<div class="paragraph">
<p>TMAX_FNCDは，μITRON4.0仕様に規定されていないカーネル構成マクロである．</p>
</div>
<div id="API_DEF_SVC" class="listingblock">
<div class="content">
<pre>DEF_SVC		拡張サービスコールの定義〔SP〕【NGKI3168】
def_svc		拡張サービスコールの定義〔TPD〕【NGKI3169】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_SVC(FN fncd, { ATR svcatr, EXTSVC extsvc, SIZE stksz })</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = def_svc(FN fncd, const T_DSVC *pk_dsvc)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	FN			fncd		拡張サービスコールの機能コード
	T_DSVC *	pk_dsvc		拡張サービスコールの定義情報を入れたパケッ
							トへのポインタ（静的APIを除く）

　＊拡張サービスコールの定義情報（パケットの内容）
	ATR			svcatr		拡張サービスコール属性
	EXTSVC		extsvc		拡張サービスコールの先頭番地
	SIZE		stksz		拡張サービスコールで使用するスタックサイズ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER			ercd		正常終了（E_OK）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_CTX		コンテキストエラー
				・非タスクコンテキストからの呼出し〔s〕【NGKI3170】
				・CPUロック状態からの呼出し〔s〕【NGKI3171】
	E_RSATR		予約属性
				・svcatrが無効【NGKI3172】
				・その他の条件については機能の項を参照
	E_PAR		パラメータエラー
				・fncdが0または負の値【NGKI3173】
				・fncdがTMAX_FNCDよりも大きい〔s〕【NGKI3174】
				・extsvcがプログラムの先頭番地として正しくない【NGKI3175】
				・stkszが負の値〔S〕【NGKI3290】
	E_OACV		オブジェクトアクセス違反
				・システム状態に対する管理操作が許可されていない〔s〕
				　【NGKI3176】
	E_MACV		メモリアクセス違反
				・pk_dsvcが指すメモリ領域への読出しアクセスが許可されて
				　いない〔s〕【NGKI3177】
	E_OBJ		オブジェクト状態エラー
				・条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>fncdで指定した機能コード（対象機能コード）に対して，各パラメータで指定
した拡張サービスコール定義情報に従って，拡張サービスコールを定義する
【NGKI3178】．ただし，def_svcにおいてpk_dsvcをNULLにした場合には，対象
機能コードに対する拡張サービスコールの定義を解除する【NGKI3179】．</p>
</div>
<div class="paragraph">
<p>静的APIにおいては，fncd，svcatr，stkszは整数定数式パラメータ，svchdrは
一般定数式パラメータである【NGKI3180】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールを定義する場合（DEF_SVCの場合およびdef_svcにおいて
pk_dsvcをNULL以外にした場合）で，対象機能コードに対してすでに拡張サービ
スコールが定義されている場合には，E_OBJエラーとなる【NGKI3181】．</p>
</div>
<div class="paragraph">
<p>DEF_SVCは，カーネルドメインの囲みの中に記述しなければならない．そうでな
い場合には，E_RSATRエラーとなる【NGKI3183】．また，def_svcで拡張サービ
スコールを定義する場合には，拡張サービスコールの属する保護ドメインを設
定する必要はなく，拡張サービスコール属性にTA_DOM(domid)を指定した場合に
はE_RSATRエラーとなる【NGKI3184】．ただし，TA_DOM(TDOM_SELF)を指定した
場合には，指定が無視され，E_RSATRエラーは検出されない【NGKI3185】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，DEF_SVCは，クラスの囲みの外に記述しな
ければならない．そうでない場合には，E_RSATRエラーとなる【NGKI3187】．ま
た，def_svcで拡張サービスコールを定義する場合には，拡張サービスコールの
属するクラスを設定する必要はなく，拡張サービスコール属性に
TA_CLS(clsid)を指定した場合にはE_RSATRエラーとなる【NGKI3188】．ただし，
TA_CLS(TCLS_SELF)を指定した場合には，指定が無視され，E_RSATRエラーは検
出されない【NGKI3189】．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールの定義を解除する場合（def_svcにおいてpk_dsvcをNULLに
した場合）で，対象機能コードに対して拡張サービスコールが定義されていな
い場合には，E_OBJエラーとなる【NGKI3190】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，DEF_SVCのみをサポートする【HRPS0167】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>拡張サービスコールの定義情報に，stksz（拡張サービスコールで使用するスタッ
クサイズ）を追加した．</p>
</div>
<div class="paragraph">
<p>extsvcのデータ型を，EXTSVCに変更した．</p>
</div>
<div id="API_cal_svc" class="listingblock">
<div class="content">
<pre>cal_svc		拡張サービスコールの呼出し〔TIP〕【NGKI3191】</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_UINT ercd = cal_svc(FN fncd, intptr_t par1, intptr_t par2,
						intptr_t par3, intptr_t par4, intptr_t par5)</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	FN			fncd		呼び出す拡張サービスコールの機能コード
	intptr_t	par1		拡張サービスコールへの第1パラメータ
	intptr_t	par2		拡張サービスコールへの第2パラメータ
	intptr_t	par3		拡張サービスコールへの第3パラメータ
	intptr_t	par4		拡張サービスコールへの第4パラメータ
	intptr_t	par5		拡張サービスコールへの第5パラメータ</pre>
</div>
</div>
<div class="paragraph">
<p>【リターンパラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER_UINT		ercd		正常終了（正の値または0）またはエラーコード</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_SYS		システムエラー
				・条件については機能の項を参照
	E_RSFN		予約機能コード
				・fncdが0または負の値【NGKI3192】
				・fncdがTMAX_FNCDよりも大きい【NGKI3193】
				・fncdで指定した機能コードに対して拡張サービスコールが
				　定義されていない【NGKI3194】
	E_NOMEM		メモリ不足
				・条件については機能の項を参照
　＊その他，拡張サービスコールが返すエラーコードがそのまま返る．</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>fncdで指定した機能コードの拡張サービスコールを，par1，par2，…，par5を
パラメータとして呼び出し，拡張サービスコールの返値を返す【NGKI3195】．</p>
</div>
<div class="paragraph">
<p>また，タスクコンテキストから呼び出した場合には，次のエラーが検出される
【NGKI3196】．スタック（ユーザタスクの場合はシステムスタック）の残り領
域が，拡張サービスコールで使用するスタックサイズよりも小さい場合には，
E_NOMEMエラーとなる【NGKI3197】．また，拡張サービスコールのネストレベル
が上限（＝255）を超える場合には，E_SYSエラーが返る【NGKI3198】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様では，cal_svcでカーネルのサービスコールを呼び出せるかどう
かは実装定義としているが，この仕様では，カーネルのサービスコールを呼び
出せないこととした．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールが呼び出される時に，スタックの残り領域のサイズをチェッ
クする機能を追加した．</p>
</div>
<div class="paragraph">
<p>拡張サービスコールに対するパラメータを，intptr_t型のパラメータ5個に固定
し，cal_svcから返るエラー（E_SYS，E_RSFN，E_NOMEM）について規定した．</p>
</div>
<div class="paragraph">
<p>【仕様決定の理由】</p>
</div>
<div class="paragraph">
<p>パラメータの型と数を固定したのは，型チェックを厳密にできるようにし，パ
ラメータをコンパイラやコーリングコンベンションによらずに正しく渡せるよ
うにするためである．</p>
</div>
</div>
<div class="sect2">
<h3 id="_システム構成管理機能">4.12. システム構成管理機能</h3>
<div class="paragraph">
<p>システム構成管理機能には，非タスクコンテキスト用スタック領域を設定する
機能，初期化ルーチンと終了処理ルーチンを登録する機能，カーネルのコンフィ
ギュレーション情報やバージョン情報を参照する機能が含まれる．</p>
</div>
<div class="paragraph">
<p>非タスクコンテキスト用スタック領域は，非タスクコンテキストで実行される
処理単位が用いるスタック領域である．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，非タスクコンテキスト用のスタック領域は，
カーネルの用いるオブジェクト管理領域と同様に扱われる【NGKI3199】．</p>
</div>
<div class="paragraph">
<p>初期化ルーチンは，カーネルが実行を制御する処理単位で，カーネルの動作開
始の直前に，カーネル非動作状態で実行される【NGKI3200】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，初期化ルーチンは，カーネルドメインに属す
る【NGKI3201】．</p>
</div>
<div class="paragraph">
<p>初期化ルーチン属性に指定できる属性はない【NGKI3202】．そのため初期化ルー
チン属性には，TA_NULLを指定しなければならない【NGKI3203】．</p>
</div>
<div class="paragraph">
<p>C言語による初期化ルーチンの記述形式は次の通り【NGKI3204】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void initialization_routine(intptr_t exinf)
	{
		初期化ルーチン本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，初期化ルーチンの拡張情報が渡される【NGKI3205】．</p>
</div>
<div class="paragraph">
<p>終了処理ルーチンは，カーネルが実行を制御する処理単位で，カーネルの動作
終了の直後に，カーネル非動作状態で実行される【NGKI3206】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルにおいて，終了処理ルーチンは，カーネルドメインに属
する【NGKI3207】．</p>
</div>
<div class="paragraph">
<p>終了処理ルーチン属性に指定できる属性はない【NGKI3208】．そのため終了処
理ルーチン属性には，TA_NULLを指定しなければならない【NGKI3209】．</p>
</div>
<div class="paragraph">
<p>C言語による終了処理ルーチンの記述形式は次の通り【NGKI3210】．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">	void termination_routine(intptr_t exinf)
	{
		終了処理ルーチン本体
	}</code></pre>
</div>
</div>
<div class="paragraph">
<p>exinfには，終了処理ルーチンの拡張情報が渡される【NGKI3211】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>非タスクコンテキスト用スタック領域の設定と，終了処理ルーチンは，
μITRON4.0仕様に規定されていない機能である．</p>
</div>
<div id="API_LMT_DOM" class="listingblock">
<div class="content">
<pre>LMT_DOM		保護ドメインに対する制限の設定〔SP〕【NGKI3441】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	LMT_DOM({ PRI mintpri })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>　＊保護ドメインに対する制限の設定情報
	PRI			mintpri		指定できる最高のタスク優先度</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・ユーザドメインの囲みの中に記述されていない【NGKI3442】
				・クラスの囲みの中に記述されている〔M〕【NGKI3443】
	E_OBJ		オブジェクト状態エラー
				・保護ドメインに対する制限が設定済み【NGKI3444】
	E_PAR		パラメータエラー
				・mintpriが有効範囲外【NGKI3445】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>パラメータで指定した保護ドメインに対する制限の設定情報に従って，ユーザ
ドメインに対する制限を設定する【NGKI3446】．</p>
</div>
<div class="paragraph">
<p>mintpriは整数定数式パラメータである【NGKI3447】．</p>
</div>
<div class="paragraph">
<p>LMT_DOMにより保護ドメインに対する制限を設定しないユーザドメインに対して
は，指定できる最高のタスク優先度はTMIN_TPRI＋1に設定される【NGKI3448】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0/PX仕様に定義されていない静的APIである．</p>
</div>
<div id="API_DEF_ICS" class="listingblock">
<div class="content">
<pre>DEF_ICS		非タスクコンテキスト用スタック領域の設定〔S〕【NGKI3212】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_ICS({ SIZE istksz, STK_T *istk })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>　＊非タスクコンテキスト用スタック領域の設定情報
	SIZE		istksz		非タスクコンテキスト用スタック領域のサイズ
							（バイト数）
	STK_T		istk		非タスクコンテキスト用スタック領域の先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3213】
				・クラスの囲みの中に記述されていない〔M〕【NGKI3214】
	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_NOMEM		メモリ不足
				・非タスクコンテキスト用スタック領域が確保できない【NGKI3215】
	E_OBJ		オブジェクト状態エラー
				・非タスクコンテキスト用スタック領域が設定済み【NGKI3216】
				・その他の条件については機能の項を参照</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した非タスクコンテキスト用スタック領域の設定情報に従っ
て，非タスクコンテキスト用スタック領域を設定する【NGKI3217】．istkszに
0以下の値を指定した時や，ターゲット定義の最小値よりも小さい値を指定した
時には，E_PARエラーとなる【NGKI3254】．</p>
</div>
<div class="paragraph">
<p>istkszは整数定数式パラメータ，istkは一般定数式パラメータである．コンフィ
ギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができ
ない【NGKI3218】．</p>
</div>
<div class="paragraph">
<p>istkをNULLとした場合，istkszで指定したサイズのスタック領域が，コンフィ
ギュレータにより確保される【NGKI3219】．istkszにターゲット定義の制約に
合致しないサイズを指定した時には，ターゲット定義の制約に合致するように
大きい方に丸めたサイズで確保される【NGKI3220】．</p>
</div>
<div class="paragraph">
<p>istkにNULL以外を指定した場合，istkとistkszで指定したスタック領域は，ア
プリケーションで確保しておく必要がある【NGKI3221】．スタック領域をアプ
リケーションで確保する方法については，「2.15.3 カーネル共通マクロ」の節
を参照すること．その方法に従わず，istkやistkszにターゲット定義の制約に
合致しない先頭番地やサイズを指定した時には，E_PARエラーとなる
【NGKI3222】．</p>
</div>
<div class="paragraph">
<p>保護機能対応カーネルでは，istkとistkszで指定した非タスクコンテキスト用
のスタック領域がカーネル専用のメモリオブジェクトに含まれない場合，
E_OBJエラーとなる【NGKI3223】．</p>
</div>
<div class="paragraph">
<p>DEF_ICSにより非タスクコンテキスト用スタック領域を設定しない場合，ターゲッ
ト定義のデフォルトのサイズのスタック領域が，コンフィギュレータにより確
保される【NGKI3224】．</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，非タスクコンテキスト用スタック領域は
プロセッサ毎に確保する必要がある【NGKI3225】．DEF_ICSにより設定する非タ
スクコンテキスト用スタック領域は，DEF_ICSの記述をその囲みの中に含むクラ
スの初期割付けプロセッサが使用する【NGKI3226】．そのプロセッサに対して
すでに非タスクコンテキスト用スタック領域が設定されている場合には，
E_OBJエラーとなる【NGKI3227】．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，istkにはNULLを指定しなくてはならず，その場合でも，コン
フィギュレータは非タスクコンテキスト用のスタック領域を確保しない
【SSPS0149】．これは，SSPカーネルでは，すべての処理単位が共有スタック領
域を使用し，非タスクコンテキストのみが用いるスタック領域を持たないため
である．そのため，DEF_ICSの役割は，非タスクコンテキストが用いるスタック
領域のサイズを指定することのみとなる．itskにNULL以外を指定した場合には，
E_PARエラーとなる【SSPS0150】．</p>
</div>
<div class="paragraph">
<p>共有スタック領域の設定方法については，DEF_STKの項を参照すること．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div id="API_DEF_STK" class="listingblock">
<div class="content">
<pre>DEF_STK		共有スタック領域の設定〔S〕【NGKI3228】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	DEF_STK({ SIZE stksz, STK_T *stk })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>　＊共有スタック領域の設定情報
	SIZE		stksz		共有スタック領域のサイズ（バイト数）
	STK_T		stk			共有スタック領域の先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_PAR		パラメータエラー
				・条件については機能の項を参照
	E_NOMEM		メモリ不足
				・共有スタック領域が確保できない【NGKI3229】
	E_OBJ		オブジェクト状態エラー
				・共有スタック領域が設定済み</pre>
</div>
</div>
<div class="paragraph">
<p>【サポートするカーネル】</p>
</div>
<div class="paragraph">
<p>DEF_STKは，TOPPERS/SSPカーネルのみがサポートする静的APIである．他のカー
ネルは，DEF_STKをサポートしない【NGKI3230】．</p>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した共有スタック領域の設定情報に従って，共有スタック
領域を設定する【NGKI3231】．stkszに0以下の値を指定した時や，ターゲット
定義の最小値よりも小さい値を指定した時には，E_PARエラーとなる【NGKI3255】．</p>
</div>
<div class="paragraph">
<p>stkszは整数定数式パラメータ，stkは一般定数式パラメータである．コンフィ
ギュレータは，静的APIのメモリ不足（E_NOMEM）エラーを検出することができ
ない【NGKI3232】．</p>
</div>
<div class="paragraph">
<p>stkをNULLとした場合，stkszで指定したサイズのスタック領域が，コンフィギュ
レータにより確保される【NGKI3233】．stkszにターゲット定義の制約に合致し
ないサイズを指定した時には，ターゲット定義の制約に合致するように大きい
方に丸めたサイズで確保される【NGKI3234】．</p>
</div>
<div class="paragraph">
<p>stkにNULL以外を指定した場合，stkとstkszで指定したスタック領域は，アプリ
ケーションで確保しておく必要がある【NGKI3235】．スタック領域をアプリケー
ションで確保する方法については，「2.15.3 カーネル共通マクロ」の節を参照
すること．その方法に従わず，stkやstkszにターゲット定義の制約に合致しな
い先頭番地やサイズを指定した時には，E_PARエラーとなる【NGKI3236】．</p>
</div>
<div class="paragraph">
<p>コンフィギュレータは，各タスクのスタック領域のサイズと，非タスクコンテ
キスト用のスタック領域のサイズから，共有スタック領域に必要なサイズを計
算する【NGKI3237】．DEF_STKにより共有スタック領域を設定しない場合，必要
なサイズの共有スタック領域が，コンフィギュレータにより確保される
【NGKI3238】．</p>
</div>
<div class="paragraph">
<p>stkszに指定したスタック領域のサイズが，共有スタック領域に必要なサイズよ
りも小さい場合，コンフィギュレータは警告メッセージを出力する【NGKI3239】．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div id="API_ATT_INI" class="listingblock">
<div class="content">
<pre>ATT_INI		初期化ルーチンの追加〔S〕【NGKI3240】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ATT_INI({ ATR iniatr, intptr_t exinf, INIRTN inirtn })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>　＊初期化ルーチンの追加情報
	ATR			iniatr		初期化ルーチン属性
	intptr_t	exinf		初期化ルーチンの拡張情報
	INIRTN		inirtn		初期化ルーチンの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・iniatrが無効【NGKI3241】
				・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3242】
	E_PAR		パラメータエラー
				・inirtnがプログラムの先頭番地として正しくない【NGKI3243】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した初期化ルーチン追加情報に従って，初期化ルーチンを
追加する【NGKI3244】．</p>
</div>
<div class="paragraph">
<p>iniatrは整数定数式パラメータ，exinfとinirtnは一般定数式パラメータである
【NGKI3245】．</p>
</div>
<div class="paragraph">
<p>inirtnが不正である場合にE_PARエラーが検出されるか否かは，ターゲット定義
である【NGKI3246】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，クラスに属さないグローバル初期化ルー
チンはマスタプロセッサで実行され，クラスに属するローカル初期化ルーチン
はそのクラスの初期割付けプロセッサにより実行される．</p>
</div>
<div id="API_ATT_TER" class="listingblock">
<div class="content">
<pre>ATT_TER		終了処理ルーチンの追加〔S〕【NGKI3247】</pre>
</div>
</div>
<div class="paragraph">
<p>【静的API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ATT_TER({ ATR teratr, intptr_t exinf, TERRTN terrtn })</pre>
</div>
</div>
<div class="paragraph">
<p>【パラメータ】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>　＊終了処理ルーチンの追加情報
	ATR			teratr		終了処理ルーチン属性
	intptr_t	exinf		終了処理ルーチンの拡張情報
	TERRTN		terrtn		終了処理ルーチンの先頭番地</pre>
</div>
</div>
<div class="paragraph">
<p>【エラーコード】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	E_RSATR		予約属性
				・teratrが無効【NGKI3248】
				・カーネルドメインの囲みの中に記述されていない〔P〕【NGKI3249】
	E_PAR		パラメータエラー
				・terrtnがプログラムの先頭番地として正しくない【NGKI3250】</pre>
</div>
</div>
<div class="paragraph">
<p>【機能】</p>
</div>
<div class="paragraph">
<p>各パラメータで指定した終了処理ルーチン追加情報に従って，終了処理ルーチ
ンを追加する【NGKI3251】．</p>
</div>
<div class="paragraph">
<p>teratrは整数定数式パラメータ，exinfとterrtnは一般定数式パラメータである
【NGKI3252】．</p>
</div>
<div class="paragraph">
<p>terrtnが不正である場合にE_PARエラーが検出されるか否かは，ターゲット定義
である【NGKI3253】．</p>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>マルチプロセッサ対応カーネルでは，クラスに属さないグローバル終了処理ルー
チンはマスタプロセッサで実行され，クラスに属するローカル終了処理ルーチ
ンはそのクラスの初期割付けプロセッサにより実行される．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>μITRON4.0仕様に定義されていない静的APIである．</p>
</div>
<div id="API_ref_cfg" class="listingblock">
<div class="content">
<pre>ref_cfg		コンフィギュレーション情報の参照〔T〕</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_cfg(T_RCFG *pk_rcfg)</pre>
</div>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ref_cfgをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ref_cfgをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ref_cfgをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ref_cfgをサポートしない．</p>
</div>
<div id="API_ref_ver" class="listingblock">
<div class="content">
<pre>ref_ver		バージョン情報の参照〔T〕</pre>
</div>
</div>
<div class="paragraph">
<p>【C言語API】</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ER ercd = ref_ver(T_RVER *pk_rver)</pre>
</div>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>【TOPPERS/ASPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>ASPカーネルでは，ref_verをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/FMPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>FMPカーネルでは，ref_verをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/HRP2カーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>HRP2カーネルでは，ref_verをサポートしない．</p>
</div>
<div class="paragraph">
<p>【TOPPERS/SSPカーネルにおける規定】</p>
</div>
<div class="paragraph">
<p>SSPカーネルでは，ref_verをサポートしない．</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_リファレンス">5. リファレンス</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_サービスコール一覧">5.1. サービスコール一覧</h3>
<div class="paragraph">
<p>(1) タスク管理機能</p>
</div>
<div class="paragraph">
<p>ER_ID tskid = <a href="#API_CRE_TSK">acre_tsk</a>(const T_CTSK *pk_ctsk)					〔TD〕<br>
ER ercd = <a href="#API_SAC_TSK">sac_tsk</a>(ID tskid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_tsk">del_tsk</a>(ID tskid)										〔TD〕<br>
ER ercd = <a href="#API_act_tsk">act_tsk</a>(ID tskid)										〔T〕<br>
ER ercd = <a href="#API_act_tsk">iact_tsk</a>(ID tskid)									〔I〕<br>
ER ercd = <a href="#API_mact_tsk">mact_tsk</a>(ID tskid, ID prcid)							〔TM〕<br>
ER ercd = <a href="#API_mact_tsk">imact_tsk</a>(ID tskid, ID prcid)						〔IM〕<br>
ER_UINT	actcnt = <a href="#API_can_act">can_act</a>(ID tskid)								〔T〕<br>
ER ercd = <a href="#API_mig_tsk">mig_tsk</a>(ID tskid, ID prcid)							〔TM〕<br>
ER ercd = <a href="#API_ext_tsk">ext_tsk</a>()												〔T〕<br>
ER ercd = <a href="#API_ter_tsk">ter_tsk</a>(ID tskid)										〔T〕<br>
ER ercd = <a href="#API_chg_pri">chg_pri</a>(ID tskid, PRI tskpri)							〔T〕<br>
ER ercd = <a href="#API_get_pri">get_pri</a>(ID tskid, PRI *p_tskpri)						〔T〕<br>
ER ercd = <a href="#API_get_inf">get_inf</a>(intptr_t *p_exinf)							〔T〕<br>
ER ercd = <a href="#API_ref_tsk">ref_tsk</a>(ID tskid, T_RTSK *pk_rtsk)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>(2) タスク付属同期機能</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_slp_tsk">slp_tsk</a>()												〔T〕<br>
ER ercd = <a href="#API_slp_tsk">tslp_tsk</a>(TMO tmout)									〔T〕<br>
ER ercd = <a href="#API_wup_tsk">wup_tsk</a>(ID tskid)										〔T〕<br>
ER ercd = <a href="#API_iwup_tsk">iwup_tsk</a>(ID tskid)									〔I〕<br>
ER_UINT wupcnt = <a href="#API_can_wup">can_wup</a>(ID tskid)								〔T〕<br>
ER ercd = <a href="#API_rel_wai">rel_wai</a>(ID tskid)										〔T〕<br>
ER ercd = <a href="#API_irel_wai">irel_wai</a>(ID tskid)									〔I〕<br>
ER ercd = <a href="#API_sus_tsk">sus_tsk</a>(ID tskid)										〔T〕<br>
ER ercd = <a href="#API_rsm_tsk">rsm_tsk</a>(ID tskid)										〔T〕<br>
ER ercd = <a href="#API_dis_wai">dis_wai</a>(ID tskid)										〔TP〕<br>
ER ercd = <a href="#API_dis_wai">idis_wai</a>(ID tskid)									〔IP〕<br>
ER ercd = <a href="#API_ena_wai">ena_wai</a>(ID tskid)										〔TP〕<br>
ER ercd = <a href="#API_ena_wai">iena_wai</a>(ID tskid)									〔IP〕<br>
ER ercd = <a href="#API_dly_tsk">dly_tsk</a>(RELTIM dlytim)								〔T〕<br></p>
</div>
<div class="paragraph">
<p>(3) タスク例外処理機能</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_def_tex">def_tex</a>(ID tskid, const T_DTEX *pk_dtex)				〔TD〕<br>
ER ercd = <a href="#API_ras_tex">ras_tex</a>(ID tskid, TEXPTN rasptn)						〔T〕<br>
ER ercd = <a href="#API_ras_tex">iras_tex</a>(ID tskid, TEXPTN rasptn)						〔I〕<br>
ER ercd = <a href="#API_dis_tex">dis_tex</a>()												〔T〕<br>
ER ercd = <a href="#API_ena_tex">ena_tex</a>()												〔T〕<br>
bool_t state = <a href="#API_sns_tex">sns_tex</a>()										〔TI〕<br>
ER ercd = <a href="#API_ref_tex">ref_tex</a>(ID tskid, T_RTEX *pk_rtex)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>(4) 同期・通信機能</p>
</div>
<div class="paragraph">
<p>セマフォ</p>
</div>
<div class="paragraph">
<p>ER_ID semid = <a href="#API_CRE_SEM">acre_sem</a>(const T_CSEM *pk_csem)					〔TD〕<br>
ER ercd = <a href="#API_SAC_SEM">sac_sem</a>(ID semid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_sem">del_sem</a>(ID semid)										〔TD〕<br>
ER ercd = <a href="#API_sig_sem">sig_sem</a>(ID semid)										〔T〕<br>
ER ercd = <a href="#API_sig_sem">isig_sem</a>(ID semid)									〔I〕<br>
ER ercd = <a href="#API_wai_sem">wai_sem</a>(ID semid)										〔T〕<br>
ER ercd = <a href="#API_pol_sem">pol_sem</a>(ID semid)										〔T〕<br>
ER ercd = <a href="#API_wai_sem">twai_sem</a>(ID semid, TMO tmout)							〔T〕<br>
ER ercd = <a href="#API_ini_sem">ini_sem</a>(ID semid)										〔T〕<br>
ER ercd = <a href="#API_ref_sem">ref_sem</a>(ID semid, T_RSEM *pk_rsem)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>イベントフラグ</p>
</div>
<div class="paragraph">
<p>ER_ID flgid = <a href="#API_CRE_FLG">acre_flg</a>(const T_CFLG *pk_cflg)					〔TD〕<br>
ER ercd = <a href="#API_SAC_FLG">sac_flg</a>(ID flgid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_flg">del_flg</a>(ID flgid)										〔TD〕<br>
ER ercd = <a href="#API_set_flg">set_flg</a>(ID flgid, FLGPTN setptn)						〔T〕<br>
ER ercd = <a href="#API_set_flg">iset_flg</a>(ID flgid, FLGPTN setptn)						〔I〕<br>
ER ercd = <a href="#API_clr_flg">clr_flg</a>(ID flgid, FLGPTN clrptn)						〔T〕<br>
ER ercd = <a href="#API_wai_flg">wai_flg</a>(ID flgid, FLGPTN waiptn, MODE wfmode, FLGPTN *p_flgptn)						〔T〕<br>
ER ercd = <a href="#API_pol_flg">pol_flg</a>(ID flgid, FLGPTN waiptn, MODE wfmode, FLGPTN *p_flgptn)						〔T〕<br>
ER ercd = <a href="#API_wai_flg">twai_flg</a>(ID flgid, FLGPTN waiptn,	 MODE wfmode, FLGPTN *p_flgptn, TMO tmout)			〔T〕<br>
ER ercd = <a href="#API_ini_flg">ini_flg</a>(ID flgid)										〔T〕<br>
ER ercd = <a href="#API_ref_flg">ref_flg</a>(ID flgid, T_RFLG *pk_rflg)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>データキュー</p>
</div>
<div class="paragraph">
<p>ER_ID dtqid = <a href="#API_CRE_DTQ">acre_dtq</a>(const T_CDTQ *pk_cdtq)					〔TD〕<br>
ER ercd = <a href="#API_SAC_DTQ">sac_dtq</a>(ID dtqid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_dtq">del_dtq</a>(ID dtqid)										〔TD〕<br>
ER ercd = <a href="#API_snd_dtq">snd_dtq</a>(ID dtqid, intptr_t data)						〔T〕<br>
ER ercd = <a href="#API_snd_dtq">psnd_dtq</a>(ID dtqid, intptr_t data)						〔T〕<br>
ER ercd = <a href="#API_snd_dtq">ipsnd_dtq</a>(ID dtqid, intptr_t data)					〔I〕<br>
ER ercd = <a href="#API_snd_dtq">tsnd_dtq</a>(ID dtqid, intptr_t data, TMO tmout)			〔T〕<br>
ER ercd = <a href="#API_snd_dtq">fsnd_dtq</a>(ID dtqid, intptr_t data)						〔T〕<br>
ER ercd = <a href="#API_snd_dtq">ifsnd_dtq</a>(ID dtqid, intptr_t data)					〔I〕<br>
ER ercd = <a href="#API_rcv_dtq">rcv_dtq</a>(ID dtqid, intptr_t *p_data)					〔T〕<br>
ER ercd = <a href="#API_rcv_dtq">prcv_dtq</a>(ID dtqid, intptr_t *p_data)					〔T〕<br>
ER ercd = <a href="#API_rcv_dtq">trcv_dtq</a>(ID dtqid, intptr_t *p_data, TMO tmout)		〔T〕<br>
ER ercd = <a href="#API_ini_dtq">ini_dtq</a>(ID dtqid)										〔T〕<br>
ER ercd = <a href="#API_ref_dtq">ref_dtq</a>(ID dtqid, T_RDTQ *pk_rdtq)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>優先度データキュー</p>
</div>
<div class="paragraph">
<p>ER_ID pdqid = <a href="#API_CRE_PDQ">acre_pdq</a>(const T_CPDQ *pk_cpdq)					〔TD〕<br>
ER ercd = <a href="#API_SAC_PDQ">sac_pdq</a>(ID pdqid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_pdq">del_pdq</a>(ID pdqid)										〔TD〕<br>
ER ercd = <a href="#API_snd_pdq">snd_pdq</a>(ID pdqid, intptr_t data, PRI datapri)			〔T〕<br>
ER ercd = <a href="#API_snd_pdq">psnd_pdq</a>(ID pdqid, intptr_t data, PRI datapri)		〔T〕<br>
ER ercd = <a href="#API_snd_pdq">ipsnd_pdq</a>(ID pdqid, intptr_t data, PRI datapri)		〔I〕<br>
ER ercd = <a href="#API_snd_pdq">tsnd_pdq</a>(ID pdqid, intptr_t data,	 PRI datapri, TMO tmout)					〔T〕<br>
ER ercd = <a href="#API_rcv_pdq">rcv_pdq</a>(ID pdqid, intptr_t *p_data, PRI *p_datapri)	〔T〕<br>
ER ercd = <a href="#API_rcv_pdq">prcv_pdq</a>(ID pdqid, intptr_t *p_data, PRI *p_datapri)	〔T〕<br>
ER ercd = <a href="#API_rcv_pdq">trcv_pdq</a>(ID pdqid, intptr_t *p_data,	PRI *p_datapri, TMO tmout)				〔T〕<br>
ER ercd = <a href="#API_ini_pdq">ini_pdq</a>(ID pdqid)										〔T〕<br>
ER ercd = <a href="#API_ref_pdq">ref_pdq</a>(ID pdqid, T_RPDQ *pk_rpdq)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>メールボックス</p>
</div>
<div class="paragraph">
<p>ER_ID mbxid = <a href="#API_CRE_MBX">acre_mbx</a>(const T_CMBX *pk_cmbx)					〔TDp〕<br>
ER ercd = <a href="#API_del_mbx">del_mbx</a>(ID mbxid)										〔TDp〕<br>
ER ercd = <a href="#API_snd_mbx">snd_mbx</a>(ID mbxid, T_MSG *pk_msg)						〔Tp〕<br>
ER ercd = <a href="#API_rcv_mbx">rcv_mbx</a>(ID mbxid, T_MSG **ppk_msg)					〔Tp〕<br>
ER ercd = <a href="#API_rcv_mbx">prcv_mbx</a>(ID mbxid, T_MSG **ppk_msg)					〔Tp〕<br>
ER ercd = <a href="#API_rcv_mbx">trcv_mbx</a>(ID mbxid, T_MSG **ppk_msg, TMO tmout)		〔Tp〕<br>
ER ercd = <a href="#API_ini_mbx">ini_mbx</a>(ID mbxid)										〔Tp〕<br>
ER ercd = <a href="#API_ref_mbx">ref_mbx</a>(ID mbxid, T_RMBX *pk_rmbx)					〔Tp〕<br></p>
</div>
<div class="paragraph">
<p>ミューテックス</p>
</div>
<div class="paragraph">
<p>ER_ID mtxid = <a href="#API_CRE_MTX">acre_mtx</a>(const T_CMTX *pk_cmtx)					〔TD〕<br>
ER ercd = <a href="#API_SAC_MTX">sac_mtx</a>(ID mtxid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_mtx">del_mtx</a>(ID mtxid)										〔TD〕<br>
ER ercd = <a href="#API_loc_mtx">loc_mtx</a>(ID mtxid)										〔T〕<br>
ER ercd = <a href="#API_loc_mtx">ploc_mtx</a>(ID mtxid)									〔T〕<br>
ER ercd = <a href="#API_loc_mtx">tloc_mtx</a>(ID mtxid, TMO tmout)							〔T〕<br>
ER ercd = <a href="#API_unl_mtx">unl_mtx</a>(ID mtxid)										〔T〕<br>
ER ercd = <a href="#API_ini_mtx">ini_mtx</a>(ID mtxid)										〔T〕<br>
ER ercd = <a href="#API_ref_mtx">ref_mtx</a>(ID mtxid, T_RMTX *pk_rmtx)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>メッセージバッファ</p>
</div>
<div class="paragraph">
<p>ER_ID mbfid = <a href="#API_CRE_MBF">acre_mbf</a>(const T_CMBF *pk_cmbf)					〔TD〕<br>
ER ercd = <a href="#API_SAC_MBF">sac_mbf</a>(ID mbfid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_mbf">del_mbf</a>(ID mbfid)										〔TD〕<br>
ER ercd = <a href="#API_snd_mbf">snd_mbf</a>(ID mbfid, const void *msg, uint_t msgsz)		〔T〕<br>
ER ercd = <a href="#API_snd_mbf">psnd_mbf</a>(ID mbfid, const void *msg, uint_t msgsz)		〔T〕<br>
ER ercd = <a href="#API_snd_mbf">tsnd_mbf</a>(ID mbfid, const void *msg, uint_t msgsz, TMO tmout)					〔T〕<br>
ER_UINT msgsz = <a href="#API_rcv_mbf">rcv_mbf</a>(ID mbfid, void *msg)					〔T〕<br>
ER_UINT msgsz = <a href="#API_rcv_mbf">prcv_mbf</a>(ID mbfid, void *msg)					〔T〕<br>
ER_UINT msgsz = <a href="#API_rcv_mbf">trcv_mbf</a>(ID mbfid, void *msg, TMO tmout)		〔T〕<br>
ER ercd = <a href="#API_ini_mbf">ini_mbf</a>(ID mbfid)										〔T〕<br>
ER ercd = <a href="#API_ref_mbf">ref_mbf</a>(ID mbfid, T_RMBF *pk_rmbf)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>スピンロック</p>
</div>
<div class="paragraph">
<p>ER_ID spnid = <a href="#API_CRE_SPN">acre_spn</a>(const T_CSPN *pk_cspn)					〔TMD〕<br>
ER ercd = <a href="#API_SAC_SPN">sac_spn</a>(ID spnid, const ACVCT *p_acvct)				〔TPMD〕<br>
ER ercd = <a href="#API_del_spn">del_spn</a>(ID spnid)										〔TMD〕<br>
ER ercd = <a href="#API_loc_spn">loc_spn</a>(ID spnid)										〔TM〕<br>
ER ercd = <a href="#API_loc_spn">iloc_spn</a>(ID spnid)									〔IM〕<br>
ER ercd = <a href="#API_try_spn">try_spn</a>(ID spnid)										〔TM〕<br>
ER ercd = <a href="#API_try_spn">itry_spn</a>(ID spnid)									〔IM〕<br>
ER ercd = <a href="#API_unl_spn">unl_spn</a>(ID spnid)										〔TM〕<br>
ER ercd = <a href="#API_unl_spn">iunl_spn</a>(ID spnid)									〔IM〕<br>
ER ercd = <a href="#API_ref_spn">ref_spn</a>(ID spnid, T_RSPN *pk_rspn)					〔TM〕<br></p>
</div>
<div class="paragraph">
<p>(5) メモリプール管理機能</p>
</div>
<div class="paragraph">
<p>固定長メモリプール</p>
</div>
<div class="paragraph">
<p>ER_ID mpfid = <a href="#API_CRE_MPF">acre_mpf</a>(const T_CMPF *pk_cmpf)					〔TD〕<br>
ER ercd = <a href="#API_SAC_MPF">sac_mpf</a>(ID mpfid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_mpf">del_mpf</a>(ID mpfid)										〔TD〕<br>
ER ercd = <a href="#API_get_mpf">get_mpf</a>(ID mpfid, void <strong>p_blk)						〔T〕<br>
ER ercd = <a href="#API_get_mpf">pget_mpf</a>(ID mpfid, void </strong>p_blk)						〔T〕<br>
ER ercd = <a href="#API_get_mpf">tget_mpf</a>(ID mpfid, void **p_blk, TMO tmout)			〔T〕<br>
ER ercd = <a href="#API_rel_mpf">rel_mpf</a>(ID mpfid, void *blk)							〔T〕<br>
ER ercd = <a href="#API_ini_mpf">ini_mpf</a>(ID mpfid)										〔T〕<br>
ER ercd = <a href="#API_ref_mpf">ref_mpf</a>(ID mpfid, T_RMPF *pk_rmpf)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>(6) 時間管理機能</p>
</div>
<div class="paragraph">
<p>システム時刻管理</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_get_tim">get_tim</a>(SYSTIM *p_systim)								〔T〕<br>
ER ercd = <a href="#API_get_utm">get_utm</a>(SYSUTM *p_sysutm)								〔TI〕<br></p>
</div>
<div class="paragraph">
<p>周期ハンドラ</p>
</div>
<div class="paragraph">
<p>ER_ID cycid = <a href="#API_CRE_CYC">acre_cyc</a>(const T_CCYC *pk_ccyc)					〔TD〕<br>
ER ercd = <a href="#API_SAC_CYC">sac_cyc</a>(ID cycid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_cyc">del_cyc</a>(ID cycid)										〔TD〕<br>
ER ercd = <a href="#API_sta_cyc">sta_cyc</a>(ID cycid)										〔T〕<br>
ER ercd = <a href="#API_sta_cyc">msta_cyc</a>(ID cycid, ID prcid)							〔TM〕<br>
ER ercd = <a href="#API_stp_cyc">stp_cyc</a>(ID cycid)										〔T〕<br>
ER ercd = <a href="#API_ref_cyc">ref_cyc</a>(ID cycid, T_RCYC *pk_rcyc)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>アラームハンドラ</p>
</div>
<div class="paragraph">
<p>ER_ID almid = <a href="#API_CRE_ALM">acre_alm</a>(const T_CALM *pk_calm)					〔TD〕<br>
ER ercd = <a href="#API_SAC_ALM">sac_alm</a>(ID almid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_alm">del_alm</a>(ID almid)										〔TD〕<br>
ER ercd = <a href="#API_sta_alm">sta_alm</a>(ID almid, RELTIM almtim)						〔T〕<br>
ER ercd = <a href="#API_sta_alm">ista_alm</a>(ID almid, RELTIM almtim)						〔I〕<br>
ER ercd = <a href="#API_sta_alm">msta_alm</a>(ID almid, RELTIM almtim, ID prcid)			〔TM〕<br>
ER ercd = <a href="#API_sta_alm">imsta_alm</a>(ID almid, RELTIM almtim, ID prcid)			〔IM〕<br>
ER ercd = <a href="#API_stp_alm">stp_alm</a>(ID almid)										〔T〕<br>
ER ercd = <a href="#API_stp_alm">istp_alm</a>(ID almid)									〔I〕<br>
ER ercd = <a href="#API_ref_alm">ref_alm</a>(ID almid, T_RALM *pk_ralm)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>オーバランハンドラ</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_def_ovr">def_ovr,</a>(const T_DOVR *pk_dovr)						〔TD〕<br>
ER ercd = <a href="#API_sta_ovr">sta_ovr</a>(ID tskid, OVRTIM ovrtim)						〔T〕<br>
ER ercd = <a href="#API_sta_ovr">ista_ovr</a>(ID tskid, OVRTIM ovrtim)						〔I〕<br>
ER ercd = <a href="#API_stp_ovr">stp_ovr</a>(ID tskid)										〔T〕<br>
ER ercd = <a href="#API_stp_ovr">istp_ovr</a>(ID tskid)									〔I〕<br>
ER ercd = <a href="#API_ref_ovr">ref_ovr</a>(ID tskid, T_ROVR *pk_rovr)					〔T〕<br></p>
</div>
<div class="paragraph">
<p>(7) システム状態管理機能</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_sac_sys">sac_sys</a>(const ACVCT *p_acvct)							〔TPD〕<br>
ER ercd = <a href="#API_rot_rdq">rot_rdq</a>(PRI tskpri)									〔T〕<br>
ER ercd = <a href="#API_rot_rdq">irot_rdq</a>(PRI tskpri)									〔I〕<br>
ER ercd = <a href="#API_rot_rdq">mrot_rdq</a>(PRI tskpri, ID prcid)						〔TM〕<br>
ER ercd = <a href="#API_rot_rdq">imrot_rdq</a>(PRI tskpri, ID prcid)						〔IM〕<br>
ER ercd = <a href="#API_get_tid">get_tid</a>(ID *p_tskid)									〔T〕<br>
ER ercd = <a href="#API_get_tid">iget_tid</a>(ID *p_tskid)									〔I〕<br>
ER ercd = <a href="#API_get_did">get_did</a>(ID *p_domid)									〔TP〕<br>
ER ercd = <a href="#API_get_pid">get_pid</a>(ID *p_prcid)									〔TM〕<br>
ER ercd = <a href="#API_get_pid">iget_pid</a>(ID *p_prcid)									〔IM〕<br>
ER ercd = <a href="#API_loc_cpu">loc_cpu</a>()												〔T〕<br>
ER ercd = <a href="#API_loc_cpu">iloc_cpu</a>()											〔I〕<br>
ER ercd = <a href="#API_unl_cpu">unl_cpu</a>()												〔T〕<br>
ER ercd = <a href="#API_unl_cpu">iunl_cpu</a>()											〔I〕<br>
ER ercd = <a href="#API_dis_dsp">dis_dsp</a>()												〔T〕<br>
ER ercd = <a href="#API_ena_dsp">ena_dsp</a>()												〔T〕<br>
bool_t state = <a href="#API_sns_ctx">sns_ctx</a>()										〔TI〕<br>
bool_t state = <a href="#API_sns_loc">sns_loc</a>()										〔TI〕<br>
bool_t state = <a href="#API_sns_dsp">sns_dsp</a>()										〔TI〕<br>
bool_t state = <a href="#API_sns_dpn">sns_dpn</a>()										〔TI〕<br>
bool_t state = <a href="#API_sns_ker">sns_ker</a>()										〔TI〕<br>
ER ercd = <a href="#API_ext_ker">ext_ker</a>()												〔TI〕<br>
ER ercd = <a href="#API_ref_sys">ref_sys</a>(T_RSYS *pk_rsys)								〔T〕<br></p>
</div>
<div class="paragraph">
<p>(8) メモリオブジェクト管理機能</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_att_mem">att_mem</a>(const T_AMEM *pk_amem)						〔TPD〕<br>
ER ercd = <a href="#API_att_pma">att_pma</a>(const T_AMEM *pk_apma)						〔TPD〕<br>
ER ercd = <a href="#API_sac_mem">sac_mem</a>(const void *base, const ACVCT *p_acvct)		〔TPD〕<br>
ER ercd = <a href="#API_det_mem">det_mem</a>(const void *base)								〔TPD〕<br>
ER ercd = <a href="#API_prb_mem">prb_mem</a>(const void *base, SIZE size,	ID tskid, MODE pmmode)				〔TP〕<br>
ER ercd = <a href="#API_ref_mem">ref_mem</a>(const void *base, T_RMEM *pk_rmem)			〔TP〕<br></p>
</div>
<div class="paragraph">
<p>(9) 割込み管理機能</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_cfg_int">cfg_int</a>(INTNO intno, const T_CINT *pk_cint)			〔TD〕<br>
ER_ID isrid = <a href="#API_CRE_ISR">acre_isr</a>(const T_CISR *pk_cisr)					〔TD〕<br>
ER ercd = <a href="#API_SAC_ISR">sac_isr</a>(ID isrid, const ACVCT *p_acvct)				〔TPD〕<br>
ER ercd = <a href="#API_del_isr">del_isr</a>(ID isrid)										〔TD〕<br>
ER ercd = <a href="#API_ref_isr">ref_isr</a>(ID isrid, T_RISR *pk_risr)					〔T〕<br>
ER ercd = <a href="#API_DEF_INH">def_inh</a>(INHNO inhno, const T_DINH *pk_dinh)			〔TD〕<br>
ER ercd = <a href="#API_dis_int">dis_int</a>(INTNO intno)									〔T〕<br>
ER ercd = <a href="#API_ena_int">ena_int</a>(INTNO intno)									〔T〕<br>
ER ercd = <a href="#API_ref_int">ref_int</a>(INTNO intno, T_RINT *pk_rint)					〔T〕<br>
ER ercd = <a href="#API_chg_ipm">chg_ipm</a>(PRI intpri)									〔T〕<br>
ER ercd = <a href="#API_get_ipm">get_ipm</a>(PRI *p_intpri)								〔T〕<br></p>
</div>
<div class="paragraph">
<p>(10) CPU例外管理機能</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_def_exc">def_exc</a>(EXCNO excno, const T_DEXC *pk_dexc)			〔TD〕<br>
bool_t stat = <a href="#API_xsns_dpn">xsns_dpn</a>(void *p_excinf)							〔TI〕<br>
bool_t stat = <a href="#API_xsns_xpn">xsns_xpn</a>(void *p_excinf)							〔TI〕<br></p>
</div>
<div class="paragraph">
<p>(11) 拡張サービスコール管理機能</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_DEF_SVC">def_svc</a>(FN fncd, const T_DSVC *pk_dsvc)				〔TPD〕<br>
ER_UINT ercd = <a href="#API_CAL_SVC">cal_svc</a>(FN fncd, intptr_t par1, intptr_t par2,intptr_t par3, intptr_t par4, intptr_t par5)	〔TIP〕</p>
</div>
<div class="paragraph">
<p>(12) システム構成管理機能</p>
</div>
<div class="paragraph">
<p>ER ercd = <a href="#API_ref_cfg">ref_cfg</a>(T_RCFG *pk_rcfg)								〔T〕<br>
ER ercd = <a href="#API_ref_ver">ref_ver</a>(T_RVER *pk_rver)								〔T〕<br></p>
</div>
</div>
<div class="sect2">
<h3 id="_静的api一覧">5.2. 静的API一覧</h3>
<div class="paragraph">
<p>(1) タスク管理機能</p>
</div>
<div class="paragraph">
<p>＊保護機能対応でないカーネルの場合</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_TSK">CRE_TSK</a>(ID tskid, { ATR tskatr, intptr_t exinf, TASK task, PRI itskpri, SIZE stksz, STK_T *stk })		〔S〕</p>
</div>
<div class="paragraph">
<p>＊保護機能対応カーネルの場合</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_TSK">CRE_TSK</a>(ID tskid, { ATR tskatr, intptr_t exinf, TASK task, PRI itskpri, SIZE stksz, STK_T *stk,	SIZE sstksz, STK_T *sstk })	〔SP〕
	※ sstkszおよびsstkの記述は省略することができる．</p>
</div>
<div class="paragraph">
<p><a href="#API_AID_TSK">AID_TSK</a>(uint_t notsk)											〔SD〕<br>
<a href="#API_SAC_TSK">SAC_TSK</a>(ID tskid, { ACPTN acptn1, ACPTN acptn2,	ACPTN acptn3, ACPTN acptn4 })				〔SP〕<br>
<a href="#API_DEF_EPR">DEF_EPR</a>(ID tskid, { PRI exepri })								〔S〕</p>
</div>
<div class="paragraph">
<p>(2) タスク付属同期機能</p>
</div>
<div class="paragraph">
<p>なし</p>
</div>
<div class="paragraph">
<p>(3) タスク例外処理機能</p>
</div>
<div class="paragraph">
<p><a href="#API_def_tex">DEF_TEX</a>(ID tskid, { ATR texatr, TEXRTN texrtn })				〔S〕</p>
</div>
<div class="paragraph">
<p>(4) 同期・通信機能</p>
</div>
<div class="paragraph">
<p>セマフォ</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_SEM">CRE_SEM</a>(ID semid, { ATR sematr, uint_t isemcnt, uint_t maxsem })〔S〕<br>
<a href="#API_AID_SEM">AID_SEM</a>(uint_t nosem)											〔SD〕<br>
<a href="#API_SAC_SEM">SAC_SEM</a>(ID semid, { ACPTN acptn1, ACPTN acptn2,	ACPTN acptn3, ACPTN acptn4 })				〔SP〕</p>
</div>
<div class="paragraph">
<p>イベントフラグ</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_FLG">CRE_FLG</a>(ID flgid, { ATR flgatr, FLGPTN iflgptn })				〔S〕<br>
<a href="#API_AID_FLG">AID_FLG</a>(uint_t noflg)											〔SD〕<br>
<a href="#API_SAC_FLG">SAC_FLG</a>(ID flgid, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })					〔SP〕</p>
</div>
<div class="paragraph">
<p>データキュー</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_DTQ">CRE_DTQ</a>(ID dtqid, { ATR dtqatr, uint_t dtqcnt, void *dtqmb })	〔S〕<br>
<a href="#API_AID_DTQ">AID_DTQ</a>(uint_t nodtq)											〔SD〕<br>
<a href="#API_SAC_DTQ">SAC_DTQ</a>(ID dtqid, { ACPTN acptn1, ACPTN acptn2,	ACPTN acptn3, ACPTN acptn4 })				〔SP〕</p>
</div>
<div class="paragraph">
<p>優先度データキュー</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_PDQ">CRE_PDQ</a>(ID pdqid, { ATR pdqatr, uint_t pdqcnt, PRI maxdpri, void *pdqmb })					〔S〕<br>
<a href="#API_AID_PDQ">AID_PDQ</a>(uint_t nopdq)											〔SD〕<br>
<a href="#API_SAC_PDQ">SAC_PDQ</a>(ID pdqid, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })					〔SP〕</p>
</div>
<div class="paragraph">
<p>メールボックス</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_MBX">CRE_MBX</a>(ID mbxid, { ATR mbxatr, PRI maxmpri, void *mprihd })	〔Sp〕<br>
<a href="#API_AID_MBX">AID_MBX</a>(uint_t nombx)											〔SpD〕</p>
</div>
<div class="paragraph">
<p>ミューテックス</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_MTX">CRE_MTX</a>(ID mtxid, { ATR mtxatr, PRI ceilpri })					〔S〕<br>
<a href="#API_AID_MTX">AID_MTX</a>(uint_t nomtx)											〔SD〕<br>
<a href="#API_SAC_MTX">SAC_MTX</a>(ID mtxid, { ACPTN acptn1, ACPTN acptn2,	ACPTN acptn3, ACPTN acptn4 })				〔SP〕</p>
</div>
<div class="paragraph">
<p>メッセージバッファ</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_MBF">CRE_MBF</a>(ID mbfid, { ATR mbfatr, uint_t maxmsz, SIZE mbfsz, void *mbfmb })		〔S〕<br>
<a href="#API_AID_MBF">AID_MBF</a>(uint_t nombf)											〔SD〕<br>
<a href="#API_SAC_MBF">SAC_MBF</a>(ID mbfid, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })					〔SP〕</p>
</div>
<div class="paragraph">
<p>スピンロック</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_SPN">CRE_SPN</a>(ID spnid, { ATR spnatr })								〔SM〕<br>
<a href="#API_AID_SPN">AID_SPN</a>(uint_t nospn)											〔SMD〕<br>
<a href="#API_SAC_SPN">SAC_SPN</a>(ID spnid, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })					〔SPM〕</p>
</div>
<div class="paragraph">
<p>(5) メモリプール管理機能</p>
</div>
<div class="paragraph">
<p>固定長メモリプール</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_MPF">CRE_MPF</a>(ID mpfid, { ATR mpfatr, uint_t blkcnt, uint_t blksz, MPF_T *mpf, void *mpfmb })	〔S〕<br>
<a href="#API_AID_MPF">AID_MPF</a>(uint_t nompf)											〔SD〕<br>
<a href="#API_SAC_MPF">SAC_MPF</a>(ID mpfid, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })					〔SP〕</p>
</div>
<div class="paragraph">
<p>(6) 時間管理機能</p>
</div>
<div class="paragraph">
<p>周期ハンドラ</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_CYC">CRE_CYC</a>(ID cycid, { ATR cycatr, intptr_t exinf, CYCHDR cychdr, RELTIM cyctim, RELTIM cycphs })	〔S〕<br>
<a href="#API_AID_CYC">AID_CYC</a>(uint_t nocyc)											〔SD〕<br>
<a href="#API_SAC_CYC">SAC_CYC</a>(ID cycid, { ACPTN acptn1, ACPTN acptn2,	ACPTN acptn3, ACPTN acptn4 })				〔SP〕</p>
</div>
<div class="paragraph">
<p>アラームハンドラ</p>
</div>
<div class="paragraph">
<p><a href="#API_CRE_ALM">CRE_ALM</a>(ID almid, { ATR almatr, intptr_t exinf, ALMHDR almhdr })〔S〕<br>
<a href="#API_AID_ALM">AID_ALM</a>(uint_t noalm)											〔SD〕<br>
<a href="#API_SAC_ALM">SAC_ALM</a>(ID almid, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })					〔SP〕</p>
</div>
<div class="paragraph">
<p>オーバランハンドラ</p>
</div>
<div class="paragraph">
<p><a href="#API_DEF_OVR">DEF_OVR</a>({ ATR ovratr, OVRHDR ovrhdr })							〔S〕</p>
</div>
<div class="paragraph">
<p>(7) システム状態管理機能</p>
</div>
<div class="paragraph">
<p><a href="#API_sac_sys">SAC_SYS</a>({ ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })							〔SP〕</p>
</div>
<div class="paragraph">
<p>(8) メモリオブジェクト管理機能</p>
</div>
<div class="paragraph">
<p><a href="#API_ATT_REG">ATT_REG</a>("メモリリージョン名",	{ ATR regatr, void *base, SIZE size })								〔SP〕<br>
<a href="#API_DEF_SRG">DEF_SRG</a>("標準ROMリージョン名", "標準RAMリージョン名")			〔SP〕<br>
<a href="#API_ATT_SEC">ATT_SEC</a>("セクション名", { ATR mematr, "メモリリージョン名" })	〔SP〕<br>
<a href="#API_ATA_SEC">ATA_SEC</a>("セクション名", { ATR mematr, "メモリリージョン名" }, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })	〔SP〕<br>
<a href="#API_LNK_SEC">LNK_SEC</a>("セクション名", { "メモリリージョン名" })				〔SP〕<br>
<a href="#API_ATT_MOD">ATT_MOD</a>("オブジェクトモジュール名")								〔SP〕<br>
<a href="#API_ATA_MOD">ATA_MOD</a>("オブジェクトモジュール名", { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })								〔SP〕<br>
<a href="#API_att_mem">ATT_MEM</a>({ ATR mematr, void *base, SIZE size })					〔SP〕<br>
<a href="#API_ATA_MEM">ATA_MEM</a>({ ATR mematr, void *base, SIZE size }, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })					〔SP〕<br>
<a href="#API_att_pma">ATA_PMA</a>({ ATR mematr, void *base, SIZE size, void *paddr })		〔SP〕<br>
<a href="#API_ATA_PMA">ATA_PMA</a>({ ATR mematr, void *base, SIZE size, void *paddr  }, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })	〔SP〕</p>
</div>
<div class="paragraph">
<p>(9) 割込み管理機能</p>
</div>
<div class="paragraph">
<p><a href="#API-CFG_INT">CFG_INT</a>(INTNO intno, { ATR intatr, PRI intpri })				〔S〕<br>
<a href="#API_CRE_ISR">CRE_ISR</a>(ID isrid, { ATR isratr, intptr_t exinf, INTNO intno, ISR isr, PRI isrpri })					〔S〕<br>
<a href="#API_ATT_ISR">ATT_ISR</a>({ ATR isratr, intptr_t exinf, INTNO intno, ISR isr, PRI isrpri })							〔S〕<br>
<a href="#API_AID_ISR">AID_ISR</a>(uint_t noisr)											〔SD〕<br>
<a href="#API_SAC_ISR">SAC_ISR</a>(ID isrid, { ACPTN acptn1, ACPTN acptn2, ACPTN acptn3, ACPTN acptn4 })					〔SP〕<br>
<a href="#API_DEF_INH">DEF_INH</a>(INHNO inhno, { ATR inhatr, INTHDR inthdr })				〔S〕</p>
</div>
<div class="paragraph">
<p>(10) CPU例外管理機能</p>
</div>
<div class="paragraph">
<p><a href="#API_def_exc">DEF_EXC</a>(EXCNO excno, { ATR excatr, EXCHDR exchdr })				〔S〕</p>
</div>
<div class="paragraph">
<p>(11) 拡張サービスコール管理機能</p>
</div>
<div class="paragraph">
<p><a href="#API_DEF_SVC">DEF_SVC</a>(FN fncd, { ATR svcatr, EXTSVC svcrtn, SIZE stksz })		〔SP〕</p>
</div>
<div class="paragraph">
<p>(12) システム構成管理機能</p>
</div>
<div class="paragraph">
<p><a href="#API_LMT_DOM">LMT_DOM</a>({ PRI mintpri })										〔SP〕
<a href="#API_DEF_ICS">DEF_ICS</a>({ SIZE istksz, STK_T *istk })							〔S〕
<a href="#API_DEF_STK">DEF_STK</a>({ SIZE stksz, STK_T *stk })								〔S〕
<a href="#API_ATT_INI">ATT_INI</a>({ ATR iniatr, intptr_t exinf, INIRTN inirtn })			〔S〕
<a href="#API_ATT_TER">ATT_TER</a>({ ATR teratr, intptr_t exinf, TERRTN terrtn })			〔S〕</p>
</div>
</div>
<div class="sect2">
<h3 id="_データ型">5.3. データ型</h3>
<div class="sect3">
<h4 id="_toppers共通データ型_2">5.3.1. TOPPERS共通データ型</h4>
<div class="literalblock">
<div class="content">
<pre>int8_t		符号付き8ビット整数（オプション，C99準拠）
uint8_t		符号無し8ビット整数（オプション，C99準拠）
int16_t		符号付き16ビット整数（C99準拠）
uint16_t	符号無し16ビット整数（C99準拠）
int32_t		符号付き32ビット整数（C99準拠）
uint32_t	符号無し32ビット整数（C99準拠）
int64_t		符号付き64ビット整数（オプション，C99準拠）
uint64_t	符号無し64ビット整数（オプション，C99準拠）
int128_t	符号付き128ビット整数（オプション，C99準拠）
uint128_t	符号無し128ビット整数（オプション，C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>int_least8_t	8ビット以上の符号付き整数（C99準拠）
uint_least8_t	int_least8_t型と同じサイズの符号無し整数（C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>float32_t	IEEE754準拠の32ビット単精度浮動小数点数（オプション）
double64_t	IEEE754準拠の64ビット倍精度浮動小数点数（オプション）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>bool_t		真偽値（trueまたはfalse）
int_t		16ビット以上の符号付き整数
uint_t		int_t型と同じサイズの符号無し整数
long_t		32ビット以上かつint_t型以上のサイズの符号付き整数
ulong_t		long_t型と同じサイズの符号無し整数</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>intptr_t	ポインタを格納できるサイズの符号付き整数（C99準拠）
uintptr_t	intptr_t型と同じサイズの符号無し整数（C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>FN			機能コード（符号付き整数，int_tに定義）
ER			エラーコード（符号付き整数，int_tに定義）
ID			オブジェクトのID番号（符号付き整数，int_tに定義）
ATR			オブジェクト属性（符号無し整数，uint_tに定義）
STAT		オブジェクトの状態（符号無し整数，uint_tに定義）
MODE		サービスコールの動作モード（符号無し整数，uint_tに定義）
PRI			優先度（符号付き整数，int_tに定義）
SIZE		メモリ領域のサイズ（符号無し整数，ポインタを格納できる
			サイズの符号無し整数型に定義）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TMO			タイムアウト指定（符号付き整数，単位はミリ秒，int_tに定義）
RELTIM		相対時間（符号無し整数，単位はミリ秒，uint_tに定義）
SYSTIM		システム時刻（符号無し整数，単位はミリ秒，ulong_tに定義）
SYSUTM		性能評価用システム時刻（符号無し整数，単位はマイクロ秒，
			ulong_tに定義）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>FP			プログラムの起動番地（型の定まらない関数ポインタ）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ER_BOOL		エラーコードまたは真偽値（符号付き整数，int_tに定義）
ER_ID		エラーコードまたはID番号（符号付き整数，int_tに定義，
			負のID番号は格納できない）
ER_UINT		エラーコードまたは符号無し整数（符号付き整数，int_tに
			定義，符号無し整数を格納する場合の有効ビット数はuint_t
			より1ビット短い）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>MB_T		オブジェクト管理領域を確保するためのデータ型</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ACPTN		アクセス許可パターン（符号無し32ビット整数，uint32_tに
			定義）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct acvct {		/* アクセス許可ベクタ */
	ACPTN	acptn1;			/* 通常操作1のアクセス許可パターン */
	ACPTN	acptn2;			/* 通常操作2のアクセス許可パターン */
	ACPTN	acptn3;			/* 管理操作のアクセス許可パターン */
	ACPTN	acptn4;			/* 参照操作のアクセス許可パターン */
} ACVCT;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_カーネルの使用するデータ型">5.3.2. カーネルの使用するデータ型</h4>
<div class="literalblock">
<div class="content">
<pre>TEXPTN		タスク例外要因のビットパターン（符号無し整数，uint_tに定義）
FLGPTN		イベントフラグのビットパターン（符号無し整数，uint_tに定義）
OVRTIM		プロセッサ時間（符号無し整数，単位はマイクロ秒，ulong_tに定義）
INTNO		割込み番号（符号無し整数，uint_tに定義）
INHNO		割込みハンドラ番号（符号無し整数，uint_tに定義）
EXCNO		CPU例外ハンドラ番号（符号無し整数，uint_tに定義）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TASK		タスクのメインルーチン（関数ポインタ）
TEXRTN		タスク例外処理ルーチン（関数ポインタ）
CYCHDR		周期ハンドラ（関数ポインタ）
ALMHDR		アラームハンドラ（関数ポインタ）
OVRHDR		オーバランハンドラ（関数ポインタ）
ISR			割込みサービスルーチン（関数ポインタ）
INTHDR		割込みハンドラ（関数ポインタ）
EXCHDR		CPU例外ハンドラ（関数ポインタ）
EXTSVC		拡張サービスコール（関数ポインタ）
INIRTN		初期化ルーチン（関数ポインタ）
TERRTN		終了処理ルーチン（関数ポインタ）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>STK_T		スタック領域を確保するためのデータ型
MPF_T		固定長メモリプール領域を確保するためのデータ型</pre>
</div>
</div>
<div class="paragraph">
<p>メールボックスのメッセージヘッダ【NGKI4001】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef	struct t_msg {
	struct t_msg	*pk_next;
} T_MSG;</pre>
</div>
</div>
<div class="paragraph">
<p>メールボックスの優先度付きメッセージヘッダ【NGKI4002】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef	struct t_msg_pri {
	T_MSG		msgque;			/* メールボックスのメッセージヘッダ */
	PRI			msgpri;			/* メッセージ優先度 */
} T_MSG_PRI;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_カーネルの使用するパケット形式">5.3.3. カーネルの使用するパケット形式</h4>
<div class="paragraph">
<p>(1) タスク管理機能</p>
</div>
<div class="paragraph">
<p>タスクの生成情報のパケット形式【NGKI4003】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_ctsk {
	ATR			tskatr;		/* タスク属性 */
	intptr_t	exinf;		/* タスクの拡張情報 */
	TASK		task;		/* タスクのメインルーチンの先頭番地 */
	PRI			itskpri;	/* タスクの起動時優先度 */
	SIZE		stksz;		/* タスクのスタック領域のサイズ */
	STK_T *		stk;		/* タスクのスタック領域の先頭番地 */
	/* 以下は，保護機能対応カーネルの場合 */
	SIZE		sstksz;		/* タスクのシステムスタック領域のサイズ */
	STK_T *		sstk;		/* タスクのシステムスタック領域の先頭番地 */
} T_CTSK;</pre>
</div>
</div>
<div class="paragraph">
<p>タスクの現在状態のパケット形式【NGKI4004】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rtsk {
	STAT		tskstat;	/* タスク状態 */
	PRI			tskpri;		/* タスクの現在優先度 */
	PRI			tskbpri;	/* タスクのベース優先度 */
	STAT		tskwait;	/* 待ち要因 */
	ID			wobjid;		/* 待ち対象のオブジェクトのID */
	TMO			lefttmo;	/* タイムアウトするまでの時間 */
	uint_t		actcnt;		/* 起動要求キューイング数 */
	uint_t		wupcnt;		/* 起床要求キューイング数 */
	/* 以下は，保護機能対応カーネルの場合 */
	bool_t		texmsk;		/* タスク例外マスク状態か否か */
	bool_t		waifbd;		/* 待ち禁止状態か否か */
	uint_t		svclevel;	/* 拡張サービスコールのネストレベル */
	/* 以下は，マルチプロセッサ対応カーネルの場合 */
	ID			prcid;		/* 割付けプロセッサのID */
	ID			actprc		/* 次の起動時の割付けプロセッサのID */
} T_RTSK;</pre>
</div>
</div>
<div class="paragraph">
<p>(2) タスク付属同期機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>なし</pre>
</div>
</div>
<div class="paragraph">
<p>(3) タスク例外処理機能</p>
</div>
<div class="paragraph">
<p>タスク例外処理ルーチンの定義情報のパケット形式【NGKI4005】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_dtex {
	ATR			texatr;		/* タスク例外処理ルーチン属性 */
	TEXRTN		texrtn;		/* タスク例外処理ルーチンの先頭番地 */
} T_DTEX;</pre>
</div>
</div>
<div class="paragraph">
<p>タスク例外処理の現在状態のパケット形式【NGKI4006】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rtex {
	STAT		texstat;	/* タスク例外処理の状態 */
	TEXPTN		pndptn;		/* 保留例外要因 */
} T_RTEX;</pre>
</div>
</div>
<div class="paragraph">
<p>(4) 同期・通信機能</p>
</div>
<div class="paragraph">
<p>セマフォの生成情報のパケット形式【NGKI4007】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_csem {
	ATR			sematr;		/* セマフォ属性 */
	uint_t		isemcnt;	/* セマフォの初期資源数 */
	uint_t		maxsem;		/* セマフォの最大資源数 */
} T_CSEM;</pre>
</div>
</div>
<div class="paragraph">
<p>セマフォの現在状態のパケット形式【NGKI4008】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rsem {
	ID			wtskid;		/* セマフォの待ち行列の先頭のタスクのID番号 */
	uint_t		semcnt;		/* セマフォの資源数 */
} T_RSEM;</pre>
</div>
</div>
<div class="paragraph">
<p>イベントフラグの生成情報のパケット形式【NGKI4009】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cflg {
	ATR			flgatr;		/* イベントフラグ属性 */
	FLGPTN		iflgptn;	/* イベントフラグの初期ビットパターン */
} T_CFLG;</pre>
</div>
</div>
<div class="paragraph">
<p>イベントフラグの現在状態のパケット形式【NGKI4010】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rflg {
	ID			wtskid;		/* イベントフラグの待ち行列の先頭のタス
							   クのID番号 */
	FLGPTN		flgptn;		/* イベントフラグのビットパターン */
} T_RFLG;</pre>
</div>
</div>
<div class="paragraph">
<p>データキューの生成情報のパケット形式【NGKI4011】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cdtq {
	ATR			dtqatr;		/* データキュー属性 */
	uint_t		dtqcnt;		/* データキュー管理領域に格納できるデータ数 */
	void *		dtqmb;		/* データキュー管理領域の先頭番地 */
} T_CDTQ;</pre>
</div>
</div>
<div class="paragraph">
<p>データキューの現在状態のパケット形式【NGKI4012】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rdtq {
	ID			stskid;		/* データキューの送信待ち行列の先頭のタ
							   スクのID番号 */
	ID			rtskid;		/* データキューの受信待ち行列の先頭のタ
							   スクのID番号 */
	uint_t		sdtqcnt;	/* データキュー管理領域に格納されている
							   データの数 */
} T_RDTQ;</pre>
</div>
</div>
<div class="paragraph">
<p>優先度データキューの生成情報のパケット形式【NGKI4013】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cpdq {
	ATR			pdqatr;		/* 優先度データキュー属性 */
	uint_t		pdqcnt;		/* 優先度データキュー管理領域に格納でき
							   るデータ数 */
	PRI			maxdpri;	/* 優先度データキューに送信できるデータ
							   優先度の最大値 */
	void *		pdqmb;		/* 優先度データキュー管理領域の先頭番地 */
} T_CPDQ;</pre>
</div>
</div>
<div class="paragraph">
<p>優先度データキューの現在状態のパケット形式【NGKI4014】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rpdq {
	ID			stskid;		/* 優先度データキューの送信待ち行列の先
							   頭のタスクのID番号 */
	ID			rtskid;		/* 優先度データキューの受信待ち行列の先
							   頭のタスクのID番号 */
	uint_t		spdqcnt;	/* 優先度データキュー管理領域に格納され
							   ているデータの数 */
} T_RPDQ;</pre>
</div>
</div>
<div class="paragraph">
<p>メールボックスの生成情報のパケット形式【NGKI4015】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cmbx {
	ATR			mbxatr;		/* メールボックス属性 */
	PRI			maxmpri;	/* 優先度メールボックスに送信できるメッ
							   セージ優先度の最大値 */
	void *		mprihd;		/* 優先度別のメッセージキューヘッダ領域
							   の先頭番地 */
} T_CMBX;</pre>
</div>
</div>
<div class="paragraph">
<p>メールボックスの現在状態のパケット形式【NGKI4016】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rmbx {
	ID			wtskid;		/* メールボックスの待ち行列の先頭のタスク
							   のID番号 */
	T_MSG		*pk_msg;	/* メッセージキューの先頭につながれたメッ
							   セージの先頭番地 */
} T_RMBX;</pre>
</div>
</div>
<div class="paragraph">
<p>ミューテックスの生成情報のパケット形式【NGKI4017】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cmtx {
	ATR			mtxatr;		/* ミューテックス属性 */
	PRI			ceilpri;	/* ミューテックスの上限優先度 */
} T_CMTX;</pre>
</div>
</div>
<div class="paragraph">
<p>ミューテックスの現在状態のパケット形式【NGKI4018】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rmtx {
	ID			htskid;		/* ミューテックスをロックしているタス
							   クのID番号 */
	ID			wtskid;		/* ミューテックスの待ち行列の先頭のタ
							   スクのID番号 */
} T_RMTX;</pre>
</div>
</div>
<div class="paragraph">
<p>メッセージバッファの生成情報のパケット形式【NGKI4037】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cmbf {
	ATR			mbfatr;		/* メッセージバッファ属性 */
	uint_t		maxmsz;		/* メッセージバッファの最大メッセージ
							   サイズ（バイト数）*/
	SIZE		mbfsz;		/* メッセージバッファ管理領域のサイズ
							   （バイト数）*/
	void *		mbfmb;		/* メッセージバッファ管理領域の先頭番地 */
} T_CMBF;</pre>
</div>
</div>
<div class="paragraph">
<p>メッセージバッファの現在状態のパケット形式【NGKI4038】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rmbf {
	ID		stskid;		/* メッセージバッファの送信待ち行列の先頭の
						   タスクのID番号 */
	ID		rtskid;		/* メッセージバッファの受信待ち行列の先頭の
						   タスクのID番号 */
	uint_t	smbfcnt;	/* メッセージバッファ管理領域に格納されてい
						   るメッセージの数 */
	SIZE	fmbfsz;		/* メッセージバッファ管理領域中の空き領域の
						   サイズ */
} T_RMBF;</pre>
</div>
</div>
<div class="paragraph">
<p>スピンロックの生成情報のパケット形式【NGKI4019】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cspn {
	ATR			spnatr;		/* スピンロック属性 */
} T_CSPN;</pre>
</div>
</div>
<div class="paragraph">
<p>スピンロックの現在状態のパケット形式【NGKI4020】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rspn {
	STAT		spnstat		/* スピンロックのロック状態 */
} T_RSPN;</pre>
</div>
</div>
<div class="paragraph">
<p>(5) メモリプール管理機能</p>
</div>
<div class="paragraph">
<p>固定長メモリプールの生成情報のパケット形式【NGKI4021】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cmpf {
	ATR			mpfatr;		/* 固定長メモリプール属性 */
	uint_t		blkcnt;		/* 獲得できる固定長メモリブロックの数 */
	uint_t		blksz;		/* 固定長メモリブロックのサイズ */
	MPF_T *		mpf;		/* 固定長メモリプール領域の先頭番地 */
	void *		mpfmb;		/* 固定長メモリプール管理領域の先頭番地 */
} T_CMPF;</pre>
</div>
</div>
<div class="paragraph">
<p>固定長メモリプールの現在状態のパケット形式【NGKI4022】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rmpf {
	ID			wtskid;		/* 固定長メモリプールの待ち行列の先頭の
							   タスクのID番号 */
	uint_t		fblkcnt;	/* 固定長メモリプール領域の空きメモリ領
							   域に割り付けることができる固定長メモ
							   リブロックの数 */
} T_RMPF;</pre>
</div>
</div>
<div class="paragraph">
<p>(6) 時間管理機能</p>
</div>
<div class="paragraph">
<p>周期ハンドラの生成情報のパケット形式【NGKI4023】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_ccyc {
	ATR			cycatr;		/* 周期ハンドラ属性 */
	intptr_t	exinf;		/* 周期ハンドラの拡張情報 */
	CYCHDR		cychdr;		/* 周期ハンドラの先頭番地 */
	RELTIM		cyctim;		/* 周期ハンドラの起動周期 */
	RELTIM		cycphs;		/* 周期ハンドラの起動位相 */
} T_CCYC;</pre>
</div>
</div>
<div class="paragraph">
<p>周期ハンドラの現在状態のパケット形式【NGKI4024】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rcyc {
	STAT		cycstat;	/* 周期ハンドラの動作状態 */
	RELTIM		lefttim;	/* 次に周期ハンドラを起動する時刻までの
							   相対時間 */
	/* 以下は，マルチプロセッサ対応カーネルの場合 */
	ID			prcid;		/* 割付けプロセッサのID */
} T_RCYC;</pre>
</div>
</div>
<div class="paragraph">
<p>アラームハンドラの生成情報のパケット形式【NGKI4025】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_calm {
	ATR			almatr;		/* アラームハンドラ属性 */
	intptr_t	exinf;		/* アラームハンドラの拡張情報 */
	ALMHDR		almhdr;		/* アラームハンドラの先頭番地 */
} T_CALM;</pre>
</div>
</div>
<div class="paragraph">
<p>アラームハンドラの現在状態のパケット形式【NGKI4026】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_ralm {
	STAT		almstat;	/* アラームハンドラの動作状態 */
	RELTIM		lefttim;	/* アラームハンドラを起動する時刻までの
							   相対時間 */
	/* 以下は，マルチプロセッサ対応カーネルの場合 */
	ID			prcid;		/* 割付けプロセッサのID */
} T_RALM;</pre>
</div>
</div>
<div class="paragraph">
<p>オーバランハンドラの定義情報のパケット形式【NGKI4027】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_dovr {
	ATR			ovratr;		/* オーバランハンドラ属性 */
	OVRHDR		ovrhdr;		/* オーバランハンドラの先頭番地 */
} T_DOVR;</pre>
</div>
</div>
<div class="paragraph">
<p>オーバランハンドラの現在状態のパケット形式【NGKI4028】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_rovr {
	STAT	ovrstat;		/* オーバランハンドラの動作状態 */
	OVRTIM	leftotm;		/* 残りプロセッサ時間 */
} T_ROVR;</pre>
</div>
</div>
<div class="paragraph">
<p>(7) システム状態管理機能</p>
</div>
<div class="paragraph">
<p>システムの現在状態のパケット形式</p>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>(8) メモリオブジェクト管理機能</p>
</div>
<div class="paragraph">
<p>メモリオブジェクトの登録情報のパケット形式【NGKI4029】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_amem {
	ATR			mematr		/* メモリオブジェクト属性 */
	void *		base		/* 登録するメモリ領域の先頭番地 */
	SIZE		size		/* 登録するメモリ領域のサイズ（バイト数）*/
} T_AMEM;</pre>
</div>
</div>
<div class="paragraph">
<p>物理メモリ領域の登録情報のパケット形式【NGKI4030】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_apma {
	ATR			mematr		/* メモリオブジェクト属性 */
	void *		base		/* 登録するメモリ領域の先頭番地 */
	SIZE		size		/* 登録するメモリ領域のサイズ（バイト数）*/
	void *		paddr		/* 登録するメモリ領域の物理アドレスの先頭
							   番地 */
} T_APMA;</pre>
</div>
</div>
<div class="paragraph">
<p>メモリオブジェクトの現在状態のパケット形式</p>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>(9) 割込み管理機能</p>
</div>
<div class="paragraph">
<p>割込み要求ラインの属性の設定情報のパケット形式【NGKI4031】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cint {
	ATR			intatr;		/* 割込み要求ライン属性 */
	PRI			intpri;		/* 割込み優先度 */
} T_CINT;</pre>
</div>
</div>
<div class="paragraph">
<p>割込みサービスルーチンの生成情報のパケット形式【NGKI4032】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_cisr {
	ATR			isratr;		/* 割込みサービスルーチン属性 */
	intptr_t	exinf;		/* 割込みサービスルーチンの拡張情報 */
	INTNO		intno;		/* 割込みサービスルーチンを登録する割込
							   み番号 */
	ISR			isr;		/* 割込みサービスルーチンの先頭番地 */
	PRI			isrpri;		/* 割込みサービスルーチン優先度 */
} T_CISR;</pre>
</div>
</div>
<div class="paragraph">
<p>割込みサービスルーチンの現在状態のパケット形式</p>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>割込みハンドラの定義情報のパケット形式【NGKI4033】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_dinh {
	ATR			inhatr;		/* 割込みハンドラ属性 */
	INTHDR		inthdr;		/* 割込みハンドラの先頭番地 */
} T_DINH;</pre>
</div>
</div>
<div class="paragraph">
<p>割込み要求ラインの現在状態のパケット形式</p>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>(10) CPU例外管理機能</p>
</div>
<div class="paragraph">
<p>CPU例外ハンドラの定義情報のパケット形式【NGKI4034】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_dexc {
	ATR			excatr;		/* CPU例外ハンドラ属性 */
	EXCHDR		exchdr;		/* CPU例外ハンドラの先頭番地 */
} T_DEXC;</pre>
</div>
</div>
<div class="paragraph">
<p>(11) 拡張サービスコール管理機能</p>
</div>
<div class="paragraph">
<p>拡張サービスコールの定義情報のパケット形式【NGKI4035】</p>
</div>
<div class="literalblock">
<div class="content">
<pre>typedef struct t_dsvc {
	ATR			svcatr		/* 拡張サービスコール属性 */
	EXTSVC		svcrtn		/* 拡張サービスコールの先頭番地 */
	SIZE		stksz		/* 拡張サービスコールで使用するスタック
							   サイズ */
} T_DSVC;</pre>
</div>
</div>
<div class="paragraph">
<p>(12) システム構成管理機能</p>
</div>
<div class="paragraph">
<p>コンフィギュレーション情報のパケット形式</p>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
<div class="paragraph">
<p>バージョン情報のパケット形式</p>
</div>
<div class="paragraph">
<p>☆未完成</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_定数とマクロ">5.4. 定数とマクロ</h3>
<div class="sect3">
<h4 id="_toppers共通定数_2">5.4.1. TOPPERS共通定数</h4>
<div class="paragraph">
<p>(1) 一般定数</p>
</div>
<div class="literalblock">
<div class="content">
<pre>NULL					無効ポインタ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>true			1		真
false			0		偽</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>E_OK			0		正常終了</pre>
</div>
</div>
<div class="paragraph">
<p>(2) 整数型に格納できる最大値と最小値</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INT8_MAX			int8_tに格納できる最大値（オプション，C99準拠）
INT8_MIN			int8_tに格納できる最小値（オプション，C99準拠）
UINT8_MAX			uint8_tに格納できる最大値（オプション，C99準拠）
INT16_MAX			int16_tに格納できる最大値（C99準拠）
INT16_MIN			int16_tに格納できる最小値（C99準拠）
UINT16_MAX			uint16_tに格納できる最大値（C99準拠）
INT32_MAX			int32_tに格納できる最大値（C99準拠）
INT32_MIN			int32_tに格納できる最小値（C99準拠）
UINT32_MAX			uint32_tに格納できる最大値（C99準拠）
INT64_MAX			int64_tに格納できる最大値（オプション，C99準拠）
INT64_MIN			int64_tに格納できる最小値（オプション，C99準拠）
UINT64_MAX			uint64_tに格納できる最大値（オプション，C99準拠）
INT128_MAX			int128_tに格納できる最大値（オプション，C99準拠）
INT128_MIN			int128_tに格納できる最小値（オプション，C99準拠）
UINT128_MAX			uint128_tに格納できる最大値（オプション，C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>INT_LEAST8_MAX		int_least8_tに格納できる最大値（C99準拠）
INT_LEAST8_MIN		int_least8_tに格納できる最小値（C99準拠）
UINT_LEAST8_MAX		uint_least8_tに格納できる最大値（C99準拠）
INT_MAX				int_tに格納できる最大値（C90準拠）
INT_MIN				int_tに格納できる最小値（C90準拠）
UINT_MAX			uint_tに格納できる最大値（C90準拠）
LONG_MAX			long_tに格納できる最大値（C90準拠）
LONG_MIN			long_tに格納できる最小値（C90準拠）
ULONG_MAX			ulong_tに格納できる最大値（C90準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>FLOAT32_MIN			float32_tに格納できる最小の正規化された正の浮
					動小数点数（オプション）
FLOAT32_MAX			float32_tに格納できる表現可能な最大の有限浮動
					小数点数（オプション）
DOUBLE64_MIN		double64_tに格納できる最小の正規化された正の浮
					動小数点数（オプション）
DOUBLE64_MAX		double64_tに格納できる表現可能な最大の有限浮動
					小数点数（オプション）</pre>
</div>
</div>
<div class="paragraph">
<p>(3) 整数型のビット数</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CHAR_BIT			char型のビット数（C90準拠）</pre>
</div>
</div>
<div class="paragraph">
<p>(4) オブジェクト属性</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_NULL		0U		オブジェクト属性を指定しない</pre>
</div>
</div>
<div class="paragraph">
<p>(5) タイムアウト指定</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMO_POL		0		ポーリング
TMO_FEVR	-1		永久待ち
TMO_NBLK	-2		ノンブロッキング</pre>
</div>
</div>
<div class="paragraph">
<p>(6) アクセス許可パターン</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TACP_KERNEL		0U		カーネルドメインのみにアクセスを許可
TACP_SHARED		~0U		すべての保護ドメインにアクセスを許可</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_toppers共通マクロ_2">5.4.2. TOPPERS共通マクロ</h4>
<div class="paragraph">
<p>(1) 整数定数を作るマクロ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INT8_C(val)			int_least8_t型の定数を作るマクロ（C99準拠）
UINT8_C(val)		uint_least8_t型の定数を作るマクロ（C99準拠）
INT16_C(val)		int16_t型の定数を作るマクロ（C99準拠）
UINT16_C(val)		uint16_t型の定数を作るマクロ（C99準拠）
INT32_C(val)		int32_t型の定数を作るマクロ（C99準拠）
UINT32_C(val)		uint32_t型の定数を作るマクロ（C99準拠）
INT64_C(val)		int64_t型の定数を作るマクロ（オプション，C99準拠）
UINT64_C(val)		uint64_t型の定数を作るマクロ（オプション，C99準拠）
INT128_C(val)		int128_t型の定数を作るマクロ（オプション，C99準拠）
UINT128_C(val)		uint128_t型の定数を作るマクロ（オプション，C99準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>UINT_C(val)			uint_t型の定数を作るマクロ
ULONG_C(val)		ulong_t型の定数を作るマクロ</pre>
</div>
</div>
<div class="paragraph">
<p>(2) 型に関する情報を取り出すためのマクロ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>offsetof(structure, field)	構造体structure中のフィールドfieldの
							バイト位置を返すマクロ（C90準拠）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>alignof(type)				型typeのアラインメント単位を返すマクロ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ALIGN_TYPE(addr, type)		番地addrが型typeに対してアラインしてい
							るかどうかを返すマクロ</pre>
</div>
</div>
<div class="paragraph">
<p>(3) assertマクロ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>assert(exp)			expが成立しているかを検査するマクロ（C90準拠）</pre>
</div>
</div>
<div class="paragraph">
<p>(4) コンパイラの拡張機能のためのマクロ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>inline				インライン関数
Inline				ファイルローカルなインライン関数
asm					インラインアセンブラ
Asm					インラインアセンブラ（最適化抑止）
throw()				例外を発生しない関数
NoReturn			リターンしない関数</pre>
</div>
</div>
<div class="paragraph">
<p>(5) エラーコード生成・分解マクロ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ERCD(mercd, sercd)	メインエラーコードmercdとサブエラーコードsercdか
					ら，エラーコードを生成するためのマクロ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>MERCD(ercd)			エラーコードercdからメインエラーコードを抽出する
					ためのマクロ
SERCD(ercd)			エラーコードercdからサブエラーコードを抽出するた
					めのマクロ</pre>
</div>
</div>
<div class="paragraph">
<p>(6) アクセス許可パターン生成マクロ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TACP(domid)			domidで指定される保護ドメインに属する処理単位の
					みにアクセスを許可するアクセス許可パターン</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル共通定数_2">5.4.3. カーネル共通定数</h4>
<div class="paragraph">
<p>(1) オブジェクト属性</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_TPRI			0x01U	タスクの待ち行列をタスクの優先度順に</pre>
</div>
</div>
<div class="paragraph">
<p>(2) 保護ドメインID</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TDOM_SELF		0		自タスクの属する保護ドメイン
TDOM_KERNEL		-1		カーネルドメイン
TDOM_NONE		-2		無所属（保護ドメインに属さない）</pre>
</div>
</div>
<div class="paragraph">
<p>(3) その他のカーネル共通定数</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TCLS_SELF		0		自タスクの属するクラス</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TPRC_NONE		0		割付けプロセッサの指定がない
TPRC_INI		0		初期割付けプロセッサ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TSK_SELF		0		自タスク指定
TSK_NONE		0		該当するタスクがない</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TPRI_SELF		0		自タスクのベース優先度の指定
TPRI_INI		0		タスクの起動時優先度の指定</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TIPM_ENAALL		0		割込み優先度マスク全解除</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル共通マクロ_2">5.4.4. カーネル共通マクロ</h4>
<div class="paragraph">
<p>(1) オブジェクト属性を作るマクロ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_DOM(domid)		domidで指定される保護ドメインに属する
TA_CLS(clsid)		clsidで指定されるクラスに属する</pre>
</div>
</div>
<div class="paragraph">
<p>(2) サービスコールの呼出し方法を指定するマクロ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SVC_CALL(svc)		svcで指定されるサービスコールを関数呼出しによっ
					て呼び出すための名称</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_カーネルの機能毎の定数">5.4.5. カーネルの機能毎の定数</h4>
<div class="paragraph">
<p>(1) タスク管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_ACT			0x02U	タスクの生成時にタスクを起動する
TA_RSTR			0x04U	生成するタスクを制約タスクとする
TA_FPU					FPUレジスタをコンテキストに含める</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TTS_RUN			0x01U	実行状態
TTS_RDY			0x02U	実行可能状態
TTS_WAI			0x04U	待ち状態
TTS_SUS			0x08U	強制待ち状態
TTS_WAS			0x0cU	二重待ち状態
TTS_DMT			0x10U	休止状態</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TTW_SLP			0x0001U	起床待ち
TTW_DLY			0x0002U	時間経過待ち
TTW_SEM			0x0004U	セマフォの資源獲得待ち
TTW_FLG			0x0008U	イベントフラグ待ち
TTW_SDTQ		0x0010U	データキューへの送信待ち
TTW_RDTQ		0x0020U	データキューからの受信待ち
TTW_SPDQ		0x0100U	優先度データキューへの送信待ち
TTW_RPDQ		0x0200U	優先度データキューからの受信待ち
TTW_MBX			0x0040U	メールボックスからの受信待ち
TTW_MTX			0x0080U	ミューテックスのロック待ち状態
TTW_SMBF		0x0400U	メッセージバッファへの送信待ち
TTW_RMBF		0x0800U	メッセージバッファからの受信待ち
TTW_MPF			0x2000U	固定長メモリブロックの獲得待ち</pre>
</div>
</div>
<div class="paragraph">
<p>TA_FPUの値は，ターゲット定義とする．</p>
</div>
<div class="paragraph">
<p>(3) タスク例外処理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TTEX_ENA		0x01U	タスク例外処理許可状態
TTEX_DIS		0x02U	タスク例外処理禁止状態</pre>
</div>
</div>
<div class="paragraph">
<p>(4) 同期・通信機能</p>
</div>
<div class="paragraph">
<p>イベントフラグ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_WMUL			0x02U	複数のタスクが待つのを許す
TA_CLR			0x04U	タスクの待ち解除時にイベントフラグをクリアする</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TWF_ORW			0x01U	イベントフラグのOR待ちモード
TWF_ANDW		0x02U	イベントフラグのAND待ちモード</pre>
</div>
</div>
<div class="paragraph">
<p>メールボックス</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_MPRI			0x02U	メッセージキューをメッセージの優先度順にする</pre>
</div>
</div>
<div class="paragraph">
<p>スピンロック</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TSPN_UNL		0x01U	取得されていない状態
TSPN_LOC		0x02U	取得されている状態</pre>
</div>
</div>
<div class="paragraph">
<p>(6) 時間管理機能</p>
</div>
<div class="paragraph">
<p>周期ハンドラ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_STA			0x02U	周期ハンドラの生成時に周期ハンドラを動作開始する
TA_PHS			0x04U	周期ハンドラを生成した時刻を基準時刻とする</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TCYC_STP		0x01U	周期ハンドラが動作していない状態
TCYC_STA		0x02U	周期ハンドラが動作している状態</pre>
</div>
</div>
<div class="paragraph">
<p>アラームハンドラ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TALM_STP		0x01U	アラームハンドラが動作していない状態
TALM_STA		0x02U	アラームハンドラが動作している状態</pre>
</div>
</div>
<div class="paragraph">
<p>オーバランハンドラ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOVR_STP		0x01U	オーバランハンドラが動作していない状態
TOVR_STA		0x02U	オーバランハンドラが動作している状態</pre>
</div>
</div>
<div class="paragraph">
<p>(8) メモリオブジェクト管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_NOWRITE		0x01U	書込みアクセス禁止
TA_NOREAD		0x02U	読出しアクセス禁止
TA_EXEC			0x04U	実行アクセス許可
TA_MEMINI		0x08U	メモリの初期化を行う
TA_MEMPRSV		0x10U	メモリの初期化を行わない
TA_SDATA		0x20U	ショートデータ領域に配置
TA_UNCACHE		0x40U	キャッシュ禁止
TA_IODEV		0x80U	周辺デバイスの領域
TA_WTHROUGH				ライトスルーキャッシュを用いる</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TPM_WRITE		0x01U	書込みアクセス権のチェック
TPM_READ		0x02U	読出しアクセス権のチェック
TPM_EXEC		0x04U	実行アクセス権のチェック</pre>
</div>
</div>
<div class="paragraph">
<p>TA_WTHROUGHの値は，ターゲット定義とする．</p>
</div>
<div class="paragraph">
<p>(9) 割込み管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_ENAINT		0x01U	割込み要求禁止フラグをクリア
TA_EDGE			0x02U	エッジトリガ
TA_POSEDGE				ポジティブエッジトリガ
TA_NEGEDGE				ネガティブエッジトリガ
TA_BOTHEDGE				両エッジトリガ
TA_LOWLEVEL				ローレベルトリガ
TA_HIGHLEVEL			ハイレベルトリガ</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_NONKERNEL	0x02U	カーネル管理外の割込み</pre>
</div>
</div>
<div class="paragraph">
<p>TA_POSEDGE，TA_NEGEDGE，TA_BOTHEDGE，TA_LOWLEVEL，TA_HIGHLEVELの値は，
ターゲット定義とする．</p>
</div>
<div class="paragraph">
<p>(10) CPU例外管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TA_DIRECT				CPU例外ハンドラを直接呼び出す</pre>
</div>
</div>
<div class="paragraph">
<p>TA_DIRECTの値は，ターゲット定義とする．</p>
</div>
</div>
<div class="sect3">
<h4 id="_カーネルの機能毎のマクロ">5.4.6. カーネルの機能毎のマクロ</h4>
<div class="paragraph">
<p>(1) タスク管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>COUNT_STK_T(sz)		サイズszのスタック領域を確保するために必要な
					STK_T型の配列の要素数
ROUND_STK_T(sz)		要素数COUNT_STK_T(sz)のSTK_T型の配列のサイズ（sz
					を，STK_T型のサイズの倍数になるように大きい方に
					丸めた値）</pre>
</div>
</div>
<div class="paragraph">
<p>(4) 同期・通信機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_DTQMB(dtqcnt)	dtqcntで指定した数のデータを格納できるデータ
					キュー管理領域のサイズ（バイト数）
TCNT_DTQMB(dtqcnt)	dtqcntで指定した数のデータを格納できるデータ
					キュー管理領域を確保するために必要なMB_T型の配
					列の要素数</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_PDQMB(pdqcnt)	pdqcntで指定した数のデータを格納できる優先度デー
					タキュー管理領域のサイズ（バイト数）
TCNT_PDQMB(pdqcnt)	pdqcntで指定した数のデータを格納できる優先度デー
					タキュー管理領域を確保するために必要なMB_T型の
					配列の要素数</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_MBFMB(msgcnt, msgsz)	msgszで指定したサイズのメッセージを，
							msgcntで指定した数だけ格納できるメッセー
							ジバッファ管理領域のサイズ（バイト数）
TCNT_MBFMB(msgcnt, msgsz)	msgszで指定したサイズのメッセージを，
							msgcntで指定した数だけ格納できるメッセー
							ジバッファ管理領域を確保するために必要
							なMB_T型の配列の要素数</pre>
</div>
</div>
<div class="paragraph">
<p>(5) メモリプール管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>COUNT_MPF_T(blksz)	固定長メモリブロックのサイズがblkszの固定長メモ
					リプール領域を確保するために，固定長メモリブロッ
					ク1つあたりに必要なMPF_T型の配列の要素数を求め
					るマクロ
ROUND_MPF_T(blksz)	要素数COUNT_MPF_T(blksz)のMPF_T型の配列のサイズ
					（blkszを，MPF_T型のサイズの倍数になるように大き
					い方に丸めた値）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TSZ_MPFMB(blkcnt)	blkcntで指定した数の固定長メモリブロックを管理
					することができる固定長メモリプール管理領域のサ
					イズ（バイト数）
TCNT_MPFMB(blkcnt)	blkcntで指定した数の固定長メモリブロックを管理
					することができる固定長メモリプール管理領域を確
					保するために必要なMB_T型の配列の要素数</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_構成マクロ">5.5. 構成マクロ</h3>
<div class="sect3">
<h4 id="_toppers共通構成マクロ_2">5.5.1. TOPPERS共通構成マクロ</h4>
<div class="paragraph">
<p>(1) 相対時間の範囲</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_RELTIM		相対時間に指定できる最大値</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_カーネル共通構成マクロ_2">5.5.2. カーネル共通構成マクロ</h4>
<div class="paragraph">
<p>(1) サポートする機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_PROTECT			保護機能対応のカーネル
TOPPERS_SUPPORT_MULTI_PRC		マルチプロセッサ対応のカーネル
TOPPERS_SUPPORT_DYNAMIC_CRE		動的生成対応のカーネル</pre>
</div>
</div>
<div class="paragraph">
<p>(2) 優先度の範囲</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_TPRI		タスク優先度の最小値（＝1）
TMAX_TPRI		タスク優先度の最大値</pre>
</div>
</div>
<div class="paragraph">
<p>(3) プロセッサの数</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_PRCID		プロセッサの数</pre>
</div>
</div>
<div class="paragraph">
<p>(4) 特殊な役割を持ったプロセッサ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_MASTER_PRCID		マスタプロセッサのID番号
TOPPERS_SYSTIM_PRCID		システム時刻管理プロセッサのID番号</pre>
</div>
</div>
<div class="paragraph">
<p>(5) タイマ方式</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SYSTIM_LOCAL		ローカルタイマ方式の場合にマクロ定義
TOPPERS_SYSTIM_GLOBAL		グローバルタイマ方式の場合にマクロ定義</pre>
</div>
</div>
<div class="paragraph">
<p>(6) バージョン情報</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TKERNEL_MAKER		カーネルのメーカコード（＝0x0118）
TKERNEL_PRID		カーネルの識別番号
TKERNEL_SPVER		カーネル仕様のバージョン番号
TKERNEL_PRVER		カーネルのバージョン番号</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_カーネルの機能毎の構成マクロ">5.5.3. カーネルの機能毎の構成マクロ</h4>
<div class="paragraph">
<p>(1) タスク管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_ACTCNT		タスクの起動要求キューイング数の最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_TSKID		登録できるタスクの数（動的生成対応でないカーネルで
				は，静的APIによって登録されたタスクの数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>(2) タスク付属同期機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_WUPCNT		タスクの起床要求キューイング数の最大値</pre>
</div>
</div>
<div class="paragraph">
<p>(3) タスク例外処理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TBIT_TEXPTN		タスク例外要因のビット数（TEXPTNの有効ビット数）</pre>
</div>
</div>
<div class="paragraph">
<p>(4) 同期・通信機能</p>
</div>
<div class="paragraph">
<p>セマフォ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_MAXSEM		セマフォの最大資源数の最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_SEMID		登録できるセマフォの数（動的生成対応でないカーネル
				では，静的APIによって登録されたセマフォの数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>イベントフラグ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TBIT_FLGPTN		イベントフラグのビット数（FLGPTNの有効ビット数）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_FLGID		登録できるイベントフラグの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたイベントフラグの
				数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>データキュー</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_DTQID		登録できるデータキューの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたデータキューの数
				に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>優先度データキュー</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_DPRI		データ優先度の最小値（＝1）
TMAX_DPRI		データ優先度の最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_PDQID		登録できる優先度データキューの数（動的生成対応でな
				いカーネルでは，静的APIによって登録された優先度デー
				タキューの数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>メールボックス</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_MPRI		メッセージ優先度の最小値（＝1）
TMAX_MPRI		メッセージ優先度の最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_MBXID		登録できるメールボックスの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたメールボックスの
				数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>ミューテックス</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_MTXID		登録できるミューテックスの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたミューテックスの
				数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>メッセージバッファ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_MBFID		登録できるメッセージバッファの数（動的生成対応でな
				いカーネルでは，静的APIによって登録されたメッセー
				ジバッファの数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>スピンロック</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_SPNID		登録できるスピンロックの数（動的生成対応でないカー
				ネルでは，静的APIによって登録されたミューテックスの
				数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>(5) メモリプール管理機能</p>
</div>
<div class="paragraph">
<p>固定長メモリプール</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_MPFID		登録できる固定長メモリプールの数（動的生成対応でない
				カーネルでは，静的APIによって登録された固定長メモリ
				プールの数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>(6) 時間管理機能</p>
</div>
<div class="paragraph">
<p>システム時刻管理</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TIC_NUME	タイムティックの周期（単位はミリ秒）の分子
TIC_DENO	タイムティックの周期（単位はミリ秒）の分母</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_GET_UTM		get_utmがサポートされている</pre>
</div>
</div>
<div class="paragraph">
<p>周期ハンドラ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_CYCID		登録できる周期ハンドラの数（動的生成対応でないカー
				ネルでは，静的APIによって登録された周期ハンドラの数
				に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>アラームハンドラ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_ALMID		登録できるアラームハンドラの数（動的生成対応でない
				カーネルでは，静的APIによって登録されたアラームハン
				ドラの数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>オーバランハンドラ</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMAX_OVRTIM		プロセッサ時間に指定できる最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_OVRHDR		オーバランハンドラ機能がサポートされて
							いる</pre>
</div>
</div>
<div class="paragraph">
<p>(7) システム状態管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>なし</pre>
</div>
</div>
<div class="paragraph">
<p>(8) メモリオブジェクト管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_ATT_MOD		ATT_MOD／ATA_MODがサポートされている
TOPPERS_SUPPORT_ATT_PMA		ATT_PMA／ATA_PMA／att_pmaがサポートさ
							れている</pre>
</div>
</div>
<div class="paragraph">
<p>(9) 割込み管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_INTPRI		割込み優先度の最小値（最高値）
TMAX_INTPRI		割込み優先度の最大値（最低値，＝-1）</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TMIN_ISRPRI		割込みサービスルーチン優先度の最小値（＝1）
TMAX_ISRPRI		割込みサービスルーチン優先度の最大値</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TOPPERS_SUPPORT_DIS_INT		dis_intがサポートされている
TOPPERS_SUPPORT_ENA_INT		ena_intがサポートされている</pre>
</div>
</div>
<div class="paragraph">
<p>(10) CPU例外管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>なし</pre>
</div>
</div>
<div class="paragraph">
<p>(11) 拡張サービスコール管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>TNUM_FNCD		登録できる拡張サービスコールの数（動的生成対応でな
				いカーネルでは，静的APIによって登録された拡張サービ
				スコールの数に一致）</pre>
</div>
</div>
<div class="paragraph">
<p>(12) システム構成管理機能</p>
</div>
<div class="literalblock">
<div class="content">
<pre>なし</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_エラーコード一覧">5.6. エラーコード一覧</h3>
<div class="paragraph">
<p>(1) メインエラーコード</p>
</div>
<div class="literalblock">
<div class="content">
<pre>E_SYS		-5		システムエラー
E_NOSPT		-9		未サポート機能
E_RSFN		-10		予約機能コード
E_RSATR		-11		予約属性
E_PAR		-17		パラメータエラー
E_ID		-18		不正ID番号
E_CTX		-25		コンテキストエラー
E_MACV		-26		メモリアクセス違反
E_OACV		-27		オブジェクトアクセス違反
E_ILUSE		-28		サービスコール不正使用
E_NOMEM		-33		メモリ不足
E_NOID		-34		ID番号不足
E_NORES		-35		資源不足
E_OBJ		-41		オブジェクト状態エラー
E_NOEXS		-42		オブジェクト未登録
E_QOVR		-43		キューイングオーバフロー
E_RLWAI		-49		待ち禁止状態または待ち状態の強制解除
E_TMOUT		-50		ポーリング失敗またはタイムアウト
E_DLT		-51		待ちオブジェクトの削除または再初期化
E_CLS		-52		待ちオブジェクトの状態変化
E_WBLK		-57		ノンブロッキング受付け
E_BOVR		-58		バッファオーバフロー</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_機能コード一覧_ngki4036">5.7. 機能コード一覧【NGKI4036】</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">act_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iact_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can_act</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ext_tsk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x09</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ter_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_pri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_pri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_inf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x0d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">slp_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tslp_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wup_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iwup_tsk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can_wup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rel_wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">irel_wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idis_wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iena_wai</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sus_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rsm_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dly_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x1d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ras_tex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iras_tex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_tex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_tex</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_tex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_tex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sig_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isig_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pol_sem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twai_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x2d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iset_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clr_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai_flg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pol_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twai_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipsnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x39</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fsnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ifsnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x3d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipsnd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_pdq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x49</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_mbx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_mbx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_mbx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_mbx</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x4d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ploc_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tloc_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_mtx</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x51</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x55</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x59</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pget_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tget_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rel_mpf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x5d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_tim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_utm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_ovr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x61</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x65</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ista_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">istp_alm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_ovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ista_ovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_ovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">istp_ovr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x6d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_sys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_sys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rot_rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">irot_rdq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x71</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_did</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_tid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iget_tid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iloc_cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iunl_cpu</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x79</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_ctx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_loc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x7d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_dpn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sns_ker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ext_ker</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">att_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">det_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prb_mem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x85</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">att_pma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cfg_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x8d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_ipm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_ipm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x91</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xsns_dpn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xsns_xpn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x95</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_cfg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_ver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x99</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x9d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xa1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xa5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mbx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xa9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xb1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xb5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mbx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xb9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xc1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xc5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_mbx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xc9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xcd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xd1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xd5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mbx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xd9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xdd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xe1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xe5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xe9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xf1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_tex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_ovr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_inh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_exc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xf5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_svc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xf9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0xfd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mact_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imact_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mig_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msta_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">msta_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imsta_alm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x109</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mrot_rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">imrot_rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_pid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iget_pid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x10d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iloc_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">try_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">itry_spn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x115</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iunl_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x119</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-0x11d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">予約</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>【μITRON4.0仕様との関係】</p>
</div>
<div class="paragraph">
<p>サービスコールの機能コードを割り当てなおした．</p>
</div>
</div>
<div class="sect2">
<h3 id="_カーネルオブジェクトに対するアクセスの種別">5.8. カーネルオブジェクトに対するアクセスの種別</h3>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">オブジェクトの種類</th>
<th class="tableblock halign-left valign-top">通常操作1</th>
<th class="tableblock halign-left valign-top">通常操作2</th>
<th class="tableblock halign-left valign-top">管理操作</th>
<th class="tableblock halign-left valign-top">参照操作</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">メモリオブジェクト</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">書込み</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">読出し</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">det_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">実行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prb_mem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock">タスク</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">act_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ter_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_pri</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mact_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_pri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_tsk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">can_act</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rel_wai</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_tex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_tex</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mig_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sus_tsk</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_ovr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wup_tsk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rsm_tsk</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prb_mem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">can_wup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_wai</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_wai</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ras_tex</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_ovr</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_ovr</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">セマフォ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sig_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_sem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pol_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_sem</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twai_sem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_sem</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">イベントフラグ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wai_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_flg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clr_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pol_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_flg</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">twai_flg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_flg</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">データキュー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_dtq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_dtq</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_dtq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_dtq</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fsnd_dtq</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">優先度データキュー</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_pdq</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_pdq</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_pdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_pdq</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">メッセージバッファ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">snd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rcv_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mbf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">psnd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prcv_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mbf</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tsnd_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trcv_mbf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mbf</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">ミューテックス</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_mtx</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mtx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mtx</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ploc_mtx</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mtx</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tloc_mtx</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mtx</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_mtx</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">スピンロック</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_spn</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_spn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_spn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">try_spn</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_spn</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_spn</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">固定長メモリプール</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rel_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_mpf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_mpf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pget_mpf</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ini_mpf</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tget_mpf</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_mpf</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">周期ハンドラ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_cyc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_cyc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msta_cyc</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_cyc</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">アラームハンドラ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sta_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stp_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_alm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_alm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msta_alm</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_alm</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">割込みサービスルーチン</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">del_isr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_isr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sac_isr</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="8"><p class="tableblock">システム状態</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rot_rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loc_cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acre_yyy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_tim</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mrot_rdq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unl_cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">att_mem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_ipm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dis_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">att_pma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_sys</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_dsp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ena_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cfg_int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chg_ipm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_inh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_cfg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_exc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref_ver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_svc</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">def_ovr</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>すべての保護ドメインから呼び出すことができるサービスコール：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自タスクへの操作（ext_tsk，get_inf，slp_tsk，tslp_tsk，dly_tsk，dis_tex，ena_tex）</p>
</li>
<li>
<p>タスク例外状態参照（sns_tex）</p>
</li>
<li>
<p>性能評価用システム時刻の参照（get_utm）</p>
</li>
<li>
<p>システム状態参照（get_tid，get_did，get_pid，sns_ctx，sns_loc，sns_dsp，sns_dpn，sns_ker）</p>
</li>
<li>
<p>CPU例外発生時の状態参照（xsns_dpn，xsns_xpn）</p>
</li>
<li>
<p>拡張サービスコールの呼出し（cal_svc）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>カーネルドメインのみから呼び出すことができるサービスコール：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>システム状態のアクセス許可ベクタの設定（sac_sys）</p>
</li>
<li>
<p>カーネルの終了（ext_ker）</p>
</li>
<li>
<p>非タスクコンテキスト専用のサービスコール</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>【補足説明】</p>
</div>
<div class="paragraph">
<p>xsns_dpnとxsns_xpnは，エラーコードを返さないために，すべての保護ドメイ
ンから呼び出すことができるサービスコールとしているが，タスクコンテキス
トから呼び出した場合には必ずtrueが返ることとしており，実質的にはカーネ
ルドメインのみから呼び出すことができる．</p>
</div>
<div class="paragraph">
<p>【μITRON4.0/PX仕様との関係】</p>
</div>
<div class="paragraph">
<p>get_priは，μITRON4.0/PX仕様ではタスクに対する通常操作1としていたのを，
タスクに対する参照操作に変更した．また，get_ipm（μITRON4.0/PX仕様では
get_ixx）をシステム状態に対する通常操作2から参照操作に，sac_sysをシステ
ム状態に対する管理操作からカーネルドメインのみから呼び出すことができる
サービスコールに変更した．システム時刻に対するアクセス許可ベクタは廃止
し，get_timはシステム状態に対する参照操作とした．</p>
</div>
<div class="paragraph">
<p>【仕様変更の経緯】</p>
</div>
<div class="paragraph">
<p>この仕様のRelease 1.5以前では，unl_mtxは，アクセス許可ベクタによるアク
セス保護を行わないサービスコールとしていた．これは，ミューテックスをロッ
クしたタスク以外がunl_mtxを呼び出すとE_ILUSEエラーとなるため，実質的に
は対象ミューテックスの通常操作1としてアクセス保護されているとみなすこと
ができると考えたためである．しかし，タスクが拡張サービスコールの中で
ミューテックスをロックした場合，アクセス許可ベクタではアクセスが許可さ
れていないミューテックスをロックすることができる．このようなミューテッ
クスのロック解除は，タスクから直接unl_mtxを呼んで行うのではなく，拡張サー
ビスコールの中で行うべきと考えられる．そこで，unl_mtxを，対象ミューテッ
クスの通常操作1としてアクセス保護する仕様に変更した．なお，HRP2カーネル
Release 2.1以前のバージョンは，古い仕様に従って実装されている．</p>
</div>
</div>
<div class="sect2">
<h3 id="_ターゲット定義事項一覧">5.9. ターゲット定義事項一覧</h3>
<div class="paragraph">
<p>・割込み優先度の段階数［NGKI0256］</p>
</div>
<div class="paragraph">
<p>・割込み番号の付与方法［NGKI0272］</p>
</div>
<div class="paragraph">
<p>・割込みハンドラ番号の付与方法［NGKI0273］</p>
</div>
<div class="paragraph">
<p>・割込み番号に対応しない割込みハンドラ番号や，割込みハンドラ番号に対応
　しない割込み番号を設けるか［NGKI0276］</p>
</div>
<div class="paragraph">
<p>・受け付けた割込み要求に対して，割込みサービスルーチンも割込みハンドラ
　も登録していない場合の振舞い［NGKI0249］</p>
</div>
<div class="paragraph">
<p>・割込み要求禁止フラグがサポートされているか［NGKI0260］［NGKI0261］</p>
</div>
<div class="paragraph">
<p>・割込み要求禁止フラグの振舞いを仕様と異なるものとするか［NGKI0261］</p>
</div>
<div class="paragraph">
<p>・割込み要求ラインのトリガモードの設定がサポートされているか［NGKI0267］</p>
</div>
<div class="paragraph">
<p>・割込み要求ラインをエッジトリガに設定する場合に，ポジティブエッジトリ
　ガかネガティブエッジトリガか両エッジトリガかを設定できるか［NGKI0265］</p>
</div>
<div class="paragraph">
<p>・割込み要求ラインをレベルトリガに設定する場合に，ローレベルトリガかハ
　イレベルトリガかを設定できるか［NGKI0266］</p>
</div>
<div class="paragraph">
<p>・あるプロセッサで割込み要求禁止フラグを動的にセット／クリアしても，他
　のプロセッサに対しては割込みがマスク／マスク解除されないものとするか
　〔M〕［NGKI0281］</p>
</div>
<div class="paragraph">
<p>・TMIN_INTPRIを固定するか設定できるようにするかと，設定できるようにする
　場合の設定方法［NGKI0288］</p>
</div>
<div class="paragraph">
<p>・NMI以外にカーネル管理外の割込みを設けるか（設けられるようにするか）
　［NGKI0289］</p>
</div>
<div class="paragraph">
<p>・カーネル管理外の割込みハンドラが実行開始される時のシステム状態とコン
　テキスト，割込みハンドラの終了時に行われる処理，割込みハンドラの記述
　方法［NGKI0292］</p>
</div>
<div class="paragraph">
<p>・カーネル管理外の割込みの設定方法として，3つの方法のいずれを採用するか
　［NGKI0295］</p>
</div>
<div class="paragraph">
<p>・カーネル管理外とされた割込みに対して，カーネルのAPIにより割込みハンド
　ラを登録できるかと，割込み要求ラインの属性を設定できるか［NGKI0297］</p>
</div>
<div class="paragraph">
<p>・CPU例外ハンドラ番号の付与方法［NGKI0306］</p>
</div>
<div class="paragraph">
<p>・発生したCPU例外に対して，CPU例外ハンドラを登録していない場合の振舞い
　［NGKI0314］</p>
</div>
<div class="paragraph">
<p>・メモリオブジェクトの先頭番地とサイズに対する制約〔P〕［NGKI0070］
　［NGKI2774］</p>
</div>
<div class="paragraph">
<p>・コンパイラが出力しないセクションの中で，どれを標準のセクションと扱う
　か〔P〕［NGKI0113］</p>
</div>
<div class="paragraph">
<p>・保護ドメイン毎の標準セクションのセクション名を，標準のセクション名と
　保護ドメイン名を"_"でつないだものとする仕様を変更するか〔P〕［NGKI0116］</p>
</div>
<div class="paragraph">
<p>・タスクのユーザスタック領域はそのタスク（とカーネルドメインに属する処
　理単位）のみがアクセスできるという仕様を変更するか〔P〕［NGKI0074］</p>
</div>
<div class="paragraph">
<p>・メモリオブジェクトに対して，通常のメモリアクセスにより，許可されてい
　ない書込みアクセスまたは読出しアクセス（実行アクセスを含む）を行おう
　とした場合に，どのCPU例外ハンドラが起動されるか〔P〕［NGKI0411］</p>
</div>
<div class="paragraph">
<p>・メモリオブジェクトに対して，サービスコールを通じて，許可されていない
　書込みアクセスまたは読出しアクセスを行おうとした場合に，サービスコー
　ルからE_MACVエラーが返るか，メモリアクセス違反ハンドラが起動されるか
　〔P〕［NGKI0413］</p>
</div>
<div class="paragraph">
<p>・メモリアクセス違反ハンドラで，アクセス違反を発生させたアクセスに関す
　る情報（アクセスした番地，アクセスの種別，アクセスした命令の番地など）
　を参照する方法〔P〕［NGKI0414］</p>
</div>
<div class="paragraph">
<p>・メモリオブジェクトの書込みアクセスと読出しアクセス（実行アクセスを含
　む）に対して設定できるアクセス許可パターンに対する制限〔P〕［NGKI0417］</p>
</div>
<div class="paragraph">
<p>・1つの保護ドメインに登録できるメモリオブジェクトの数に対する制限〔P〕
　［NGKI0423］</p>
</div>
<div class="paragraph">
<p>・ユーザスタック領域に対して実行アクセスを行えるか〔P〕［NGKI0440］</p>
</div>
<div class="paragraph">
<p>・タスクのユーザスタック領域を，そのタスクが属する保護ドメイン全体から
　アクセスできるものとするか〔P〕［NGKI0441］</p>
</div>
<div class="paragraph">
<p>・使用できるクラスのID番号とその属性〔M〕［NGKI0107］</p>
</div>
<div class="paragraph">
<p>・どのプロセッサをマスタプロセッサとするか〔M〕［NGKI0101］</p>
</div>
<div class="paragraph">
<p>・ローカルタイマ方式とグローバルタイマ方式のどちらの方式を用いることが
　できるか〔M〕［NGKI0108］</p>
</div>
<div class="paragraph">
<p>・グローバルタイマ方式の場合に，どのプロセッサをシステム時刻管理プロセッ
　サとするか〔M〕［NGKI0111］</p>
</div>
<div class="paragraph">
<p>・int8_t，uint8_t，int64_t，uint64_t，int128_t，uint128_t，float32_t，
　double64_tが使用できるか［NGKI0488］［NGKI0490］</p>
</div>
<div class="paragraph">
<p>・ターゲット定義のタスク属性［NGKI1016］</p>
</div>
<div class="paragraph">
<p>・タスクが用いるスタック領域のサイズの最小値［NGKI1042］</p>
</div>
<div class="paragraph">
<p>・タスクのシステムスタック領域のサイズの最小値〔P〕［NGKI1044］</p>
</div>
<div class="paragraph">
<p>・タスクが用いるスタック領域の先頭番地とサイズに対する制約［NGKI1050］
　［NGKI1056］</p>
</div>
<div class="paragraph">
<p>・ユーザスタックのスタック領域（ユーザスタック領域）をアプリケーション
　で確保する方法〔P〕［NGKI1059］</p>
</div>
<div class="paragraph">
<p>・タスクのシステムスタック領域の先頭番地とサイズに対する制約〔P〕
　［NGKI1062］［NGKI1065］［NGKI1070］</p>
</div>
<div class="paragraph">
<p>・データキュー管理領域の先頭番地に対する制約［NGKI1687］</p>
</div>
<div class="paragraph">
<p>・優先度データキュー管理領域の先頭番地に対する制約［NGKI1824］</p>
</div>
<div class="paragraph">
<p>・メッセージバッファ管理領域の先頭番地とサイズに対する制約［NGKI3319］
　［NGKI3324］</p>
</div>
<div class="paragraph">
<p>・生成できるスピンロックの数の上限〔M〕［NGKI2142］</p>
</div>
<div class="paragraph">
<p>・スピンロックに対して，複数のプロセッサがロックの取得を待っている時に，
　どのプロセッサが最初にロックを取得できるか〔M〕［NGKI2183］</p>
</div>
<div class="paragraph">
<p>・固定長メモリプール領域の先頭番地に対する制約［NGKI2249］</p>
</div>
<div class="paragraph">
<p>・固定長メモリプール管理領域の先頭番地に対する制約［NGKI2256］</p>
</div>
<div class="paragraph">
<p>・タイムティックの周期［NGKI2335］</p>
</div>
<div class="paragraph">
<p>・マルチプロセッサ対応カーネルにおける性能評価用システム時刻の扱い〔M〕
　［NGKI2346］</p>
</div>
<div class="paragraph">
<p>・get_utmがサポートされているか［NGKI2360］</p>
</div>
<div class="paragraph">
<p>・オーバランハンドラ機能がサポートされているか［NGKI2598］</p>
</div>
<div class="paragraph">
<p>・オーバランハンドラ機能のプロセッサ時間に指定できる値の上限［NGKI2594］</p>
</div>
<div class="paragraph">
<p>・ターゲット定義のメモリリージョン属性〔P〕</p>
</div>
<div class="paragraph">
<p>・メモリリージョンの先頭番地とサイズに対する制約〔P〕［NGKI2768］</p>
</div>
<div class="paragraph">
<p>・メモリオブジェクトに対するTA_NOWRITE属性，TA_NOREAD属性，TA_EXEC属性
　の内，どのような場合にどの属性の指定が無視されるか〔P〕［NGKI2782］</p>
</div>
<div class="paragraph">
<p>・ショートデータ領域がサポートされておらず，TA_SDATA属性が無視されるか
　〔P〕［NGKI2789］</p>
</div>
<div class="paragraph">
<p>・TA_NOWRITEを指定した場合に，TA_SDATAが無視されるか〔P〕［NGKI2790］</p>
</div>
<div class="paragraph">
<p>・TA_UNCACHE属性やTA_IODEV属性を指定しても意味がなく，これらの属性が無
　視されるか〔P〕［NGKI2792］</p>
</div>
<div class="paragraph">
<p>・キャッシュ禁止にできないメモリオブジェクトと周辺デバイスの領域として
　扱うことができないメモリオブジェクト〔P〕［NGKI2793］</p>
</div>
<div class="paragraph">
<p>・ターゲット定義のメモリオブジェクト属性〔P〕［NGKI2794］</p>
</div>
<div class="paragraph">
<p>・ATA_SECにより登録できるセクションが属する保護ドメインや登録できる数
　に対する制限〔P〕［NGKI2831］</p>
</div>
<div class="paragraph">
<p>・ATT_MOD／ATA_MODがサポートされているか〔P〕［NGKI2859］</p>
</div>
<div class="paragraph">
<p>・ATT_MOD／ATA_MODにより登録されるセクション毎のメモリオブジェクトに設
　定されるメモリオブジェクト属性〔P〕［NGKI2850］</p>
</div>
<div class="paragraph">
<p>・クラスの囲みの中に記述されたATT_MOD／ATA_MODにおいて，クラスの標準メ
　モリリージョンが定義されている場合でも，共通の標準メモリリージョンに
　配置されるセクション〔PM〕［NGKI3271］</p>
</div>
<div class="paragraph">
<p>・ATA_MODにより登録できるオブジェクトモジュールが属する保護ドメインや登
　録できる数に対する制限〔P〕［NGKI2857］</p>
</div>
<div class="paragraph">
<p>・ATT_MEM／ATA_MEMにより登録できるメモリオブジェクトが属する保護ドメイ
　ンや登録できる数に対する制限〔P〕［NGKI2878］</p>
</div>
<div class="paragraph">
<p>・ATT_MEM／ATA_MEM／att_memにより登録するメモリ領域の先頭番地とサイズに
　対する制約〔P〕［NGKI2880］</p>
</div>
<div class="paragraph">
<p>・ATT_PMA／ATA_PMA／att_pmaがサポートされているか〔P〕［NGKI2903］
　［HRPS0156］</p>
</div>
<div class="paragraph">
<p>・ATT_PMA／ATA_PMAにより登録できるメモリオブジェクトが属する保護ドメイ
　ンや登録できる数に対する制限〔P〕［NGKI2898］</p>
</div>
<div class="paragraph">
<p>・ATT_PMA／ATA_PMA／att_pmaにより登録するメモリ領域の先頭番地とサイズ，
　物理アドレス空間における先頭番地に対する制約〔P〕［NGKI2900］</p>
</div>
<div class="paragraph">
<p>・ターゲット定義の割込み要求ライン属性［NGKI2945］</p>
</div>
<div class="paragraph">
<p>・割込みハンドラ属性にTA_NONKERNELを指定できるか［NGKI2957］</p>
</div>
<div class="paragraph">
<p>・その他のターゲット定義の割込みハンドラ属性［NGKI2959］</p>
</div>
<div class="paragraph">
<p>・cfg_intにおいて，複数の割込み要求ラインの割込み優先度が連動して設定さ
　れるか〔D〕［NGKI2980］</p>
</div>
<div class="paragraph">
<p>・CFG_INT／cfg_intで，カーネル管理外の割込み要求ラインに対しても属性を
　設定できるか［NGKI2982］</p>
</div>
<div class="paragraph">
<p>・CFG_INT／cfg_intで，各割込み要求ラインに対して設定できる割込み要求ラ
　イン属性／割込み優先度に対する制限［NGKI2986］</p>
</div>
<div class="paragraph">
<p>・割込みサービスルーチンが属することができるクラスに対する制限〔M〕
　［NGKI3018］</p>
</div>
<div class="paragraph">
<p>・CRE_ISR／ATT_ISRにおいて，isrが不正である場合にE_PARエラーが検出され
　るか［NGKI3020］</p>
</div>
<div class="paragraph">
<p>・DEF_INH／def_inhで，カーネル管理外の割込みに対しても割込みハンドラを
　定義できるか［NGKI3064］</p>
</div>
<div class="paragraph">
<p>・カーネル管理外に固定されている割込みハンドラがあるか［NGKI3067］</p>
</div>
<div class="paragraph">
<p>・カーネル管理に固定されている割込みハンドラがあるか［NGKI3068］</p>
</div>
<div class="paragraph">
<p>・割込みハンドラが属することができるクラスに対する制限〔M〕［NGKI3074］</p>
</div>
<div class="paragraph">
<p>・def_inhで，静的APIで定義された割込みハンドラの定義を解除できるか〔D〕
　［NGKI3077］</p>
</div>
<div class="paragraph">
<p>・DEF_INH／def_inhで割込みハンドラを定義（または定義解除）できない割込
　みハンドラ番号［NGKI3078］</p>
</div>
<div class="paragraph">
<p>・def_inhを呼び出したタスクが割り付けられているプロセッサから定義（また
　は定義解除）できない割込みハンドラ〔M〕［NGKI3079］</p>
</div>
<div class="paragraph">
<p>・DEF_INHにおいて，inthdrが不正である場合にE_PARエラーが検出されるか
　［NGKI3080］</p>
</div>
<div class="paragraph">
<p>・dis_intがサポートされているか［NGKI3091］</p>
</div>
<div class="paragraph">
<p>・dis_intにより，どのような場合に割込み要求ラインの割込み要求禁止フラグ
　をセットできないか［NGKI3087］</p>
</div>
<div class="paragraph">
<p>・dis_intにおいて，割込み要求禁止フラグの振舞いが，この仕様の規定と異な
　るか［NGKI3089］</p>
</div>
<div class="paragraph">
<p>・ena_intがサポートされているか［NGKI3104］</p>
</div>
<div class="paragraph">
<p>・ena_intにより，どのような場合に割込み要求ラインの割込み要求禁止フラグ
　をクリアできないか［NGKI3100］</p>
</div>
<div class="paragraph">
<p>・ena_intにおいて，割込み要求禁止フラグの振舞いが，この仕様の規定と異な
　るか［NGKI3102］</p>
</div>
<div class="paragraph">
<p>・chg_ipmにより，割込み優先度マスクをTMIN_INTPRIよりも小さい値に変更で
　きるか［NGKI3114］</p>
</div>
<div class="paragraph">
<p>・ターゲット定義のCPU例外ハンドラ属性［NGKI3123］</p>
</div>
<div class="paragraph">
<p>・def_excで，静的APIで定義されたCPU例外ハンドラの定義を解除できるか〔D〕
　［NGKI3148］</p>
</div>
<div class="paragraph">
<p>・DEF_EXCにおいて，exchdrが不正である場合にE_PARエラーが検出されるか
　［NGKI3149］</p>
</div>
<div class="paragraph">
<p>・非タスクコンテキスト用スタック領域のサイズの最小値［NGKI3254］</p>
</div>
<div class="paragraph">
<p>・非タスクコンテキスト用スタック領域の先頭番地とサイズに対する制約
　［NGKI3220］［NGKI3222］</p>
</div>
<div class="paragraph">
<p>・DEF_ICSにより非タスクコンテキスト用スタック領域を設定しない場合の，非
　タスクコンテキスト用スタック領域のデフォルトのサイズ［NGKI3224］</p>
</div>
<div class="paragraph">
<p>・共有スタック領域のサイズの最小値［NGKI3255］</p>
</div>
<div class="paragraph">
<p>・共有スタック領域の先頭番地とサイズに対する制約［NGKI3234］［NGKI3236］</p>
</div>
<div class="paragraph">
<p>・ATT_INIにおいて，inirtnが不正である場合にE_PARエラーが検出されるか
　［NGKI3246］</p>
</div>
<div class="paragraph">
<p>・ATT_TERにおいて，terrtnが不正である場合にE_PARエラーが検出されるか
　［NGKI3253］</p>
</div>
</div>
<div class="sect2">
<h3 id="_省略名の元になった英語">5.10. 省略名の元になった英語</h3>
<div class="sect3">
<h4 id="_サービスコールと静的apiの名称の中のxxxの元になった英語">5.10.1. サービスコールと静的APIの名称の中のxxxの元になった英語</h4>
<div class="literalblock">
<div class="content">
<pre>xxx		元になった英語
----------------------
act		activate
aid		automatically assigned ID
ata		attach with access control vector
att		attach
cal		call
can		cancel
cfg		configure
chg		change
clr		clear
cre		create
def		define
del		delete
det		detach
dis		disable
dly		delay
ena		enable
epr		execution priority
ext		exit
get		get
ini		initialize
lmt		limit
lnk		link
loc		lock
mig		migrate
pol		poll
prb		probe
ras		raise
rcv		receive
ref		reference
rel		release
rot		rotate
rsm		resume
sac		set access control vector
set		set
sig		signal
slp		sleep
snd		send
sns		sense
sta		start
stp		stop
sus		suspend
ter		terminate
try		try
unl		unlock
wai		wait
wup		wake up</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_サービスコールと静的apiの名称の中のyyy_の元になった英語">5.10.2. サービスコールと静的APIの名称の中のyyy の元になった英語</h4>
<div class="literalblock">
<div class="content">
<pre>yyy		元になった英語
----------------------
act		activation
alm		alarm handler
cfg		configuration
cpu		CPU
ctx		context
cyc		cyclic handler
did		domain ID
dom		domain
dpn		dispatch pending
dsp		dispatch
dtq		data queue
exc		exception
flg		eventflag
ics		interrupt context stack
inf		information
inh		interrupt handler
ini		initilization
int		interrupt
ipm		interrupt priority mask
isr		interrupt service routine
ker		kernel
loc		lock
mbf		message buffer
mbx		mailbox
mpf		fixed-sized memory pool
mem		memory
mod		module
mtx		mutex
ovr		overrun handler
pdq		priority data queue
pid		processor ID
pma		physical memory area
pri		priority
rdq		ready queue
reg		region
sec		section
sem		semaphore
srg		standard memory region
spn		spin lock
stk		stack
sys		system
svc		service call
ter		termination
tex		task exception
tid		task ID
tim		time
tsk		task
utm		time in micro second
ver		version
wai		wait
wup		wake up
xpn		exception pending</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_サービスコールの名称の中のzの元になった英語">5.10.3. サービスコールの名称の中のzの元になった英語</h4>
<div class="literalblock">
<div class="content">
<pre>z		元になった英語
----------------------
a		automatic ID assignment
f		force
i		interrupt
m		multiprocessor
p		poll
t		timeout
x		exception</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_バージョン履歴">5.11. バージョン履歴</h3>
<div class="literalblock">
<div class="content">
<pre>2008年11月19日	Release 1.0.0		最初のリリース
2009年5月8日	Release 1.1.0		FMPカーネルに関する記述が完成
2010年5月10日	Release 1.2.0
2011年5月5日	Release 1.3.0		HRP2カーネルに関する記述が完成
2012年5月16日	Release 1.4.0		SSPカーネルに関する記述が完成
2012年12月19日	Release 1.5.0		HRP2カーネルの仕様変更を反映
2014年1月16日	Release 1.6.0
2014年11月17日	Release 1.7.0
2015年5月30日	Release 1.7.1</pre>
</div>
</div>
<div class="paragraph">
<p>以上</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-07-20 01:21:51 UTC
</div>
</div>
</body>
</html>